<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PX4 Firmware: src/lib/ecl/l1/ecl_l1_pos_controller.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PX4 Firmware
   </div>
   <div id="projectbrief">PX4 Autopilot Software http://px4.io</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/db7/ecl__l1__pos__controller_8cpp_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ecl_l1_pos_controller.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d1/db7/ecl__l1__pos__controller_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/****************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *   Copyright (c) 2013 Estimation and Control Library (ECL). All rights reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * are met:</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * 1. Redistributions of source code must retain the above copyright</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer in</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *    the documentation and/or other materials provided with the</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *    distribution.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * 3. Neither the name ECL nor the names of its contributors may be</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *    used to endorse or promote products derived from this software</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *    without specific prior written permission.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> ****************************************************************************/</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * @file ecl_l1_pos_controller.h</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * Implementation of L1 position control.</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * Authors and acknowledgements in header.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;float.h&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dfb/ecl__l1__pos__controller_8h.html">ecl_l1_pos_controller.h</a>&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">matrix::Vector2f</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">using</span> <a class="code" href="../../d0/de4/namespacematrix.html#ad36650ba691474397ef7ba79da6d3782">matrix::wrap_pi</a>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#adcbf0ee88d4daf62942f15100a689af3">   49</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#adcbf0ee88d4daf62942f15100a689af3">ECL_L1_Pos_Controller::update_roll_setpoint</a>()</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">float</span> roll_new = atanf(<a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab11afb9e61754f5cc8e96350f78006ae">_lateral_accel</a> * 1.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a> / <a class="code" href="../../db/d35/geo_8h.html#a32a64125a796fad5c13297499d50b082">CONSTANTS_ONE_G</a>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    roll_new = <a class="code" href="../../dd/d47/namespacemath.html#a4a49a65edaf29055a3cb021908a031d7">math::constrain</a>(roll_new, -<a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ad7772e30a5a46aa11704974abc316be3">_roll_lim_rad</a>, <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ad7772e30a5a46aa11704974abc316be3">_roll_lim_rad</a>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a6d2ed6790aa3266f420fda34fbb5af35">_dt</a> &gt; 0.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a> &amp;&amp; <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a35ba63bfb0a0aaee18a6a31b372e3a03">_roll_slew_rate</a> &gt; 0.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>) {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="comment">// slew rate limiting active</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        roll_new = <a class="code" href="../../dd/d47/namespacemath.html#a4a49a65edaf29055a3cb021908a031d7">math::constrain</a>(roll_new, <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0d7cdc949544aed07fe09082f6b26dfd">_roll_setpoint</a> - <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a35ba63bfb0a0aaee18a6a31b372e3a03">_roll_slew_rate</a> * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a6d2ed6790aa3266f420fda34fbb5af35">_dt</a>, <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0d7cdc949544aed07fe09082f6b26dfd">_roll_setpoint</a> + <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a35ba63bfb0a0aaee18a6a31b372e3a03">_roll_slew_rate</a> * _dt);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d2/d53/ecl_8h.html#a5181155e284a192217ea7e0ea70bb810">ISFINITE</a>(roll_new)) {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0d7cdc949544aed07fe09082f6b26dfd">_roll_setpoint</a> = roll_new;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ac11b87b276fae1e9a0d2b887ecbf9ccd">   65</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ac11b87b276fae1e9a0d2b887ecbf9ccd">ECL_L1_Pos_Controller::switch_distance</a>(<span class="keywordtype">float</span> wp_radius)</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">/* following [2], switching on L1 distance */</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dd/d47/namespacemath.html#a0590ec5bbbdad228b5a47307af425055">math::min</a>(wp_radius, <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab140bdbf54dfb9b452df75483048aff4">_L1_distance</a>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a4812a285e3309e23e33f86f5cb86cf78">   72</a></span>&#160;<a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a4812a285e3309e23e33f86f5cb86cf78">ECL_L1_Pos_Controller::navigate_waypoints</a>(<span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;vector_A, <span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;vector_B,</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;vector_curr_position, <span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;ground_speed_vector)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">/* this follows the logic presented in [1] */</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordtype">float</span> eta = 0.0f;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">float</span> xtrack_vel = 0.0f;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">float</span> ltrack_vel = 0.0f;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">/* get the direction between the last (visited) and next waypoint */</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af3ba2f227a0db76fdd1014325477758b">_target_bearing</a> = <a class="code" href="../../d7/d09/geo_8cpp.html#a71a3f1dd74077ca88d95a943768c728b">get_bearing_to_next_waypoint</a>((<span class="keywordtype">double</span>)vector_curr_position(0), (<span class="keywordtype">double</span>)vector_curr_position(1), (<span class="keywordtype">double</span>)vector_B(0), (<span class="keywordtype">double</span>)vector_B(1));</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">/* enforce a minimum ground speed of 0.1 m/s to avoid singularities */</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">float</span> ground_speed = <a class="code" href="../../dd/d47/namespacemath.html#ad42187b143e9e0e96bb14c7edcfbfef6">math::max</a>(ground_speed_vector.length(), 0.1f);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">/* calculate the L1 length required for the desired period */</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab140bdbf54dfb9b452df75483048aff4">_L1_distance</a> = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#aba118cbd8de4dca801aa448400479b3c">_L1_ratio</a> * ground_speed;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">/* calculate vector from A to B */</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> vector_AB = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">get_local_planar_vector</a>(vector_A, vector_B);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">     * check if waypoints are on top of each other. If yes,</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">     * skip A and directly continue to B</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">if</span> (vector_AB.length() &lt; 1.0e-6<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>) {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        vector_AB = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">get_local_planar_vector</a>(vector_curr_position, vector_B);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    vector_AB.normalize();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">/* calculate the vector from waypoint A to the aircraft */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> vector_A_to_airplane = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">get_local_planar_vector</a>(vector_A, vector_curr_position);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">/* calculate crosstrack error (output only) */</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0c20f9987cb970fb4a189e44143a5a19">_crosstrack_error</a> = vector_AB % vector_A_to_airplane;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">     * If the current position is in a +-135 degree angle behind waypoint A</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">     * and further away from A than the L1 distance, then A becomes the L1 point.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">     * If the aircraft is already between A and B normal L1 logic is applied.</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">float</span> distance_A_to_airplane = vector_A_to_airplane.length();</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">float</span> alongTrackDist = vector_A_to_airplane * vector_AB;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">/* estimate airplane position WRT to B */</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> vector_B_to_P_unit = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">get_local_planar_vector</a>(vector_B, vector_curr_position).<a class="code" href="../../d1/d71/classmatrix_1_1_vector.html#aaed6e2f480ce5d7031d1547e05f8fe76">normalized</a>();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">/* calculate angle of airplane position vector relative to line) */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// XXX this could probably also be based solely on the dot product</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">float</span> AB_to_BP_bearing = atan2f(vector_B_to_P_unit % vector_AB, vector_B_to_P_unit * vector_AB);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">/* extension from [2], fly directly to A */</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span> (distance_A_to_airplane &gt; _L1_distance &amp;&amp; alongTrackDist / <a class="code" href="../../dd/d47/namespacemath.html#ad42187b143e9e0e96bb14c7edcfbfef6">math::max</a>(distance_A_to_airplane, 1.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>) &lt; -0.7071<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>) {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">/* calculate eta to fly to waypoint A */</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="comment">/* unit vector from waypoint A to current position */</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> vector_A_to_airplane_unit = vector_A_to_airplane.normalized();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">/* velocity across / orthogonal to line */</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        xtrack_vel = ground_speed_vector % (-vector_A_to_airplane_unit);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment">/* velocity along line */</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        ltrack_vel = ground_speed_vector * (-vector_A_to_airplane_unit);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        eta = atan2f(xtrack_vel, ltrack_vel);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="comment">/* bearing from current position to L1 point */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">_nav_bearing</a> = atan2f(-vector_A_to_airplane_unit(1), -vector_A_to_airplane_unit(0));</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">         * If the AB vector and the vector from B to airplane point in the same</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">         * direction, we have missed the waypoint. At +- 90 degrees we are just passing it.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabsf(AB_to_BP_bearing) &lt; <a class="code" href="../../dd/d47/namespacemath.html#a7e34369248d5d1565073dc552dd90d5c">math::radians</a>(100.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>)) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">         * Extension, fly back to waypoint.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">         *</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">         * This corner case is possible if the system was following</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">         * the AB line from waypoint A to waypoint B, then is</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">         * switched to manual mode (or otherwise misses the waypoint)</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">         * and behind the waypoint continues to follow the AB line.</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">/* calculate eta to fly to waypoint B */</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">/* velocity across / orthogonal to line */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        xtrack_vel = ground_speed_vector % (-vector_B_to_P_unit);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">/* velocity along line */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        ltrack_vel = ground_speed_vector * (-vector_B_to_P_unit);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        eta = atan2f(xtrack_vel, ltrack_vel);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">/* bearing from current position to L1 point */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">_nav_bearing</a> = atan2f(-vector_B_to_P_unit(1), -vector_B_to_P_unit(0));</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="comment">/* calculate eta to fly along the line between A and B */</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">/* velocity across / orthogonal to line */</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        xtrack_vel = ground_speed_vector % vector_AB;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="comment">/* velocity along line */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        ltrack_vel = ground_speed_vector * vector_AB;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">/* calculate eta2 (angle of velocity vector relative to line) */</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordtype">float</span> eta2 = atan2f(xtrack_vel, ltrack_vel);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">/* calculate eta1 (angle to L1 point) */</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordtype">float</span> xtrackErr = vector_A_to_airplane % vector_AB;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordtype">float</span> sine_eta1 = xtrackErr / <a class="code" href="../../dd/d47/namespacemath.html#ad42187b143e9e0e96bb14c7edcfbfef6">math::max</a>(_L1_distance, 0.1<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment">/* limit output to 45 degrees */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        sine_eta1 = <a class="code" href="../../dd/d47/namespacemath.html#a4a49a65edaf29055a3cb021908a031d7">math::constrain</a>(sine_eta1, -0.7071<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>, 0.7071<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>); <span class="comment">//sin(pi/4) = 0.7071</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordtype">float</span> eta1 = asinf(sine_eta1);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        eta = eta1 + eta2;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">/* bearing from current position to L1 point */</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">_nav_bearing</a> = atan2f(vector_AB(1), vector_AB(0)) + eta1;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">/* limit angle to +-90 degrees */</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    eta = <a class="code" href="../../dd/d47/namespacemath.html#a4a49a65edaf29055a3cb021908a031d7">math::constrain</a>(eta, (-<a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a>) / 2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>, +<a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> / 2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab11afb9e61754f5cc8e96350f78006ae">_lateral_accel</a> = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a24992dd0d188e8751b2e50de55e6ff0f">_K_L1</a> * ground_speed * ground_speed / _L1_distance * sinf(eta);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">/* flying to waypoints, not circling them */</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a32d0cf6f80bd6bc9f4908de53dfaf2d0">_circle_mode</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* the bearing angle, in NED frame */</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a99c88ba7aed40cd31eab144e8f3ac029">_bearing_error</a> = eta;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#adcbf0ee88d4daf62942f15100a689af3">update_roll_setpoint</a>();</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab402b69cd3a6053795e90d83a84c0da3">  200</a></span>&#160;<a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab402b69cd3a6053795e90d83a84c0da3">ECL_L1_Pos_Controller::navigate_loiter</a>(<span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;vector_A, <span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;vector_curr_position, <span class="keywordtype">float</span> radius,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                       int8_t loiter_direction, <span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;ground_speed_vector)</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;{</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">/* the complete guidance logic in this section was proposed by [2] */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">/* calculate the gains for the PD loop (circle tracking) */</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">float</span> omega = (2.0f * <a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> / <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a618c4443b778abce4563f46528e58fce">_L1_period</a>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordtype">float</span> K_crosstrack = omega * omega;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordtype">float</span> K_velocity = 2.0f * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab8e680d1d0c70dd4a50598ad261108a9">_L1_damping</a> * omega;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">/* update bearing to next waypoint */</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af3ba2f227a0db76fdd1014325477758b">_target_bearing</a> = <a class="code" href="../../d7/d09/geo_8cpp.html#a71a3f1dd74077ca88d95a943768c728b">get_bearing_to_next_waypoint</a>((<span class="keywordtype">double</span>)vector_curr_position(0), (<span class="keywordtype">double</span>)vector_curr_position(1), (<span class="keywordtype">double</span>)vector_A(0), (<span class="keywordtype">double</span>)vector_A(1));</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">/* ground speed, enforce minimum of 0.1 m/s to avoid singularities */</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">float</span> ground_speed = <a class="code" href="../../dd/d47/namespacemath.html#ad42187b143e9e0e96bb14c7edcfbfef6">math::max</a>(ground_speed_vector.length(), 0.1f);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">/* calculate the L1 length required for the desired period */</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab140bdbf54dfb9b452df75483048aff4">_L1_distance</a> = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#aba118cbd8de4dca801aa448400479b3c">_L1_ratio</a> * ground_speed;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">/* calculate the vector from waypoint A to current position */</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> vector_A_to_airplane = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">get_local_planar_vector</a>(vector_A, vector_curr_position);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> vector_A_to_airplane_unit;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">/* prevent NaN when normalizing */</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">if</span> (vector_A_to_airplane.length() &gt; <a class="code" href="../../db/de5/stdlib__imports_8hpp.html#aafe5d2c4dc0edd9840f20e885dcae6ad">FLT_EPSILON</a>) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment">/* store the normalized vector from waypoint A to current position */</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        vector_A_to_airplane_unit = vector_A_to_airplane.normalized();</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        vector_A_to_airplane_unit = vector_A_to_airplane;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">/* calculate eta angle towards the loiter center */</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">/* velocity across / orthogonal to line from waypoint to current position */</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordtype">float</span> xtrack_vel_center = vector_A_to_airplane_unit % ground_speed_vector;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">/* velocity along line from waypoint to current position */</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">float</span> ltrack_vel_center = - (ground_speed_vector * vector_A_to_airplane_unit);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordtype">float</span> eta = atan2f(xtrack_vel_center, ltrack_vel_center);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="comment">/* limit eta to 90 degrees */</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    eta = <a class="code" href="../../dd/d47/namespacemath.html#a4a49a65edaf29055a3cb021908a031d7">math::constrain</a>(eta, -<a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> / 2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>, +<a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> / 2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">/* calculate the lateral acceleration to capture the center point */</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">float</span> lateral_accel_sp_center = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a24992dd0d188e8751b2e50de55e6ff0f">_K_L1</a> * ground_speed * ground_speed / _L1_distance * sinf(eta);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="comment">/* for PD control: Calculate radial position and velocity errors */</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">/* radial velocity error */</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordtype">float</span> xtrack_vel_circle = -ltrack_vel_center;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">/* radial distance from the loiter circle (not center) */</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">float</span> xtrack_err_circle = vector_A_to_airplane.length() - radius;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">/* cross track error for feedback */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0c20f9987cb970fb4a189e44143a5a19">_crosstrack_error</a> = xtrack_err_circle;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="comment">/* calculate PD update to circle waypoint */</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordtype">float</span> lateral_accel_sp_circle_pd = (xtrack_err_circle * K_crosstrack + xtrack_vel_circle * K_velocity);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="comment">/* calculate velocity on circle / along tangent */</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">float</span> tangent_vel = xtrack_vel_center * loiter_direction;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">/* prevent PD output from turning the wrong way */</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">if</span> (tangent_vel &lt; 0.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>) {</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        lateral_accel_sp_circle_pd = <a class="code" href="../../dd/d47/namespacemath.html#ad42187b143e9e0e96bb14c7edcfbfef6">math::max</a>(lateral_accel_sp_circle_pd, 0.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">/* calculate centripetal acceleration setpoint */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">float</span> lateral_accel_sp_circle_centripetal = tangent_vel * tangent_vel / <a class="code" href="../../dd/d47/namespacemath.html#ad42187b143e9e0e96bb14c7edcfbfef6">math::max</a>((0.5<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a> * radius),</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            (radius + xtrack_err_circle));</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">/* add PD control on circle and centripetal acceleration for total circle command */</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordtype">float</span> lateral_accel_sp_circle = loiter_direction * (lateral_accel_sp_circle_pd + lateral_accel_sp_circle_centripetal);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">     * Switch between circle (loiter) and capture (towards waypoint center) mode when</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">     * the commands switch over. Only fly towards waypoint if outside the circle.</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// XXX check switch over</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">if</span> ((lateral_accel_sp_center &lt; lateral_accel_sp_circle &amp;&amp; loiter_direction &gt; 0 &amp;&amp; xtrack_err_circle &gt; 0.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>) ||</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        (lateral_accel_sp_center &gt; lateral_accel_sp_circle &amp;&amp; loiter_direction &lt; 0 &amp;&amp; xtrack_err_circle &gt; 0.0f)) {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab11afb9e61754f5cc8e96350f78006ae">_lateral_accel</a> = lateral_accel_sp_center;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a32d0cf6f80bd6bc9f4908de53dfaf2d0">_circle_mode</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="comment">/* angle between requested and current velocity vector */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a99c88ba7aed40cd31eab144e8f3ac029">_bearing_error</a> = eta;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">/* bearing from current position to L1 point */</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">_nav_bearing</a> = atan2f(-vector_A_to_airplane_unit(1), -vector_A_to_airplane_unit(0));</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab11afb9e61754f5cc8e96350f78006ae">_lateral_accel</a> = lateral_accel_sp_circle;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a32d0cf6f80bd6bc9f4908de53dfaf2d0">_circle_mode</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a99c88ba7aed40cd31eab144e8f3ac029">_bearing_error</a> = 0.0f;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">/* bearing from current position to L1 point */</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">_nav_bearing</a> = atan2f(-vector_A_to_airplane_unit(1), -vector_A_to_airplane_unit(0));</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#adcbf0ee88d4daf62942f15100a689af3">update_roll_setpoint</a>();</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;}</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a7567fdc1eb3b4bdaf0d8d6ef2ec509ab">  300</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a7567fdc1eb3b4bdaf0d8d6ef2ec509ab">ECL_L1_Pos_Controller::navigate_heading</a>(<span class="keywordtype">float</span> navigation_heading, <span class="keywordtype">float</span> current_heading,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;ground_speed_vector)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;{</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">/* the complete guidance logic in this section was proposed by [2] */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">     * As the commanded heading is the only reference</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">     * (and no crosstrack correction occurs),</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">     * target and navigation bearing become the same</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af3ba2f227a0db76fdd1014325477758b">_target_bearing</a> = <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">_nav_bearing</a> = <a class="code" href="../../d0/de4/namespacematrix.html#ad36650ba691474397ef7ba79da6d3782">wrap_pi</a>(navigation_heading);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">float</span> eta = <a class="code" href="../../d0/de4/namespacematrix.html#ad36650ba691474397ef7ba79da6d3782">wrap_pi</a>(<a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af3ba2f227a0db76fdd1014325477758b">_target_bearing</a> - <a class="code" href="../../d0/de4/namespacematrix.html#ad36650ba691474397ef7ba79da6d3782">wrap_pi</a>(current_heading));</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">/* consequently the bearing error is exactly eta: */</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a99c88ba7aed40cd31eab144e8f3ac029">_bearing_error</a> = eta;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">/* ground speed is the length of the ground speed vector */</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">float</span> ground_speed = ground_speed_vector.length();</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">/* adjust L1 distance to keep constant frequency */</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab140bdbf54dfb9b452df75483048aff4">_L1_distance</a> = ground_speed / <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ac5420343fe85896df5bed1090ab85bc2">_heading_omega</a>;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordtype">float</span> omega_vel = ground_speed * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ac5420343fe85896df5bed1090ab85bc2">_heading_omega</a>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">/* not circling a waypoint */</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a32d0cf6f80bd6bc9f4908de53dfaf2d0">_circle_mode</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">/* navigating heading means by definition no crosstrack error */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0c20f9987cb970fb4a189e44143a5a19">_crosstrack_error</a> = 0;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">/* limit eta to 90 degrees */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    eta = <a class="code" href="../../dd/d47/namespacemath.html#a4a49a65edaf29055a3cb021908a031d7">math::constrain</a>(eta, (-<a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a>) / 2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>, +<a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> / 2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab11afb9e61754f5cc8e96350f78006ae">_lateral_accel</a> = 2.0f * sinf(eta) * omega_vel;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#adcbf0ee88d4daf62942f15100a689af3">update_roll_setpoint</a>();</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a5526936756605515a35f2b31902a6152">  337</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a5526936756605515a35f2b31902a6152">ECL_L1_Pos_Controller::navigate_level_flight</a>(<span class="keywordtype">float</span> current_heading)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;{</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">/* the logic in this section is trivial, but originally proposed by [2] */</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">/* reset all heading / error measures resulting in zero roll */</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af3ba2f227a0db76fdd1014325477758b">_target_bearing</a> = current_heading;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">_nav_bearing</a> = current_heading;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a99c88ba7aed40cd31eab144e8f3ac029">_bearing_error</a> = 0;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0c20f9987cb970fb4a189e44143a5a19">_crosstrack_error</a> = 0;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab11afb9e61754f5cc8e96350f78006ae">_lateral_accel</a> = 0;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">/* not circling a waypoint when flying level */</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a32d0cf6f80bd6bc9f4908de53dfaf2d0">_circle_mode</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#adcbf0ee88d4daf62942f15100a689af3">update_roll_setpoint</a>();</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">  354</a></span>&#160;<a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">ECL_L1_Pos_Controller::get_local_planar_vector</a>(<span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;origin, <span class="keyword">const</span> <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> &amp;target)<span class="keyword"> const</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">/* this is an approximation for small angles, proposed by [2] */</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">Vector2f</a> out(<a class="code" href="../../dd/d47/namespacemath.html#a7e34369248d5d1565073dc552dd90d5c">math::radians</a>((target(0) - origin(0))),</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;             <a class="code" href="../../dd/d47/namespacemath.html#a7e34369248d5d1565073dc552dd90d5c">math::radians</a>((target(1) - origin(1))*cosf(<a class="code" href="../../dd/d47/namespacemath.html#a7e34369248d5d1565073dc552dd90d5c">math::radians</a>(origin(0)))));</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordflow">return</span> out * <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(<a class="code" href="../../db/d35/geo_8h.html#aa7ad3d7dc84fcc6b91654bb9a736dfee">CONSTANTS_RADIUS_OF_EARTH</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab449fa4dc6e9feb1fd69eef9215559ee">  363</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab449fa4dc6e9feb1fd69eef9215559ee">ECL_L1_Pos_Controller::set_l1_period</a>(<span class="keywordtype">float</span> period)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;{</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a618c4443b778abce4563f46528e58fce">_L1_period</a> = period;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">/* calculate the ratio introduced in [2] */</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#aba118cbd8de4dca801aa448400479b3c">_L1_ratio</a> = 1.0f / <a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab8e680d1d0c70dd4a50598ad261108a9">_L1_damping</a> * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a618c4443b778abce4563f46528e58fce">_L1_period</a>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">/* calculate normalized frequency for heading tracking */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ac5420343fe85896df5bed1090ab85bc2">_heading_omega</a> = sqrtf(2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a>) * <a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> / <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a618c4443b778abce4563f46528e58fce">_L1_period</a>;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;}</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno"><a class="line" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a2a25fd4f58af2b9b0f696081a1f47201">  374</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a2a25fd4f58af2b9b0f696081a1f47201">ECL_L1_Pos_Controller::set_l1_damping</a>(<span class="keywordtype">float</span> damping)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;{</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab8e680d1d0c70dd4a50598ad261108a9">_L1_damping</a> = damping;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">/* calculate the ratio introduced in [2] */</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#aba118cbd8de4dca801aa448400479b3c">_L1_ratio</a> = 1.0f / <a class="code" href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a> * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab8e680d1d0c70dd4a50598ad261108a9">_L1_damping</a> * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a618c4443b778abce4563f46528e58fce">_L1_period</a>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">/* calculate the L1 gain (following [2]) */</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a24992dd0d188e8751b2e50de55e6ff0f">_K_L1</a> = 4.0f * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab8e680d1d0c70dd4a50598ad261108a9">_L1_damping</a> * <a class="code" href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab8e680d1d0c70dd4a50598ad261108a9">_L1_damping</a>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div><div class="ttc" id="namespacemath_html_a4a49a65edaf29055a3cb021908a031d7"><div class="ttname"><a href="../../dd/d47/namespacemath.html#a4a49a65edaf29055a3cb021908a031d7">math::constrain</a></div><div class="ttdeci">constexpr _Tp constrain(_Tp val, _Tp min_val, _Tp max_val)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d34/_limits_8hpp_source.html#l00066">Limits.hpp:66</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a2a25fd4f58af2b9b0f696081a1f47201"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a2a25fd4f58af2b9b0f696081a1f47201">ECL_L1_Pos_Controller::set_l1_damping</a></div><div class="ttdeci">void set_l1_damping(float damping)</div><div class="ttdoc">Set the L1 damping factor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00374">ecl_l1_pos_controller.cpp:374</a></div></div>
<div class="ttc" id="geo_8h_html_aa7ad3d7dc84fcc6b91654bb9a736dfee"><div class="ttname"><a href="../../db/d35/geo_8h.html#aa7ad3d7dc84fcc6b91654bb9a736dfee">CONSTANTS_RADIUS_OF_EARTH</a></div><div class="ttdeci">static constexpr double CONSTANTS_RADIUS_OF_EARTH</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/geo_8h_source.html#l00061">geo.h:61</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a6d2ed6790aa3266f420fda34fbb5af35"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a6d2ed6790aa3266f420fda34fbb5af35">ECL_L1_Pos_Controller::_dt</a></div><div class="ttdeci">float _dt</div><div class="ttdoc">control loop time in seconds </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00227">ecl_l1_pos_controller.h:227</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a35ba63bfb0a0aaee18a6a31b372e3a03"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a35ba63bfb0a0aaee18a6a31b372e3a03">ECL_L1_Pos_Controller::_roll_slew_rate</a></div><div class="ttdeci">float _roll_slew_rate</div><div class="ttdoc">roll angle setpoint slew rate limit in rad/s </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00226">ecl_l1_pos_controller.h:226</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a24992dd0d188e8751b2e50de55e6ff0f"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a24992dd0d188e8751b2e50de55e6ff0f">ECL_L1_Pos_Controller::_K_L1</a></div><div class="ttdeci">float _K_L1</div><div class="ttdoc">L1 control gain for _L1_damping. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00221">ecl_l1_pos_controller.h:221</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a32d0cf6f80bd6bc9f4908de53dfaf2d0"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a32d0cf6f80bd6bc9f4908de53dfaf2d0">ECL_L1_Pos_Controller::_circle_mode</a></div><div class="ttdeci">bool _circle_mode</div><div class="ttdoc">flag for loiter mode </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00212">ecl_l1_pos_controller.h:212</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ac11b87b276fae1e9a0d2b887ecbf9ccd"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ac11b87b276fae1e9a0d2b887ecbf9ccd">ECL_L1_Pos_Controller::switch_distance</a></div><div class="ttdeci">float switch_distance(float waypoint_switch_radius)</div><div class="ttdoc">Get the switch distance. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00065">ecl_l1_pos_controller.cpp:65</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_adcbf0ee88d4daf62942f15100a689af3"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#adcbf0ee88d4daf62942f15100a689af3">ECL_L1_Pos_Controller::update_roll_setpoint</a></div><div class="ttdeci">void update_roll_setpoint()</div><div class="ttdoc">Update roll angle setpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00049">ecl_l1_pos_controller.cpp:49</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_af3ba2f227a0db76fdd1014325477758b"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af3ba2f227a0db76fdd1014325477758b">ECL_L1_Pos_Controller::_target_bearing</a></div><div class="ttdeci">float _target_bearing</div><div class="ttdoc">the heading setpoint </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00216">ecl_l1_pos_controller.h:216</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ab402b69cd3a6053795e90d83a84c0da3"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab402b69cd3a6053795e90d83a84c0da3">ECL_L1_Pos_Controller::navigate_loiter</a></div><div class="ttdeci">void navigate_loiter(const matrix::Vector2f &amp;vector_A, const matrix::Vector2f &amp;vector_curr_position, float radius, int8_t loiter_direction, const matrix::Vector2f &amp;ground_speed_vector)</div><div class="ttdoc">Navigate on an orbit around a loiter waypoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00200">ecl_l1_pos_controller.cpp:200</a></div></div>
<div class="ttc" id="stdlib__imports_8hpp_html_aafe5d2c4dc0edd9840f20e885dcae6ad"><div class="ttname"><a href="../../db/de5/stdlib__imports_8hpp.html#aafe5d2c4dc0edd9840f20e885dcae6ad">FLT_EPSILON</a></div><div class="ttdeci">#define FLT_EPSILON</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de5/stdlib__imports_8hpp_source.html#l00026">stdlib_imports.hpp:26</a></div></div>
<div class="ttc" id="geo_8h_html_a32a64125a796fad5c13297499d50b082"><div class="ttname"><a href="../../db/d35/geo_8h.html#a32a64125a796fad5c13297499d50b082">CONSTANTS_ONE_G</a></div><div class="ttdeci">static constexpr float CONSTANTS_ONE_G</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/geo_8h_source.html#l00051">geo.h:51</a></div></div>
<div class="ttc" id="ecl__l1__pos__controller_8h_html"><div class="ttname"><a href="../../d0/dfb/ecl__l1__pos__controller_8h.html">ecl_l1_pos_controller.h</a></div><div class="ttdoc">Implementation of L1 position control. </div></div>
<div class="ttc" id="classmatrix_1_1_vector_html_aaed6e2f480ce5d7031d1547e05f8fe76"><div class="ttname"><a href="../../d1/d71/classmatrix_1_1_vector.html#aaed6e2f480ce5d7031d1547e05f8fe76">matrix::Vector::normalized</a></div><div class="ttdeci">Vector normalized() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d20/_vector_8hpp_source.html#l00103">Vector.hpp:103</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a555c0cbc02a81f8df7cd18dfc5388fb2"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a555c0cbc02a81f8df7cd18dfc5388fb2">ECL_L1_Pos_Controller::_nav_bearing</a></div><div class="ttdeci">float _nav_bearing</div><div class="ttdoc">bearing to L1 reference point </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00213">ecl_l1_pos_controller.h:213</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_aba118cbd8de4dca801aa448400479b3c"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#aba118cbd8de4dca801aa448400479b3c">ECL_L1_Pos_Controller::_L1_ratio</a></div><div class="ttdeci">float _L1_ratio</div><div class="ttdoc">L1 ratio for navigation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00220">ecl_l1_pos_controller.h:220</a></div></div>
<div class="ttc" id="namespacemath_html_a7e34369248d5d1565073dc552dd90d5c"><div class="ttname"><a href="../../dd/d47/namespacemath.html#a7e34369248d5d1565073dc552dd90d5c">math::radians</a></div><div class="ttdeci">constexpr T radians(T degrees)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d34/_limits_8hpp_source.html#l00085">Limits.hpp:85</a></div></div>
<div class="ttc" id="integration_8cpp_html_af5ba872dd09316732300733cc164ac1a"><div class="ttname"><a href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a></div><div class="ttdeci">Vector&lt; float, 6 &gt; f(float t, const Matrix&lt; float, 6, 1 &gt; &amp;, const Matrix&lt; float, 3, 1 &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da1/integration_8cpp_source.html#l00008">integration.cpp:8</a></div></div>
<div class="ttc" id="namespacematrix_html_a1b583711c91bf5c9f5b515e167edce90"><div class="ttname"><a href="../../d0/de4/namespacematrix.html#a1b583711c91bf5c9f5b515e167edce90">matrix::Vector2f</a></div><div class="ttdeci">Vector2&lt; float &gt; Vector2f</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d12/_vector2_8hpp_source.html#l00069">Vector2.hpp:69</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ab140bdbf54dfb9b452df75483048aff4"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab140bdbf54dfb9b452df75483048aff4">ECL_L1_Pos_Controller::_L1_distance</a></div><div class="ttdeci">float _L1_distance</div><div class="ttdoc">L1 lead distance, defined by period and damping. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00211">ecl_l1_pos_controller.h:211</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ad7772e30a5a46aa11704974abc316be3"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ad7772e30a5a46aa11704974abc316be3">ECL_L1_Pos_Controller::_roll_lim_rad</a></div><div class="ttdeci">float _roll_lim_rad</div><div class="ttdoc">maximum roll angle in radians </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00224">ecl_l1_pos_controller.h:224</a></div></div>
<div class="ttc" id="geo_8cpp_html_a71a3f1dd74077ca88d95a943768c728b"><div class="ttname"><a href="../../d7/d09/geo_8cpp.html#a71a3f1dd74077ca88d95a943768c728b">get_bearing_to_next_waypoint</a></div><div class="ttdeci">float get_bearing_to_next_waypoint(double lat_now, double lon_now, double lat_next, double lon_next)</div><div class="ttdoc">Returns the bearing to the next waypoint in radians. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d09/geo_8cpp_source.html#l00320">geo.cpp:320</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ab449fa4dc6e9feb1fd69eef9215559ee"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab449fa4dc6e9feb1fd69eef9215559ee">ECL_L1_Pos_Controller::set_l1_period</a></div><div class="ttdeci">void set_l1_period(float period)</div><div class="ttdoc">Set the L1 period. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00363">ecl_l1_pos_controller.cpp:363</a></div></div>
<div class="ttc" id="namespacemath_html_a0590ec5bbbdad228b5a47307af425055"><div class="ttname"><a href="../../dd/d47/namespacemath.html#a0590ec5bbbdad228b5a47307af425055">math::min</a></div><div class="ttdeci">constexpr _Tp min(_Tp a, _Tp b)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d34/_limits_8hpp_source.html#l00054">Limits.hpp:54</a></div></div>
<div class="ttc" id="namespacematrix_html_ad36650ba691474397ef7ba79da6d3782"><div class="ttname"><a href="../../d0/de4/namespacematrix.html#ad36650ba691474397ef7ba79da6d3782">matrix::wrap_pi</a></div><div class="ttdeci">Type wrap_pi(Type x)</div><div class="ttdoc">Wrap value in range [-, ) </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d28/helper__functions_8hpp_source.html#l00067">helper_functions.hpp:67</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a4812a285e3309e23e33f86f5cb86cf78"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a4812a285e3309e23e33f86f5cb86cf78">ECL_L1_Pos_Controller::navigate_waypoints</a></div><div class="ttdeci">void navigate_waypoints(const matrix::Vector2f &amp;vector_A, const matrix::Vector2f &amp;vector_B, const matrix::Vector2f &amp;vector_curr_position, const matrix::Vector2f &amp;ground_speed)</div><div class="ttdoc">Navigate between two waypoints. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00072">ecl_l1_pos_controller.cpp:72</a></div></div>
<div class="ttc" id="namespacemath_html_ad42187b143e9e0e96bb14c7edcfbfef6"><div class="ttname"><a href="../../dd/d47/namespacemath.html#ad42187b143e9e0e96bb14c7edcfbfef6">math::max</a></div><div class="ttdeci">constexpr _Tp max(_Tp a, _Tp b)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d34/_limits_8hpp_source.html#l00060">Limits.hpp:60</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ac5420343fe85896df5bed1090ab85bc2"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ac5420343fe85896df5bed1090ab85bc2">ECL_L1_Pos_Controller::_heading_omega</a></div><div class="ttdeci">float _heading_omega</div><div class="ttdoc">Normalized frequency. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00222">ecl_l1_pos_controller.h:222</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a99c88ba7aed40cd31eab144e8f3ac029"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a99c88ba7aed40cd31eab144e8f3ac029">ECL_L1_Pos_Controller::_bearing_error</a></div><div class="ttdeci">float _bearing_error</div><div class="ttdoc">bearing error </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00214">ecl_l1_pos_controller.h:214</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a0c20f9987cb970fb4a189e44143a5a19"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0c20f9987cb970fb4a189e44143a5a19">ECL_L1_Pos_Controller::_crosstrack_error</a></div><div class="ttdeci">float _crosstrack_error</div><div class="ttdoc">crosstrack error in meters </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00215">ecl_l1_pos_controller.h:215</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a0d7cdc949544aed07fe09082f6b26dfd"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a0d7cdc949544aed07fe09082f6b26dfd">ECL_L1_Pos_Controller::_roll_setpoint</a></div><div class="ttdeci">float _roll_setpoint</div><div class="ttdoc">current roll angle setpoint in radians </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00225">ecl_l1_pos_controller.h:225</a></div></div>
<div class="ttc" id="ashtech_8cpp_html_ab9c3c609e1d02430671de0a109410ac8"><div class="ttname"><a href="../../df/d7f/ashtech_8cpp.html#ab9c3c609e1d02430671de0a109410ac8">M_PI_F</a></div><div class="ttdeci">#define M_PI_F</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d7f/ashtech_8cpp_source.html#l00044">ashtech.cpp:44</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a5526936756605515a35f2b31902a6152"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a5526936756605515a35f2b31902a6152">ECL_L1_Pos_Controller::navigate_level_flight</a></div><div class="ttdeci">void navigate_level_flight(float current_heading)</div><div class="ttdoc">Keep the wings level. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00337">ecl_l1_pos_controller.cpp:337</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ab8e680d1d0c70dd4a50598ad261108a9"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab8e680d1d0c70dd4a50598ad261108a9">ECL_L1_Pos_Controller::_L1_damping</a></div><div class="ttdeci">float _L1_damping</div><div class="ttdoc">L1 damping ratio. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00219">ecl_l1_pos_controller.h:219</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a7567fdc1eb3b4bdaf0d8d6ef2ec509ab"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a7567fdc1eb3b4bdaf0d8d6ef2ec509ab">ECL_L1_Pos_Controller::navigate_heading</a></div><div class="ttdeci">void navigate_heading(float navigation_heading, float current_heading, const matrix::Vector2f &amp;ground_speed)</div><div class="ttdoc">Navigate on a fixed bearing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00300">ecl_l1_pos_controller.cpp:300</a></div></div>
<div class="ttc" id="ecl_8h_html_a5181155e284a192217ea7e0ea70bb810"><div class="ttname"><a href="../../d2/d53/ecl_8h.html#a5181155e284a192217ea7e0ea70bb810">ISFINITE</a></div><div class="ttdeci">#define ISFINITE(x)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d53/ecl_8h_source.html#l00100">ecl.h:100</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_a618c4443b778abce4563f46528e58fce"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#a618c4443b778abce4563f46528e58fce">ECL_L1_Pos_Controller::_L1_period</a></div><div class="ttdeci">float _L1_period</div><div class="ttdoc">L1 tracking period in seconds. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00218">ecl_l1_pos_controller.h:218</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_af693c7fe83fbb45f103062f97e412aae"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#af693c7fe83fbb45f103062f97e412aae">ECL_L1_Pos_Controller::get_local_planar_vector</a></div><div class="ttdeci">matrix::Vector2f get_local_planar_vector(const matrix::Vector2f &amp;origin, const matrix::Vector2f &amp;target) const</div><div class="ttdoc">Convert a 2D vector from WGS84 to planar coordinates. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/db7/ecl__l1__pos__controller_8cpp_source.html#l00354">ecl_l1_pos_controller.cpp:354</a></div></div>
<div class="ttc" id="class_e_c_l___l1___pos___controller_html_ab11afb9e61754f5cc8e96350f78006ae"><div class="ttname"><a href="../../d9/dbb/class_e_c_l___l1___pos___controller.html#ab11afb9e61754f5cc8e96350f78006ae">ECL_L1_Pos_Controller::_lateral_accel</a></div><div class="ttdeci">float _lateral_accel</div><div class="ttdoc">Lateral acceleration setpoint in m/s^2. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dfb/ecl__l1__pos__controller_8h_source.html#l00210">ecl_l1_pos_controller.h:210</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="../../dir_6f10fbb79da377506552735e446823ce.html">ecl</a></li><li class="navelem"><a class="el" href="../../dir_6c0f405e92760acf1185ebc905d74fab.html">l1</a></li><li class="navelem"><a class="el" href="../../d1/db7/ecl__l1__pos__controller_8cpp.html">ecl_l1_pos_controller.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
