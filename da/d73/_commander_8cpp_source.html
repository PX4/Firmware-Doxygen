<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PX4 Firmware: src/modules/commander/Commander.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PX4 Firmware
   </div>
   <div id="projectbrief">PX4 Autopilot Software http://px4.io</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('da/d73/_commander_8cpp_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Commander.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../da/d73/_commander_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/****************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *   Copyright (c) 2013-2018 PX4 Development Team. All rights reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * are met:</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * 1. Redistributions of source code must retain the above copyright</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer in</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *    the documentation and/or other materials provided with the</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *    distribution.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * 3. Neither the name PX4 nor the names of its contributors may be</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *    used to endorse or promote products derived from this software</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *    without specific prior written permission.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> ****************************************************************************/</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * @file commander.cpp</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * Main state machine / business logic</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * @TODO This application is currently in a rewrite process. Main changes:</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> *          - Calibration routines are moved into the event system</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *          - Commander is rewritten as class</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> *          - State machines will be model driven</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d55/_commander_8hpp.html">Commander.hpp</a>&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">/* commander module headers */</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/db5/accelerometer__calibration_8h.html">accelerometer_calibration.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dc9/airspeed__calibration_8h.html">airspeed_calibration.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/dda/arm__auth_8h.html">arm_auth.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d51/baro__calibration_8h.html">baro_calibration.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/da9/calibration__routines_8h.html">calibration_routines.h</a>&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/dbe/commander__helper_8h.html">commander_helper.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d14/esc__calibration_8h.html">esc_calibration.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d3a/gyro__calibration_8h.html">gyro_calibration.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/db8/mag__calibration_8h.html">mag_calibration.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/da8/_preflight_check_8h.html">PreflightCheck.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d20/px4__custom__mode_8h.html">px4_custom_mode.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/dc5/rc__calibration_8h.html">rc_calibration.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/de8/state__machine__helper_8h.html">state_machine_helper.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d63/health__flag__helper_8h.html">health_flag_helper.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">/* PX4 headers */</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../db/d6e/dataman_8h.html">dataman/dataman.h</a>&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d6/d10/drv__hrt_8h.html">drivers/drv_hrt.h</a>&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d9/d25/drv__tone__alarm_8h.html">drivers/drv_tone_alarm.h</a>&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../db/d35/geo_8h.html">lib/ecl/geo/geo.h</a>&gt;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;mathlib/mathlib.h&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d4/d9d/navigation_8h.html">navigator/navigation.h</a>&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d4/d35/px4__config_8h.html">px4_config.h</a>&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../df/dd0/px4__defines_8h.html">px4_defines.h</a>&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d2/de9/px4__posix_8h.html">px4_posix.h</a>&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../dd/d3d/px4__shutdown_8h.html">px4_shutdown.h</a>&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../da/d65/px4__tasks_8h.html">px4_tasks.h</a>&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d3/d2d/px4__time_8h.html">px4_time.h</a>&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d2/dd4/circuit__breaker_8h.html">circuit_breaker/circuit_breaker.h</a>&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d6/d40/err_8h.html">systemlib/err.h</a>&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d4/dad/hysteresis_8h.html">systemlib/hysteresis/hysteresis.h</a>&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html">systemlib/mavlink_log.h</a>&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d5/d33/param_8h.html">parameters/param.h</a>&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &lt;cfloat&gt;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d5/d5d/actuator__armed_8h.html">uORB/topics/actuator_armed.h</a>&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../dc/d46/actuator__controls_8h.html">uORB/topics/actuator_controls.h</a>&gt;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d5/dc1/battery__status_8h.html">uORB/topics/battery_status.h</a>&gt;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d3/dfb/build_2doxygen_2u_o_r_b_2topics_2cpuload_8h.html">uORB/topics/cpuload.h</a>&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d7/ddd/geofence__result_8h.html">uORB/topics/geofence_result.h</a>&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d7/df9/home__position_8h.html">uORB/topics/home_position.h</a>&gt;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d0/d28/manual__control__setpoint_8h.html">uORB/topics/manual_control_setpoint.h</a>&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d1/d88/build_2doxygen_2u_o_r_b_2topics_2mavlink__log_8h.html">uORB/topics/mavlink_log.h</a>&gt;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../db/d02/build_2doxygen_2u_o_r_b_2topics_2mission_8h.html">uORB/topics/mission.h</a>&gt;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../df/d0e/mission__result_8h.html">uORB/topics/mission_result.h</a>&gt;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d6/d7c/offboard__control__mode_8h.html">uORB/topics/offboard_control_mode.h</a>&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../de/d76/parameter__update_8h.html">uORB/topics/parameter_update.h</a>&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d4/d58/power__button__state_8h.html">uORB/topics/power_button_state.h</a>&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d9/da0/safety_8h.html">uORB/topics/safety.h</a>&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../dc/d50/subsystem__info_8h.html">uORB/topics/subsystem_info.h</a>&gt;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d6/d0c/system__power_8h.html">uORB/topics/system_power.h</a>&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d9/d33/telemetry__status_8h.html">uORB/topics/telemetry_status.h</a>&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d7/d94/vehicle__command_8h.html">uORB/topics/vehicle_command.h</a>&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../db/d2e/vehicle__command__ack_8h.html">uORB/topics/vehicle_command_ack.h</a>&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d6/d55/vehicle__global__position_8h.html">uORB/topics/vehicle_global_position.h</a>&gt;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d8/ddd/vehicle__land__detected_8h.html">uORB/topics/vehicle_land_detected.h</a>&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d7/d34/vehicle__local__position_8h.html">uORB/topics/vehicle_local_position.h</a>&gt;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d6/d33/vehicle__status__flags_8h.html">uORB/topics/vehicle_status_flags.h</a>&gt;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../d0/d75/vtol__vehicle__status_8h.html">uORB/topics/vtol_vehicle_status.h</a>&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../db/dd6/u_o_r_b_8h.html">uORB/uORB.h</a>&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967ba">  112</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967ba">VEHICLE_MODE_FLAG</a></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;{</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa44f1b640cbede2524ebd969b83543fa2">  114</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa44f1b640cbede2524ebd969b83543fa2">VEHICLE_MODE_FLAG_CUSTOM_MODE_ENABLED</a>=1, <span class="comment">/* 0b00000001 Reserved for future use. | */</span></div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baafd83f65335a20163ec2f5246b29c1ac3">  115</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baafd83f65335a20163ec2f5246b29c1ac3">VEHICLE_MODE_FLAG_TEST_ENABLED</a>=2, <span class="comment">/* 0b00000010 system has a test mode enabled. This flag is intended for temporary system tests and should not be used for stable implementations. | */</span></div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baafd28e3943259929afa30fd1df7a31484">  116</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baafd28e3943259929afa30fd1df7a31484">VEHICLE_MODE_FLAG_AUTO_ENABLED</a>=4, <span class="comment">/* 0b00000100 autonomous mode enabled, system finds its own goal positions. Guided flag can be set or not, depends on the actual implementation. | */</span></div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa7eab6df663b28cd27c05647d1c229a44">  117</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa7eab6df663b28cd27c05647d1c229a44">VEHICLE_MODE_FLAG_GUIDED_ENABLED</a>=8, <span class="comment">/* 0b00001000 guided mode enabled, system flies MISSIONs / mission items. | */</span></div><div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa2b948319b0cae30c24654277d671e01c">  118</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa2b948319b0cae30c24654277d671e01c">VEHICLE_MODE_FLAG_STABILIZE_ENABLED</a>=16, <span class="comment">/* 0b00010000 system stabilizes electronically its attitude (and optionally position). It needs however further control inputs to move around. | */</span></div><div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa49f8f6f0548e303ff4ad833b82e3a6c9">  119</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa49f8f6f0548e303ff4ad833b82e3a6c9">VEHICLE_MODE_FLAG_HIL_ENABLED</a>=32, <span class="comment">/* 0b00100000 hardware in the loop simulation. All motors / actuators are blocked, but internal software is full operational. | */</span></div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa395c3f85ae2bf89d57722a85b660f99e">  120</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa395c3f85ae2bf89d57722a85b660f99e">VEHICLE_MODE_FLAG_MANUAL_INPUT_ENABLED</a>=64, <span class="comment">/* 0b01000000 remote control input is enabled. | */</span></div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baaa411c6c721ffa0bba846cfdba506faa5">  121</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baaa411c6c721ffa0bba846cfdba506faa5">VEHICLE_MODE_FLAG_SAFETY_ARMED</a>=128, <span class="comment">/* 0b10000000 MAV safety set to armed. Motors are enabled / running / can start. Ready to fly. | */</span></div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa9677280463962911f04cc2711e835381">  122</a></span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa9677280463962911f04cc2711e835381">VEHICLE_MODE_FLAG_ENUM_END</a>=129, <span class="comment">/*  | */</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;} <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967ba">VEHICLE_MODE_FLAG</a>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">/* Decouple update interval and hysteresis counters, all depends on intervals */</span></div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a3486f705b15b9507c8236c09c9f317c3">  126</a></span>&#160;<span class="keyword">static</span> constexpr uint64_t <a class="code" href="../../da/d73/_commander_8cpp.html#a3486f705b15b9507c8236c09c9f317c3">COMMANDER_MONITORING_INTERVAL</a> = 10_ms;</div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a8901a9ed66dcf0e34733f8bef2a511fe">  127</a></span>&#160;<span class="preprocessor">#define COMMANDER_MONITORING_LOOPSPERMSEC (1/(COMMANDER_MONITORING_INTERVAL/1000.0f))</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a1b0e4cbb477cef67a15af010278c80f1">  129</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">float</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a1b0e4cbb477cef67a15af010278c80f1">STICK_ON_OFF_LIMIT</a> = 0.9f;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a0bb55b41f149880b19556b510bfd8b26">  131</a></span>&#160;<span class="keyword">static</span> constexpr uint64_t <a class="code" href="../../da/d73/_commander_8cpp.html#a0bb55b41f149880b19556b510bfd8b26">OFFBOARD_TIMEOUT</a> = 500_ms;</div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ae70d79a727876216e886dab6d5282fc1">  132</a></span>&#160;<span class="keyword">static</span> constexpr uint64_t <a class="code" href="../../da/d73/_commander_8cpp.html#ae70d79a727876216e886dab6d5282fc1">HOTPLUG_SENS_TIMEOUT</a> = 8_s;   <span class="comment">/**&lt; wait for hotplug sensors to come online for upto 8 seconds */</span></div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a00d869b19f4893dfdffbbc156fc3202b">  133</a></span>&#160;<span class="keyword">static</span> constexpr uint64_t <a class="code" href="../../da/d73/_commander_8cpp.html#a00d869b19f4893dfdffbbc156fc3202b">PRINT_MODE_REJECT_INTERVAL</a> = 500_ms;</div><div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a3b5c5036e7865e587e2dee076b4a7d68">  134</a></span>&#160;<span class="keyword">static</span> constexpr uint64_t <a class="code" href="../../da/d73/_commander_8cpp.html#a3b5c5036e7865e587e2dee076b4a7d68">INAIR_RESTART_HOLDOFF_INTERVAL</a> = 500_ms;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">/* Mavlink log uORB handle */</span></div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">  137</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#aa578d8384f0c48d5814fe5be88c4b3a9">  138</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> <a class="code" href="../../da/d73/_commander_8cpp.html#aa578d8384f0c48d5814fe5be88c4b3a9">power_button_state_pub</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">/* flags */</span></div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a19e65cfacb780bf766338756148a966d">  141</a></span>&#160;<span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a19e65cfacb780bf766338756148a966d">thread_should_exit</a> = <span class="keyword">false</span>;    <span class="comment">/**&lt; daemon exit flag */</span></div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">  142</a></span>&#160;<span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a> = <span class="keyword">false</span>;        <span class="comment">/**&lt; daemon status flag */</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">  144</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a> = 0;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">  146</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">leds_counter</a>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">/* To remember when last notification was sent */</span></div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a3a559214533089fa9b2ef7bfc5540eb2">  148</a></span>&#160;<span class="keyword">static</span> uint64_t <a class="code" href="../../da/d73/_commander_8cpp.html#a3a559214533089fa9b2ef7bfc5540eb2">last_print_mode_reject_time</a> = 0;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/da3/classsystemlib_1_1_hysteresis.html">systemlib::Hysteresis</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a8a8c8d54731fad55667b29782218e016">auto_disarm_hysteresis</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">  152</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a> = 0.25f;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a707b22601c0c46541a855d5320fb60e4">  154</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a707b22601c0c46541a855d5320fb60e4">status</a> = {};</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a8e176daf1db88e230ba94a5543e72112">  155</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d5c/structbattery__status__s.html">battery_status_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a8e176daf1db88e230ba94a5543e72112">battery</a> = {};</div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a43de48f7498f5233b5f62dc2e50985a1">  156</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d54/structactuator__armed__s.html">actuator_armed_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a43de48f7498f5233b5f62dc2e50985a1">armed</a> = {};</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a3ca89696abad4daf8863c6bc11ae5d46">  157</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/d06/structsafety__s.html">safety_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a3ca89696abad4daf8863c6bc11ae5d46">safety</a> = {};</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a69dd696400330312a7b07eeaca2b61b5">  158</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d3/d52/structvehicle__control__mode__s.html">vehicle_control_mode_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a69dd696400330312a7b07eeaca2b61b5">control_mode</a> = {};</div><div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a69bb5f2c7b1da001628ef44926171f29">  159</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d9d/structoffboard__control__mode__s.html">offboard_control_mode_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a69bb5f2c7b1da001628ef44926171f29">offboard_control_mode</a> = {};</div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a744a0719bd24008570206af7be22eafe">  160</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d6d/structhome__position__s.html">home_position_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a744a0719bd24008570206af7be22eafe">_home</a> = {};</div><div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">  161</a></span>&#160;<span class="keyword">static</span> int32_t <a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[manual_control_setpoint_s::MODE_SLOT_MAX];</div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a949f89551e92456f630ceaf21ef5f590">  162</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d88/structcommander__state__s.html">commander_state_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a949f89551e92456f630ceaf21ef5f590">internal_state</a> = {};</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">  164</a></span>&#160;<span class="keyword">static</span> uint8_t <a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> = commander_state_s::MAIN_STATE_MAX;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a45da51db6880801086e2fee51898e4af">  166</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../de/de6/structmanual__control__setpoint__s.html">manual_control_setpoint_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a45da51db6880801086e2fee51898e4af">sp_man</a> = {};       <span class="comment">///&lt; the current manual control setpoint</span></div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a64e7b89a4779519af7a79d8e9293ca34">  167</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <a class="code" href="../../de/de6/structmanual__control__setpoint__s.html">manual_control_setpoint_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a64e7b89a4779519af7a79d8e9293ca34">_last_sp_man</a> = {}; <span class="comment">///&lt; the manual control setpoint valid at the last mode switch</span></div><div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#af618a6b9c76079c11172b6c0c7bd326c">  168</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> uint8_t <a class="code" href="../../da/d73/_commander_8cpp.html#af618a6b9c76079c11172b6c0c7bd326c">_last_sp_man_arm_switch</a> = 0;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a5b71f638371b95b5cf3e0a97479c3d56">  170</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html">vtol_vehicle_status_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a5b71f638371b95b5cf3e0a97479c3d56">vtol_status</a> = {};</div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#aab672fcf477e5224043c668ea3981b81">  171</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/dbb/structcpuload__s.html">cpuload_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#aab672fcf477e5224043c668ea3981b81">cpuload</a> = {};</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">  173</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a8bb4bd9db2891f8edb99b0086e973001">  174</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a8bb4bd9db2891f8edb99b0086e973001">last_overload</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#abcdc326c93c28a0a624d7d682352f53a">  176</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html">vehicle_status_flags_s</a> <a class="code" href="../../da/d73/_commander_8cpp.html#abcdc326c93c28a0a624d7d682352f53a">status_flags</a> = {};</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#afd0a2e6a4c9209262305d2f15ca74e4f">  178</a></span>&#160;<span class="keyword">static</span> uint64_t <a class="code" href="../../da/d73/_commander_8cpp.html#afd0a2e6a4c9209262305d2f15ca74e4f">rc_signal_lost_timestamp</a>;       <span class="comment">// Time at which the RC reception was lost</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">  180</a></span>&#160;<span class="keyword">static</span> uint8_t <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a> = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539af8cefe7a4cc03a758c7209dd6d721b79">ARM_REQ_NONE</a>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a881c644a74329486a4925c156831747b">  182</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a881c644a74329486a4925c156831747b">_last_condition_global_position_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ad413547e8415393f14acfc8e09c642a2">  184</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html">vehicle_land_detected_s</a> <a class="code" href="../../d8/d08/namespaceland__detector.html">land_detector</a> = {};</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">  186</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a> = INFINITY; <span class="comment">///&lt; maximum allowable horizontal position uncertainty after adjustment for flight condition</span></div><div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a1d36762fa2d596c65f758185aa92d02a">  187</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a1d36762fa2d596c65f758185aa92d02a">_skip_pos_accuracy_check</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment"> * The daemon app only briefly exists to start</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"> * the background job. The stack size assigned in the</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"> * Makefile does only apply to this management task.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment"> * The actual stack size should be set in the call</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment"> * to task_create().</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"> * @ingroup apps</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <a class="code" href="../../d9/ddc/namespace_____e_x_p_o_r_t.html">__EXPORT</a> <span class="keywordtype">int</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a9351d6b0ff1efb4fd6d687f143be98c7">commander_main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment"> * Print the correct usage.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#af47859830f7c0908c582447aeaa1c67c">usage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *reason);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a11781677749dd4c7b3306165a9db7235">control_status_leds</a>(<a class="code" href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a> *status_local, <span class="keyword">const</span> <a class="code" href="../../d0/d54/structactuator__armed__s.html">actuator_armed_s</a> *actuator_armed, <span class="keywordtype">bool</span> changed,</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;             <a class="code" href="../../d0/d5c/structbattery__status__s.html">battery_status_s</a> *battery_local, <span class="keyword">const</span> <a class="code" href="../../d7/dbb/structcpuload__s.html">cpuload_s</a> *cpuload_local);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a55e27eff85d06cb0126947a279414da3">get_circuit_breaker_params</a>();</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#abbddddc6e2c6951b59f612c852b13467">set_control_mode</a>();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#ae6a03cce77b545417f304d159a90b6b4">stabilization_required</a>();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d87/px4io_8c.html#abaa327c5cc17da179a4bfea0de695fbc">msg</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e">print_reject_arm</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d87/px4io_8c.html#abaa327c5cc17da179a4bfea0de695fbc">msg</a>);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a8008fbbb8f369eeb0f452863fe664355">print_status</a>();</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(<span class="keywordtype">bool</span> arm, <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> *<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *armedBy);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment"> * Loop that runs at a lower rate and priority for calibration and parameter tasks.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keywordtype">void</span> *<a class="code" href="../../da/d73/_commander_8cpp.html#af62ee6f05861387a2bc3831c160afea8">commander_low_prio_loop</a>(<span class="keywordtype">void</span> *arg);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(<span class="keyword">const</span> <a class="code" href="../../d7/dcc/structvehicle__command__s.html">vehicle_command_s</a> &amp;cmd, <span class="keywordtype">unsigned</span> result, <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> &amp;command_ack_pub);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a5bc5269a368d9e600d2319bd25a3e24a">  230</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a5bc5269a368d9e600d2319bd25a3e24a">power_button_state_notification_cb</a>(<a class="code" href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8">board_power_button_state_notification_e</a> request)</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;{</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// Note: this can be called from IRQ handlers, so we publish a message that will be handled</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// on the main thread of commander.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="../../dd/db8/structpower__button__state__s.html">power_button_state_s</a> button_state;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ad9992550fcc33ebb4a18721e84266730">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8ad7e82073686a1c431e2fef318678185d">PWR_BUTTON_RESPONSE_SHUT_DOWN_PENDING</a>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">switch</span>(request) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8a7cab0fe15d4128d24401d038abf557e2">PWR_BUTTON_IDEL</a>:</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ac9d1fe794d88be48f84f6508f0c9ba0d">event</a> = power_button_state_s::PWR_BUTTON_STATE_IDEL;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8aa8193660df9df37350367e61c0983ca3">PWR_BUTTON_DOWN</a>:</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ac9d1fe794d88be48f84f6508f0c9ba0d">event</a> = power_button_state_s::PWR_BUTTON_STATE_DOWN;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8a9947c957447b1ac8d174ae99c78f5997">PWR_BUTTON_UP</a>:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ac9d1fe794d88be48f84f6508f0c9ba0d">event</a> = power_button_state_s::PWR_BUTTON_STATE_UP;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8a512698c1ea37d13e6fdbde36a88b0685">PWR_BUTTON_REQUEST_SHUT_DOWN</a>:</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ac9d1fe794d88be48f84f6508f0c9ba0d">event</a> = power_button_state_s::PWR_BUTTON_STATE_REQUEST_SHUTDOWN;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;unhandled power button state: %i&quot;</span>, (<span class="keywordtype">int</span>)request);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#aa578d8384f0c48d5814fe5be88c4b3a9">power_button_state_pub</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(power_button_state), <a class="code" href="../../da/d73/_commander_8cpp.html#aa578d8384f0c48d5814fe5be88c4b3a9">power_button_state_pub</a>, &amp;button_state);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;power_button_state_pub not properly initialized&quot;</span>);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a7d4ab27a470c0ef9f9f693631ab1ff22">  265</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a7d4ab27a470c0ef9f9f693631ab1ff22">send_vehicle_command</a>(uint16_t cmd, <span class="keywordtype">float</span> param1 = NAN, <span class="keywordtype">float</span> param2 = NAN)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;{</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="../../d7/dcc/structvehicle__command__s.html">vehicle_command_s</a> vcmd = {};</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a81cc3fc9405436c7f6100259e69d18b1">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> = param1;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abbb4baad7f6410ef1f2ce1ba5841f00a">param2</a> = param2;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a4a1ffaa0862d627a54c57bc8cb6d3929">param3</a> = NAN;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a63efacb8a96b64f975496cb06b9636d5">param4</a> = NAN;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a7a66aafb32c26d7245a7d1e1106045e0">param5</a> = (double)NAN;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a388b7a9e0e9d2e211904cb365db2155b">param6</a> = (double)NAN;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abefaf0afd13d3b4cd44c3e29a6cb1694">param7</a> = NAN;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a> = vehicle_command_s::VEHICLE_CMD_NAV_TAKEOFF;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aa0e9092f01d4004c4ea966daafbd36d9">target_system</a> = status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#adaecaa390e38921923f07353069200d0">system_id</a>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    vcmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a868def4801788306c335df9ce7ffd7e7">target_component</a> = status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a1a3cc064f154b4354a8fdcab80eeac4a">component_id</a>;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> h = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a91df70141220b84c1c01619db0c3e105">orb_advertise_queue</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_command), &amp;vcmd, vehicle_command_s::ORB_QUEUE_LENGTH);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">return</span> (h != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a9351d6b0ff1efb4fd6d687f143be98c7">  285</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a9351d6b0ff1efb4fd6d687f143be98c7">commander_main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> (argc &lt; 2) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#af47859830f7c0908c582447aeaa1c67c">usage</a>(<span class="stringliteral">&quot;missing command&quot;</span>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;start&quot;</span>)) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a>) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;already running&quot;</span>);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            <span class="comment">/* this is not an error */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a19e65cfacb780bf766338756148a966d">thread_should_exit</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <a class="code" href="../../de/d33/navio__rgbled_2test_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">Commander::main</a>(argc, argv);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordtype">unsigned</span> constexpr max_wait_us = 1000000;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordtype">unsigned</span> constexpr max_wait_steps = 2000;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordtype">unsigned</span> i;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; max_wait_steps; i++) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(max_wait_us / max_wait_steps);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a>) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">return</span> !(i &lt; max_wait_steps);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;stop&quot;</span>)) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a>) {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a1456147685cf86fa9d058baf143ae141">PX4_WARN</a>(<span class="stringliteral">&quot;already stopped&quot;</span>);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a19e65cfacb780bf766338756148a966d">thread_should_exit</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <a class="code" href="../../de/d33/navio__rgbled_2test_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">Commander::main</a>(argc, argv);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;terminated.&quot;</span>);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">/* commands needing the app to run below */</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a>) {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;not started&quot;</span>);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;status&quot;</span>)) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a8008fbbb8f369eeb0f452863fe664355">print_status</a>();</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;calibrate&quot;</span>)) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">if</span> (argc &gt; 2) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordtype">int</span> calib_ret = <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;mag&quot;</span>)) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                calib_ret = <a class="code" href="../../de/d14/mag__calibration_8cpp.html#afc0e4e0619e1f2846eeec88a20aa9b8e">do_mag_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;accel&quot;</span>)) {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                calib_ret = <a class="code" href="../../dd/dcd/accelerometer__calibration_8cpp.html#ad01f28350f810d176a4ae4bc4e9fa81f">do_accel_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;gyro&quot;</span>)) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                calib_ret = <a class="code" href="../../df/d5e/gyro__calibration_8cpp.html#a4efe4d135d3df2f59371abd80f19801a">do_gyro_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;level&quot;</span>)) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                calib_ret = <a class="code" href="../../dd/dcd/accelerometer__calibration_8cpp.html#adf8b5d0eb3d93e20d76e3273b6f27b88">do_level_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;esc&quot;</span>)) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                calib_ret = <a class="code" href="../../d1/d41/esc__calibration_8cpp.html#a076fa55d1c50ba98926631180977e012">do_esc_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;armed);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;airspeed&quot;</span>)) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                calib_ret = <a class="code" href="../../d3/d73/airspeed__calibration_8cpp.html#a86965ddfd735f86625739ca51be885d7">do_airspeed_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;argument %s unsupported.&quot;</span>, argv[2]);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <span class="keywordflow">if</span> (calib_ret) {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;calibration failed, exiting.&quot;</span>);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;missing argument&quot;</span>);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;check&quot;</span>)) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordtype">bool</span> preflight_check_res = <a class="code" href="../../d3/dc6/class_commander.html#a31c2d7d8ee9793a82b291658016a3f29">Commander::preflight_check</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;Preflight check: %s&quot;</span>, preflight_check_res ? <span class="stringliteral">&quot;OK&quot;</span> : <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordtype">bool</span> prearm_check_res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#ac8732d75f16faf5917ec531ad9dc2856">prearm_check</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, status_flags, battery, safety, <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>));</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;Prearm check: %s&quot;</span>, prearm_check_res ? <span class="stringliteral">&quot;OK&quot;</span> : <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;arm&quot;</span>)) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> != <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(<span class="keyword">true</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;command line&quot;</span>)) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;arming failed&quot;</span>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;disarm&quot;</span>)) {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> == <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(<span class="keyword">false</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;command line&quot;</span>)) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;rejected disarm&quot;</span>);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;takeoff&quot;</span>)) {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="comment">/* see if we got a home position */</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a160aaccd15cb7daf7d2533255c364dec">condition_local_position_valid</a>) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> != <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(<span class="keyword">true</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;command line&quot;</span>)) {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                ret = <a class="code" href="../../da/d73/_commander_8cpp.html#a7d4ab27a470c0ef9f9f693631ab1ff22">send_vehicle_command</a>(vehicle_command_s::VEHICLE_CMD_NAV_TAKEOFF);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;arming failed&quot;</span>);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;rejecting takeoff, no position lock yet. Please retry..&quot;</span>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">return</span> (ret ? 0 : 1);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;land&quot;</span>)) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordtype">bool</span> ret = <a class="code" href="../../da/d73/_commander_8cpp.html#a7d4ab27a470c0ef9f9f693631ab1ff22">send_vehicle_command</a>(vehicle_command_s::VEHICLE_CMD_NAV_LAND);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">return</span> (ret ? 0 : 1);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;transition&quot;</span>)) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordtype">bool</span> ret = <a class="code" href="../../da/d73/_commander_8cpp.html#a7d4ab27a470c0ef9f9f693631ab1ff22">send_vehicle_command</a>(vehicle_command_s::VEHICLE_CMD_DO_VTOL_TRANSITION,</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                (<span class="keywordtype">float</span>)(status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> ? vtol_vehicle_status_s::VEHICLE_VTOL_STATE_FW : vtol_vehicle_status_s::VEHICLE_VTOL_STATE_MC));</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">return</span> (ret ? 0 : 1);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;mode&quot;</span>)) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="keywordflow">if</span> (argc &gt; 2) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            uint8_t new_main_state = commander_state_s::MAIN_STATE_MAX;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;manual&quot;</span>)) {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_MANUAL;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;altctl&quot;</span>)) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_ALTCTL;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;posctl&quot;</span>)) {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_POSCTL;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;auto:mission&quot;</span>)) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_AUTO_MISSION;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;auto:loiter&quot;</span>)) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_AUTO_LOITER;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;auto:rtl&quot;</span>)) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_AUTO_RTL;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;acro&quot;</span>)) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_ACRO;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;offboard&quot;</span>)) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_OFFBOARD;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;stabilized&quot;</span>)) {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_STAB;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;rattitude&quot;</span>)) {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_RATTITUDE;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;auto:takeoff&quot;</span>)) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_AUTO_TAKEOFF;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;auto:land&quot;</span>)) {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_AUTO_LAND;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(argv[2], <span class="stringliteral">&quot;auto:precland&quot;</span>)) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                new_main_state = commander_state_s::MAIN_STATE_AUTO_PRECLAND;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;argument %s unsupported.&quot;</span>, argv[2]);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, new_main_state, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;mode change failed&quot;</span>);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;missing argument&quot;</span>);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    }</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (!strcmp(argv[1], <span class="stringliteral">&quot;lockdown&quot;</span>)) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">if</span> (argc &lt; 3) {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#af47859830f7c0908c582447aeaa1c67c">usage</a>(<span class="stringliteral">&quot;not enough arguments, missing [on, off]&quot;</span>);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordtype">bool</span> ret = <a class="code" href="../../da/d73/_commander_8cpp.html#a7d4ab27a470c0ef9f9f693631ab1ff22">send_vehicle_command</a>(vehicle_command_s::VEHICLE_CMD_DO_FLIGHTTERMINATION,</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                strcmp(argv[2], <span class="stringliteral">&quot;off&quot;</span>) ? 2.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a> : 0.0<a class="code" href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a> <span class="comment">/* lockdown */</span>, 0.0f);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordflow">return</span> (ret ? 0 : 1);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    }</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#af47859830f7c0908c582447aeaa1c67c">usage</a>(<span class="stringliteral">&quot;unrecognized command&quot;</span>);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#af47859830f7c0908c582447aeaa1c67c">  494</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#af47859830f7c0908c582447aeaa1c67c">usage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *reason)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> (reason &amp;&amp; *reason &gt; 0) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;%s&quot;</span>, reason);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;usage: commander {start|stop|status|calibrate|check|arm|disarm|takeoff|land|transition|mode}\n&quot;</span>);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;}</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a8008fbbb8f369eeb0f452863fe664355">  503</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a8008fbbb8f369eeb0f452863fe664355">print_status</a>()</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;{</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;type: %s&quot;</span>, (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a>) ? <span class="stringliteral">&quot;symmetric motion&quot;</span> : <span class="stringliteral">&quot;forward motion&quot;</span>);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;safety: USB enabled: %s, power state valid: %s&quot;</span>, (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a675c19070b0ca7956c113ce12c8e57d0">usb_connected</a>) ? <span class="stringliteral">&quot;[OK]&quot;</span> : <span class="stringliteral">&quot;[NO]&quot;</span>,</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a6f833ad768df9691686a66efc82b65ca">condition_power_input_valid</a>) ? <span class="stringliteral">&quot; [OK]&quot;</span> : <span class="stringliteral">&quot;[NO]&quot;</span>);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;home: lat = %.7f, lon = %.7f, alt = %.2f, yaw: %.2f&quot;</span>, _home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a93b8b23d202c9af3989e4be84c88cb8a">lat</a>, _home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a719b8706b5e251c3ca85de8bb3ea46eb">lon</a>, (<span class="keywordtype">double</span>)_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#ab2a80f05f7fea0dfe632c2893fde1829">alt</a>, (<span class="keywordtype">double</span>)_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a17f2ace87bd73b3f2c6593e350c1519b">yaw</a>);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;home: x = %.7f, y = %.7f, z = %.2f &quot;</span>, (<span class="keywordtype">double</span>)_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a6cccfd19ff9b7e8075d8c14ab485ac63">x</a>, (<span class="keywordtype">double</span>)_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#abb00d6356fa27cb10bf632ed86fcddac">y</a>, (<span class="keywordtype">double</span>)_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a01b9c594d162ddd0ea3a9d3184095599">z</a>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;datalink: %s %s&quot;</span>, (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a>) ? <span class="stringliteral">&quot;LOST&quot;</span> : <span class="stringliteral">&quot;OK&quot;</span>, (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a791f24dab19dc433eabd2f32b8024638">high_latency_data_link_active</a>) ? <span class="stringliteral">&quot;(high latency)&quot;</span> : <span class="stringliteral">&quot; &quot;</span>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;main state: %d&quot;</span>, internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a>);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;nav state: %d&quot;</span>, status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">nav_state</a>);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;arming: %s&quot;</span>, <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a21e577c574ece19b4d86dac4f79b4786">arming_state_names</a>[status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a>]);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a8394cc39ce8c41dba0adf2a5990ff1ed">  516</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> <a class="code" href="../../da/d73/_commander_8cpp.html#a8394cc39ce8c41dba0adf2a5990ff1ed">status_pub</a>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">  518</a></span>&#160;<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(<span class="keywordtype">bool</span> arm, <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> *mavlink_log_pub_local, <span class="keyword">const</span> <span class="keywordtype">char</span> *armedBy)</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;{</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> arming_res = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">// Transition the armed state. By passing mavlink_log_pub to arming_state_transition it will</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="comment">// output appropriate error messages if the state cannot transition.</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    arming_res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a>(&amp;status,</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                         battery,</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                         safety,</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                         arm ? vehicle_status_s::ARMING_STATE_ARMED : vehicle_status_s::ARMING_STATE_STANDBY,</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                         &amp;armed,</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                         <span class="keyword">true</span> <span class="comment">/* fRunPreArmChecks */</span>,</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                         mavlink_log_pub_local,</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                         &amp;status_flags,</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                         <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>,</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                         <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>));</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">if</span> (arming_res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a>) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a>(mavlink_log_pub_local, <span class="stringliteral">&quot;%s by %s&quot;</span>, arm ? <span class="stringliteral">&quot;ARMED&quot;</span> : <span class="stringliteral">&quot;DISARMED&quot;</span>, armedBy);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arming_res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    }</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">return</span> arming_res;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;}</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#ac3fc4568a88c91cb4ab97de9f77698a9">  545</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#ac3fc4568a88c91cb4ab97de9f77698a9">Commander::Commander</a>() :</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="../../db/db3/class_module_params.html">ModuleParams</a>(nullptr)</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;{</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;}</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a228a3bb17659b7a44a845e304da1191a">  551</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#a228a3bb17659b7a44a845e304da1191a">Commander::handle_command</a>(<a class="code" href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a> *status_local, <span class="keyword">const</span> <a class="code" href="../../d7/dcc/structvehicle__command__s.html">vehicle_command_s</a>&amp; cmd, <a class="code" href="../../d0/d54/structactuator__armed__s.html">actuator_armed_s</a> *armed_local,</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <a class="code" href="../../dc/d6d/structhome__position__s.html">home_position_s</a> *home, <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> *home_pub, <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> *command_ack_pub, <span class="keywordtype">bool</span> *changed)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;{</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">/* only handle commands that are meant to be handled by this system and component */</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordflow">if</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aa0e9092f01d4004c4ea966daafbd36d9">target_system</a> != status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#adaecaa390e38921923f07353069200d0">system_id</a> || ((cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a868def4801788306c335df9ce7ffd7e7">target_component</a> != status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#a1a3cc064f154b4354a8fdcab80eeac4a">component_id</a>)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            &amp;&amp; (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a868def4801788306c335df9ce7ffd7e7">target_component</a> != 0))) { <span class="comment">// component_id 0: valid for all components</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">/* result of the command */</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordtype">unsigned</span> cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_UNSUPPORTED;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">/* request to set different system mode */</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">switch</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a>) {</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_REPOSITION: {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="comment">// Just switch the flight mode here, the navigator takes care of</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">// doing something sensible with the coordinates. Its designed</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="comment">// to not require navigator and command to receive / process</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment">// the data at the exact same time.</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="comment">// Check if a mode switch had been requested</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">if</span> ((((uint32_t)cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abbb4baad7f6410ef1f2ce1ba5841f00a">param2</a>) &amp; 1) &gt; 0) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="keywordflow">if</span> ((main_ret != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>)) {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Rejecting reposition command&quot;</span>);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            }</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_MODE: {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            uint8_t base_mode = (uint8_t)cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            uint8_t custom_main_mode = (uint8_t)cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abbb4baad7f6410ef1f2ce1ba5841f00a">param2</a>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            uint8_t custom_sub_mode = (uint8_t)cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a4a1ffaa0862d627a54c57bc8cb6d3929">param3</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> arming_ret = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> main_ret = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="comment">/* set HIL state */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a6728c9b87db5be26a1fca643136f77d6">hil_state_t</a> new_hil_state = (base_mode &amp; <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa49f8f6f0548e303ff4ad833b82e3a6c9">VEHICLE_MODE_FLAG_HIL_ENABLED</a>) ? vehicle_status_s::HIL_STATE_ON : vehicle_status_s::HIL_STATE_OFF;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> hil_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a7633ff1e49699b0d54cdf0865bc11f3f">hil_state_transition</a>(new_hil_state, <a class="code" href="../../da/d73/_commander_8cpp.html#a8394cc39ce8c41dba0adf2a5990ff1ed">status_pub</a>, status_local, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="comment">// We ignore base_mode &amp; VEHICLE_MODE_FLAG_SAFETY_ARMED because</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="comment">// the command VEHICLE_CMD_COMPONENT_ARM_DISARM should be used</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="comment">// instead according to the latest mavlink spec.</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keywordflow">if</span> (base_mode &amp; <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa44f1b640cbede2524ebd969b83543fa2">VEHICLE_MODE_FLAG_CUSTOM_MODE_ENABLED</a>) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <span class="comment">/* use autopilot-specific mode */</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651acf0106552e058571aac0ec3260ea9f14">PX4_CUSTOM_MAIN_MODE_MANUAL</a>) {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                    <span class="comment">/* MANUAL */</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651ae33a097de52d1ef791d7e847ca4bdc13">PX4_CUSTOM_MAIN_MODE_ALTCTL</a>) {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    <span class="comment">/* ALTCTL */</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_ALTCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a2389f6ae07055aa6657d587ca3709328">PX4_CUSTOM_MAIN_MODE_POSCTL</a>) {</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                    <span class="comment">/* POSCTL */</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                    <a class="code" href="../../d3/dc6/class_commander.html#a66e5bc6e5edea5edb1eb0aab356e5663">reset_posvel_validity</a>(changed);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_POSCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651aaac23d3467b1659a528e372e6873064c">PX4_CUSTOM_MAIN_MODE_AUTO</a>) {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                    <span class="comment">/* AUTO */</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    <span class="keywordflow">if</span> (custom_sub_mode &gt; 0) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                        <a class="code" href="../../d3/dc6/class_commander.html#a66e5bc6e5edea5edb1eb0aab356e5663">reset_posvel_validity</a>(changed);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                        <span class="keywordflow">switch</span>(custom_sub_mode) {</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a175ba35fe9b90492566bbfd685d30bfa">PX4_CUSTOM_SUB_MODE_AUTO_LOITER</a>:</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                            main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a08af91b9a59af0f61330cbc3091f5791">PX4_CUSTOM_SUB_MODE_AUTO_MISSION</a>:</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                            <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a22967f4ba02c22cbc1f09983ceb412db">condition_auto_mission_available</a>) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_MISSION, status_flags, &amp;internal_state);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                main_ret = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                            }</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a1e57825a3f1332693ea4ed0a5ad1f36a">PX4_CUSTOM_SUB_MODE_AUTO_RTL</a>:</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                            main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_RTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a6af91d090b1b0869f2eb334b30fa9620">PX4_CUSTOM_SUB_MODE_AUTO_TAKEOFF</a>:</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                            main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_TAKEOFF, status_flags, &amp;internal_state);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a0f84ecb91094f0d3263db94087fd5801">PX4_CUSTOM_SUB_MODE_AUTO_LAND</a>:</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                            main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_LAND, status_flags, &amp;internal_state);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2ac081e262ec37301d4484082d4b11edf7">PX4_CUSTOM_SUB_MODE_AUTO_FOLLOW_TARGET</a>:</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                            main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_FOLLOW_TARGET, status_flags, &amp;internal_state);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2aa74de9e199a8e8a1000097f7f5fc3cde">PX4_CUSTOM_SUB_MODE_AUTO_PRECLAND</a>:</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                            main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_PRECLAND, status_flags, &amp;internal_state);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                        <span class="keywordflow">default</span>:</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                            main_ret = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Unsupported auto mode&quot;</span>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                        }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                        main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_MISSION, status_flags, &amp;internal_state);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                    }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a0c5569ce5df2d68fbe8794ce3e50528a">PX4_CUSTOM_MAIN_MODE_ACRO</a>) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                    <span class="comment">/* ACRO */</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_ACRO, status_flags, &amp;internal_state);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a82ba96ba45e14bd6e8f11def4302025b">PX4_CUSTOM_MAIN_MODE_RATTITUDE</a>) {</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                    <span class="comment">/* RATTITUDE */</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_RATTITUDE, status_flags, &amp;internal_state);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a83e626f323c886037e137a1547a7f485">PX4_CUSTOM_MAIN_MODE_STABILIZED</a>) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                    <span class="comment">/* STABILIZED */</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_STAB, status_flags, &amp;internal_state);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (custom_main_mode == <a class="code" href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a8c44097aa32ee4b2b767d0d0f1da7a18">PX4_CUSTOM_MAIN_MODE_OFFBOARD</a>) {</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                    <a class="code" href="../../d3/dc6/class_commander.html#a66e5bc6e5edea5edb1eb0aab356e5663">reset_posvel_validity</a>(changed);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                    <span class="comment">/* OFFBOARD */</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_OFFBOARD, status_flags, &amp;internal_state);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                <span class="comment">/* use base mode */</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                <span class="keywordflow">if</span> (base_mode &amp; <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baafd28e3943259929afa30fd1df7a31484">VEHICLE_MODE_FLAG_AUTO_ENABLED</a>) {</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                    <span class="comment">/* AUTO */</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                    main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_MISSION, status_flags, &amp;internal_state);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (base_mode &amp; <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa395c3f85ae2bf89d57722a85b660f99e">VEHICLE_MODE_FLAG_MANUAL_INPUT_ENABLED</a>) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                    <span class="keywordflow">if</span> (base_mode &amp; <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa7eab6df663b28cd27c05647d1c229a44">VEHICLE_MODE_FLAG_GUIDED_ENABLED</a>) {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                        <span class="comment">/* POSCTL */</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                        main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_POSCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (base_mode &amp; <a class="code" href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa2b948319b0cae30c24654277d671e01c">VEHICLE_MODE_FLAG_STABILIZE_ENABLED</a>) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                        <span class="comment">/* STABILIZED */</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_STAB, status_flags, &amp;internal_state);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                        <span class="comment">/* MANUAL */</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                        main_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                    }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="keywordflow">if</span> ((hil_ret != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) &amp;&amp; (arming_ret != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) &amp;&amp; (main_ret != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>)) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                <span class="keywordflow">if</span> (arming_ret == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Rejecting arming cmd&quot;</span>);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                }</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        }</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_COMPONENT_ARM_DISARM: {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="comment">// Adhere to MAVLink specs, but base on knowledge that these fundamentally encode ints</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="comment">// for logic state parameters</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            <span class="keywordflow">if</span> (static_cast&lt;int&gt;(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> + 0.5f) != 0 &amp;&amp; static_cast&lt;int&gt;(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> + 0.5f) != 1) {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Unsupported ARM_DISARM param: %.3f&quot;</span>, (<span class="keywordtype">double</span>)cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                <span class="keywordtype">bool</span> cmd_arms = (<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> + 0.5f) == 1);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="comment">// Flick to inair restore first if this comes from an onboard system</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                <span class="keywordflow">if</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#ae886d0e0606a4c10194b38789b30ba4e">source_system</a> == status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#adaecaa390e38921923f07353069200d0">system_id</a> &amp;&amp; cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a3da26a5e7cda0177a3457522377bad9e">source_component</a> == status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#a1a3cc064f154b4354a8fdcab80eeac4a">component_id</a>) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> = vehicle_status_s::ARMING_STATE_IN_AIR_RESTORE;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    <span class="comment">// Refuse to arm if preflight checks have failed</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    <span class="keywordflow">if</span> ((!status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#a477f9050e58a25f419da7f643b4c52fb">hil_state</a>) != vehicle_status_s::HIL_STATE_ON &amp;&amp; !status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#abf8f27de653a86414890a4928caff730">condition_system_sensors_initialized</a>) {</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Arming DENIED. Preflight checks have failed.&quot;</span>);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_DENIED;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                    <span class="comment">// Refuse to arm if in manual with non-zero throttle</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                    <span class="keywordflow">if</span> (cmd_arms</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                        &amp;&amp; (status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">nav_state</a> == vehicle_status_s::NAVIGATION_STATE_MANUAL</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                        || status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">nav_state</a> == vehicle_status_s::NAVIGATION_STATE_ACRO</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                        || status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">nav_state</a> == vehicle_status_s::NAVIGATION_STATE_STAB</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                        || status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">nav_state</a> == vehicle_status_s::NAVIGATION_STATE_RATTITUDE)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                        &amp;&amp; (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a> &gt; 0.1f)) {</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Arming DENIED. Manual throttle non-zero.&quot;</span>);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                        cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_DENIED;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                    }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> arming_res = <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(cmd_arms, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;arm/disarm component command&quot;</span>);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                <span class="keywordflow">if</span> (arming_res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                    cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                    cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    <span class="comment">/* update home position on arming if at least 500 ms from commander start spent to avoid setting home on in-air restart */</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                    <span class="keywordflow">if</span> (cmd_arms &amp;&amp; (arming_res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a>) &amp;&amp;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                        (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>() &gt; (<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a> + <a class="code" href="../../da/d73/_commander_8cpp.html#a3b5c5036e7865e587e2dee076b4a7d68">INAIR_RESTART_HOLDOFF_INTERVAL</a>)) &amp;&amp;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                        !home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a6ac17e9135ded73c11140645a4fd239d">manual_home</a>) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                        <a class="code" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">set_home_position</a>(*home_pub, *home, <span class="keyword">false</span>);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                    }</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                }</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        }</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_FLIGHTTERMINATION: {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="keywordflow">if</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> &gt; 1.5f) {</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                armed_local-&gt;<a class="code" href="../../d0/d54/structactuator__armed__s.html#abc259b5c60d6ec93ca24021880faadc8">lockdown</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;forcing lockdown (motors off)&quot;</span>);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> &gt; 0.5f) {</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                <span class="comment">//XXX update state machine?</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                armed_local-&gt;<a class="code" href="../../d0/d54/structactuator__armed__s.html#af8c77c6ad99b1b28aea8bdade01d5b44">force_failsafe</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;forcing failsafe (termination)&quot;</span>);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abbb4baad7f6410ef1f2ce1ba5841f00a">param2</a> &lt;= 0) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                    <span class="comment">/* reset all commanded failure modes */</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                    <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;reset all non-flighttermination failsafe commands&quot;</span>);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                armed_local-&gt;<a class="code" href="../../d0/d54/structactuator__armed__s.html#af8c77c6ad99b1b28aea8bdade01d5b44">force_failsafe</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                armed_local-&gt;<a class="code" href="../../d0/d54/structactuator__armed__s.html#abc259b5c60d6ec93ca24021880faadc8">lockdown</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;disabling failsafe and lockdown&quot;</span>);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            }</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        }</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_HOME: {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordtype">bool</span> use_current = cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> &gt; 0.5f;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="keywordflow">if</span> (use_current) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                <span class="comment">/* use current position */</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">set_home_position</a>(*home_pub, *home, <span class="keyword">false</span>)) {</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                    cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                    cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                }</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">double</span> lat = cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a7a66aafb32c26d7245a7d1e1106045e0">param5</a>;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">double</span> lon = cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a388b7a9e0e9d2e211904cb365db2155b">param6</a>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">float</span> alt = cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abefaf0afd13d3b4cd44c3e29a6cb1694">param7</a>;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                <span class="keywordflow">if</span> (PX4_ISFINITE(lat) &amp;&amp; PX4_ISFINITE(lon) &amp;&amp; PX4_ISFINITE(alt)) {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    <span class="keyword">const</span> <a class="code" href="../../d4/d36/structvehicle__local__position__s.html">vehicle_local_position_s</a> &amp;local_pos = <a class="code" href="../../d3/dc6/class_commander.html#af23998581890b6330bbded526e41c6c2">_local_position_sub</a>.<a class="code" href="../../d0/d65/classu_o_r_b_1_1_subscription.html#aa01d2ff362359aa05b64e93c6df668e0">get</a>();</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    <span class="keywordflow">if</span> (local_pos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#af73ac895427b64d590a879be7605d00e">xy_global</a> &amp;&amp; local_pos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#adb219481b72536d9c74ca2077e10d056">z_global</a>) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                        <span class="comment">/* use specified position */</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a670e3ee95d617c1ca40de997c4b971d4">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a93b8b23d202c9af3989e4be84c88cb8a">lat</a> = lat;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a719b8706b5e251c3ca85de8bb3ea46eb">lon</a> = lon;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#ab2a80f05f7fea0dfe632c2893fde1829">alt</a> = alt;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a6ac17e9135ded73c11140645a4fd239d">manual_home</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#affca1cec624c8bcf53bced8a1fa3174e">valid_alt</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a81736b88f32e773a42da7a9b79616e53">valid_hpos</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                        <span class="comment">// update local projection reference including altitude</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                        <span class="keyword">struct </span><a class="code" href="../../de/d7e/structmap__projection__reference__s.html">map_projection_reference_s</a> ref_pos;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                        <a class="code" href="../../d7/d09/geo_8cpp.html#a0233fe4ad7352b7918faeaf7aa5d8818">map_projection_init</a>(&amp;ref_pos, local_pos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#ad634aeca2e48fc3badeabf702712443c">ref_lat</a>, local_pos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a3e7159a2406220b8ba71fb6fc29e5725">ref_lon</a>);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                        <a class="code" href="../../d7/d09/geo_8cpp.html#a5ea48079b8cf05b1b7f7d2b96e07b7f3">map_projection_project</a>(&amp;ref_pos, lat, lon, &amp;home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a6cccfd19ff9b7e8075d8c14ab485ac63">x</a>, &amp;home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#abb00d6356fa27cb10bf632ed86fcddac">y</a>);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                        home-&gt;<a class="code" href="../../dc/d6d/structhome__position__s.html#a01b9c594d162ddd0ea3a9d3184095599">z</a> = -(alt - local_pos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#ac6becf13094bd56fdc0baa04bd5a2fb0">ref_alt</a>);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                        <span class="comment">/* announce new home position */</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                        <span class="keywordflow">if</span> (*home_pub != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(home_position), *home_pub, home);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                            *home_pub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(home_position), home);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                        }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                        <span class="comment">/* mark home position as set */</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                        status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                        cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                        cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                    }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                    cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_DENIED;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                }</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_NAV_GUIDED_ENABLE: {</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> res = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            <span class="keyword">static</span> <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a2f52ae536a2c0afd5c4e45e87c7cb522">main_state_t</a> main_state_pre_offboard = commander_state_s::MAIN_STATE_MANUAL;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordflow">if</span> (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_OFFBOARD) {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                main_state_pre_offboard = internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            }</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">if</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> &gt; 0.5f) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_OFFBOARD, status_flags, &amp;internal_state);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                <span class="keywordflow">if</span> (res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;OFFBOARD&quot;</span>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a90487f5880f298a4be4208abcbf46ec9">offboard_control_set_by_command</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                    <span class="comment">/* Set flag that offboard was set via command, main state is not overridden by rc */</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a90487f5880f298a4be4208abcbf46ec9">offboard_control_set_by_command</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                <span class="comment">/* If the mavlink command is used to enable or disable offboard control:</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">                 * switch back to previous mode when disabling */</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, main_state_pre_offboard, status_flags, &amp;internal_state);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a90487f5880f298a4be4208abcbf46ec9">offboard_control_set_by_command</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <span class="keywordflow">if</span> (res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        }</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_NAV_RETURN_TO_LAUNCH: {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <span class="comment">/* switch to RTL which ends the mission */</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_RTL, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Returning to launch&quot;</span>);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Return to launch denied&quot;</span>);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            }</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_NAV_TAKEOFF: {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="comment">/* ok, home set, use it to take off */</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_TAKEOFF, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_AUTO_TAKEOFF) {</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Takeoff denied, disarm and re-try&quot;</span>);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        }</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_NAV_LAND: {</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_LAND, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Landing at current position&quot;</span>);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Landing denied, land manually&quot;</span>);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        }</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_NAV_PRECLAND: {</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_PRECLAND, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Precision landing&quot;</span>);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Precision landing denied, land manually&quot;</span>);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            }</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_MISSION_START: {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_DENIED;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="comment">// check if current mission and first item are valid</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a22967f4ba02c22cbc1f09983ceb412db">condition_auto_mission_available</a>) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            <span class="comment">// requested first mission item valid</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="keywordflow">if</span> (PX4_ISFINITE(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>) &amp;&amp; (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> &gt;= -1) &amp;&amp; (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a> &lt; <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().seq_total)) {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                <span class="comment">// switch to AUTO_MISSION and ARM</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                <span class="keywordflow">if</span> ((<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> != <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(*status_local, commander_state_s::MAIN_STATE_AUTO_MISSION, status_flags, &amp;internal_state))</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                    &amp;&amp; (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> != <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(<span class="keyword">true</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;mission start command&quot;</span>))) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                    cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                    cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Mission start denied&quot;</span>);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Mission start denied, no valid mission&quot;</span>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_CONTROL_HIGH_LATENCY: {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <span class="keywordtype">bool</span> hl_exists = <span class="keyword">false</span>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8c09e8f28a090e8cae61e10d627f102a">ORB_MULTI_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].high_latency) {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                    hl_exists = <span class="keyword">true</span>;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                }</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            }</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="comment">// if no high latency telemetry exists send a failed acknowledge</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <span class="keywordflow">if</span> (!hl_exists) {</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                cmd_result = vehicle_command_s::VEHICLE_CMD_RESULT_FAILED;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Control high latency failed, no hl telemetry available&quot;</span>);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            }</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        }</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_CUSTOM_0:</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_CUSTOM_1:</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_CUSTOM_2:</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_MOUNT_CONTROL:</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_MOUNT_CONFIGURE:</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_MOUNT_CONTROL_QUAT:</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_REBOOT_SHUTDOWN:</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_CALIBRATION:</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_SET_SENSOR_OFFSETS:</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_STORAGE:</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_UAVCAN:</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PAYLOAD_PREPARE_DEPLOY:</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PAYLOAD_CONTROL_DEPLOY:</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_VTOL_TRANSITION:</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_TRIGGER_CONTROL:</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_DIGICAM_CONTROL:</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_CAM_TRIGG_DIST:</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_CAM_TRIGG_INTERVAL:</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_SET_CAMERA_MODE:</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_CHANGE_SPEED:</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_LAND_START:</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_GO_AROUND:</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_START_RX_PAIR:</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_LOGGING_START:</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_LOGGING_STOP:</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_NAV_DELAY:</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_ROI:</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_NAV_ROI:</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_ROI_LOCATION:</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_ROI_WPNEXT_OFFSET:</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_SET_ROI_NONE:</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_DO_ORBIT:</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="comment">/* ignore commands that are handled by other parts of the system */</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        <span class="comment">/* Warn about unsupported commands, this makes sense because only commands</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">         * to this component ID (or all) are passed by mavlink. */</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_UNSUPPORTED, *command_ack_pub);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">if</span> (cmd_result != vehicle_command_s::VEHICLE_CMD_RESULT_UNSUPPORTED) {</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <span class="comment">/* already warned about unsupported commands in &quot;default&quot; case */</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, cmd_result, *command_ack_pub);</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;}</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">* @brief This function initializes the home position an altitude of the vehicle. This happens first time we get a good GPS fix and each</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">*        time the vehicle is armed with a good GPS fix.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">**/</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l01049"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60"> 1049</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">Commander::set_home_position</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> &amp;homePub, <a class="code" href="../../dc/d6d/structhome__position__s.html">home_position_s</a> &amp;home, <span class="keywordtype">bool</span> set_alt_only_to_lpos_ref)</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;{</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/d36/structvehicle__local__position__s.html">vehicle_local_position_s</a> &amp;localPosition = <a class="code" href="../../d3/dc6/class_commander.html#af23998581890b6330bbded526e41c6c2">_local_position_sub</a>.<a class="code" href="../../d0/d65/classu_o_r_b_1_1_subscription.html#aa01d2ff362359aa05b64e93c6df668e0">get</a>();</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../da/dcb/structvehicle__global__position__s.html">vehicle_global_position_s</a> &amp;globalPosition = <a class="code" href="../../d3/dc6/class_commander.html#a10b495bdc2e05bbaa14fb7cf22481a4b">_global_position_sub</a>.get();</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">if</span> (!set_alt_only_to_lpos_ref) {</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="comment">//Need global and local position fix to be able to set home</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a> || !status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a160aaccd15cb7daf7d2533255c364dec">condition_local_position_valid</a>) {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        }</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="comment">//Ensure that the GPS accuracy is good enough for intializing home</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">if</span> (globalPosition.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#ad92e6508d09300498b54c7a227b2173f">eph</a> &gt; _home_eph_threshold.get() || globalPosition.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#a2d59429010e175af866935d9ad749d45">epv</a> &gt; _home_epv_threshold.get()) {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <span class="comment">// Set home position</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a93b8b23d202c9af3989e4be84c88cb8a">lat</a> = globalPosition.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#ac54e9f7030508c4633fd509e4c7ad3ff">lat</a>;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a719b8706b5e251c3ca85de8bb3ea46eb">lon</a> = globalPosition.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#a10c47986082d72c9a1ca7767a8ab7e9d">lon</a>;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a81736b88f32e773a42da7a9b79616e53">valid_hpos</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#ab2a80f05f7fea0dfe632c2893fde1829">alt</a> = globalPosition.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#a9a576ebabe4dc0ef1bff7c709d3b6e9a">alt</a>;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#affca1cec624c8bcf53bced8a1fa3174e">valid_alt</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a6cccfd19ff9b7e8075d8c14ab485ac63">x</a> = localPosition.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a9b67102131d452cb37c2b5c20eeaa25a">x</a>;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#abb00d6356fa27cb10bf632ed86fcddac">y</a> = localPosition.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a6129ef0612b94fe46408821b068dbecd">y</a>;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a01b9c594d162ddd0ea3a9d3184095599">z</a> = localPosition.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a544045618786171c0de95d5d3ee6f4b3">z</a>;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a17f2ace87bd73b3f2c6593e350c1519b">yaw</a> = localPosition.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#ab7e004388fbc3c6caad2379ecf9cd846">yaw</a>;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="comment">//Play tune first time we initialize HOME</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a>) {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#a93b848866e8f1f475dba5d34c911a7fb">tune_home_set</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        }</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        <span class="comment">/* mark home position as set */</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;        status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!home.<a class="code" href="../../dc/d6d/structhome__position__s.html#affca1cec624c8bcf53bced8a1fa3174e">valid_alt</a> &amp;&amp; localPosition.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#adb219481b72536d9c74ca2077e10d056">z_global</a>) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="comment">// handle special case where we are setting only altitude using local position reference</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#ab2a80f05f7fea0dfe632c2893fde1829">alt</a> = localPosition.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#ac6becf13094bd56fdc0baa04bd5a2fb0">ref_alt</a>;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        home.<a class="code" href="../../dc/d6d/structhome__position__s.html#affca1cec624c8bcf53bced8a1fa3174e">valid_alt</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    }</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a670e3ee95d617c1ca40de997c4b971d4">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a6ac17e9135ded73c11140645a4fd239d">manual_home</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="comment">/* announce new home position */</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">if</span> (homePub != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(home_position), homePub, &amp;home);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        homePub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(home_position), &amp;home);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;}</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l01111"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a86abaf98d17aeacd9aef07a0a9a6fb9a"> 1111</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#a86abaf98d17aeacd9aef07a0a9a6fb9a">Commander::run</a>()</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;{</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordtype">bool</span> sensor_fail_tune_played = <span class="keyword">false</span>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordtype">bool</span> arm_tune_played = <span class="keyword">false</span>;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordtype">bool</span> was_landed = <span class="keyword">true</span>;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordtype">bool</span> was_falling = <span class="keyword">false</span>;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordtype">bool</span> was_armed = <span class="keyword">false</span>;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">// XXX for now just set sensors as initialized</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#abf8f27de653a86414890a4928caff730">condition_system_sensors_initialized</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="comment">/* set parameters */</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_sys_type = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;MAV_TYPE&quot;</span>);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_system_id = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;MAV_SYS_ID&quot;</span>);</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_component_id = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;MAV_COMP_ID&quot;</span>);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_enable_datalink_loss = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;NAV_DLL_ACT&quot;</span>);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_offboard_loss_act = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_OBL_ACT&quot;</span>);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_offboard_loss_rc_act = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_OBL_RC_ACT&quot;</span>);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_enable_rc_loss = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;NAV_RCL_ACT&quot;</span>);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_datalink_loss_timeout = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_DL_LOSS_T&quot;</span>);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_highlatencydatalink_loss_timeout = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_HLDL_LOSS_T&quot;</span>);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_rc_loss_timeout = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_RC_LOSS_T&quot;</span>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_datalink_regain_timeout = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_DL_REG_T&quot;</span>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_highlatencydatalink_regain_timeout = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_HLDL_REG_T&quot;</span>);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_ef_throttle_thres = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_EF_THROT&quot;</span>);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_ef_current2throttle_thres = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_EF_C2T&quot;</span>);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_ef_time_thres = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_EF_TIME&quot;</span>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_rc_in_off = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_RC_IN_MODE&quot;</span>);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_rc_arm_hyst = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_RC_ARM_HYST&quot;</span>);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_min_stick_change = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_RC_STICK_OV&quot;</span>);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_geofence_action = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;GF_ACTION&quot;</span>);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_disarm_land = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_DISARM_LAND&quot;</span>);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_low_bat_act = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_LOW_BAT_ACT&quot;</span>);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_offboard_loss_timeout = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_OF_LOSS_T&quot;</span>);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_arm_without_gps = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_ARM_WO_GPS&quot;</span>);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_arm_switch_is_button = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_ARM_SWISBTN&quot;</span>);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_rc_override = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_RC_OVERRIDE&quot;</span>);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_arm_mission_required = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_ARM_MIS_REQ&quot;</span>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_flight_uuid = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_FLIGHT_UUID&quot;</span>);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_takeoff_finished_action = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_TAKEOFF_ACT&quot;</span>);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_fmode_1 = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_FLTMODE1&quot;</span>);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_fmode_2 = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_FLTMODE2&quot;</span>);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_fmode_3 = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_FLTMODE3&quot;</span>);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_fmode_4 = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_FLTMODE4&quot;</span>);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_fmode_5 = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_FLTMODE5&quot;</span>);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_fmode_6 = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_FLTMODE6&quot;</span>);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="comment">/* failsafe response to loss of navigation accuracy */</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <a class="code" href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a> _param_posctl_nav_loss_act = <a class="code" href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a>(<span class="stringliteral">&quot;COM_POSCTL_NAVL&quot;</span>);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="comment">/* pthread for slow low prio thread */</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    pthread_t commander_low_prio_thread;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="comment">/* initialize */</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d3d/aerocore2_2init_8c.html#aaff94d6fc452d6b3e28b9879fc344f7b">led_init</a>() != <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>) {</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a1456147685cf86fa9d058baf143ae141">PX4_WARN</a>(<span class="stringliteral">&quot;LED init failed&quot;</span>);</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    }</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../df/d08/commander__helper_8cpp.html#a3856cb2922ca5879cf4039f78b482df6">buzzer_init</a>() != <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>) {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a1456147685cf86fa9d058baf143ae141">PX4_WARN</a>(<span class="stringliteral">&quot;Buzzer init failed&quot;</span>);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordtype">int</span> power_button_state_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(power_button_state));</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    {</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="comment">// we need to do an initial publication to make sure uORB allocates the buffer, which cannot happen</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="comment">// in IRQ context.</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <a class="code" href="../../dd/db8/structpower__button__state__s.html">power_button_state_s</a> button_state;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ad9992550fcc33ebb4a18721e84266730">timestamp</a> = 0;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ac9d1fe794d88be48f84f6508f0c9ba0d">event</a> = 0xff;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#aa578d8384f0c48d5814fe5be88c4b3a9">power_button_state_pub</a> = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(power_button_state), &amp;button_state);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(power_button_state), power_button_state_sub, &amp;button_state);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    }</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d3d/pwr_8c.html#ab910bc35afda44ed87bd60c85bae1278">board_register_power_state_notification_cb</a>(<a class="code" href="../../da/d73/_commander_8cpp.html#a5bc5269a368d9e600d2319bd25a3e24a">power_button_state_notification_cb</a>) != 0) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;Failed to register power notification callback&quot;</span>);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    }</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">// We want to accept RC inputs as default</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2b48cdd399be15b5d8a85868e07fb009">rc_input_blocked</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a0b788807aa3def3dc8db87a124c0f552">rc_input_mode</a> = vehicle_status_s::RC_IN_MODE_DEFAULT;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> = commander_state_s::MAIN_STATE_MANUAL;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#a4f40eddad3e8b89feae1d4d7a5ff4e32">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">nav_state</a> = vehicle_status_s::NAVIGATION_STATE_MANUAL;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> = vehicle_status_s::ARMING_STATE_INIT;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">failsafe</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">/* neither manual nor offboard control commands have been received */</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a5e98dab42c762cafa7e5daccbafc7df1">offboard_control_signal_found_once</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ab523de02dbf3b2653d75b2f8c6568481">rc_signal_found_once</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="comment">/* mark all signals lost as long as they haven&#39;t been found */</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">rc_signal_lost</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#af5c7947e4a99fd45ecdac793f12b0ed0">offboard_control_signal_lost</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a89fea35afeeebd6ec26f230f995f5b74">offboard_control_loss_timeout</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">condition_system_hotplug_timeout</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a565a5ab4cfcae22faba52debbd7d855f">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a6f833ad768df9691686a66efc82b65ca">condition_power_input_valid</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a675c19070b0ca7956c113ce12c8e57d0">usb_connected</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a5f3ba300194ab441460971eb29f5be09">rc_calibration_valid</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="comment">// CIRCUIT BREAKERS</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a5fd2f6f34bd14719fe79d6fd5d7e2b89">circuit_breaker_engaged_power_check</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a02fe8d41494860e12091f8bc69476fd3">circuit_breaker_engaged_airspd_check</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2883f5d087a492fba009efe196d35399">circuit_breaker_engaged_enginefailure_check</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ad38d1e9d742cf10244b0769b7233f0ac">circuit_breaker_engaged_gpsfailure_check</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a55e27eff85d06cb0126947a279414da3">get_circuit_breaker_params</a>();</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">/* Set position and velocity validty to false */</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a160aaccd15cb7daf7d2533255c364dec">condition_local_position_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ac91747453f278b9349ddd13da330fa0c">condition_local_velocity_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a728a009d7b2aa98228f09d5b0ddf5da9">condition_local_altitude_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">/* publish initial state */</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a8394cc39ce8c41dba0adf2a5990ff1ed">status_pub</a> = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_status), &amp;status);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#a8394cc39ce8c41dba0adf2a5990ff1ed">status_pub</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;ERROR: orb_advertise for topic vehicle_status failed (uorb app running?).\n&quot;</span>);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;exiting.&quot;</span>);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <a class="code" href="../../da/d65/px4__tasks_8h.html#a242f0d89422bbfafc38856f4cb4a520c">px4_task_exit</a>(<a class="code" href="../../df/dd0/px4__defines_8h.html#a70e1b6490b2e0b591672067b5cb2a06b">PX4_ERROR</a>);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    }</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="comment">/* Initialize armed with all false */</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    memset(&amp;armed, 0, <span class="keyword">sizeof</span>(armed));</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="comment">/* armed topic */</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> armed_pub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(actuator_armed), &amp;armed);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> last_disarmed_timestamp = 0;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="comment">/* vehicle control mode topic */</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    memset(&amp;control_mode, 0, <span class="keyword">sizeof</span>(control_mode));</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> control_mode_pub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_control_mode), &amp;control_mode);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="comment">/* home position */</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> home_pub = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    memset(&amp;_home, 0, <span class="keyword">sizeof</span>(_home));</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="comment">/* command ack */</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> command_ack_pub = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> commander_state_pub = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> vehicle_status_flags_pub = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="comment">/* init mission state, do it here to allow navigator to use stored mission even if mavlink failed to start */</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#af1dc603ce8ac5c165ffbf71cc57f850f">mission_init</a>();</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    <span class="comment">/* Start monitoring loop */</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    <span class="keywordtype">unsigned</span> <a class="code" href="../../d4/d6d/safety_8c.html#a57451d202e70f5eafc93a3cc5e6c0c6e">counter</a> = 0;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    <span class="keywordtype">int</span> stick_off_counter = 0;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordtype">int</span> stick_on_counter = 0;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keywordtype">bool</span> low_battery_voltage_actions_done = <span class="keyword">false</span>;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordtype">bool</span> critical_battery_voltage_actions_done = <span class="keyword">false</span>;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keywordtype">bool</span> emergency_battery_voltage_actions_done = <span class="keyword">false</span>;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordtype">bool</span> dangerous_battery_level_requests_poweroff = <span class="keyword">false</span>;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordtype">bool</span> status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordtype">bool</span> param_init_forced = <span class="keyword">true</span>;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordtype">bool</span> updated = <span class="keyword">false</span>;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <span class="comment">/* Subscribe to safety topic */</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keywordtype">int</span> safety_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(safety));</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    memset(&amp;safety, 0, <span class="keyword">sizeof</span>(safety));</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    safety.<a class="code" href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_switch_available</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <span class="comment">/* Subscribe to geofence result topic */</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <span class="keywordtype">int</span> geofence_result_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(geofence_result));</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../de/d20/structgeofence__result__s.html">geofence_result_s</a> geofence_result;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    memset(&amp;geofence_result, 0, <span class="keyword">sizeof</span>(geofence_result));</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="comment">/* Subscribe to manual control data */</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keywordtype">int</span> sp_man_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(manual_control_setpoint));</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    memset(&amp;sp_man, 0, <span class="keyword">sizeof</span>(sp_man));</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="comment">/* Subscribe to offboard control data */</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="keywordtype">int</span> offboard_control_mode_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(offboard_control_mode));</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    memset(&amp;offboard_control_mode, 0, <span class="keyword">sizeof</span>(offboard_control_mode));</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="comment">/* Subscribe to land detector */</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordtype">int</span> land_detector_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_land_detected));</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="comment">/* Subscribe to command topic */</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordtype">int</span> cmd_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_command));</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="comment">/* Subscribe to parameters changed topic */</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="keywordtype">int</span> param_changed_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(parameter_update));</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="comment">/* Subscribe to battery topic */</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keywordtype">int</span> battery_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(battery_status));</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    memset(&amp;battery, 0, <span class="keyword">sizeof</span>(battery));</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="comment">/* Subscribe to subsystem info topic */</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keywordtype">int</span> subsys_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(subsystem_info));</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d2/d77/structsubsystem__info__s.html">subsystem_info_s</a> info;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    memset(&amp;info, 0, <span class="keyword">sizeof</span>(info));</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="comment">/* Subscribe to system power */</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="keywordtype">int</span> system_power_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(system_power));</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="comment">/* Subscribe to actuator controls (outputs) */</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keywordtype">int</span> actuator_controls_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a1d8875c6fa9f0e16530aaa02dc0b15a0">ORB_ID_VEHICLE_ATTITUDE_CONTROLS</a>);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="comment">/* Subscribe to vtol vehicle status topic */</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keywordtype">int</span> vtol_vehicle_status_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vtol_vehicle_status));</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="comment">//struct vtol_vehicle_status_s vtol_status;</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    memset(&amp;vtol_status, 0, <span class="keyword">sizeof</span>(vtol_status));</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#ac693321b0d448d89bc3405f42c0aca25">vtol_in_rw_mode</a> = <span class="keyword">true</span>;     <span class="comment">//default for vtol is rotary wing</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="keywordtype">int</span> cpuload_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(cpuload));</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    memset(&amp;cpuload, 0, <span class="keyword">sizeof</span>(cpuload));</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a11781677749dd4c7b3306165a9db7235">control_status_leds</a>(&amp;status, &amp;armed, <span class="keyword">true</span>, &amp;battery, &amp;cpuload);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="comment">/* update vehicle status to find out vehicle type (required for preflight checks) */</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    int32_t system_type;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_sys_type, &amp;system_type); <span class="comment">// get system type</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a77354aa68f159914167923823d9b3969">system_type</a> = (uint8_t)system_type;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> = <a class="code" href="../../df/d08/commander__helper_8cpp.html#a90a80fd140e5e1feba80ba0c5ef25c7c">is_rotary_wing</a>(&amp;status) || <a class="code" href="../../df/d08/commander__helper_8cpp.html#ac9d6d724d9a0766dab248d713484ecea">is_vtol</a>(&amp;status);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a6933ad99aa1ab7be2ca6bac09268fe7d">is_vtol</a> = <a class="code" href="../../df/d08/commander__helper_8cpp.html#ac9d6d724d9a0766dab248d713484ecea">is_vtol</a>(&amp;status);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="comment">// initially set to failed</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a507475e5384f1b19a477d4dcdcc96043">_last_lpos_fail_time_us</a> = <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a8ab1a540c7edb08e96e74a4b4e03ef73">_last_gpos_fail_time_us</a> = <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#af910bab86d61393dae3f0786476e6df9">_last_lvel_fail_time_us</a> = <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="comment">// Run preflight check</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    int32_t rc_in_off = 0;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_rc_in_off, &amp;rc_in_off);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    int32_t arm_switch_is_button = 0;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_arm_switch_is_button, &amp;arm_switch_is_button);</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    int32_t arm_without_gps_param = 0;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_arm_without_gps, &amp;arm_without_gps_param);</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a> = (arm_without_gps_param == 1) ? <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539af8cefe7a4cc03a758c7209dd6d721b79">ARM_REQ_NONE</a> : <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a7fbd2725bf089f82868a221a5694616b">ARM_REQ_GPS_BIT</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    int32_t arm_mission_required_param = 0;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_arm_mission_required, &amp;arm_mission_required_param);</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a> |= (arm_mission_required_param &amp; (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a6b89b750b7cbb3572b9f0c0e5af6af95">ARM_REQ_MISSION_BIT</a> | <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a5e98cfd3ee04ceb54280b7dce3976897">ARM_REQ_ARM_AUTH_BIT</a>));</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a0b788807aa3def3dc8db87a124c0f552">rc_input_mode</a> = rc_in_off;</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="comment">// user adjustable duration required to assert arm/disarm via throttle/rudder stick</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    int32_t rc_arm_hyst = 100;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_rc_arm_hyst, &amp;rc_arm_hyst);</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    rc_arm_hyst *= <a class="code" href="../../da/d73/_commander_8cpp.html#a8901a9ed66dcf0e34733f8bef2a511fe">COMMANDER_MONITORING_LOOPSPERMSEC</a>;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    int32_t datalink_loss_act = 0;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    int32_t rc_loss_act = 0;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    int32_t datalink_loss_timeout = 10;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    int32_t highlatencydatalink_loss_timeout = 120;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keywordtype">float</span> rc_loss_timeout = 0.5;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    int32_t datalink_regain_timeout = 0;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    int32_t highlatencydatalink_regain_timeout = 0;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordtype">float</span> offboard_loss_timeout = 0.0f;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    int32_t offboard_loss_act = 0;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    int32_t offboard_loss_rc_act = 0;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    int32_t posctl_nav_loss_act = 0;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    int32_t geofence_action = 0;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    int32_t flight_uuid = 0;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="comment">/* RC override auto modes */</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;    int32_t rc_override = 0;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    int32_t takeoff_complete_act = 0;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="comment">/* Thresholds for engine failure detection */</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordtype">float</span> ef_throttle_thres = 1.0f;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="keywordtype">float</span> ef_current2throttle_thres = 0.0f;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordtype">float</span> ef_time_thres = 1000.0f;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    uint64_t timestamp_engine_healthy = 0; <span class="comment">/**&lt; absolute time when engine was healty */</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    int32_t disarm_when_landed = 0;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    int32_t low_bat_action = 0;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="comment">/* check which state machines for changes, clear &quot;changed&quot; flag */</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordtype">bool</span> main_state_changed = <span class="keyword">false</span>;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="keywordtype">bool</span> failsafe_old = <span class="keyword">false</span>;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keywordtype">bool</span> have_taken_off_since_arming = <span class="keyword">false</span>;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="comment">/* initialize low priority thread */</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    pthread_attr_t commander_low_prio_attr;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <a class="code" href="../../d6/dfb/stubs__posix_8c.html#a0b85ebb1e3aac081a4c0a5e85ae3cbe9">pthread_attr_init</a>(&amp;commander_low_prio_attr);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <a class="code" href="../../d6/dfb/stubs__posix_8c.html#a812a9a455ae2ef2bb0dca4fff201a281">pthread_attr_setstacksize</a>(&amp;commander_low_prio_attr, <a class="code" href="../../d2/de9/px4__posix_8h.html#aac9185b05932251394cfc62241f1b47e">PX4_STACK_ADJUSTED</a>(3000));</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="preprocessor">#ifndef __PX4_QURT</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="comment">// This is not supported by QURT (yet).</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keyword">struct </span>sched_param param;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    (void)<a class="code" href="../../d6/dfb/stubs__posix_8c.html#afd3d272d702481044f8a8cd253fd9b47">pthread_attr_getschedparam</a>(&amp;commander_low_prio_attr, &amp;param);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">/* low priority */</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    param.sched_priority = SCHED_PRIORITY_DEFAULT - 50;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    (void)<a class="code" href="../../d6/dfb/stubs__posix_8c.html#a579e6529f0ce482312a5e77ac61cb4d5">pthread_attr_setschedparam</a>(&amp;commander_low_prio_attr, &amp;param);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ae5d18438d4d20c8a2e42cd2500578d79">pthread_create</a>(&amp;commander_low_prio_thread, &amp;commander_low_prio_attr, <a class="code" href="../../da/d73/_commander_8cpp.html#af62ee6f05861387a2bc3831c160afea8">commander_low_prio_loop</a>, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <a class="code" href="../../d6/dfb/stubs__posix_8c.html#a4bcdbf47c17c7dcc51e9f05f5cb56d81">pthread_attr_destroy</a>(&amp;commander_low_prio_attr);</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <a class="code" href="../../d0/d49/arm__auth_8cpp.html#a0a9c9025843ead7dbd98608fabd36d2a">arm_auth_init</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#adaecaa390e38921923f07353069200d0">system_id</a>);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">while</span> (!should_exit()) {</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> arming_ret = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="comment">/* update parameters */</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        <span class="keywordtype">bool</span> params_updated = <span class="keyword">false</span>;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(param_changed_sub, &amp;params_updated);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        <span class="keywordflow">if</span> (params_updated || param_init_forced) {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;            <span class="comment">/* parameters changed */</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d4/d2a/structparameter__update__s.html">parameter_update_s</a> param_changed;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(parameter_update), param_changed_sub, &amp;param_changed);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            <a class="code" href="../../db/db3/class_module_params.html#acf08d1a67a584f7b6e0feaa9182bede1">updateParams</a>();</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <span class="comment">/* update parameters */</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_sys_type, &amp;system_type) != <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>) {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                    <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;failed getting new system type&quot;</span>);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a77354aa68f159914167923823d9b3969">system_type</a> = (uint8_t)system_type;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                }</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                <span class="comment">/* disable manual override for all systems that rely on electronic stabilization */</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../df/d08/commander__helper_8cpp.html#a90a80fd140e5e1feba80ba0c5ef25c7c">is_rotary_wing</a>(&amp;status) || (<a class="code" href="../../df/d08/commander__helper_8cpp.html#ac9d6d724d9a0766dab248d713484ecea">is_vtol</a>(&amp;status) &amp;&amp; vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#ac693321b0d448d89bc3405f42c0aca25">vtol_in_rw_mode</a>)) {</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                <span class="comment">/* set vehicle_status.is_vtol flag */</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a6933ad99aa1ab7be2ca6bac09268fe7d">is_vtol</a> = <a class="code" href="../../df/d08/commander__helper_8cpp.html#ac9d6d724d9a0766dab248d713484ecea">is_vtol</a>(&amp;status);</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                <span class="comment">/* check and update system / component ID */</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                int32_t sys_id = 0;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_system_id, &amp;sys_id);</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#adaecaa390e38921923f07353069200d0">system_id</a> = sys_id;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                int32_t comp_id = 0;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_component_id, &amp;comp_id);</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a1a3cc064f154b4354a8fdcab80eeac4a">component_id</a> = comp_id;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                <a class="code" href="../../da/d73/_commander_8cpp.html#a55e27eff85d06cb0126947a279414da3">get_circuit_breaker_params</a>();</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            }</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            <span class="comment">/* Safety parameters */</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_enable_datalink_loss, &amp;datalink_loss_act);</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_enable_rc_loss, &amp;rc_loss_act);</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_datalink_loss_timeout, &amp;datalink_loss_timeout);</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_highlatencydatalink_loss_timeout, &amp;highlatencydatalink_loss_timeout);</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_rc_loss_timeout, &amp;rc_loss_timeout);</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_rc_in_off, &amp;rc_in_off);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a0b788807aa3def3dc8db87a124c0f552">rc_input_mode</a> = rc_in_off;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_rc_arm_hyst, &amp;rc_arm_hyst);</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_min_stick_change, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>);</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_rc_override, &amp;rc_override);</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            <span class="comment">// percentage (* 0.01) needs to be doubled because RC total interval is 2, not 1</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a> *= 0.02f;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            rc_arm_hyst *= <a class="code" href="../../da/d73/_commander_8cpp.html#a8901a9ed66dcf0e34733f8bef2a511fe">COMMANDER_MONITORING_LOOPSPERMSEC</a>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_datalink_regain_timeout, &amp;datalink_regain_timeout);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_highlatencydatalink_regain_timeout, &amp;highlatencydatalink_regain_timeout);</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_ef_throttle_thres, &amp;ef_throttle_thres);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_ef_current2throttle_thres, &amp;ef_current2throttle_thres);</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_ef_time_thres, &amp;ef_time_thres);</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_geofence_action, &amp;geofence_action);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_disarm_land, &amp;disarm_when_landed);</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_flight_uuid, &amp;flight_uuid);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            <span class="comment">// If we update parameters the first time</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            <span class="comment">// make sure the hysteresis time gets set.</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;            <span class="comment">// After that it will be set in the main state</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            <span class="comment">// machine based on the arming state.</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            <span class="keywordflow">if</span> (param_init_forced) {</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                <a class="code" href="../../da/d73/_commander_8cpp.html#a8a8c8d54731fad55667b29782218e016">auto_disarm_hysteresis</a>.<a class="code" href="../../de/da3/classsystemlib_1_1_hysteresis.html#ab6beddd49f853bc44d352bff928944fa">set_hysteresis_time_from</a>(<span class="keyword">false</span>, disarm_when_landed * 1_s);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            }</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_low_bat_act, &amp;low_bat_action);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_offboard_loss_timeout, &amp;offboard_loss_timeout);</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_offboard_loss_act, &amp;offboard_loss_act);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_offboard_loss_rc_act, &amp;offboard_loss_rc_act);</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_arm_switch_is_button, &amp;arm_switch_is_button);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_arm_without_gps, &amp;arm_without_gps_param);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a> = (arm_without_gps_param == 1) ? <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539af8cefe7a4cc03a758c7209dd6d721b79">ARM_REQ_NONE</a> : <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a7fbd2725bf089f82868a221a5694616b">ARM_REQ_GPS_BIT</a>;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_arm_mission_required, &amp;arm_mission_required_param);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a> |= (arm_mission_required_param &amp; (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a6b89b750b7cbb3572b9f0c0e5af6af95">ARM_REQ_MISSION_BIT</a> | <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a5e98cfd3ee04ceb54280b7dce3976897">ARM_REQ_ARM_AUTH_BIT</a>));</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            <span class="comment">/* flight mode slots */</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_fmode_1, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[0]);</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_fmode_2, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[1]);</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_fmode_3, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[2]);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_fmode_4, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[3]);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_fmode_5, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[4]);</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_fmode_6, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[5]);</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;            <span class="comment">/* failsafe response to loss of navigation accuracy */</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_posctl_nav_loss_act, &amp;posctl_nav_loss_act);</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            <a class="code" href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a>(_param_takeoff_finished_action, &amp;takeoff_complete_act);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            param_init_forced = <span class="keyword">false</span>;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        }</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="comment">/* handle power button state */</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(power_button_state_sub, &amp;updated);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            <a class="code" href="../../dd/db8/structpower__button__state__s.html">power_button_state_s</a> button_state;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(power_button_state), power_button_state_sub, &amp;button_state);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;            <span class="keywordflow">if</span> (button_state.<a class="code" href="../../dd/db8/structpower__button__state__s.html#ac9d1fe794d88be48f84f6508f0c9ba0d">event</a> == power_button_state_s::PWR_BUTTON_STATE_REQUEST_SHUTDOWN) {</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                <a class="code" href="../../df/d04/shutdown_8cpp.html#ac973512abb1ee1d0cacd5df9e1f68b6a">px4_shutdown_request</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            }</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        }</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(sp_man_sub, &amp;updated);</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(manual_control_setpoint), sp_man_sub, &amp;sp_man);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        }</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(offboard_control_mode_sub, &amp;updated);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(offboard_control_mode), offboard_control_mode_sub, &amp;offboard_control_mode);</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        }</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <span class="keywordflow">if</span> (offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a6d7fd315d60485d2b13fdc0f1ec273b0">timestamp</a> != 0 &amp;&amp;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a6d7fd315d60485d2b13fdc0f1ec273b0">timestamp</a> + <a class="code" href="../../da/d73/_commander_8cpp.html#a0bb55b41f149880b19556b510bfd8b26">OFFBOARD_TIMEOUT</a> &gt; <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>()) {</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#af5c7947e4a99fd45ecdac793f12b0ed0">offboard_control_signal_lost</a>) {</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#af5c7947e4a99fd45ecdac793f12b0ed0">offboard_control_signal_lost</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;                status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a89fea35afeeebd6ec26f230f995f5b74">offboard_control_loss_timeout</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;            }</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;            <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#af5c7947e4a99fd45ecdac793f12b0ed0">offboard_control_signal_lost</a>) {</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#af5c7947e4a99fd45ecdac793f12b0ed0">offboard_control_signal_lost</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            }</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            <span class="comment">/* check timer if offboard was there but now lost */</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a89fea35afeeebd6ec26f230f995f5b74">offboard_control_loss_timeout</a> &amp;&amp; offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a6d7fd315d60485d2b13fdc0f1ec273b0">timestamp</a> != 0) {</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                <span class="keywordflow">if</span> (offboard_loss_timeout &lt; FLT_EPSILON) {</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;                    <span class="comment">/* execute loss action immediately */</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a89fea35afeeebd6ec26f230f995f5b74">offboard_control_loss_timeout</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                    <span class="comment">/* wait for timeout if set */</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a89fea35afeeebd6ec26f230f995f5b74">offboard_control_loss_timeout</a> = offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a6d7fd315d60485d2b13fdc0f1ec273b0">timestamp</a> +</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                            <a class="code" href="../../da/d73/_commander_8cpp.html#a0bb55b41f149880b19556b510bfd8b26">OFFBOARD_TIMEOUT</a> + offboard_loss_timeout * 1e6f &lt; <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                }</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a89fea35afeeebd6ec26f230f995f5b74">offboard_control_loss_timeout</a>) {</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                }</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            }</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        }</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <span class="comment">// poll the telemetry status</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <a class="code" href="../../d3/dc6/class_commander.html#a7b9c381b03caead8f28b7b8b69a6d5cd">poll_telemetry_status</a>();</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(system_power_sub, &amp;updated);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            <a class="code" href="../../d5/d64/structsystem__power__s.html">system_power_s</a> system_power = {};</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(system_power), system_power_sub, &amp;system_power);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;system_power.<a class="code" href="../../d5/d64/structsystem__power__s.html#afe13ca57e9b25fc674a07ecb14a97975">timestamp</a>) &lt; 200_ms) {</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                <span class="keywordflow">if</span> (system_power.<a class="code" href="../../d5/d64/structsystem__power__s.html#a8aada9af06ed11bf4b219615c42eae4d">servo_valid</a> &amp;&amp;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                    !system_power.<a class="code" href="../../d5/d64/structsystem__power__s.html#abb6386885b9fd026949aa75ccb50bdda">brick_valid</a> &amp;&amp;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                    !system_power.<a class="code" href="../../d5/d64/structsystem__power__s.html#a71d2a39e424f04cd5a035bddf2d354a1">usb_connected</a>) {</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                    <span class="comment">/* flying only on servo rail, this is unsafe */</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a6f833ad768df9691686a66efc82b65ca">condition_power_input_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a6f833ad768df9691686a66efc82b65ca">condition_power_input_valid</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                }</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                <span class="comment">/* if the USB hardware connection went away, reboot */</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a675c19070b0ca7956c113ce12c8e57d0">usb_connected</a> &amp;&amp; !system_power.<a class="code" href="../../d5/d64/structsystem__power__s.html#a71d2a39e424f04cd5a035bddf2d354a1">usb_connected</a>) {</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                    <span class="comment">/*</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">                     * apparently the USB cable went away but we are still powered,</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">                     * so lets reset to a classic non-usb state.</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">                     */</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;USB disconnected, rebooting.&quot;</span>)</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                    <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(400000);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                    <a class="code" href="../../df/d04/shutdown_8cpp.html#ac973512abb1ee1d0cacd5df9e1f68b6a">px4_shutdown_request</a>(<span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                }</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            }</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        }</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="comment">/* update safety topic */</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(safety_sub, &amp;updated);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            <span class="keywordtype">bool</span> previous_safety_off = safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a>;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(safety), safety_sub, &amp;safety) == <a class="code" href="../../df/dd0/px4__defines_8h.html#a3c8cfc47ec868777204de29272228e79">PX4_OK</a>) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                <span class="comment">/* disarm if safety is now on and still armed */</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> &amp;&amp; (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a477f9050e58a25f419da7f643b4c52fb">hil_state</a> == vehicle_status_s::HIL_STATE_OFF)</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                    &amp;&amp; safety.<a class="code" href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_switch_available</a> &amp;&amp; !safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a>) {</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a>(&amp;status, battery, safety, vehicle_status_s::ARMING_STATE_STANDBY,</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                            &amp;armed, <span class="keyword">true</span> <span class="comment">/* fRunPreArmChecks */</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>,</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                            &amp;status_flags, <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>))</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                       ) {</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                        status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                    }</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                }</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                <span class="comment">// Notify the user if the status of the safety switch changes</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                <span class="keywordflow">if</span> (safety.<a class="code" href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_switch_available</a> &amp;&amp; previous_safety_off != safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a>) {</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                    <span class="keywordflow">if</span> (safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a>) {</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a85bd5445469c33c209c0947ec5050d67">set_tune</a>(<a class="code" href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca72d04553574119dc4ec64a7109f41615">TONE_NOTIFY_POSITIVE_TUNE</a>);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                        <a class="code" href="../../df/d08/commander__helper_8cpp.html#ad3a2cfa84c8bc14c5d6dc35fcb98ec27">tune_neutral</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                    }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                }</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;            }</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        }</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        <span class="comment">/* update vtol vehicle status*/</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(vtol_vehicle_status_sub, &amp;updated);</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;            <span class="comment">/* vtol status changed */</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vtol_vehicle_status), vtol_vehicle_status_sub, &amp;vtol_status);</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ab1296ede7579a9dc43aa8a9a6bd06b3a">vtol_fw_permanent_stab</a> = vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#aec88b6ced052abc9e7fe5d5a2a31223a">fw_permanent_stab</a>;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <span class="comment">/* Make sure that this is only adjusted if vehicle really is of type vtol */</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../df/d08/commander__helper_8cpp.html#ac9d6d724d9a0766dab248d713484ecea">is_vtol</a>(&amp;status)) {</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                <span class="comment">// Check if there has been any change while updating the flags</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> != vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#ac693321b0d448d89bc3405f42c0aca25">vtol_in_rw_mode</a>) {</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> = vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#ac693321b0d448d89bc3405f42c0aca25">vtol_in_rw_mode</a>;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                }</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a> != vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#a2bfa5197c337c95901e7384087d10a51">vtol_in_trans_mode</a>) {</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a> = vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#a2bfa5197c337c95901e7384087d10a51">vtol_in_trans_mode</a>;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                }</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ac8d6d35a973defcbdd48f855ee191044">in_transition_to_fw</a> != vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#a9c8011a22816871714ab7a7c7099019e">in_transition_to_fw</a>) {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ac8d6d35a973defcbdd48f855ee191044">in_transition_to_fw</a> = vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#a9c8011a22816871714ab7a7c7099019e">in_transition_to_fw</a>;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                }</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a564b08611fcdc00e94d8a30a53584722">vtol_transition_failure</a> != vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#ab62ff4972289ff4622e0d4b7b06ccce3">vtol_transition_failsafe</a>) {</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a564b08611fcdc00e94d8a30a53584722">vtol_transition_failure</a> = vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#ab62ff4972289ff4622e0d4b7b06ccce3">vtol_transition_failsafe</a>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                }</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a0c785f711e5a5a4bb0104ff5670e85a7">soft_stop</a> != !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a>) {</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                    armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a0c785f711e5a5a4bb0104ff5670e85a7">soft_stop</a> = !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a>;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                }</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            }</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        }</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <a class="code" href="../../d3/dc6/class_commander.html#a800e1be6a8f20efff3869495f08dde3a">estimator_check</a>(&amp;status_changed);</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="comment">/* Update land detector */</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(land_detector_sub, &amp;updated);</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_land_detected), land_detector_sub, &amp;land_detector);</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            <span class="comment">// Only take actions if armed</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                <span class="keywordflow">if</span> (was_landed != land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>) {</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                    <span class="keywordflow">if</span> (land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>) {</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Landing detected&quot;</span>);</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Takeoff detected&quot;</span>);</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                        have_taken_off_since_arming = <span class="keyword">true</span>;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                        <span class="comment">// Set all position and velocity test probation durations to takeoff value</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                        <span class="comment">// This is a larger value to give the vehicle time to complete a failsafe landing</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                        <span class="comment">// if faulty sensors cause loss of navigation shortly after takeoff.</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                        <a class="code" href="../../d3/dc6/class_commander.html#a3e39683a9372d76c388ad29ac0ccf5f1">_gpos_probation_time_us</a> = _failsafe_pos_probation.get() * 1_s;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                        <a class="code" href="../../d3/dc6/class_commander.html#a9a354bcb8a90b2090e15d1ae25894a34">_lpos_probation_time_us</a> = _failsafe_pos_probation.get() * 1_s;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                        <a class="code" href="../../d3/dc6/class_commander.html#a58568c8d5856cb438e8bfbc9592da526">_lvel_probation_time_us</a> = _failsafe_pos_probation.get() * 1_s;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                    }</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                }</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;                <span class="keywordflow">if</span> (was_falling != land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a538b7032a1788f22c0b9f6cdf96da0e6">freefall</a>) {</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;                    <span class="keywordflow">if</span> (land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a538b7032a1788f22c0b9f6cdf96da0e6">freefall</a>) {</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Freefall detected&quot;</span>);</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                    }</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                }</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            }</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;            was_landed = land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            was_falling = land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a538b7032a1788f22c0b9f6cdf96da0e6">freefall</a>;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        }</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="comment">/* Update hysteresis time. Use a time of factor 5 longer if we have not taken off yet. */</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> timeout_time = disarm_when_landed * 1_s;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        <span class="keywordflow">if</span> (!have_taken_off_since_arming) {</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            timeout_time *= 5;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        }</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a8a8c8d54731fad55667b29782218e016">auto_disarm_hysteresis</a>.<a class="code" href="../../de/da3/classsystemlib_1_1_hysteresis.html#ab6beddd49f853bc44d352bff928944fa">set_hysteresis_time_from</a>(<span class="keyword">false</span>, timeout_time);</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;        <span class="comment">// Check for auto-disarm</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> &amp;&amp; land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a> &amp;&amp; disarm_when_landed &gt; 0) {</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a8a8c8d54731fad55667b29782218e016">auto_disarm_hysteresis</a>.<a class="code" href="../../de/da3/classsystemlib_1_1_hysteresis.html#ad18f5f4835b9d51a4efa952b30e1b8b7">set_state_and_update</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a8a8c8d54731fad55667b29782218e016">auto_disarm_hysteresis</a>.<a class="code" href="../../de/da3/classsystemlib_1_1_hysteresis.html#ad18f5f4835b9d51a4efa952b30e1b8b7">set_state_and_update</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        }</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#a8a8c8d54731fad55667b29782218e016">auto_disarm_hysteresis</a>.<a class="code" href="../../de/da3/classsystemlib_1_1_hysteresis.html#a5143218563224b1fd4113a8e25234830">get_state</a>()) {</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a>(<span class="keyword">false</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;auto disarm on land&quot;</span>);</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        }</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a>) {</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;            <span class="comment">// store the last good main_state when not in an navigation</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            <span class="comment">// hold state</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> = internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a>;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_AUTO_RTL</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;               &amp;&amp; internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_AUTO_LOITER</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;               &amp;&amp; internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_AUTO_LAND) {</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            <span class="comment">// reset flag again when we switched out of it</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        }</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(cpuload_sub, &amp;updated);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(cpuload), cpuload_sub, &amp;cpuload);</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        }</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="comment">/* update battery status */</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(battery_sub, &amp;updated);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(battery_status), battery_sub, &amp;battery);</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            <span class="comment">/* only consider battery voltage if system has been running 6s (usb most likely detected) and battery voltage is valid */</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>) &gt; 6_s)</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;                &amp;&amp; battery.<a class="code" href="../../d0/d5c/structbattery__status__s.html#a54fa5c303ebc3d6ef3d3f79a8e12ea84">voltage_filtered_v</a> &gt; 2.0f * FLT_EPSILON) {</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;                <span class="comment">/* if battery voltage is getting lower, warn using buzzer, etc. */</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;                <span class="keywordflow">if</span> (battery.<a class="code" href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">warning</a> == battery_status_s::BATTERY_WARNING_LOW &amp;&amp;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                    !low_battery_voltage_actions_done) {</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                    low_battery_voltage_actions_done = <span class="keyword">true</span>;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;                    <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;LOW BATTERY, RETURN TO LAND ADVISED&quot;</span>);</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;LOW BATTERY, TAKEOFF DISCOURAGED&quot;</span>);</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;                    }</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (battery.<a class="code" href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">warning</a> == battery_status_s::BATTERY_WARNING_CRITICAL &amp;&amp;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                       !critical_battery_voltage_actions_done) {</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                    critical_battery_voltage_actions_done = <span class="keyword">true</span>;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                    <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CRITICAL BATTERY, SHUT SYSTEM DOWN&quot;</span>);</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                        <span class="keywordflow">if</span> (low_bat_action == 1 || low_bat_action == 3) {</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                            <span class="comment">// let us send the critical message even if already in RTL</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> != <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_RTL, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                                <a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CRITICAL BATTERY, RETURNING TO LAND&quot;</span>);</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CRITICAL BATTERY, RTL FAILED&quot;</span>);</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                            }</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (low_bat_action == 2) {</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> != <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_LAND, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                                <a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CRITICAL BATTERY, LANDING AT CURRENT POSITION&quot;</span>);</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CRITICAL BATTERY, LANDING FAILED&quot;</span>);</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;                            }</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CRITICAL BATTERY, RETURN TO LAUNCH ADVISED!&quot;</span>);</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                        }</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                    }</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (battery.<a class="code" href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">warning</a> == battery_status_s::BATTERY_WARNING_EMERGENCY &amp;&amp;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                       !emergency_battery_voltage_actions_done) {</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                    emergency_battery_voltage_actions_done = <span class="keyword">true</span>;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                    <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                        <span class="comment">// Request shutdown at the end of the cycle. This allows</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                        <span class="comment">// the vehicle state to be published after emergency landing</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                        dangerous_battery_level_requests_poweroff = <span class="keyword">true</span>;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                        <span class="keywordflow">if</span> (low_bat_action == 2 || low_bat_action == 3) {</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_LAND, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                                <a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;DANGEROUS BATTERY LEVEL, LANDING IMMEDIATELY&quot;</span>);</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;DANGEROUS BATTERY LEVEL, LANDING FAILED&quot;</span>);</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                            }</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;DANGEROUS BATTERY LEVEL, LANDING ADVISED!&quot;</span>);</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                        }</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                    }</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                }</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                <span class="comment">/* End battery voltage check */</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            }</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;        }</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;        <span class="comment">/* update subsystem info which arrives from outside of commander*/</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;        <span class="keywordflow">do</span> {</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(subsys_sub, &amp;updated);</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;            <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(subsystem_info), subsys_sub, &amp;info);</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                <a class="code" href="../../d0/dc0/health__flag__helper_8cpp.html#a3523b6bbd000329099eed54f4994dbf1">set_health_flags</a>(info.<a class="code" href="../../d2/d77/structsubsystem__info__s.html#ae88ed921e58882855dc9bdba521e5250">subsystem_type</a>, info.<a class="code" href="../../d2/d77/structsubsystem__info__s.html#a2a3e8f0aa814145ffce5e91b89cc7ad4">present</a>, info.<a class="code" href="../../d2/d77/structsubsystem__info__s.html#a75c83be03c2805eee14b5d215bf88edb">enabled</a>, info.<a class="code" href="../../d2/d77/structsubsystem__info__s.html#a2b1fcc36dc57d1fa226fcc69088afc06">ok</a>, status);</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            }</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;        } <span class="keywordflow">while</span>(updated);</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;        <span class="comment">/* If in INIT state, try to proceed to STANDBY state */</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#aae8f00ee97a82f182912b95d4b017df5">condition_calibration_enabled</a> &amp;&amp; status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_INIT) {</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;            arming_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a>(&amp;status, battery, safety, vehicle_status_s::ARMING_STATE_STANDBY, &amp;armed,</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                                 <span class="keyword">true</span> <span class="comment">/* fRunPreArmChecks */</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;status_flags,</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                                 <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>));</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            <span class="keywordflow">if</span> (arming_ret == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                <span class="comment">/* do not complain if not allowed into standby */</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                arming_ret = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            }</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        }</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        <span class="comment">/* start mission result check */</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> prev_mission_instance_count = <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().instance_count;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.update()) {</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d5/dd1/structmission__result__s.html">mission_result_s</a> &amp;mission_result = <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get();</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            <span class="comment">// if mission_result is valid for the current mission</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> mission_result_ok = (mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#a6e06db9b2266dbe0a2f302f5c42cec98">timestamp</a> &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>) &amp;&amp; (mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#ad18bbbbc2a2bade91480f6cf56029f63">instance_count</a> &gt; 0);</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a22967f4ba02c22cbc1f09983ceb412db">condition_auto_mission_available</a> = mission_result_ok &amp;&amp; mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#aebceada7bf8a7fa201333d19b6de8a9b">valid</a>;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;            <span class="keywordflow">if</span> (mission_result_ok) {</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af4cedc421ae8ff1d0036ffae953f4ff1">mission_failure</a> != mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#a3634ac27af85453b6438000b5da5eacb">failure</a>) {</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af4cedc421ae8ff1d0036ffae953f4ff1">mission_failure</a> = mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#a3634ac27af85453b6438000b5da5eacb">failure</a>;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                    <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af4cedc421ae8ff1d0036ffae953f4ff1">mission_failure</a>) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Mission cannot be completed&quot;</span>);</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;                    }</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                }</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                <span class="comment">/* Only evaluate mission state if home is set */</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;                <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a> &amp;&amp;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                    (prev_mission_instance_count != mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#ad18bbbbc2a2bade91480f6cf56029f63">instance_count</a>)) {</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                    <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a22967f4ba02c22cbc1f09983ceb412db">condition_auto_mission_available</a>) {</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                        <span class="comment">/* the mission is invalid */</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a0fbfdcc7204af2e319abaf40e7d2b0be">tune_mission_fail</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#ad8c83264a64a3a8fef920e042915b8d6">warning</a>) {</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                        <span class="comment">/* the mission has a warning */</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a0fbfdcc7204af2e319abaf40e7d2b0be">tune_mission_fail</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                        <span class="comment">/* the mission is valid */</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                        <a class="code" href="../../df/d08/commander__helper_8cpp.html#aa021364ef29e453bc47ea80afec2af55">tune_mission_ok</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                    }</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                }</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            }</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        }</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="comment">/* start geofence result check */</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(geofence_result_sub, &amp;updated);</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(geofence_result), geofence_result_sub, &amp;geofence_result);</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        }</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        <span class="comment">// Geofence actions</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> &amp;&amp; (geofence_result.<a class="code" href="../../de/d20/structgeofence__result__s.html#aa4a2d86a221517f743d953e7f481f0c4">geofence_action</a> != geofence_result_s::GF_ACTION_NONE)) {</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;            <span class="keyword">static</span> <span class="keywordtype">bool</span> geofence_loiter_on = <span class="keyword">false</span>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;            <span class="keyword">static</span> <span class="keywordtype">bool</span> geofence_rtl_on = <span class="keyword">false</span>;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;            <span class="comment">// check for geofence violation</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;            <span class="keywordflow">if</span> (geofence_result.<a class="code" href="../../de/d20/structgeofence__result__s.html#a276582775437eb350e7c20d739c4b4e5">geofence_violated</a>) {</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                <span class="keyword">static</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> last_geofence_violation = 0;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> geofence_violation_action_interval = 10_s;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;last_geofence_violation) &gt; geofence_violation_action_interval) {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                    last_geofence_violation = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                    <span class="keywordflow">switch</span> (geofence_result.<a class="code" href="../../de/d20/structgeofence__result__s.html#aa4a2d86a221517f743d953e7f481f0c4">geofence_action</a>) {</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                        <span class="keywordflow">case</span> (geofence_result_s::GF_ACTION_NONE) : {</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                            <span class="comment">// do nothing</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;                        }</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                        <span class="keywordflow">case</span> (geofence_result_s::GF_ACTION_WARN) : {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                            <span class="comment">// do nothing, mavlink critical messages are sent by navigator</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                        }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                        <span class="keywordflow">case</span> (geofence_result_s::GF_ACTION_LOITER) : {</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                                geofence_loiter_on = <span class="keyword">true</span>;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;                            }</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                        }</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                        <span class="keywordflow">case</span> (geofence_result_s::GF_ACTION_RTL) : {</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_RTL, status_flags, &amp;internal_state)) {</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                                geofence_rtl_on = <span class="keyword">true</span>;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;                            }</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;                        }</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;                        <span class="keywordflow">case</span> (geofence_result_s::GF_ACTION_TERMINATE) : {</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                            <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;Flight termination because of geofence&quot;</span>);</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Geofence violation: flight termination&quot;</span>);</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                            armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#af8c77c6ad99b1b28aea8bdade01d5b44">force_failsafe</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                            status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                        }</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                    }</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;                }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            }</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            <span class="comment">// reset if no longer in LOITER or if manually switched to LOITER</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            geofence_loiter_on = geofence_loiter_on</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                         &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_AUTO_LOITER)</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                         &amp;&amp; (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8a3174a9dbd2ed822ef1ead8b3b2adaa">loiter_switch</a> == manual_control_setpoint_s::SWITCH_POS_OFF</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;                         || sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8a3174a9dbd2ed822ef1ead8b3b2adaa">loiter_switch</a> == manual_control_setpoint_s::SWITCH_POS_NONE);</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;            <span class="comment">// reset if no longer in RTL or if manually switched to RTL</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;            geofence_rtl_on = geofence_rtl_on</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;                      &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_AUTO_RTL)</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;                      &amp;&amp; (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a4a95c9c57e780fd2be653c6031104c96">return_switch</a> == manual_control_setpoint_s::SWITCH_POS_OFF</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;                          || sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a4a95c9c57e780fd2be653c6031104c96">return_switch</a> == manual_control_setpoint_s::SWITCH_POS_NONE);</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> = <a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> || (geofence_loiter_on || geofence_rtl_on);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        }</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        <span class="comment">// revert geofence failsafe transition if sticks are moved and we were previously in a manual mode</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        <span class="comment">// but only if not in a low battery handling action</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        <span class="keywordflow">if</span> (rc_override != 0 &amp;&amp; !critical_battery_voltage_actions_done &amp;&amp; (<a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a> &amp;&amp;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                (<a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> == commander_state_s::MAIN_STATE_MANUAL ||</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                 <a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> == commander_state_s::MAIN_STATE_ALTCTL ||</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                 <a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> == commander_state_s::MAIN_STATE_POSCTL ||</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                 <a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> == commander_state_s::MAIN_STATE_ACRO ||</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;                 <a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> == commander_state_s::MAIN_STATE_RATTITUDE ||</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                 <a class="code" href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a> == commander_state_s::MAIN_STATE_STAB))) {</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;            <span class="comment">// transition to previous state if sticks are touched</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            <span class="keywordflow">if</span> ((_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> != sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a>) &amp;&amp;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                ((fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a0087298fe10a24a1846302fcb16ce493">x</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a0087298fe10a24a1846302fcb16ce493">x</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>) ||</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                 (fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab0b913ff61a273187a2b264ee91399e5">y</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab0b913ff61a273187a2b264ee91399e5">y</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>) ||</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                 (fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>) ||</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                 (fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>))) {</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                <span class="comment">// revert to position control in any case</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_POSCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Autopilot off, returned control to pilot&quot;</span>);</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;            }</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        }</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        <span class="comment">// abort landing or auto or loiter if sticks are moved significantly</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <span class="comment">// but only if not in a low battery handling action</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <span class="keywordflow">if</span> (rc_override != 0 &amp;&amp; !critical_battery_voltage_actions_done &amp;&amp;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_AUTO_LAND ||</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;             internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_AUTO_MISSION ||</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;             internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_AUTO_LOITER)) {</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            <span class="comment">// transition to previous state if sticks are touched</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            <span class="keywordflow">if</span> ((_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> != sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a>) &amp;&amp;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                ((fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a0087298fe10a24a1846302fcb16ce493">x</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a0087298fe10a24a1846302fcb16ce493">x</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>) ||</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                 (fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab0b913ff61a273187a2b264ee91399e5">y</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab0b913ff61a273187a2b264ee91399e5">y</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>) ||</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;                 (fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>) ||</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;                 (fabsf(sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a> - _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a>))) {</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;                <span class="comment">// revert to position control in any case</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_POSCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Autopilot off, returned control to pilot&quot;</span>);</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;            }</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        }</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        <span class="comment">/* Check for mission flight termination */</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> &amp;&amp; <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().flight_termination &amp;&amp;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;            !status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a7bf26316cc590a9f16bd15abf4469870">circuit_breaker_flight_termination_disabled</a>) {</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#af8c77c6ad99b1b28aea8bdade01d5b44">force_failsafe</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            <span class="keyword">static</span> <span class="keywordtype">bool</span> flight_termination_printed = <span class="keyword">false</span>;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="keywordflow">if</span> (!flight_termination_printed) {</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Geofence violation: flight termination&quot;</span>);</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                flight_termination_printed = <span class="keyword">true</span>;</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;            }</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;            <span class="keywordflow">if</span> (counter % (1000000 / <a class="code" href="../../da/d73/_commander_8cpp.html#a3486f705b15b9507c8236c09c9f317c3">COMMANDER_MONITORING_INTERVAL</a>) == 0) {</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Flight termination active&quot;</span>);</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            }</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        }</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="comment">/* RC input check */</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2b48cdd399be15b5d8a85868e07fb009">rc_input_blocked</a> &amp;&amp; sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> != 0 &amp;&amp;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a>) &lt; (rc_loss_timeout * 1_s))) {</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;            <span class="comment">/* handle the case where RC signal was regained */</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;            <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ab523de02dbf3b2653d75b2f8c6568481">rc_signal_found_once</a>) {</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ab523de02dbf3b2653d75b2f8c6568481">rc_signal_found_once</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                <a class="code" href="../../d0/dc0/health__flag__helper_8cpp.html#a3523b6bbd000329099eed54f4994dbf1">set_health_flags</a>(subsystem_info_s::SUBSYSTEM_TYPE_RCRECEIVER, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span> &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a5f3ba300194ab441460971eb29f5be09">rc_calibration_valid</a>, status);</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">rc_signal_lost</a>) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;MANUAL CONTROL REGAINED after %llums&quot;</span>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#afd0a2e6a4c9209262305d2f15ca74e4f">rc_signal_lost_timestamp</a>) / 1000);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;                    <a class="code" href="../../d0/dc0/health__flag__helper_8cpp.html#a3523b6bbd000329099eed54f4994dbf1">set_health_flags</a>(subsystem_info_s::SUBSYSTEM_TYPE_RCRECEIVER, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">true</span> &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a5f3ba300194ab441460971eb29f5be09">rc_calibration_valid</a>, status);</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                }</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            }</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">rc_signal_lost</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> in_armed_state = (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_ARMED);</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> arm_switch_or_button_mapped = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">arm_switch</a> != manual_control_setpoint_s::SWITCH_POS_NONE;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> arm_button_pressed = arm_switch_is_button == 1</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                            &amp;&amp; sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">arm_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            <span class="comment">/* DISARM</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">             * check if left stick is in lower left position or arm button is pushed or arm switch has transition from arm to disarm</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="comment">             * and we are in MANUAL, Rattitude, or AUTO_READY mode or (ASSIST mode and landed)</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">             * do it only for rotary wings in manual mode or fixed wing if landed.</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment">             * Disable stick-disarming if arming switch or button is mapped */</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> stick_in_lower_left = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a> &lt; -<a class="code" href="../../da/d73/_commander_8cpp.html#a1b0e4cbb477cef67a15af010278c80f1">STICK_ON_OFF_LIMIT</a> &amp;&amp; sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a> &lt; 0.1f</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                    &amp;&amp; !arm_switch_or_button_mapped;</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> arm_switch_to_disarm_transition =  arm_switch_is_button == 0 &amp;&amp;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#af618a6b9c76079c11172b6c0c7bd326c">_last_sp_man_arm_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON &amp;&amp;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                    sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">arm_switch</a> == manual_control_setpoint_s::SWITCH_POS_OFF;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;            <span class="keywordflow">if</span> (in_armed_state &amp;&amp;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a0b788807aa3def3dc8db87a124c0f552">rc_input_mode</a> != vehicle_status_s::RC_IN_MODE_OFF &amp;&amp;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> || (!status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> &amp;&amp; land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>)) &amp;&amp;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                (stick_in_lower_left || arm_button_pressed || arm_switch_to_disarm_transition)) {</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                <span class="keywordflow">if</span> (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_MANUAL &amp;&amp;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                    internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_ACRO &amp;&amp;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                    internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_STAB &amp;&amp;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                    internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_RATTITUDE &amp;&amp;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;                    !land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>) {</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e">print_reject_arm</a>(<span class="stringliteral">&quot;NOT DISARMING: Not in manual mode or landed yet.&quot;</span>);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((stick_off_counter == rc_arm_hyst &amp;&amp; stick_on_counter &lt; rc_arm_hyst) || arm_switch_to_disarm_transition) {</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                    arming_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a>(&amp;status, battery, safety, vehicle_status_s::ARMING_STATE_STANDBY, &amp;armed,</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                                         <span class="keyword">true</span> <span class="comment">/* fRunPreArmChecks */</span>,</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                                         &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;status_flags, <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>));</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                }</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                stick_off_counter++;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(arm_switch_is_button == 1 &amp;&amp; sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">arm_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON)) {</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;                <span class="comment">/* do not reset the counter when holding the arm button longer than needed */</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                stick_off_counter = 0;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;            }</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;            <span class="comment">/* ARM</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">             * check if left stick is in lower right position or arm button is pushed or arm switch has transition from disarm to arm</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="comment">             * and we&#39;re in MANUAL mode.</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment">             * Disable stick-arming if arming switch or button is mapped */</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> stick_in_lower_right = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a> &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#a1b0e4cbb477cef67a15af010278c80f1">STICK_ON_OFF_LIMIT</a> &amp;&amp; sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a> &lt; 0.1f</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                    &amp;&amp; !arm_switch_or_button_mapped;</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            <span class="comment">/* allow a grace period for re-arming: preflight checks don&#39;t need to pass during that time,</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">             * for example for accidential in-air disarming */</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> in_arming_grace_period = last_disarmed_timestamp != 0 &amp;&amp; <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;last_disarmed_timestamp) &lt; 5_s;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> arm_switch_to_arm_transition = arm_switch_is_button == 0 &amp;&amp;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#af618a6b9c76079c11172b6c0c7bd326c">_last_sp_man_arm_switch</a> == manual_control_setpoint_s::SWITCH_POS_OFF &amp;&amp;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                    sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">arm_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON &amp;&amp;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                    (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a> &lt; 0.1f || in_arming_grace_period);</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;            <span class="keywordflow">if</span> (!in_armed_state &amp;&amp;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a0b788807aa3def3dc8db87a124c0f552">rc_input_mode</a> != vehicle_status_s::RC_IN_MODE_OFF &amp;&amp;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                (stick_in_lower_right || arm_button_pressed || arm_switch_to_arm_transition)) {</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                <span class="keywordflow">if</span> ((stick_on_counter == rc_arm_hyst &amp;&amp; stick_off_counter &lt; rc_arm_hyst) || arm_switch_to_arm_transition) {</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;                    <span class="comment">/* we check outside of the transition function here because the requirement</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment">                     * for being in manual mode only applies to manual arming actions.</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment">                     * the system can be armed in auto if armed via the GCS.</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;<span class="comment">                     */</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                    <span class="keywordflow">if</span> ((internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_MANUAL)</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                        &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_ACRO)</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                        &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_STAB)</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;                        &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_ALTCTL)</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                        &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_POSCTL)</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                        &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_RATTITUDE)</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                       ) {</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e">print_reject_arm</a>(<span class="stringliteral">&quot;NOT ARMING: Switch to a manual mode first.&quot;</span>);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a> &amp;&amp;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;                           geofence_action == geofence_result_s::GF_ACTION_RTL) {</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e">print_reject_arm</a>(<span class="stringliteral">&quot;NOT ARMING: Geofence RTL requires valid home&quot;</span>);</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_STANDBY) {</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;                        arming_ret = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a>(&amp;status, battery, safety, vehicle_status_s::ARMING_STATE_ARMED, &amp;armed,</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;                                             !in_arming_grace_period <span class="comment">/* fRunPreArmChecks */</span>,</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                                             &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;status_flags, <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>));</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                        <span class="keywordflow">if</span> (arming_ret != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a>) {</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;                            <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(100000);</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                            <a class="code" href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e">print_reject_arm</a>(<span class="stringliteral">&quot;NOT ARMING: Preflight checks failed&quot;</span>);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                        }</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                    }</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                }</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                stick_on_counter++;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(arm_switch_is_button == 1 &amp;&amp; sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">arm_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON)) {</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;                <span class="comment">/* do not reset the counter when holding the arm button longer than needed */</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                stick_on_counter = 0;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;            }</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#af618a6b9c76079c11172b6c0c7bd326c">_last_sp_man_arm_switch</a> = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">arm_switch</a>;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;            <span class="keywordflow">if</span> (arming_ret == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                <span class="comment">/*</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;<span class="comment">                 * the arming transition can be denied to a number of reasons:</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="comment">                 *  - pre-flight check failed (sensors not ok or not calibrated)</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="comment">                 *  - safety not disabled</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;<span class="comment">                 *  - system not in manual mode</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;                <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;            }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;            <span class="comment">/* evaluate the main state machine according to mode switches */</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;            <span class="keywordtype">bool</span> first_rc_eval = (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> == 0) &amp;&amp; (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> &gt; 0);</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;            <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> main_res = <a class="code" href="../../d3/dc6/class_commander.html#ade5d0ec0717254516d98549218e1ed74">set_main_state</a>(status, &amp;status_changed);</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;            <span class="comment">/* store last position lock state */</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a881c644a74329486a4925c156831747b">_last_condition_global_position_valid</a> = status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a>;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;            <span class="comment">/* play tune on mode change only if armed, blink LED always */</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;            <span class="keywordflow">if</span> (main_res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a> || first_rc_eval) {</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                <a class="code" href="../../df/d08/commander__helper_8cpp.html#a24e135bf6ba98c55a652feab03293aa7">tune_positive</a>(armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>);</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;                main_state_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (main_res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                <span class="comment">/* DENIED here indicates bug in the commander */</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Switching to this mode is currently not possible&quot;</span>);</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;            }</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            <span class="comment">/* check throttle kill switch */</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;            <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aba20d37bdb280289f4cd154a3ada5bb2">kill_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;                <span class="comment">/* set lockdown flag */</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;                <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a9cf631c451f379b81b2263b338945c29">manual_lockdown</a>) {</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;MANUAL KILL SWITCH ENGAGED&quot;</span>);</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;                    armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a9cf631c451f379b81b2263b338945c29">manual_lockdown</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;                }</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aba20d37bdb280289f4cd154a3ada5bb2">kill_switch</a> == manual_control_setpoint_s::SWITCH_POS_OFF) {</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a9cf631c451f379b81b2263b338945c29">manual_lockdown</a>) {</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;MANUAL KILL SWITCH OFF&quot;</span>);</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;                    armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a9cf631c451f379b81b2263b338945c29">manual_lockdown</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;                }</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;            }</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;            <span class="comment">/* no else case: do not change lockdown flag in unconfigured case */</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;            <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2b48cdd399be15b5d8a85868e07fb009">rc_input_blocked</a> &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">rc_signal_lost</a>) {</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;MANUAL CONTROL LOST (at t=%llums)&quot;</span>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>() / 1000);</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">rc_signal_lost</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                <a class="code" href="../../da/d73/_commander_8cpp.html#afd0a2e6a4c9209262305d2f15ca74e4f">rc_signal_lost_timestamp</a> = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a>;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                <a class="code" href="../../d0/dc0/health__flag__helper_8cpp.html#a3523b6bbd000329099eed54f4994dbf1">set_health_flags</a>(subsystem_info_s::SUBSYSTEM_TYPE_RCRECEIVER, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, status);</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;            }</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;        }</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;        <span class="comment">// data link checks which update the status</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <a class="code" href="../../d3/dc6/class_commander.html#a4aa2c84e4d98b8a7b47e4acbd1ffb5b6">data_link_checks</a>(highlatencydatalink_loss_timeout, highlatencydatalink_regain_timeout, datalink_loss_timeout, datalink_regain_timeout, &amp;status_changed);</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="comment">// engine failure detection</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        <span class="comment">// TODO: move out of commander</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(actuator_controls_sub, &amp;updated);</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            <span class="comment">/* Check engine failure</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="comment">             * only for fixed wing for now</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;            <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2883f5d087a492fba009efe196d35399">circuit_breaker_engaged_enginefailure_check</a> &amp;&amp;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a6933ad99aa1ab7be2ca6bac09268fe7d">is_vtol</a> &amp;&amp; armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                <a class="code" href="../../de/d27/structactuator__controls__s.html">actuator_controls_s</a> <a class="code" href="../../da/d56/test__mixer_8cpp.html#af32da262f1b7e3453e38a3916d74a937">actuator_controls</a> = {};</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a1d8875c6fa9f0e16530aaa02dc0b15a0">ORB_ID_VEHICLE_ATTITUDE_CONTROLS</a>, actuator_controls_sub, &amp;actuator_controls);</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">float</span> throttle = actuator_controls.<a class="code" href="../../de/d27/structactuator__controls__s.html#a79704ffb6e8e15bfb0e0d82538d7b0e2">control</a>[actuator_controls_s::INDEX_THROTTLE];</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">float</span> current2throttle = battery.<a class="code" href="../../d0/d5c/structbattery__status__s.html#a446b3327cc7afcc85cd58d0a08af72f0">current_a</a> / throttle;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                <span class="keywordflow">if</span> (((throttle &gt; ef_throttle_thres) &amp;&amp; (current2throttle &lt; ef_current2throttle_thres))</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                    || status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ad0ebc3155e091da9b5f84578af8627aa">engine_failure</a>) {</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">float</span> elapsed = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;timestamp_engine_healthy) / 1e6f;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                    <span class="comment">/* potential failure, measure time */</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                    <span class="keywordflow">if</span> ((timestamp_engine_healthy &gt; 0) &amp;&amp; (elapsed &gt; ef_time_thres)</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                        &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ad0ebc3155e091da9b5f84578af8627aa">engine_failure</a>) {</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                        status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ad0ebc3155e091da9b5f84578af8627aa">engine_failure</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                        status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                        <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;Engine Failure&quot;</span>);</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                        <a class="code" href="../../d0/dc0/health__flag__helper_8cpp.html#a3523b6bbd000329099eed54f4994dbf1">set_health_flags</a>(subsystem_info_s::SUBSYSTEM_TYPE_MOTORCONTROL, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, status);</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                    }</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                }</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                <span class="comment">/* no failure reset flag */</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                timestamp_engine_healthy = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ad0ebc3155e091da9b5f84578af8627aa">engine_failure</a>) {</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;                    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ad0ebc3155e091da9b5f84578af8627aa">engine_failure</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;                    status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                }</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;            }</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        }</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        <span class="comment">/* Reset main state to loiter or auto-mission after takeoff is completed.</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment">         * Sometimes, the mission result topic is outdated and the mission is still signaled</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="comment">         * as finished even though we only just started with the takeoff. Therefore, we also</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment">         * check the timestamp of the mission_result topic. */</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        <span class="keywordflow">if</span> (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_AUTO_TAKEOFF</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;            &amp;&amp; (<a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().timestamp &gt; internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#a4f40eddad3e8b89feae1d4d7a5ff4e32">timestamp</a>)</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;            &amp;&amp; <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().finished) {</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> mission_available = (<a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().timestamp &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>)</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                               &amp;&amp; (<a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().instance_count &gt; 0) &amp;&amp; <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().valid;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            <span class="keywordflow">if</span> ((takeoff_complete_act == 1) &amp;&amp; mission_available) {</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_MISSION, status_flags, &amp;internal_state);</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state);</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;            }</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        }</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        <span class="comment">/* check if we are disarmed and there is a better mode to wait in */</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;            <span class="comment">/* if there is no radio control but GPS lock the user might want to fly using</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;<span class="comment">             * just a tablet. Since the RC will force its mode switch setting on connecting</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;<span class="comment">             * we can as well just wait in a hold mode which enables tablet control.</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">rc_signal_lost</a> &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_MANUAL)</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a>) {</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;                <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state);</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            }</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;        }</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        <span class="comment">/* handle commands last, as the system needs to be updated to handle them */</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(cmd_sub, &amp;updated);</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d7/dcc/structvehicle__command__s.html">vehicle_command_s</a> cmd;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            <span class="comment">/* got command */</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_command), cmd_sub, &amp;cmd);</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;            <span class="comment">/* handle it */</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a228a3bb17659b7a44a845e304da1191a">handle_command</a>(&amp;status, cmd, &amp;armed, &amp;_home, &amp;home_pub, &amp;command_ack_pub, &amp;status_changed)) {</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;            }</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        }</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;        <span class="comment">/* Check for failure combinations which lead to flight termination */</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;        <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> &amp;&amp;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;            !status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a7bf26316cc590a9f16bd15abf4469870">circuit_breaker_flight_termination_disabled</a>) {</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;            <span class="comment">/* At this point the data link and the gps system have been checked</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment">             * If we are not in a manual (RC stick controlled mode)</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">             * and both failed we want to terminate the flight */</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;            <span class="keywordflow">if</span> (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_MANUAL &amp;&amp;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_ACRO &amp;&amp;</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_RATTITUDE &amp;&amp;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_STAB &amp;&amp;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_ALTCTL &amp;&amp;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> != commander_state_s::MAIN_STATE_POSCTL &amp;&amp;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a>) {</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#af8c77c6ad99b1b28aea8bdade01d5b44">force_failsafe</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                <span class="keyword">static</span> <span class="keywordtype">bool</span> flight_termination_printed = <span class="keyword">false</span>;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                <span class="keywordflow">if</span> (!flight_termination_printed) {</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;DL and GPS lost: flight termination&quot;</span>);</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                    flight_termination_printed = <span class="keyword">true</span>;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                }</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                <span class="keywordflow">if</span> (counter % (1000000 / <a class="code" href="../../da/d73/_commander_8cpp.html#a3486f705b15b9507c8236c09c9f317c3">COMMANDER_MONITORING_INTERVAL</a>) == 0) {</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;DL and GPS lost: flight termination&quot;</span>);</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                }</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;            }</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;            <span class="comment">/* At this point the rc signal and the gps system have been checked</span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;<span class="comment">             * If we are in manual (controlled with RC):</span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment">             * if both failed we want to terminate the flight */</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;            <span class="keywordflow">if</span> ((internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_ACRO ||</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;                 internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_RATTITUDE ||</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                 internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_MANUAL ||</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                 internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_STAB ||</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                 internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_ALTCTL ||</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                 internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_POSCTL) &amp;&amp;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">rc_signal_lost</a>) {</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#af8c77c6ad99b1b28aea8bdade01d5b44">force_failsafe</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                <span class="keyword">static</span> <span class="keywordtype">bool</span> flight_termination_printed = <span class="keyword">false</span>;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                <span class="keywordflow">if</span> (!flight_termination_printed) {</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                    <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;Flight termination because of RC signal loss and GPS failure&quot;</span>);</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                    flight_termination_printed = <span class="keyword">true</span>;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                }</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                <span class="keywordflow">if</span> (counter % (1000000 / <a class="code" href="../../da/d73/_commander_8cpp.html#a3486f705b15b9507c8236c09c9f317c3">COMMANDER_MONITORING_INTERVAL</a>) == 0) {</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;RC and GPS lost: flight termination&quot;</span>);</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                }</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;            }</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;        }</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <span class="comment">/* Get current timestamp */</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> now = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;        <span class="comment">// automatically set or update home position</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;        <span class="keywordflow">if</span> (!_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a6ac17e9135ded73c11140645a4fd239d">manual_home</a>) {</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d4/d36/structvehicle__local__position__s.html">vehicle_local_position_s</a> &amp;local_position = <a class="code" href="../../d3/dc6/class_commander.html#af23998581890b6330bbded526e41c6c2">_local_position_sub</a>.<a class="code" href="../../d0/d65/classu_o_r_b_1_1_subscription.html#aa01d2ff362359aa05b64e93c6df668e0">get</a>();</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;            <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                <span class="keywordflow">if</span> ((!was_armed || (was_landed &amp;&amp; !land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>)) &amp;&amp;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                    (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#a3b5c5036e7865e587e2dee076b4a7d68">INAIR_RESTART_HOLDOFF_INTERVAL</a>)) {</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                    <span class="comment">/* update home position on arming if at least 500 ms from commander start spent to avoid setting home on in-air restart */</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                    <a class="code" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">set_home_position</a>(home_pub, _home, <span class="keyword">false</span>);</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                }</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a>) {</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                    <span class="keywordflow">if</span> (land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a> &amp;&amp; local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a599e9590c26c03d311ec605c83de93fe">xy_valid</a> &amp;&amp; local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1e26011ac97cdb64280a835282cd2484">z_valid</a>) {</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                        <span class="comment">/* distance from home */</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                        <span class="keywordtype">float</span> home_dist_xy = -1.0f;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                        <span class="keywordtype">float</span> home_dist_z = -1.0f;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                        <a class="code" href="../../d7/d09/geo_8cpp.html#a16bc9df3a7f0deb5c9afbabfbef7ec12">mavlink_wpm_distance_to_point_local</a>(_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a6cccfd19ff9b7e8075d8c14ab485ac63">x</a>, _home.<a class="code" href="../../dc/d6d/structhome__position__s.html#abb00d6356fa27cb10bf632ed86fcddac">y</a>, _home.<a class="code" href="../../dc/d6d/structhome__position__s.html#a01b9c594d162ddd0ea3a9d3184095599">z</a>,</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                                            local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a9b67102131d452cb37c2b5c20eeaa25a">x</a>, local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a6129ef0612b94fe46408821b068dbecd">y</a>, local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a544045618786171c0de95d5d3ee6f4b3">z</a>,</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                                            &amp;home_dist_xy, &amp;home_dist_z);</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                        <span class="keywordflow">if</span> ((home_dist_xy &gt; local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a545a96d9feb361cc083d23d3be0f81b7">eph</a> * 2) || (home_dist_z &gt; local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a45d36e6d933a09e22156f39017eb4892">epv</a> * 2)) {</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                            <span class="comment">/* update when disarmed, landed and moved away from current home position */</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                            <a class="code" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">set_home_position</a>(home_pub, _home, <span class="keyword">false</span>);</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                        }</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                    }</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                    <span class="comment">/* First time home position update - but only if disarmed */</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                    <a class="code" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">set_home_position</a>(home_pub, _home, <span class="keyword">false</span>);</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                }</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;            }</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;            <span class="comment">/* Set home position altitude to EKF origin height if home is not set and the EKF has a global origin.</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="comment">             * This allows home atitude to be used in the calculation of height above takeoff location when GPS</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;<span class="comment">             * use has commenced after takeoff. */</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;            <span class="keywordflow">if</span> (!_home.<a class="code" href="../../dc/d6d/structhome__position__s.html#affca1cec624c8bcf53bced8a1fa3174e">valid_alt</a> &amp;&amp; local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#adb219481b72536d9c74ca2077e10d056">z_global</a>) {</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">set_home_position</a>(home_pub, _home, <span class="keyword">true</span>);</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            }</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;        }</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;        <span class="comment">// check for arming state change</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;        <span class="keywordflow">if</span> (was_armed != armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;            status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;            <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) { <span class="comment">// increase the flight uuid upon disarming</span></div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                ++flight_uuid;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                <span class="comment">// no need for param notification: the only user is mavlink which reads the param upon request</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                <a class="code" href="../../d9/da5/param_8c.html#a803f9e8aef28899d6311b39e482584eb">param_set_no_notification</a>(_param_flight_uuid, &amp;flight_uuid);</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                last_disarmed_timestamp = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;            }</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        }</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        was_armed = armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        <span class="comment">/* now set navigation state according to failsafe and main state */</span></div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        <span class="keywordtype">bool</span> nav_state_changed = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#ad29324d14c22f8565991bcb678368db2">set_nav_state</a>(&amp;status,</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                               &amp;armed,</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                               &amp;internal_state,</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                               &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>,</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                               (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a2755aa25019760dab5a1f6df4edc892a">link_loss_actions_t</a>)datalink_loss_act,</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                               <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().finished,</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                               <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get().stay_in_failsafe,</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                               <a class="code" href="../../da/d73/_commander_8cpp.html#abcdc326c93c28a0a624d7d682352f53a">status_flags</a>,</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                               land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>,</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                               (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a2755aa25019760dab5a1f6df4edc892a">link_loss_actions_t</a>)rc_loss_act,</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                               offboard_loss_act,</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                               offboard_loss_rc_act,</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                               posctl_nav_loss_act);</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;        <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">failsafe</a> != failsafe_old) {</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;            status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;            <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">failsafe</a>) {</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Failsafe mode enabled&quot;</span>);</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Failsafe mode disabled&quot;</span>);</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;            }</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;            failsafe_old = status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">failsafe</a>;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;        }</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <span class="comment">// TODO handle mode changes by commands</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        <span class="keywordflow">if</span> (main_state_changed || nav_state_changed) {</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;            main_state_changed = <span class="keyword">false</span>;</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        }</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;        <span class="comment">/* publish states (armed, control_mode, vehicle_status, commander_state, vehicle_status_flags) at 1 Hz or immediately when changed */</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a565a5ab4cfcae22faba52debbd7d855f">timestamp</a>) &gt;= 1_s || status_changed) {</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#abbddddc6e2c6951b59f612c852b13467">set_control_mode</a>();</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;            control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a20baad7833089fbd4b892688c449ef47">timestamp</a> = now;</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_control_mode), control_mode_pub, &amp;control_mode);</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a565a5ab4cfcae22faba52debbd7d855f">timestamp</a> = now;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_status), <a class="code" href="../../da/d73/_commander_8cpp.html#a8394cc39ce8c41dba0adf2a5990ff1ed">status_pub</a>, &amp;status);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a415b07e3247c7d8d6ccafb25681db1f0">timestamp</a> = now;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;            <span class="comment">/* set prearmed state if safety is off, or safety is not present and 5 seconds passed */</span></div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;            <span class="keywordflow">if</span> (safety.<a class="code" href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_switch_available</a>) {</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                <span class="comment">/* safety is off, go into prearmed */</span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a1fe0540b456b257ed8cbb5f7c5a30ab3">prearmed</a> = safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a>;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                <span class="comment">/* safety is not present, go into prearmed</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;<span class="comment">                 * (all output drivers should be started / unlocked last in the boot process</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;<span class="comment">                 * when the rest of the system is fully initialized)</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a1fe0540b456b257ed8cbb5f7c5a30ab3">prearmed</a> = (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>) &gt; 5_s);</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;            }</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(actuator_armed), armed_pub, &amp;armed);</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            <span class="comment">/* publish internal state for logging purposes */</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <span class="keywordflow">if</span> (commander_state_pub != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;                <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(commander_state), commander_state_pub, &amp;internal_state);</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;                commander_state_pub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(commander_state), &amp;internal_state);</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            }</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;            <span class="comment">/* publish vehicle_status_flags */</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;            status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#aaa922fdf78be43086fc6453ba6a0fccc">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;            <span class="keywordflow">if</span> (vehicle_status_flags_pub != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_status_flags), vehicle_status_flags_pub, &amp;status_flags);</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;                vehicle_status_flags_pub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_status_flags), &amp;status_flags);</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            }</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        }</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        <span class="comment">/* play arming and battery warning tunes */</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        <span class="keywordflow">if</span> (!arm_tune_played &amp;&amp; armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> &amp;&amp; (!safety.<a class="code" href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_switch_available</a> || (safety.<a class="code" href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_switch_available</a></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;                            &amp;&amp; safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a>))) {</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            <span class="comment">/* play tune when armed */</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#a85bd5445469c33c209c0947ec5050d67">set_tune</a>(<a class="code" href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca103a315c3ebd325e38539413836ee925">TONE_ARMING_WARNING_TUNE</a>);</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;            arm_tune_played = <span class="keyword">true</span>;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a675c19070b0ca7956c113ce12c8e57d0">usb_connected</a> &amp;&amp;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;               (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a477f9050e58a25f419da7f643b4c52fb">hil_state</a> != vehicle_status_s::HIL_STATE_ON) &amp;&amp;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;               (battery.<a class="code" href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">warning</a> == battery_status_s::BATTERY_WARNING_CRITICAL)) {</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;            <span class="comment">/* play tune on battery critical */</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#a85bd5445469c33c209c0947ec5050d67">set_tune</a>(<a class="code" href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca8a36d4dbb249f522ed9d6116711150d6">TONE_BATTERY_WARNING_FAST_TUNE</a>);</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a477f9050e58a25f419da7f643b4c52fb">hil_state</a> != vehicle_status_s::HIL_STATE_ON) &amp;&amp;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;               (battery.<a class="code" href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">warning</a> == battery_status_s::BATTERY_WARNING_LOW)) {</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;            <span class="comment">/* play tune on battery warning */</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#a85bd5445469c33c209c0947ec5050d67">set_tune</a>(<a class="code" href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca1198296be8e5ccba65d061c57d7ca8ac">TONE_BATTERY_WARNING_SLOW_TUNE</a>);</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">failsafe</a>) {</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#ab335c1f1cc07d57fa0b0a10af3c024f7">tune_failsafe</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#a85bd5445469c33c209c0947ec5050d67">set_tune</a>(<a class="code" href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06caf6aecf75f49cf6fdca0e1c63bea30e0f">TONE_STOP_TUNE</a>);</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        }</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="comment">/* reset arm_tune_played when disarmed */</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> || (safety.<a class="code" href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_switch_available</a> &amp;&amp; !safety.<a class="code" href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_off</a>)) {</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;            <span class="comment">//Notify the user that it is safe to approach the vehicle</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;            <span class="keywordflow">if</span> (arm_tune_played) {</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                <a class="code" href="../../df/d08/commander__helper_8cpp.html#ad3a2cfa84c8bc14c5d6dc35fcb98ec27">tune_neutral</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;            }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;            arm_tune_played = <span class="keyword">false</span>;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        }</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        <span class="comment">/* play sensor failure tunes if we already waited for hotplug sensors to come up and failed */</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">condition_system_hotplug_timeout</a> = (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>) &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#ae70d79a727876216e886dab6d5282fc1">HOTPLUG_SENS_TIMEOUT</a>);</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;        <span class="keywordflow">if</span> (!sensor_fail_tune_played &amp;&amp; (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#abf8f27de653a86414890a4928caff730">condition_system_sensors_initialized</a></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                         &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">condition_system_hotplug_timeout</a>)) {</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#ac64e3f3cc38664a081caeceb560bb76f">set_tune_override</a>(<a class="code" href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06caa3dae1e566fb7da3fadca5c160df51b6">TONE_GPS_WARNING_TUNE</a>);</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;            sensor_fail_tune_played = <span class="keyword">true</span>;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        }</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;        counter++;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;        <span class="keywordtype">int</span> blink_state = <a class="code" href="../../df/d08/commander__helper_8cpp.html#a5fdd1516317993b343f2c3a02e273da6">blink_msg_state</a>();</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;        <span class="keywordflow">if</span> (blink_state &gt; 0) {</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            <span class="comment">/* blinking LED message, don&#39;t touch LEDs */</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            <span class="keywordflow">if</span> (blink_state == 2) {</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                <span class="comment">/* blinking LED message completed, restore normal state */</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                <a class="code" href="../../da/d73/_commander_8cpp.html#a11781677749dd4c7b3306165a9db7235">control_status_leds</a>(&amp;status, &amp;armed, <span class="keyword">true</span>, &amp;battery, &amp;cpuload);</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;            }</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;            <span class="comment">/* normal state */</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a11781677749dd4c7b3306165a9db7235">control_status_leds</a>(&amp;status, &amp;armed, status_changed, &amp;battery, &amp;cpuload);</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;        }</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        status_changed = <span class="keyword">false</span>;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        <span class="keywordflow">if</span> (!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;            <span class="comment">/* Reset the flag if disarmed. */</span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;            have_taken_off_since_arming = <span class="keyword">false</span>;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        }</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        <a class="code" href="../../d0/d49/arm__auth_8cpp.html#a036d498309eb1ec19b5293503a4e1e21">arm_auth_update</a>(now, params_updated || param_init_forced);</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        <span class="comment">// Handle shutdown request from emergency battery action</span></div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;        <span class="keywordflow">if</span>(!armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a> &amp;&amp; dangerous_battery_level_requests_poweroff){</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;DANGEROUSLY LOW BATTERY, SHUT SYSTEM DOWN&quot;</span>);</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(200000);</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;            <span class="keywordtype">int</span> ret_val = <a class="code" href="../../df/d04/shutdown_8cpp.html#ac973512abb1ee1d0cacd5df9e1f68b6a">px4_shutdown_request</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;            <span class="keywordflow">if</span> (ret_val) {</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;SYSTEM DOES NOT SUPPORT SHUTDOWN&quot;</span>);</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;                dangerous_battery_level_requests_poweroff = <span class="keyword">false</span>;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                <span class="keywordflow">while</span> (1) { <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(1); }</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;            }</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;        }</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;        <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(<a class="code" href="../../da/d73/_commander_8cpp.html#a3486f705b15b9507c8236c09c9f317c3">COMMANDER_MONITORING_INTERVAL</a>);</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    }</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a19e65cfacb780bf766338756148a966d">thread_should_exit</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;    <span class="comment">/* wait for threads to complete */</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="../../d6/dfb/stubs__posix_8c.html#a28a15bba47cab57cbc9f5dac9af99c8b">pthread_join</a>(commander_low_prio_thread, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;    <span class="keywordflow">if</span> (ret) {</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;        <a class="code" href="../../d6/d40/err_8h.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;join failed: %d&quot;</span>, ret);</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    }</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <a class="code" href="../../df/d08/commander__helper_8cpp.html#a305f75480edf19f6dccc6ea8bf7c46d5">rgbled_set_color_and_mode</a>(led_control_s::COLOR_WHITE, led_control_s::MODE_OFF);</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="comment">/* close fds */</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;    <a class="code" href="../../df/d08/commander__helper_8cpp.html#afd68a20846bc6ab17ae104e8ebc152d8">led_deinit</a>();</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    <a class="code" href="../../df/d08/commander__helper_8cpp.html#a1e95efa5d45a4c40cb89f9e917913a86">buzzer_deinit</a>();</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(sp_man_sub);</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(offboard_control_mode_sub);</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(safety_sub);</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(cmd_sub);</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(subsys_sub);</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(param_changed_sub);</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(battery_sub);</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(land_detector_sub);</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;}</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l02646"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a55e27eff85d06cb0126947a279414da3"> 2646</a></span>&#160;<a class="code" href="../../da/d73/_commander_8cpp.html#a55e27eff85d06cb0126947a279414da3">get_circuit_breaker_params</a>()</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;{</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a5fd2f6f34bd14719fe79d6fd5d7e2b89">circuit_breaker_engaged_power_check</a> = <a class="code" href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a>(<span class="stringliteral">&quot;CBRK_SUPPLY_CHK&quot;</span>, <a class="code" href="../../d2/dd4/circuit__breaker_8h.html#a9290a1a2713a56f14a172ef688225210">CBRK_SUPPLY_CHK_KEY</a>);</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a77167b569d24b4d50c6400e3f05e3725">circuit_breaker_engaged_usb_check</a> = <a class="code" href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a>(<span class="stringliteral">&quot;CBRK_USB_CHK&quot;</span>, <a class="code" href="../../d2/dd4/circuit__breaker_8h.html#af35d5fdcf430edeb6a2e622154c0ef9d">CBRK_USB_CHK_KEY</a>);</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a02fe8d41494860e12091f8bc69476fd3">circuit_breaker_engaged_airspd_check</a> = <a class="code" href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a>(<span class="stringliteral">&quot;CBRK_AIRSPD_CHK&quot;</span>, <a class="code" href="../../d2/dd4/circuit__breaker_8h.html#aeb249baf44440ae8b34c290b458bdc9b">CBRK_AIRSPD_CHK_KEY</a>);</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2883f5d087a492fba009efe196d35399">circuit_breaker_engaged_enginefailure_check</a> = <a class="code" href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a>(<span class="stringliteral">&quot;CBRK_ENGINEFAIL&quot;</span>, <a class="code" href="../../d2/dd4/circuit__breaker_8h.html#a7aa936101a7f04927540fd03ee90fa50">CBRK_ENGINEFAIL_KEY</a>);</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ad38d1e9d742cf10244b0769b7233f0ac">circuit_breaker_engaged_gpsfailure_check</a> = <a class="code" href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a>(<span class="stringliteral">&quot;CBRK_GPSFAIL&quot;</span>, <a class="code" href="../../d2/dd4/circuit__breaker_8h.html#a13dc33b8da38ffdd4d2e41355536e356">CBRK_GPSFAIL_KEY</a>);</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a7bf26316cc590a9f16bd15abf4469870">circuit_breaker_flight_termination_disabled</a> = <a class="code" href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a>(<span class="stringliteral">&quot;CBRK_FLIGHTTERM&quot;</span>, <a class="code" href="../../d2/dd4/circuit__breaker_8h.html#a9e0fc82dcdfde650600169450a6497c1">CBRK_FLIGHTTERM_KEY</a>);</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a488df9e755effd4a41512c7528c14b78">circuit_breaker_engaged_posfailure_check</a> = <a class="code" href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a>(<span class="stringliteral">&quot;CBRK_VELPOSERR&quot;</span>, <a class="code" href="../../d2/dd4/circuit__breaker_8h.html#a284617a00775c5d76d47a455d94d8af9">CBRK_VELPOSERR_KEY</a>);</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;}</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l02658"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#af1cf6dceb2225f61664e375a342d98ba"> 2658</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#af1cf6dceb2225f61664e375a342d98ba">Commander::check_valid</a>(<span class="keyword">const</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> &amp;<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a81cc3fc9405436c7f6100259e69d18b1">timestamp</a>, <span class="keyword">const</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> &amp;timeout, <span class="keyword">const</span> <span class="keywordtype">bool</span> valid_in, <span class="keywordtype">bool</span> *valid_out, <span class="keywordtype">bool</span> *changed)</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;{</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> t = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;    <span class="keywordtype">bool</span> valid_new = (t &lt; timestamp + timeout &amp;&amp; t &gt; timeout &amp;&amp; valid_in);</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;    <span class="keywordflow">if</span> (*valid_out != valid_new) {</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;        *valid_out = valid_new;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        *changed = <span class="keyword">true</span>;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;}</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l02670"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a11781677749dd4c7b3306165a9db7235"> 2670</a></span>&#160;<a class="code" href="../../da/d73/_commander_8cpp.html#a11781677749dd4c7b3306165a9db7235">control_status_leds</a>(<a class="code" href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a> *status_local, <span class="keyword">const</span> <a class="code" href="../../d0/d54/structactuator__armed__s.html">actuator_armed_s</a> *actuator_armed,</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;            <span class="keywordtype">bool</span> changed, <a class="code" href="../../d0/d5c/structbattery__status__s.html">battery_status_s</a> *battery_local, <span class="keyword">const</span> <a class="code" href="../../d7/dbb/structcpuload__s.html">cpuload_s</a> *cpuload_local)</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;{</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <span class="keyword">static</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> overload_start = 0;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    <span class="keywordtype">bool</span> overload = (cpuload_local-&gt;<a class="code" href="../../d7/dbb/structcpuload__s.html#a827dcce1a83fb46c2ab1519effdc6aa7">load</a> &gt; 0.80f) || (cpuload_local-&gt;<a class="code" href="../../d7/dbb/structcpuload__s.html#a34fee17defc29417b53aa8a32992d29d">ram_usage</a> &gt; 0.98f);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    <span class="keywordflow">if</span> (overload_start == 0 &amp;&amp; overload) {</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        overload_start = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!overload) {</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        overload_start = 0;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    }</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    <span class="comment">/* driving rgbled */</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <span class="keywordflow">if</span> (changed || <a class="code" href="../../da/d73/_commander_8cpp.html#a8bb4bd9db2891f8edb99b0086e973001">last_overload</a> != overload) {</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        uint8_t led_mode = led_control_s::MODE_OFF;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        uint8_t led_color = led_control_s::COLOR_WHITE;</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <span class="keywordtype">bool</span> set_normal_color = <span class="keyword">false</span>;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        uint64_t overload_warn_delay = (status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_ARMED) ? 1_ms : 250_ms;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;        <span class="comment">/* set mode */</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;        <span class="keywordflow">if</span> (overload &amp;&amp; (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;overload_start) &gt; overload_warn_delay)) {</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;            led_mode = led_control_s::MODE_BLINK_FAST;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;            led_color = led_control_s::COLOR_PURPLE;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_ARMED) {</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;            led_mode = led_control_s::MODE_ON;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;            set_normal_color = <span class="keyword">true</span>;</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#abf8f27de653a86414890a4928caff730">condition_system_sensors_initialized</a> &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">condition_system_hotplug_timeout</a>) {</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;            led_mode = led_control_s::MODE_BLINK_FAST;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;            led_color = led_control_s::COLOR_RED;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_STANDBY) {</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;            led_mode = led_control_s::MODE_BREATHE;</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;            set_normal_color = <span class="keyword">true</span>;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#abf8f27de653a86414890a4928caff730">condition_system_sensors_initialized</a> &amp;&amp; !status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">condition_system_hotplug_timeout</a>) {</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;            led_mode = led_control_s::MODE_BREATHE;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;            set_normal_color = <span class="keyword">true</span>;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status_local-&gt;<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_INIT) {</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;            <span class="comment">// if in init status it should not be in the error state</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;            led_mode = led_control_s::MODE_OFF;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        } <span class="keywordflow">else</span> {    <span class="comment">// STANDBY_ERROR and other states</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;            led_mode = led_control_s::MODE_BLINK_NORMAL;</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;            led_color = led_control_s::COLOR_RED;</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;        }</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;        <span class="keywordflow">if</span> (set_normal_color) {</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;            <span class="comment">/* set color */</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;            <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">failsafe</a>) {</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;                led_color = led_control_s::COLOR_PURPLE;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (battery_local-&gt;<a class="code" href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">warning</a> == battery_status_s::BATTERY_WARNING_LOW) {</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;                led_color = led_control_s::COLOR_AMBER;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (battery_local-&gt;<a class="code" href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">warning</a> == battery_status_s::BATTERY_WARNING_CRITICAL) {</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;                led_color = led_control_s::COLOR_RED;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;                <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">condition_home_position_valid</a> &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a>) {</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;                    led_color = led_control_s::COLOR_GREEN;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;                    led_color = led_control_s::COLOR_BLUE;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;                }</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;            }</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        }</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        <span class="keywordflow">if</span> (led_mode != led_control_s::MODE_OFF) {</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;            <a class="code" href="../../df/d08/commander__helper_8cpp.html#a305f75480edf19f6dccc6ea8bf7c46d5">rgbled_set_color_and_mode</a>(led_color, led_mode);</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        }</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    }</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#a8bb4bd9db2891f8edb99b0086e973001">last_overload</a> = overload;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="preprocessor">#if !defined(CONFIG_ARCH_LEDS) &amp;&amp; defined(BOARD_HAS_CONTROL_STATUS_LEDS)</span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    <span class="comment">/* this runs at around 20Hz, full cycle is 16 ticks = 10/16Hz */</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    <span class="keywordflow">if</span> (actuator_armed-&gt;<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;        <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">failsafe</a>) {</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;            <a class="code" href="../../d1/d3d/aerocore2_2init_8c.html#a051724a3dd62335291d698ff09ab262b">led_off</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#ae2e40566d27689f8581d7b0f12271d45">LED_BLUE</a>);</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">leds_counter</a> % 5 == 0) {</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                <a class="code" href="../../da/def/aerocore2_2led_8c.html#a43f5bcbf42e527375e744b59da4282f6">led_toggle</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#aca338dbd19d7940923334629f6e5f3b7">LED_GREEN</a>);</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;            }</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;            <a class="code" href="../../d1/d3d/aerocore2_2init_8c.html#a051724a3dd62335291d698ff09ab262b">led_off</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#aca338dbd19d7940923334629f6e5f3b7">LED_GREEN</a>);</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;            <span class="comment">/* armed, solid */</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;            <a class="code" href="../../d1/d3d/aerocore2_2init_8c.html#a8c948cf27b7a7d6bdd33b42e23bca938">led_on</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#ae2e40566d27689f8581d7b0f12271d45">LED_BLUE</a>);</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;        }</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (actuator_armed-&gt;<a class="code" href="../../d0/d54/structactuator__armed__s.html#aef783cd736e2fef1e8f22578b7dcb585">ready_to_arm</a>) {</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;        <a class="code" href="../../d1/d3d/aerocore2_2init_8c.html#a051724a3dd62335291d698ff09ab262b">led_off</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#ae2e40566d27689f8581d7b0f12271d45">LED_BLUE</a>);</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        <span class="comment">/* ready to arm, blink at 1Hz */</span></div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">leds_counter</a> % 20 == 0) {</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;            <a class="code" href="../../da/def/aerocore2_2led_8c.html#a43f5bcbf42e527375e744b59da4282f6">led_toggle</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#aca338dbd19d7940923334629f6e5f3b7">LED_GREEN</a>);</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        }</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;        <a class="code" href="../../d1/d3d/aerocore2_2init_8c.html#a051724a3dd62335291d698ff09ab262b">led_off</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#ae2e40566d27689f8581d7b0f12271d45">LED_BLUE</a>);</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;        <span class="comment">/* not ready to arm, blink at 10Hz */</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">leds_counter</a> % 2 == 0) {</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;            <a class="code" href="../../da/def/aerocore2_2led_8c.html#a43f5bcbf42e527375e744b59da4282f6">led_toggle</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#aca338dbd19d7940923334629f6e5f3b7">LED_GREEN</a>);</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        }</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    }</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;    <span class="comment">/* give system warnings on error LED */</span></div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    <span class="keywordflow">if</span> (overload) {</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">leds_counter</a> % 2 == 0) {</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;            <a class="code" href="../../da/def/aerocore2_2led_8c.html#a43f5bcbf42e527375e744b59da4282f6">led_toggle</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#a0e72d9b104ee1fa873b85cb132aa02d1">LED_AMBER</a>);</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        }</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;        <a class="code" href="../../d1/d3d/aerocore2_2init_8c.html#a051724a3dd62335291d698ff09ab262b">led_off</a>(<a class="code" href="../../d9/d71/drv__board__led_8h.html#a0e72d9b104ee1fa873b85cb132aa02d1">LED_AMBER</a>);</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    }</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <a class="code" href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">leds_counter</a>++;</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;}</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a></div><div class="line"><a name="l02801"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#ade5d0ec0717254516d98549218e1ed74"> 2801</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#ade5d0ec0717254516d98549218e1ed74">Commander::set_main_state</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a> &amp;status_local, <span class="keywordtype">bool</span> *changed)</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;{</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keywordflow">if</span> (safety.<a class="code" href="../../d1/d06/structsafety__s.html#a9e344fb952239090443e6bb0d104d0c8">override_available</a> &amp;&amp; safety.<a class="code" href="../../d1/d06/structsafety__s.html#a09dd959f9c3f6f632bfb3ee3c6ceb31f">override_enabled</a>) {</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d3/dc6/class_commander.html#a1e65f3636df4d9fba66e2be84bece448">set_main_state_override_on</a>(status_local, changed);</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d3/dc6/class_commander.html#aadc83535d40152c2a955887915ef60d6">set_main_state_rc</a>(status_local, changed);</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    }</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;}</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a></div><div class="line"><a name="l02812"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a1e65f3636df4d9fba66e2be84bece448"> 2812</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#a1e65f3636df4d9fba66e2be84bece448">Commander::set_main_state_override_on</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a> &amp;status_local, <span class="keywordtype">bool</span> *changed)</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;{</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    *changed = (res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a>);</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;}</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a></div><div class="line"><a name="l02821"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#aadc83535d40152c2a955887915ef60d6"> 2821</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#aadc83535d40152c2a955887915ef60d6">Commander::set_main_state_rc</a>(<span class="keyword">const</span> <a class="code" href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a> &amp;status_local, <span class="keywordtype">bool</span> *changed)</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;{</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="comment">/* set main state according to RC switches */</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a> res = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="comment">// Note: even if status_flags.offboard_control_set_by_command is set</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <span class="comment">// we want to allow rc mode change to take precidence.  This is a safety</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    <span class="comment">// feature, just in case offboard control goes crazy.</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="comment">/* manual setpoint has not updated, do not re-evaluate it */</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="keywordflow">if</span> (!(!<a class="code" href="../../da/d73/_commander_8cpp.html#a881c644a74329486a4925c156831747b">_last_condition_global_position_valid</a> &amp;&amp;</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;          status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a>)</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        &amp;&amp; (((_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> != 0) &amp;&amp; (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a>)) ||</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        ((_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a1691b2b3d7a262531bab73303f08a413">offboard_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a1691b2b3d7a262531bab73303f08a413">offboard_switch</a>) &amp;&amp;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a4a95c9c57e780fd2be653c6031104c96">return_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a4a95c9c57e780fd2be653c6031104c96">return_switch</a>) &amp;&amp;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aeffc7f6be61085d94cf3944d488ae58d">mode_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aeffc7f6be61085d94cf3944d488ae58d">mode_switch</a>) &amp;&amp;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab15c816845decd002c45d1b5b4791c75">acro_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab15c816845decd002c45d1b5b4791c75">acro_switch</a>) &amp;&amp;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a99e267a3df97d3af511a5469c0d035fc">rattitude_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a99e267a3df97d3af511a5469c0d035fc">rattitude_switch</a>) &amp;&amp;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab22df60b54970e3a5bb8ca8b52b004af">posctl_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab22df60b54970e3a5bb8ca8b52b004af">posctl_switch</a>) &amp;&amp;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8a3174a9dbd2ed822ef1ead8b3b2adaa">loiter_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8a3174a9dbd2ed822ef1ead8b3b2adaa">loiter_switch</a>) &amp;&amp;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a9339a419787f7d88202a7c05a1092551">mode_slot</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a9339a419787f7d88202a7c05a1092551">mode_slot</a>) &amp;&amp;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acd9cafc24c99139963c3a0e699ffd811">stab_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acd9cafc24c99139963c3a0e699ffd811">stab_switch</a>) &amp;&amp;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;         (_last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acdfd913506bc016506720168c4d1b2f6">man_switch</a> == sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acdfd913506bc016506720168c4d1b2f6">man_switch</a>)))) {</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        <span class="comment">// store the last manual control setpoint set by the pilot in a manual state</span></div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;        <span class="comment">// if the system now later enters an autonomous state the pilot can move</span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        <span class="comment">// the sticks to break out of the autonomous state</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;            &amp;&amp; (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_MANUAL ||</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;            internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_ALTCTL ||</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;            internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_POSCTL ||</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;            internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_ACRO ||</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;            internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_RATTITUDE ||</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;            internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_STAB)) {</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a> = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">timestamp</a>;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;            _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a0087298fe10a24a1846302fcb16ce493">x</a> = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a0087298fe10a24a1846302fcb16ce493">x</a>;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;            _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab0b913ff61a273187a2b264ee91399e5">y</a> = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab0b913ff61a273187a2b264ee91399e5">y</a>;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;            _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a> = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">z</a>;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;            _last_sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a> = sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">r</a>;</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;        }</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <span class="comment">/* no timestamp change or no switch change -&gt; nothing changed */</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    }</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    _last_sp_man = <a class="code" href="../../da/d73/_commander_8cpp.html#a45da51db6880801086e2fee51898e4af">sp_man</a>;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    <span class="comment">// reset the position and velocity validity calculation to give the best change of being able to select</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="comment">// the desired mode</span></div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a66e5bc6e5edea5edb1eb0aab356e5663">reset_posvel_validity</a>(changed);</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="comment">/* offboard switch overrides main switch */</span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a1691b2b3d7a262531bab73303f08a413">offboard_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_OFFBOARD, status_flags, &amp;internal_state);</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        <span class="keywordflow">if</span> (res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;OFFBOARD&quot;</span>);</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;            <span class="comment">/* mode rejected, continue to evaluate the main system mode */</span></div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;            <span class="comment">/* changed successfully or already in this state */</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;        }</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    }</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    <span class="comment">/* RTL switch overrides main switch */</span></div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;    <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a4a95c9c57e780fd2be653c6031104c96">return_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_AUTO_RTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;        <span class="keywordflow">if</span> (res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO RTL&quot;</span>);</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;            <span class="comment">/* fallback to LOITER if home position not set */</span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;            res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state);</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;        }</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;            <span class="comment">/* changed successfully or already in this state */</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        }</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        <span class="comment">/* if we get here mode was rejected, continue to evaluate the main system mode */</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    }</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    <span class="comment">/* Loiter switch overrides main switch */</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;    <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a8a3174a9dbd2ed822ef1ead8b3b2adaa">loiter_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state);</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        <span class="keywordflow">if</span> (res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO HOLD&quot;</span>);</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        }</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;    }</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    <span class="comment">/* we know something has changed - check if we are in mode slot operation */</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;    <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a9339a419787f7d88202a7c05a1092551">mode_slot</a> != manual_control_setpoint_s::MODE_SLOT_NONE) {</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a9339a419787f7d88202a7c05a1092551">mode_slot</a> &gt;= (<span class="keywordtype">int</span>)(<span class="keyword">sizeof</span>(<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>) / <span class="keyword">sizeof</span>(<a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[0]))) {</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;            <a class="code" href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a>(<span class="stringliteral">&quot;m slot overflow&quot;</span>);</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>;</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        }</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        <span class="keywordtype">int</span> new_mode = <a class="code" href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a>[sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a9339a419787f7d88202a7c05a1092551">mode_slot</a>];</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;        <span class="keywordflow">if</span> (new_mode &lt; 0) {</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;            <span class="comment">/* slot is unused */</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;            res = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;            res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;            <span class="comment">/* ensure that the mode selection does not get stuck here */</span></div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;            <span class="keywordtype">int</span> maxcount = 5;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;            <span class="comment">/* enable the use of break */</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;            <span class="comment">/* fallback strategies, give the user the closest mode to what he wanted */</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;            <span class="keywordflow">while</span> (res == <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> &amp;&amp; maxcount &gt; 0) {</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;                maxcount--;</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_AUTO_MISSION) {</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                    <span class="comment">/* fall back to loiter */</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_AUTO_LOITER;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO MISSION&quot;</span>);</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;                    }</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                }</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_AUTO_RTL) {</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;                    <span class="comment">/* fall back to position control */</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_AUTO_LOITER;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO RTL&quot;</span>);</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;                    }</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                }</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_AUTO_LAND) {</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;                    <span class="comment">/* fall back to position control */</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_AUTO_LOITER;</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO LAND&quot;</span>);</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                    }</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                }</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_AUTO_TAKEOFF) {</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;                    <span class="comment">/* fall back to position control */</span></div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_AUTO_LOITER;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO TAKEOFF&quot;</span>);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;                    }</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;                }</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_AUTO_FOLLOW_TARGET) {</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                    <span class="comment">/* fall back to position control */</span></div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_AUTO_LOITER;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO FOLLOW&quot;</span>);</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                    }</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;                }</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_AUTO_LOITER) {</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;                    <span class="comment">/* fall back to position control */</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_POSCTL;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO HOLD&quot;</span>);</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;                    }</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;                }</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_POSCTL) {</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;                    <span class="comment">/* fall back to altitude control */</span></div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_ALTCTL;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;POSITION CONTROL&quot;</span>);</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;                    }</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;                }</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_ALTCTL) {</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;                    <span class="comment">/* fall back to stabilized */</span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_STAB;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;ALTITUDE CONTROL&quot;</span>);</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;                    }</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;                }</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;                <span class="keywordflow">if</span> (new_mode == commander_state_s::MAIN_STATE_STAB) {</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;                    <span class="comment">/* fall back to manual */</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;                    new_mode = commander_state_s::MAIN_STATE_MANUAL;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;STABILIZED&quot;</span>);</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, new_mode, status_flags, &amp;internal_state);</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                    <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;                    }</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;                }</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;            }</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        }</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;        <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;    <span class="comment">/* offboard and RTL switches off or denied, check main mode switch */</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    <span class="keywordflow">switch</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#aeffc7f6be61085d94cf3944d488ae58d">mode_switch</a>) {</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    <span class="keywordflow">case</span> manual_control_setpoint_s::SWITCH_POS_NONE:</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        res = <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a>;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    <span class="keywordflow">case</span> manual_control_setpoint_s::SWITCH_POS_OFF:     <span class="comment">// MANUAL</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;        <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acd9cafc24c99139963c3a0e699ffd811">stab_switch</a> == manual_control_setpoint_s::SWITCH_POS_NONE &amp;&amp;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;            sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acdfd913506bc016506720168c4d1b2f6">man_switch</a> == manual_control_setpoint_s::SWITCH_POS_NONE) {</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment">             * Legacy mode:</span></div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;<span class="comment">             * Acro switch being used as stabilized switch in FW.</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;            <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab15c816845decd002c45d1b5b4791c75">acro_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;                <span class="comment">/* manual mode is stabilized already for multirotors, so switch to acro</span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;<span class="comment">                 * for any non-manual mode</span></div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;<span class="comment">                 */</span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a6933ad99aa1ab7be2ca6bac09268fe7d">is_vtol</a>) {</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_ACRO, status_flags, &amp;internal_state);</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a>) {</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_STAB, status_flags, &amp;internal_state);</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;                }</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a99e267a3df97d3af511a5469c0d035fc">rattitude_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;                <span class="comment">/* Similar to acro transitions for multirotors.  FW aircraft don&#39;t need a</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment">                 * rattitude mode.*/</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;                <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a>) {</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_RATTITUDE, status_flags, &amp;internal_state);</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;                    res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_STAB, status_flags, &amp;internal_state);</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;                }</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;            }</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;            <span class="comment">/* New mode:</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="comment">             * - Acro is Acro</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="comment">             * - Manual is not default anymore when the manaul switch is assigned</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;            <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acdfd913506bc016506720168c4d1b2f6">man_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab15c816845decd002c45d1b5b4791c75">acro_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_ACRO, status_flags, &amp;internal_state);</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#a99e267a3df97d3af511a5469c0d035fc">rattitude_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_RATTITUDE, status_flags, &amp;internal_state);</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acd9cafc24c99139963c3a0e699ffd811">stab_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_STAB, status_flags, &amp;internal_state);</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#acdfd913506bc016506720168c4d1b2f6">man_switch</a> == manual_control_setpoint_s::SWITCH_POS_NONE) {</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;                <span class="comment">// default to MANUAL when no manual switch is set</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;                <span class="comment">// default to STAB when the manual switch is assigned (but off)</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;                res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_STAB, status_flags, &amp;internal_state);</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;            }</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        }</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        <span class="comment">// TRANSITION_DENIED is not possible here</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    <span class="keywordflow">case</span> manual_control_setpoint_s::SWITCH_POS_MIDDLE:      <span class="comment">// ASSIST</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;        <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab22df60b54970e3a5bb8ca8b52b004af">posctl_switch</a> == manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;            res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_POSCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;            <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;                <span class="keywordflow">break</span>;  <span class="comment">// changed successfully or already in this state</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;            }</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;POSITION CONTROL&quot;</span>);</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;        }</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        <span class="comment">// fallback to ALTCTL</span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_ALTCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;        <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;            <span class="keywordflow">break</span>;  <span class="comment">// changed successfully or already in this mode</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;        }</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        <span class="keywordflow">if</span> (sp_man.<a class="code" href="../../de/de6/structmanual__control__setpoint__s.html#ab22df60b54970e3a5bb8ca8b52b004af">posctl_switch</a> != manual_control_setpoint_s::SWITCH_POS_ON) {</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;ALTITUDE CONTROL&quot;</span>);</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        }</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        <span class="comment">// fallback to MANUAL</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;        <span class="comment">// TRANSITION_DENIED is not possible here</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    <span class="keywordflow">case</span> manual_control_setpoint_s::SWITCH_POS_ON:          <span class="comment">// AUTO</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_AUTO_MISSION, status_flags, &amp;internal_state);</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;        <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;            <span class="keywordflow">break</span>;  <span class="comment">// changed successfully or already in this state</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        }</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="stringliteral">&quot;AUTO MISSION&quot;</span>);</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;        <span class="comment">// fallback to LOITER if home position not set</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_AUTO_LOITER, status_flags, &amp;internal_state);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;        <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;            <span class="keywordflow">break</span>;  <span class="comment">// changed successfully or already in this state</span></div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;        }</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;        <span class="comment">// fallback to POSCTL</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_POSCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;            <span class="keywordflow">break</span>;  <span class="comment">// changed successfully or already in this state</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        }</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;        <span class="comment">// fallback to ALTCTL</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_ALTCTL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        <span class="keywordflow">if</span> (res != <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a>) {</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;            <span class="keywordflow">break</span>;  <span class="comment">// changed successfully or already in this state</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        }</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        <span class="comment">// fallback to MANUAL</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;        res = <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a>(status_local, commander_state_s::MAIN_STATE_MANUAL, status_flags, &amp;internal_state);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        <span class="comment">// TRANSITION_DENIED is not possible here</span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    }</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;    <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;}</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l03199"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a66e5bc6e5edea5edb1eb0aab356e5663"> 3199</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#a66e5bc6e5edea5edb1eb0aab356e5663">Commander::reset_posvel_validity</a>(<span class="keywordtype">bool</span> *changed)</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;{</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    <span class="comment">// reset all the check probation times back to the minimum value</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a3e39683a9372d76c388ad29ac0ccf5f1">_gpos_probation_time_us</a> = POSVEL_PROBATION_MIN;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a9a354bcb8a90b2090e15d1ae25894a34">_lpos_probation_time_us</a> = POSVEL_PROBATION_MIN;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a58568c8d5856cb438e8bfbc9592da526">_lvel_probation_time_us</a> = POSVEL_PROBATION_MIN;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/d36/structvehicle__local__position__s.html">vehicle_local_position_s</a> &amp;local_position = <a class="code" href="../../d3/dc6/class_commander.html#af23998581890b6330bbded526e41c6c2">_local_position_sub</a>.<a class="code" href="../../d0/d65/classu_o_r_b_1_1_subscription.html#aa01d2ff362359aa05b64e93c6df668e0">get</a>();</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../da/dcb/structvehicle__global__position__s.html">vehicle_global_position_s</a> &amp;global_position = <a class="code" href="../../d3/dc6/class_commander.html#a10b495bdc2e05bbaa14fb7cf22481a4b">_global_position_sub</a>.get();</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="comment">// recheck validity</span></div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../da/d73/_commander_8cpp.html#a1d36762fa2d596c65f758185aa92d02a">_skip_pos_accuracy_check</a>) {</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <a class="code" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">check_posvel_validity</a>(<span class="keyword">true</span>, global_position.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#ad92e6508d09300498b54c7a227b2173f">eph</a>, <a class="code" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a>, global_position.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#a73b4ca186bb7f3e8e1bafdb6f5110f8d">timestamp</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a8ab1a540c7edb08e96e74a4b4e03ef73">_last_gpos_fail_time_us</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a3e39683a9372d76c388ad29ac0ccf5f1">_gpos_probation_time_us</a>, &amp;status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a>, changed);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;    }</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">check_posvel_validity</a>(local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a599e9590c26c03d311ec605c83de93fe">xy_valid</a>, local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a545a96d9feb361cc083d23d3be0f81b7">eph</a>, <a class="code" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a>, local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1488785a3e46e25e388a12fa8d132000">timestamp</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a507475e5384f1b19a477d4dcdcc96043">_last_lpos_fail_time_us</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a9a354bcb8a90b2090e15d1ae25894a34">_lpos_probation_time_us</a>, &amp;status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a160aaccd15cb7daf7d2533255c364dec">condition_local_position_valid</a>, changed);</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">check_posvel_validity</a>(local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1e44f76739d29d00717d2a1a251641c9">v_xy_valid</a>, local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#ac8475967543a2e5d1450b734a2e546aa">evh</a>, _evh_threshold.get(), local_position.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1488785a3e46e25e388a12fa8d132000">timestamp</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#af910bab86d61393dae3f0786476e6df9">_last_lvel_fail_time_us</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a58568c8d5856cb438e8bfbc9592da526">_lvel_probation_time_us</a>, &amp;status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ac91747453f278b9349ddd13da330fa0c">condition_local_velocity_valid</a>, changed);</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;}</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l03218"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c"> 3218</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">Commander::check_posvel_validity</a>(<span class="keyword">const</span> <span class="keywordtype">bool</span> data_valid, <span class="keyword">const</span> <span class="keywordtype">float</span> data_accuracy, <span class="keyword">const</span> <span class="keywordtype">float</span> required_accuracy,</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;                 <span class="keyword">const</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> &amp;data_timestamp_us, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> *last_fail_time_us, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> *probation_time_us, <span class="keywordtype">bool</span> *valid_state,</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;                 <span class="keywordtype">bool</span> *validity_changed)</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;{</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> was_valid = *valid_state;</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    <span class="keywordtype">bool</span> valid = was_valid;</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    <span class="comment">// constrain probation times</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <span class="keywordflow">if</span> (land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>) {</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;        *probation_time_us = POSVEL_PROBATION_MIN;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    }</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> data_stale = ((<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;data_timestamp_us) &gt; _failsafe_pos_delay.get() * 1_s) || (data_timestamp_us == 0));</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> req_accuracy = (was_valid ? required_accuracy * 2.5f : required_accuracy);</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> level_check_pass = data_valid &amp;&amp; !data_stale &amp;&amp; (data_accuracy &lt; req_accuracy);</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    <span class="comment">// Check accuracy with hysteresis in both test level and time</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    <span class="keywordflow">if</span> (level_check_pass) {</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;        <span class="keywordflow">if</span> (was_valid) {</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;            <span class="comment">// still valid, continue to decrease probation time</span></div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;            <span class="keyword">const</span> int64_t probation_time_new = *probation_time_us - <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(last_fail_time_us);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;            *probation_time_us = <a class="code" href="../../dd/d47/namespacemath.html#a9ab5768499dc798629f31a3e785ea313">math::constrain</a>(probation_time_new, POSVEL_PROBATION_MIN, <a class="code" href="../../d3/dc6/class_commander.html#a41dfb7eb8f0d7af2fba709f5006b3ec2">POSVEL_PROBATION_MAX</a>);</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;            <span class="comment">// check if probation period has elapsed</span></div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(last_fail_time_us) &gt; *probation_time_us) {</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;                valid = <span class="keyword">true</span>;</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;            }</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        }</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;        <span class="comment">// level check failed</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;        <span class="keywordflow">if</span> (was_valid) {</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;            <span class="comment">// FAILURE! no longer valid</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;            valid = <span class="keyword">false</span>;</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;            <span class="comment">// failed again, increase probation time</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;            <span class="keyword">const</span> int64_t probation_time_new = *probation_time_us + <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(last_fail_time_us) * _failsafe_pos_gain.get();</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;            *probation_time_us = <a class="code" href="../../dd/d47/namespacemath.html#a9ab5768499dc798629f31a3e785ea313">math::constrain</a>(probation_time_new, POSVEL_PROBATION_MIN, <a class="code" href="../../d3/dc6/class_commander.html#a41dfb7eb8f0d7af2fba709f5006b3ec2">POSVEL_PROBATION_MAX</a>);</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;        }</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;        *last_fail_time_us = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    }</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    <span class="keywordflow">if</span> (was_valid != valid) {</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;        *validity_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;        *valid_state = valid;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    }</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    <span class="keywordflow">return</span> valid;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;}</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l03273"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#abbddddc6e2c6951b59f612c852b13467"> 3273</a></span>&#160;<a class="code" href="../../da/d73/_commander_8cpp.html#abbddddc6e2c6951b59f612c852b13467">set_control_mode</a>()</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;{</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    <span class="comment">/* set vehicle_control_mode according to set_navigation_state */</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;    control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7c98f34a2a21a5f74958fd6b5f9c38ed">flag_armed</a> = armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7143908e08d82294b12d3be7d645c619">flag_external_manual_override_ok</a> = (!status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a6933ad99aa1ab7be2ca6bac09268fe7d">is_vtol</a>);</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4e49d10dc620a86b1b762bea8639020d">flag_system_hil_enabled</a> = status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a477f9050e58a25f419da7f643b4c52fb">hil_state</a> == vehicle_status_s::HIL_STATE_ON;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a197fbecdade36e98c504119349fd97c6">flag_control_offboard_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;    <span class="keywordflow">switch</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">nav_state</a>) {</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_MANUAL:</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <a class="code" href="../../da/d73/_commander_8cpp.html#ae6a03cce77b545417f304d159a90b6b4">stabilization_required</a>();</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <a class="code" href="../../da/d73/_commander_8cpp.html#ae6a03cce77b545417f304d159a90b6b4">stabilization_required</a>();</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_STAB:</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_RATTITUDE:</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_ALTCTL:</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_POSCTL:</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a>;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a>;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_RTL:</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_RCRECOVER:</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;        <span class="comment">/* override is not ok for the RTL and recovery mode */</span></div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7143908e08d82294b12d3be7d645c619">flag_external_manual_override_ok</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    <span class="comment">/* fallthrough */</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_FOLLOW_TARGET:</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_RTGS:</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_LAND:</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_LANDENGFAIL:</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_PRECLAND:</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_MISSION:</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_LOITER:</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_TAKEOFF:</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a>;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a>;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_AUTO_LANDGPSFAIL:</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_ACRO:</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_DESCEND:</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;        <span class="comment">/* TODO: check if this makes sense */</span></div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_TERMINATION:</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;        <span class="comment">/* disable all controllers on termination */</span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">flag_control_termination_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;    <span class="keywordflow">case</span> vehicle_status_s::NAVIGATION_STATE_OFFBOARD:</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">flag_control_manual_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">flag_control_auto_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a197fbecdade36e98c504119349fd97c6">flag_control_offboard_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;        <span class="comment">/*</span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;<span class="comment">         * The control flags depend on what is ignored according to the offboard control mode topic</span></div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;<span class="comment">         * Inner loop flags (e.g. attitude) also depend on outer loop ignore flags (e.g. position)</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">flag_control_rates_enabled</a> = !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a6bdb3691df2192bf78c51c49382494fc">ignore_bodyrate</a> ||</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#adfc9036117b22959305d95dca47b1a87">ignore_attitude</a> ||</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a2a24b25049165a1cdab8f39c953290fc">ignore_position</a> ||</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a82aee62e79df21ad3dec7f53b73eca27">ignore_velocity</a> ||</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#ac908a1835dfd9330d6e3394ec4a96bae">ignore_acceleration_force</a>;</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">flag_control_attitude_enabled</a> = !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#adfc9036117b22959305d95dca47b1a87">ignore_attitude</a> ||</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a2a24b25049165a1cdab8f39c953290fc">ignore_position</a> ||</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a82aee62e79df21ad3dec7f53b73eca27">ignore_velocity</a> ||</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#ac908a1835dfd9330d6e3394ec4a96bae">ignore_acceleration_force</a>;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">flag_control_rattitude_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a> = !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#ac908a1835dfd9330d6e3394ec4a96bae">ignore_acceleration_force</a> &amp;&amp;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;                !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a>;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">flag_control_velocity_enabled</a> = (!offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a82aee62e79df21ad3dec7f53b73eca27">ignore_velocity</a> ||</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a2a24b25049165a1cdab8f39c953290fc">ignore_position</a>) &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a> &amp;&amp;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;                !control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a>;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">flag_control_climb_rate_enabled</a> = (!offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a82aee62e79df21ad3dec7f53b73eca27">ignore_velocity</a> ||</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a2a24b25049165a1cdab8f39c953290fc">ignore_position</a>) &amp;&amp; !control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a>;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">flag_control_position_enabled</a> = !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a2a24b25049165a1cdab8f39c953290fc">ignore_position</a> &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">in_transition_mode</a> &amp;&amp;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;                !control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a>;</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">flag_control_altitude_enabled</a> = (!offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a82aee62e79df21ad3dec7f53b73eca27">ignore_velocity</a> ||</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;                !offboard_control_mode.<a class="code" href="../../da/d9d/structoffboard__control__mode__s.html#a2a24b25049165a1cdab8f39c953290fc">ignore_position</a>) &amp;&amp; !control_mode.<a class="code" href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">flag_control_acceleration_enabled</a>;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    }</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;}</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l03483"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#ae6a03cce77b545417f304d159a90b6b4"> 3483</a></span>&#160;<a class="code" href="../../da/d73/_commander_8cpp.html#ae6a03cce77b545417f304d159a90b6b4">stabilization_required</a>()</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;{</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;    <span class="keywordflow">return</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a> ||        <span class="comment">// is a rotary wing, or</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;        status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ab1296ede7579a9dc43aa8a9a6bd06b3a">vtol_fw_permanent_stab</a> ||    <span class="comment">// is a VTOL in fixed wing mode and stabilisation is on, or</span></div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;        (vtol_status.<a class="code" href="../../d4/d41/structvtol__vehicle__status__s.html#a2bfa5197c337c95901e7384087d10a51">vtol_in_trans_mode</a> &amp;&amp;  <span class="comment">// is currently a VTOL transitioning AND</span></div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;         !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a>));  <span class="comment">// is a fixed wing, ie: transitioning back to rotary wing mode</span></div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;}</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l03492"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8"> 3492</a></span>&#160;<a class="code" href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d87/px4io_8c.html#abaa327c5cc17da179a4bfea0de695fbc">msg</a>)</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;{</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;    <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> t = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;    <span class="keywordflow">if</span> (t - <a class="code" href="../../da/d73/_commander_8cpp.html#a3a559214533089fa9b2ef7bfc5540eb2">last_print_mode_reject_time</a> &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#a00d869b19f4893dfdffbbc156fc3202b">PRINT_MODE_REJECT_INTERVAL</a>) {</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a3a559214533089fa9b2ef7bfc5540eb2">last_print_mode_reject_time</a> = t;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;REJECT %s&quot;</span>, msg);</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;        <span class="comment">/* only buzz if armed, because else we&#39;re driving people nuts indoors</span></div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;<span class="comment">        they really need to look at the leds as well. */</span></div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>);</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;    }</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;}</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l03507"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e"> 3507</a></span>&#160;<a class="code" href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e">print_reject_arm</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d87/px4io_8c.html#abaa327c5cc17da179a4bfea0de695fbc">msg</a>)</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;{</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> t = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    <span class="keywordflow">if</span> (t - <a class="code" href="../../da/d73/_commander_8cpp.html#a3a559214533089fa9b2ef7bfc5540eb2">last_print_mode_reject_time</a> &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#a00d869b19f4893dfdffbbc156fc3202b">PRINT_MODE_REJECT_INTERVAL</a>) {</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a3a559214533089fa9b2ef7bfc5540eb2">last_print_mode_reject_time</a> = t;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, msg);</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    }</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;}</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;</div><div class="line"><a name="l03518"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b"> 3518</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(<span class="keyword">const</span> <a class="code" href="../../d7/dcc/structvehicle__command__s.html">vehicle_command_s</a> &amp;cmd, <span class="keywordtype">unsigned</span> result, <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> &amp;command_ack_pub)</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;{</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;    <span class="keywordflow">switch</span> (result) {</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED:</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a24e135bf6ba98c55a652feab03293aa7">tune_positive</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_RESULT_DENIED:</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_RESULT_FAILED:</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_RESULT_TEMPORARILY_REJECTED:</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;    <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_RESULT_UNSUPPORTED:</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    }</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    <span class="comment">/* publish ACK */</span></div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    <a class="code" href="../../da/deb/structvehicle__command__ack__s.html">vehicle_command_ack_s</a> command_ack = {};</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;    command_ack.<a class="code" href="../../da/deb/structvehicle__command__ack__s.html#a94715751095348a093d9774f9f4151b5">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    command_ack.<a class="code" href="../../da/deb/structvehicle__command__ack__s.html#ab48829d9b01a0770cb9e99af9f4f685f">command</a> = cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a>;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;    command_ack.<a class="code" href="../../da/deb/structvehicle__command__ack__s.html#a2a7cc7ebb5d9fe0d8ac550790e150699">result</a> = (uint8_t)result;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;    command_ack.<a class="code" href="../../da/deb/structvehicle__command__ack__s.html#a8042a3b38a4f70c1664f096ff1304646">target_system</a> = cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#ae886d0e0606a4c10194b38789b30ba4e">source_system</a>;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;    command_ack.<a class="code" href="../../da/deb/structvehicle__command__ack__s.html#aada7877222b0095c6650d62aa918bd2b">target_component</a> = cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a3da26a5e7cda0177a3457522377bad9e">source_component</a>;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    <span class="keywordflow">if</span> (command_ack_pub != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_command_ack), command_ack_pub, &amp;command_ack);</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;        command_ack_pub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a91df70141220b84c1c01619db0c3e105">orb_advertise_queue</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_command_ack), &amp;command_ack, vehicle_command_ack_s::ORB_QUEUE_LENGTH);</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    }</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;}</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;</div><div class="line"><a name="l03561"></a><span class="lineno"><a class="line" href="../../da/d73/_commander_8cpp.html#af62ee6f05861387a2bc3831c160afea8"> 3561</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="../../da/d73/_commander_8cpp.html#af62ee6f05861387a2bc3831c160afea8">commander_low_prio_loop</a>(<span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;{</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    <span class="comment">/* Set thread name */</span></div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;    px4_prctl(PR_SET_NAME, <span class="stringliteral">&quot;commander_low_prio&quot;</span>, px4_getpid());</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;    <span class="comment">/* Subscribe to command topic */</span></div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    <span class="keywordtype">int</span> cmd_sub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_command));</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    <span class="comment">/* command ack */</span></div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;    <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> command_ack_pub = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;    <span class="comment">/* wakeup source(s) */</span></div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;    px4_pollfd_struct_t fds[1];</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;    <span class="comment">/* use the gyro to pace output - XXX BROKEN if we are using the L3GD20 */</span></div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;    fds[0].fd = cmd_sub;</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    fds[0].events = POLLIN;</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;    <span class="keywordflow">while</span> (!<a class="code" href="../../da/d73/_commander_8cpp.html#a19e65cfacb780bf766338756148a966d">thread_should_exit</a>) {</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        <span class="comment">/* wait for up to 1000ms for data */</span></div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;        <span class="keywordtype">int</span> pret = <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#ab58015a6dcb46cf377c9091677cd4417">px4_poll</a>(&amp;fds[0], (<span class="keyword">sizeof</span>(fds) / <span class="keyword">sizeof</span>(fds[0])), 1000);</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;        <span class="keywordflow">if</span> (pret &lt; 0) {</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;            <span class="comment">/* this is undesirable but not much we can do - might want to flag unhappy status */</span></div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;            <a class="code" href="../../d6/d40/err_8h.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;commander: poll error %d, %d&quot;</span>, pret, errno);</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pret != 0) {</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d7/dcc/structvehicle__command__s.html">vehicle_command_s</a> cmd;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;            <span class="comment">/* if we reach here, we have a valid command */</span></div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(vehicle_command), cmd_sub, &amp;cmd);</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;            <span class="comment">/* ignore commands the high-prio loop or the navigator handles */</span></div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;            <span class="keywordflow">if</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a> == vehicle_command_s::VEHICLE_CMD_DO_SET_MODE ||</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;                cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a> == vehicle_command_s::VEHICLE_CMD_COMPONENT_ARM_DISARM ||</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;                cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a> == vehicle_command_s::VEHICLE_CMD_NAV_TAKEOFF ||</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;                cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a> == vehicle_command_s::VEHICLE_CMD_DO_SET_SERVO ||</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;                cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a> == vehicle_command_s::VEHICLE_CMD_DO_CHANGE_SPEED) {</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;            }</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;            <span class="comment">/* only handle low-priority commands here */</span></div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;            <span class="keywordflow">switch</span> (cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">command</a>) {</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;            <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_REBOOT_SHUTDOWN:</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../df/d25/state__machine__helper_8cpp.html#adf3c034062b0d6d7f415a35efebedf01">is_safe</a>(safety, armed)) {</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;                    <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>)) == 1) {</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;                        <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(100000);</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;                        <span class="comment">/* reboot */</span></div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;                        <a class="code" href="../../df/d04/shutdown_8cpp.html#ac973512abb1ee1d0cacd5df9e1f68b6a">px4_shutdown_request</a>(<span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>)) == 2) {</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;                        <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(100000);</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;                        <span class="comment">/* shutdown */</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;                        <a class="code" href="../../df/d04/shutdown_8cpp.html#ac973512abb1ee1d0cacd5df9e1f68b6a">px4_shutdown_request</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>)) == 3) {</div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;                        <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(100000);</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;                        <span class="comment">/* reboot to bootloader */</span></div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;                        <a class="code" href="../../df/d04/shutdown_8cpp.html#ac973512abb1ee1d0cacd5df9e1f68b6a">px4_shutdown_request</a>(<span class="keyword">true</span>, <span class="keyword">true</span>);</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_DENIED, command_ack_pub);</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;                    }</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;                    <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_DENIED, command_ack_pub);</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;                }</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;            <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_CALIBRATION: {</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;                    <span class="keywordtype">int</span> calib_ret = <a class="code" href="../../df/dd0/px4__defines_8h.html#a70e1b6490b2e0b591672067b5cb2a06b">PX4_ERROR</a>;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;                    <span class="comment">/* try to go to INIT/PREFLIGHT arming state */</span></div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a> == <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a>(&amp;status, battery, safety, vehicle_status_s::ARMING_STATE_INIT, &amp;armed,</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;                            <span class="keyword">false</span> <span class="comment">/* fRunPreArmChecks */</span>, &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;status_flags,</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;                            <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>))) {</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_DENIED, command_ack_pub);</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;                        status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#aae8f00ee97a82f182912b95d4b017df5">condition_calibration_enabled</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;                    }</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                    <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>) == 1) {</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                        <span class="comment">/* gyro calibration */</span></div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;                        calib_ret = <a class="code" href="../../df/d5e/gyro__calibration_8cpp.html#a4efe4d135d3df2f59371abd80f19801a">do_gyro_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>) == vehicle_command_s::PREFLIGHT_CALIBRATION_TEMPERATURE_CALIBRATION ||</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                           (<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a7a66aafb32c26d7245a7d1e1106045e0">param5</a>) == vehicle_command_s::PREFLIGHT_CALIBRATION_TEMPERATURE_CALIBRATION ||</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;                           (<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abefaf0afd13d3b4cd44c3e29a6cb1694">param7</a>) == vehicle_command_s::PREFLIGHT_CALIBRATION_TEMPERATURE_CALIBRATION) {</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;                        <span class="comment">/* temperature calibration: handled in events module */</span></div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;                        <span class="keywordflow">break</span>;</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abbb4baad7f6410ef1f2ce1ba5841f00a">param2</a>) == 1) {</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;                        <span class="comment">/* magnetometer calibration */</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;                        calib_ret = <a class="code" href="../../de/d14/mag__calibration_8cpp.html#afc0e4e0619e1f2846eeec88a20aa9b8e">do_mag_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a4a1ffaa0862d627a54c57bc8cb6d3929">param3</a>) == 1) {</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;                        <span class="comment">/* zero-altitude pressure calibration */</span></div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_DENIED, command_ack_pub);</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a63efacb8a96b64f975496cb06b9636d5">param4</a>) == 1) {</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;                        <span class="comment">/* RC calibration */</span></div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;                        <span class="comment">/* disable RC control input completely */</span></div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;                        status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2b48cdd399be15b5d8a85868e07fb009">rc_input_blocked</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;                        calib_ret = <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CAL: Disabling RC IN&quot;</span>);</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a63efacb8a96b64f975496cb06b9636d5">param4</a>) == 2) {</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                        <span class="comment">/* RC trim calibration */</span></div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;                        calib_ret = <a class="code" href="../../da/db3/rc__calibration_8cpp.html#a0e46b1efe365665e7ae7eba4aefae32b">do_trim_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a7a66aafb32c26d7245a7d1e1106045e0">param5</a>) == 1) {</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;                        <span class="comment">/* accelerometer calibration */</span></div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;                        calib_ret = <a class="code" href="../../dd/dcd/accelerometer__calibration_8cpp.html#ad01f28350f810d176a4ae4bc4e9fa81f">do_accel_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a7a66aafb32c26d7245a7d1e1106045e0">param5</a>) == 2) {</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;                        <span class="comment">// board offset calibration</span></div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;                        calib_ret = <a class="code" href="../../dd/dcd/accelerometer__calibration_8cpp.html#adf8b5d0eb3d93e20d76e3273b6f27b88">do_level_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a388b7a9e0e9d2e211904cb365db2155b">param6</a>) == 1 || (<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a388b7a9e0e9d2e211904cb365db2155b">param6</a>) == 2) {</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;                        <span class="comment">// TODO: param6 == 1 is deprecated, but we still accept it for a while (feb 2017)</span></div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;                        <span class="comment">/* airspeed calibration */</span></div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                        calib_ret = <a class="code" href="../../d3/d73/airspeed__calibration_8cpp.html#a86965ddfd735f86625739ca51be885d7">do_airspeed_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>);</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#abefaf0afd13d3b4cd44c3e29a6cb1694">param7</a>) == 1) {</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                        <span class="comment">/* do esc calibration */</span></div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;                        calib_ret = <a class="code" href="../../d1/d41/esc__calibration_8cpp.html#a076fa55d1c50ba98926631180977e012">do_esc_calibration</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;armed);</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#a63efacb8a96b64f975496cb06b9636d5">param4</a>) == 0) {</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;                        <span class="comment">/* RC calibration ended - have we been in one worth confirming? */</span></div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;                        <span class="keywordflow">if</span> (status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2b48cdd399be15b5d8a85868e07fb009">rc_input_blocked</a>) {</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;                            <span class="comment">/* enable RC control input */</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;                            status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a2b48cdd399be15b5d8a85868e07fb009">rc_input_blocked</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CAL: Re-enabling RC IN&quot;</span>);</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;                        }</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;                        <span class="comment">/* this always succeeds */</span></div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                        calib_ret = <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>;</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_UNSUPPORTED, command_ack_pub);</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;                    }</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                    status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#aae8f00ee97a82f182912b95d4b017df5">condition_calibration_enabled</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;                    <span class="keywordflow">if</span> (calib_ret == <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>) {</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;                        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a24e135bf6ba98c55a652feab03293aa7">tune_positive</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;                        <a class="code" href="../../d3/dc6/class_commander.html#a31c2d7d8ee9793a82b291658016a3f29">Commander::preflight_check</a>(<span class="keyword">false</span>);</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;                        <a class="code" href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a>(&amp;status, battery, safety, vehicle_status_s::ARMING_STATE_STANDBY, &amp;armed,</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;                                    <span class="keyword">false</span> <span class="comment">/* fRunPreArmChecks */</span>,</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;                                    &amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, &amp;status_flags, <a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a>, <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>));</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;                        <a class="code" href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;                    }</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;                }</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;            <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_PREFLIGHT_STORAGE: {</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;                    <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>)) == 0) {</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;                        <span class="keywordtype">int</span> ret = <a class="code" href="../../d9/da5/param_8c.html#a7ec8a852f20e4bc7577b8698120db585">param_load_default</a>();</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;                        <span class="keywordflow">if</span> (ret == <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>) {</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;settings loaded&quot;</span>);</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;                            <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;settings load ERROR&quot;</span>);</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                            <span class="comment">/* convenience as many parts of NuttX use negative errno */</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                            <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;                                ret = -ret;</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                            }</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;                            <span class="keywordflow">if</span> (ret &lt; 1000) {</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;ERROR: %s&quot;</span>, strerror(ret));</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;                            }</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;                            <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_FAILED, command_ack_pub);</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;                        }</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>)) == 1) {</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;<span class="preprocessor">#ifdef __PX4_QURT</span></div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;                        <span class="comment">// TODO FIXME: on snapdragon the save happens too early when the params</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;                        <span class="comment">// are not set yet. We therefore need to wait some time first.</span></div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;                        <a class="code" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(1000000);</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;                        <span class="keywordtype">int</span> ret = <a class="code" href="../../d9/da5/param_8c.html#a8c23617be66d165d07cc3bd42e9acffd">param_save_default</a>();</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;                        <span class="keywordflow">if</span> (ret == <a class="code" href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a>) {</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;                            <span class="comment">/* do not spam MAVLink, but provide the answer / green led mechanism */</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;                            <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;settings save error&quot;</span>);</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;                            <span class="comment">/* convenience as many parts of NuttX use negative errno */</span></div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;                            <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;                                ret = -ret;</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;                            }</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;                            <span class="keywordflow">if</span> (ret &lt; 1000) {</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;                                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;ERROR: %s&quot;</span>, strerror(ret));</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;                            }</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;                            <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_FAILED, command_ack_pub);</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;                        }</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)(cmd.<a class="code" href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">param1</a>)) == 2) {</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;                        <span class="comment">/* reset parameters and save empty file */</span></div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;                        <a class="code" href="../../d9/da5/param_8c.html#aab3a3324b8f2b8a6d4d33583024ea7cc">param_reset_all</a>();</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;                        <span class="comment">/* do not spam MAVLink, but provide the answer / green led mechanism */</span></div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;                        <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;onboard parameters reset&quot;</span>);</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;                        <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;                    }</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;                }</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;            <span class="keywordflow">case</span> vehicle_command_s::VEHICLE_CMD_START_RX_PAIR:</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;                <span class="comment">/* just ack, implementation handled in the IO driver */</span></div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;                <a class="code" href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a>(cmd, vehicle_command_s::VEHICLE_CMD_RESULT_ACCEPTED, command_ack_pub);</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;                <span class="comment">/* don&#39;t answer on unsupported commands, it will be done in main loop */</span></div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;            }</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;        }</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;    }</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;    <a class="code" href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a>(cmd_sub);</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;}</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;</div><div class="line"><a name="l03825"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a93322580e8a6adb7647a42b9f8ed3487"> 3825</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d3/dc6/class_commander.html#a93322580e8a6adb7647a42b9f8ed3487">Commander::custom_command</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;{</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d3/dc6/class_commander.html#af6c317d7048a7e6711cd0c15e5e5e6e4">print_usage</a>(<span class="stringliteral">&quot;unknown command&quot;</span>);</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;}</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;</div><div class="line"><a name="l03830"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#af6c317d7048a7e6711cd0c15e5e5e6e4"> 3830</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d3/dc6/class_commander.html#af6c317d7048a7e6711cd0c15e5e5e6e4">Commander::print_usage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *reason)</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;{</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;    <span class="keywordflow">if</span> (reason) {</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;        <a class="code" href="../../d7/d53/px4__log_8h.html#a1456147685cf86fa9d058baf143ae141">PX4_WARN</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, reason);</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;    }</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;}</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;</div><div class="line"><a name="l03839"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a0b128d701d0bcb19a4376f32a0002f73"> 3839</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d3/dc6/class_commander.html#a0b128d701d0bcb19a4376f32a0002f73">Commander::task_spawn</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;{</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;    _task_id = <a class="code" href="../../da/d65/px4__tasks_8h.html#a9c9c04f140b8e63904e0e0c6597a5fc8">px4_task_spawn_cmd</a>(<span class="stringliteral">&quot;commander&quot;</span>,</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;                      <a class="code" href="../../d6/dad/hello__start__posix_8cpp.html#aea5747e6274863a22260d0046ca87452">SCHED_DEFAULT</a>,</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;                      SCHED_PRIORITY_DEFAULT + 40,</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;                      3250,</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;                      (<a class="code" href="../../da/d65/px4__tasks_8h.html#ad6b4506aaddc80015da7892f25772f40">px4_main_t</a>)&amp;run_trampoline,</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;                      (<span class="keywordtype">char</span> *<span class="keyword">const</span> *)argv);</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;    <span class="keywordflow">if</span> (_task_id &lt; 0) {</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;        _task_id = -1;</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;        <span class="keywordflow">return</span> -errno;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;    }</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;}</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;</div><div class="line"><a name="l03856"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a51dba9924beda93aea01a07793dda28a"> 3856</a></span>&#160;<a class="code" href="../../d3/dc6/class_commander.html">Commander</a> *<a class="code" href="../../d3/dc6/class_commander.html#a51dba9924beda93aea01a07793dda28a">Commander::instantiate</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;{</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html">Commander</a> *<a class="code" href="../../d2/dec/aerofc__adc_8cpp.html#ad0a45fb9e843829aecb496154724b9de">instance</a> = <span class="keyword">new</span> <a class="code" href="../../d3/dc6/class_commander.html#ac3fc4568a88c91cb4ab97de9f77698a9">Commander</a>();</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;    <span class="comment">// XXX remove this once this is a class member</span></div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;    status = {};</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;    <span class="keywordflow">if</span> (instance) {</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;        <span class="keywordflow">if</span> (argc &gt;= 2 &amp;&amp; !strcmp(argv[1], <span class="stringliteral">&quot;--hil&quot;</span>)) {</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;            instance-&gt;<a class="code" href="../../d3/dc6/class_commander.html#a387b22616ab617aaba60b804e6b4723e">enable_hil</a>();</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;        }</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;    }</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d2/dec/aerofc__adc_8cpp.html#ad0a45fb9e843829aecb496154724b9de">instance</a>;</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;}</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;</div><div class="line"><a name="l03872"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a387b22616ab617aaba60b804e6b4723e"> 3872</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d3/dc6/class_commander.html#a387b22616ab617aaba60b804e6b4723e">Commander::enable_hil</a>()</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;{</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;    status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a477f9050e58a25f419da7f643b4c52fb">hil_state</a> = vehicle_status_s::HIL_STATE_ON;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;}</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;</div><div class="line"><a name="l03877"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#af1dc603ce8ac5c165ffbf71cc57f850f"> 3877</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d3/dc6/class_commander.html#af1dc603ce8ac5c165ffbf71cc57f850f">Commander::mission_init</a>()</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;{</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;    <span class="comment">/* init mission state, do it here to allow navigator to use stored mission even if mavlink failed to start */</span></div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;    <a class="code" href="../../db/d74/structmission__s.html">mission_s</a> mission = {};</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d47/dataman_8cpp.html#a3e79510848c9ee7d821d33a35f6779f3">dm_read</a>(<a class="code" href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8aec9fb8d456f6c372b1fd778e91600087">DM_KEY_MISSION_STATE</a>, 0, &amp;mission, <span class="keyword">sizeof</span>(<a class="code" href="../../db/d74/structmission__s.html">mission_s</a>)) == <span class="keyword">sizeof</span>(<a class="code" href="../../db/d74/structmission__s.html">mission_s</a>)) {</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;        <span class="keywordflow">if</span> (mission.<a class="code" href="../../db/d74/structmission__s.html#acaa79e79d52b69fb4f57b8941e93260d">dataman_id</a> == <a class="code" href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8a1f821db4150166fbe2c5a8b67c4579bc">DM_KEY_WAYPOINTS_OFFBOARD_0</a> || mission.<a class="code" href="../../db/d74/structmission__s.html#acaa79e79d52b69fb4f57b8941e93260d">dataman_id</a> == <a class="code" href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8a57d12e18d8660fd0083bf75f76670e07">DM_KEY_WAYPOINTS_OFFBOARD_1</a>) {</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;            <span class="keywordflow">if</span> (mission.<a class="code" href="../../db/d74/structmission__s.html#a7aca40dd38583c2f84561d097f892409">count</a> &gt; 0) {</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;                <a class="code" href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a>(<span class="stringliteral">&quot;Mission #%d loaded, %u WPs, curr: %d&quot;</span>, mission.<a class="code" href="../../db/d74/structmission__s.html#acaa79e79d52b69fb4f57b8941e93260d">dataman_id</a>, mission.<a class="code" href="../../db/d74/structmission__s.html#a7aca40dd38583c2f84561d097f892409">count</a>, mission.<a class="code" href="../../db/d74/structmission__s.html#a18927047aee87dc848d11106607cb0f5">current_seq</a>);</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;            }</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;            <a class="code" href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a>(<span class="stringliteral">&quot;reading mission state failed&quot;</span>);</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;            <span class="comment">/* initialize mission state in dataman */</span></div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;            mission.<a class="code" href="../../db/d74/structmission__s.html#afee1a7da296db84bd999a31738f474c6">timestamp</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;            mission.<a class="code" href="../../db/d74/structmission__s.html#acaa79e79d52b69fb4f57b8941e93260d">dataman_id</a> = <a class="code" href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8a1f821db4150166fbe2c5a8b67c4579bc">DM_KEY_WAYPOINTS_OFFBOARD_0</a>;</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;            <a class="code" href="../../d6/d47/dataman_8cpp.html#a9d8d206c43b9939cfd6f5d3aed46983b">dm_write</a>(<a class="code" href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8aec9fb8d456f6c372b1fd778e91600087">DM_KEY_MISSION_STATE</a>, 0, <a class="code" href="../../db/d6e/dataman_8h.html#a3aa83981a3a5ad8b8fd5a6dd657cbb2bab2d66c95797064a2803f282d203b0048">DM_PERSIST_POWER_ON_RESET</a>, &amp;mission, <span class="keyword">sizeof</span>(<a class="code" href="../../db/d74/structmission__s.html">mission_s</a>));</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;        }</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;        <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a> mission_pub = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(mission), &amp;mission);</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a1c2ecd4919751835265681c212badaf4">orb_unadvertise</a>(mission_pub);</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;    }</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;}</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;</div><div class="line"><a name="l03902"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a31c2d7d8ee9793a82b291658016a3f29"> 3902</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d3/dc6/class_commander.html#a31c2d7d8ee9793a82b291658016a3f29">Commander::preflight_check</a>(<span class="keywordtype">bool</span> report)</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;{</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> checkGNSS = (<a class="code" href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a> &amp; <a class="code" href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a7fbd2725bf089f82868a221a5694616b">ARM_REQ_GPS_BIT</a>);</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;    <span class="keywordtype">bool</span> success = <a class="code" href="../../d4/d96/namespace_preflight.html#a40c1bbeaadf96c1bd47cff1babc0f159">Preflight::preflightCheck</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, status, status_flags, checkGNSS, report, <span class="keyword">false</span>,</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;            <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>));</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    <span class="keywordflow">if</span> (success) {</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;        status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#abf8f27de653a86414890a4928caff730">condition_system_sensors_initialized</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;    }</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;    <span class="keywordflow">return</span> success;</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;}</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;</div><div class="line"><a name="l03916"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a7b9c381b03caead8f28b7b8b69a6d5cd"> 3916</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d3/dc6/class_commander.html#a7b9c381b03caead8f28b7b8b69a6d5cd">Commander::poll_telemetry_status</a>()</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;{</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;    <span class="keywordtype">bool</span> updated = <span class="keyword">false</span>;</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8c09e8f28a090e8cae61e10d627f102a">ORB_MULTI_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].subscriber &lt; 0) {</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;            <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a13413085d6b18bac3d37b3bf9ad3a54a">subscriber</a> = <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c71c73d77220ff8faf2cb8eb7509e66">orb_subscribe_multi</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(telemetry_status), i);</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;        }</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;        <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a>(<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].subscriber, &amp;updated);</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;        <span class="keywordflow">if</span> (updated) {</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;            <a class="code" href="../../dc/dda/structtelemetry__status__s.html">telemetry_status_s</a> telemetry = {};</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;            <a class="code" href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a>(<a class="code" href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a>(telemetry_status), <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].subscriber, &amp;telemetry);</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;            <span class="comment">/* perform system checks when new telemetry link connected */</span></div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;            <span class="keywordflow">if</span> (<span class="comment">/* we first connect a link or re-connect a link after loosing it or haven&#39;t yet reported anything */</span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;                (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_heartbeat == 0 || (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_heartbeat) &gt; 3_s)</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;                 || !<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].preflight_checks_reported) &amp;&amp;</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;                <span class="comment">/* and this link has a communication partner */</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;                (telemetry.<a class="code" href="../../dc/dda/structtelemetry__status__s.html#ad565cfa34c3921393e5425bbf153d749">heartbeat_time</a> &gt; 0) &amp;&amp;</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;                <span class="comment">/* and it is still connected */</span></div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;                (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;telemetry.<a class="code" href="../../dc/dda/structtelemetry__status__s.html#ad565cfa34c3921393e5425bbf153d749">heartbeat_time</a>) &lt; 2_s) &amp;&amp;</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;                <span class="comment">/* and the system is not already armed (and potentially flying) */</span></div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;                !armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;                <span class="comment">/* flag the checks as reported for this link when we actually report them */</span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a6cf391072b3f42e2f4d67d837527c840">preflight_checks_reported</a> = status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">condition_system_hotplug_timeout</a>;</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a31c2d7d8ee9793a82b291658016a3f29">preflight_check</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;                <span class="comment">// Provide feedback on mission state</span></div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d5/dd1/structmission__result__s.html">mission_result_s</a> &amp;mission_result = <a class="code" href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">_mission_result_sub</a>.get();</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;                <span class="keywordflow">if</span> ((mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#a6e06db9b2266dbe0a2f302f5c42cec98">timestamp</a> &gt; <a class="code" href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a>) &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">condition_system_hotplug_timeout</a> &amp;&amp;</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;                    (mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#ad18bbbbc2a2bade91480f6cf56029f63">instance_count</a> &gt; 0) &amp;&amp; !mission_result.<a class="code" href="../../d5/dd1/structmission__result__s.html#aebceada7bf8a7fa201333d19b6de8a9b">valid</a>) {</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;Planned mission fails check. Please upload again.&quot;</span>);</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;                    <span class="comment">//set_health_flags(subsystem_info_s::SUBSYSTEM_TYPE_MISSION, true, true, false, status); // TODO</span></div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;                    <span class="comment">//set_health_flags(subsystem_info_s::SUBSYSTEM_TYPE_MISSION, true, true, true, status); // TODO</span></div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;                }</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;            }</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;            <span class="comment">/* set (and don&#39;t reset) telemetry via USB as active once a MAVLink connection is up */</span></div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;            <span class="keywordflow">if</span> (telemetry.<a class="code" href="../../dc/dda/structtelemetry__status__s.html#a9240e83bb480acd0dd3f984db3703314">type</a> == telemetry_status_s::TELEMETRY_STATUS_RADIO_TYPE_USB) {</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;                status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a675c19070b0ca7956c113ce12c8e57d0">usb_connected</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;            }</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;            <span class="comment">/* set latency type of the telemetry connection */</span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;            <span class="keywordflow">if</span> (telemetry.<a class="code" href="../../dc/dda/structtelemetry__status__s.html#a9240e83bb480acd0dd3f984db3703314">type</a> == telemetry_status_s::TELEMETRY_STATUS_RADIO_TYPE_IRIDIUM) {</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a6ac242bf160bba783c561e8131086ea0">high_latency</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a6ac242bf160bba783c561e8131086ea0">high_latency</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;            }</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;            <span class="keywordflow">if</span> (telemetry.<a class="code" href="../../dc/dda/structtelemetry__status__s.html#ad565cfa34c3921393e5425bbf153d749">heartbeat_time</a> &gt; 0 &amp;&amp; (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a713d90351231dec0dd0f8070ad90660f">last_heartbeat</a> &lt; telemetry.<a class="code" href="../../dc/dda/structtelemetry__status__s.html#ad565cfa34c3921393e5425bbf153d749">heartbeat_time</a>)) {</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a713d90351231dec0dd0f8070ad90660f">last_heartbeat</a> = telemetry.<a class="code" href="../../dc/dda/structtelemetry__status__s.html#ad565cfa34c3921393e5425bbf153d749">heartbeat_time</a>;</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;            }</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;        }</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;        <span class="comment">// for iridium telemetry use the iridiumsbd_status to update the heartbeat</span></div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].high_latency) {</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a2f773d7c41396c682c6769c742e53f08">_iridiumsbd_status_sub</a>.update()) {</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> isbd_timestamp = <a class="code" href="../../d3/dc6/class_commander.html#a2f773d7c41396c682c6769c742e53f08">_iridiumsbd_status_sub</a>.get().last_heartbeat;</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;                <span class="keywordflow">if</span> (isbd_timestamp &gt; <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_heartbeat) {</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;                    <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a713d90351231dec0dd0f8070ad90660f">last_heartbeat</a> = isbd_timestamp;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;                }</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;            }</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;        }</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    }</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;}</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;</div><div class="line"><a name="l03992"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a4aa2c84e4d98b8a7b47e4acbd1ffb5b6"> 3992</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d3/dc6/class_commander.html#a4aa2c84e4d98b8a7b47e4acbd1ffb5b6">Commander::data_link_checks</a>(int32_t highlatencydatalink_loss_timeout, int32_t highlatencydatalink_regain_timeout,</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;                 int32_t datalink_loss_timeout, int32_t datalink_regain_timeout, <span class="keywordtype">bool</span> *status_changed)</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;{</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;    <span class="comment">/* data links check */</span></div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;    <span class="keywordtype">bool</span> have_link = <span class="keyword">false</span>;</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;    <span class="keywordtype">bool</span> high_latency_link_exists = <span class="keyword">false</span>;</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;    <span class="keywordtype">bool</span> have_low_latency_link = <span class="keyword">false</span>;</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;    int32_t dl_loss_timeout_local = 0;</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;    int32_t dl_regain_timeout_local = 0;</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8c09e8f28a090e8cae61e10d627f102a">ORB_MULTI_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].high_latency) {</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;            high_latency_link_exists = <span class="keyword">true</span>;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;            <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a791f24dab19dc433eabd2f32b8024638">high_latency_data_link_active</a>) {</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;                dl_loss_timeout_local = highlatencydatalink_loss_timeout;</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;                dl_regain_timeout_local = highlatencydatalink_regain_timeout;</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;                <span class="comment">// if the high latency link is inactive we do not want to accidentally detect it as an active link</span></div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;                dl_loss_timeout_local = INT32_MIN;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;                dl_regain_timeout_local = INT32_MAX;</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;            }</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;            dl_loss_timeout_local = datalink_loss_timeout;</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;            dl_regain_timeout_local = datalink_regain_timeout;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;        }</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_heartbeat != 0 &amp;&amp;</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;            <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_heartbeat) &lt; dl_loss_timeout_local * 1e6) {</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;            <span class="comment">/* handle the case where data link was gained first time or regained,</span></div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;<span class="comment">             * accept datalink as healthy only after datalink_regain_timeout seconds</span></div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;<span class="comment">             * */</span></div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].lost &amp;&amp;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;                <a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_dl_loss) &gt; dl_regain_timeout_local * 1e6) {</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;                <span class="comment">/* report a regain */</span></div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_dl_loss &gt; 0) {</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;                    <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;data link #%i regained&quot;</span>, i);</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].last_dl_loss == 0) {</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;                    <span class="comment">/* new link */</span></div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;                }</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;                <span class="comment">/* got link again or new */</span></div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;                *status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a205dc941c6706dc85c62e8e6becfb6e3">lost</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;                have_link = <span class="keyword">true</span>;</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].high_latency) {</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;                    have_low_latency_link = <span class="keyword">true</span>;</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;                }</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].lost) {</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;                <span class="comment">/* telemetry was healthy also in last iteration</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;<span class="comment">                 * we don&#39;t have to check a timeout */</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;                have_link = <span class="keyword">true</span>;</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].high_latency) {</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;                    have_low_latency_link = <span class="keyword">true</span>;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;                }</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;            }</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].lost) {</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;                <span class="comment">/* only reset the timestamp to a different time on state change */</span></div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#adb6c4f049a665c5e8b945d5bfeb08249">last_dl_loss</a>  = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;data link #%i lost&quot;</span>, i);</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a205dc941c6706dc85c62e8e6becfb6e3">lost</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;            }</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;        }</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;    }</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;    <span class="keywordflow">if</span> (have_link) {</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;        <span class="comment">/* handle the case where data link was regained */</span></div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;        <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a>) {</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;            *status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;        }</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;        <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a791f24dab19dc433eabd2f32b8024638">high_latency_data_link_active</a> &amp;&amp; have_low_latency_link) {</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;            <span class="comment">// regained a low latency telemetry link, deactivate the high latency link</span></div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;            <span class="comment">// to avoid transmitting unnecessary data over that link</span></div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a791f24dab19dc433eabd2f32b8024638">high_latency_data_link_active</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;            *status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;LOW LAT LINKS REGAINED, DEACTIVATE HIGH LAT LINK&quot;</span>);</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;        }</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;        <span class="keywordflow">if</span> (high_latency_link_exists &amp;&amp; !status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a791f24dab19dc433eabd2f32b8024638">high_latency_data_link_active</a> &amp;&amp; armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;            <span class="comment">// low latency telemetry lost and high latency link existing</span></div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a791f24dab19dc433eabd2f32b8024638">high_latency_data_link_active</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;            *status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;            <span class="comment">// set heartbeat to current time for high latency so that the first message can be transmitted</span></div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/dd6/u_o_r_b_8h.html#a8c09e8f28a090e8cae61e10d627f102a">ORB_MULTI_MAX_INSTANCES</a>; i++) {</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].high_latency) {</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;                    <a class="code" href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">_telemetry</a>[i].<a class="code" href="../../d5/d23/struct_commander_1_1telemetry__data.html#a713d90351231dec0dd0f8070ad90660f">last_heartbeat</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;                }</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;            }</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;            <span class="keywordflow">if</span> (!status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a>) {</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;ALL LOW LAT LINKS LOST, ACTIVATE HIGH LAT LINK&quot;</span>);</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;ACTIVATING AVAILABLE HIGH LATENCY LINK&quot;</span>);</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;            }</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a>) {</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;            <span class="keywordflow">if</span> (armed.<a class="code" href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">armed</a>) {</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;                <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;ALL DATA LINKS LOST&quot;</span>);</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;            }</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">data_link_lost</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;            status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#ab2fee9d4848de8e97f275d3bdd6acddf">data_link_lost_counter</a>++;</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;            *status_changed = <span class="keyword">true</span>;</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;        }</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;    }</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;}</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;</div><div class="line"><a name="l04116"></a><span class="lineno"><a class="line" href="../../d3/dc6/class_commander.html#a800e1be6a8f20efff3869495f08dde3a"> 4116</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d3/dc6/class_commander.html#a800e1be6a8f20efff3869495f08dde3a">Commander::estimator_check</a>(<span class="keywordtype">bool</span> *status_changed)</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;{</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;    <span class="comment">// Check if quality checking of position accuracy and consistency is to be performed</span></div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> run_quality_checks = !status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a488df9e755effd4a41512c7528c14b78">circuit_breaker_engaged_posfailure_check</a>;</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#af23998581890b6330bbded526e41c6c2">_local_position_sub</a>.<a class="code" href="../../d0/d65/classu_o_r_b_1_1_subscription.html#a1f7f1bd26da7cc8d23bbbb1a278f742f">update</a>();</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#a10b495bdc2e05bbaa14fb7cf22481a4b">_global_position_sub</a>.update();</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d4/d36/structvehicle__local__position__s.html">vehicle_local_position_s</a> &amp;lpos = <a class="code" href="../../d3/dc6/class_commander.html#af23998581890b6330bbded526e41c6c2">_local_position_sub</a>.<a class="code" href="../../d0/d65/classu_o_r_b_1_1_subscription.html#aa01d2ff362359aa05b64e93c6df668e0">get</a>();</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../da/dcb/structvehicle__global__position__s.html">vehicle_global_position_s</a> &amp;gpos = <a class="code" href="../../d3/dc6/class_commander.html#a10b495bdc2e05bbaa14fb7cf22481a4b">_global_position_sub</a>.get();</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#aa5af5fbf71d0e2096d6ffe55935a53a5">_estimator_status_sub</a>.update()) {</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d3/dca/structestimator__status__s.html">estimator_status_s</a>&amp; estimator_status = <a class="code" href="../../d3/dc6/class_commander.html#aa5af5fbf71d0e2096d6ffe55935a53a5">_estimator_status_sub</a>.get();</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;        <span class="comment">// Set the allowable position uncertainty based on combination of flight and estimator state</span></div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;        <span class="comment">// When we are in a operator demanded position control mode and are solely reliant on optical flow, do not check position error because it will gradually increase throughout flight and the operator will compensate for the drift</span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> reliant_on_opt_flow = ((estimator_status.<a class="code" href="../../d3/dca/structestimator__status__s.html#a31af1e529d73e833524180df7e2e5945">control_mode_flags</a> &amp; (1 &lt;&lt; estimator_status_s::CS_OPT_FLOW))</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;                        &amp;&amp; !(estimator_status.<a class="code" href="../../d3/dca/structestimator__status__s.html#a31af1e529d73e833524180df7e2e5945">control_mode_flags</a> &amp; (1 &lt;&lt; estimator_status_s::CS_GPS))</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;                        &amp;&amp; !(estimator_status.<a class="code" href="../../d3/dca/structestimator__status__s.html#a31af1e529d73e833524180df7e2e5945">control_mode_flags</a> &amp; (1 &lt;&lt; estimator_status_s::CS_EV_POS)));</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> operator_controlled_position = (internal_state.<a class="code" href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">main_state</a> == commander_state_s::MAIN_STATE_POSCTL);</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;        <a class="code" href="../../da/d73/_commander_8cpp.html#a1d36762fa2d596c65f758185aa92d02a">_skip_pos_accuracy_check</a> = reliant_on_opt_flow &amp;&amp; operator_controlled_position;</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../da/d73/_commander_8cpp.html#a1d36762fa2d596c65f758185aa92d02a">_skip_pos_accuracy_check</a>) {</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a> = INFINITY;</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;            <a class="code" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a> = _eph_threshold.get();</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;        }</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;        <span class="comment">/* Check estimator status for signs of bad yaw induced post takeoff navigation failure</span></div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;<span class="comment">         * for a short time interval after takeoff. Fixed wing vehicles can recover using GPS heading,</span></div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;<span class="comment">         * but rotary wing vehicles cannot so the position and velocity validity needs to be latched</span></div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="comment">         * to false after failure to prevent flyaway crashes */</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;        <span class="keywordflow">if</span> (run_quality_checks &amp;&amp; status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">is_rotary_wing</a>) {</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;            <span class="keywordflow">if</span> (status.<a class="code" href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">arming_state</a> == vehicle_status_s::ARMING_STATE_STANDBY) {</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;                <span class="comment">// reset flags and timer</span></div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a7139f51a72e31ad96cf9481174a94740">_time_at_takeoff</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#aa8b5b8481c13e6fff25d3b447d46e8d5">_nav_test_failed</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a78845d4a3762fc4b0a2220b032527f6c">_nav_test_passed</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (land_detector.<a class="code" href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">landed</a>) {</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;                <span class="comment">// record time of takeoff</span></div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a7139f51a72e31ad96cf9481174a94740">_time_at_takeoff</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;                <span class="comment">// if nav status is unconfirmed, confirm yaw angle as passed after 30 seconds or achieving 5 m/s of speed</span></div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">bool</span> sufficient_time = (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../d3/dc6/class_commander.html#a7139f51a72e31ad96cf9481174a94740">_time_at_takeoff</a>) &gt; 30_s);</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">bool</span> sufficient_speed = (lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#aa781a9d6c47b7446415873e65666c904">vx</a> * lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#aa781a9d6c47b7446415873e65666c904">vx</a> + lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a89e60c74fcb66b9a7660faa6486d6658">vy</a> * lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a89e60c74fcb66b9a7660faa6486d6658">vy</a> &gt; 25.0f);</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;                <span class="keywordtype">bool</span> innovation_pass = estimator_status.<a class="code" href="../../d3/dca/structestimator__status__s.html#a693f3aa08bd3d11a4bbc7f805ea0d737">vel_test_ratio</a> &lt; 1.0f &amp;&amp; estimator_status.<a class="code" href="../../d3/dca/structestimator__status__s.html#aa95b821a48b7903642e86c6299a2490b">pos_test_ratio</a> &lt; 1.0f;</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dc6/class_commander.html#aa8b5b8481c13e6fff25d3b447d46e8d5">_nav_test_failed</a>) {</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;                    <span class="keywordflow">if</span> (!<a class="code" href="../../d3/dc6/class_commander.html#a78845d4a3762fc4b0a2220b032527f6c">_nav_test_passed</a>) {</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;                        <span class="comment">// pass if sufficient time or speed</span></div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;                        <span class="keywordflow">if</span> (sufficient_time || sufficient_speed) {</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;                            <a class="code" href="../../d3/dc6/class_commander.html#a78845d4a3762fc4b0a2220b032527f6c">_nav_test_passed</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;                        }</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;                        <span class="comment">// record the last time the innovation check passed</span></div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;                        <span class="keywordflow">if</span> (innovation_pass) {</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;                            <a class="code" href="../../d3/dc6/class_commander.html#a697c3a90626f984c3a792c2e623c0c13">_time_last_innov_pass</a> = <a class="code" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a>();</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;                        }</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;                        <span class="comment">// if the innovation test has failed continuously, declare the nav as failed</span></div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a>(&amp;<a class="code" href="../../d3/dc6/class_commander.html#a697c3a90626f984c3a792c2e623c0c13">_time_last_innov_pass</a>) &gt; 1_s) {</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;                            <a class="code" href="../../d3/dc6/class_commander.html#aa8b5b8481c13e6fff25d3b447d46e8d5">_nav_test_failed</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;                            <a class="code" href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a>(&amp;<a class="code" href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a>, <span class="stringliteral">&quot;CRITICAL NAVIGATION FAILURE - CHECK SENSOR CALIBRATION&quot;</span>);</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;                        }</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;                    }</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;                }</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;            }</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;        }</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    }</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;    <span class="comment">/* run global position accuracy checks */</span></div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;    <span class="comment">// Check if quality checking of position accuracy and consistency is to be performed</span></div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;    <span class="keywordflow">if</span> (run_quality_checks) {</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d3/dc6/class_commander.html#aa8b5b8481c13e6fff25d3b447d46e8d5">_nav_test_failed</a>) {</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;            status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;            status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a160aaccd15cb7daf7d2533255c364dec">condition_local_position_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;            status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ac91747453f278b9349ddd13da330fa0c">condition_local_velocity_valid</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../da/d73/_commander_8cpp.html#a1d36762fa2d596c65f758185aa92d02a">_skip_pos_accuracy_check</a>) {</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;                <span class="comment">// use global position message to determine validity</span></div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;                <a class="code" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">check_posvel_validity</a>(<span class="keyword">true</span>, gpos.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#ad92e6508d09300498b54c7a227b2173f">eph</a>, <a class="code" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a>, gpos.<a class="code" href="../../da/dcb/structvehicle__global__position__s.html#a73b4ca186bb7f3e8e1bafdb6f5110f8d">timestamp</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a8ab1a540c7edb08e96e74a4b4e03ef73">_last_gpos_fail_time_us</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a3e39683a9372d76c388ad29ac0ccf5f1">_gpos_probation_time_us</a>, &amp;status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a>, status_changed);</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;            }</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;            <span class="comment">// use local position message to determine validity</span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;            <a class="code" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">check_posvel_validity</a>(lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a599e9590c26c03d311ec605c83de93fe">xy_valid</a>, lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a545a96d9feb361cc083d23d3be0f81b7">eph</a>, <a class="code" href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a>, lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1488785a3e46e25e388a12fa8d132000">timestamp</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a507475e5384f1b19a477d4dcdcc96043">_last_lpos_fail_time_us</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a9a354bcb8a90b2090e15d1ae25894a34">_lpos_probation_time_us</a>, &amp;status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a160aaccd15cb7daf7d2533255c364dec">condition_local_position_valid</a>, status_changed);</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;            <a class="code" href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">check_posvel_validity</a>(lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1e44f76739d29d00717d2a1a251641c9">v_xy_valid</a>, lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#ac8475967543a2e5d1450b734a2e546aa">evh</a>, _evh_threshold.get(), lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1488785a3e46e25e388a12fa8d132000">timestamp</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#af910bab86d61393dae3f0786476e6df9">_last_lvel_fail_time_us</a>, &amp;<a class="code" href="../../d3/dc6/class_commander.html#a58568c8d5856cb438e8bfbc9592da526">_lvel_probation_time_us</a>, &amp;status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#ac91747453f278b9349ddd13da330fa0c">condition_local_velocity_valid</a>, status_changed);</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;        }</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;    }</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="../../da/d73/_commander_8cpp.html#a881c644a74329486a4925c156831747b">_last_condition_global_position_valid</a> != status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a>) &amp;&amp; status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">condition_global_position_valid</a>) {</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        <span class="comment">// If global position state changed and is now valid, set respective health flags to true. For now also assume GPS is OK if global pos is OK, but not vice versa.</span></div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;        <a class="code" href="../../d0/dc0/health__flag__helper_8cpp.html#a7473f8ce7686f32763799b3b393d475f">set_health_flags_healthy</a>(subsystem_info_s::SUBSYSTEM_TYPE_AHRS, <span class="keyword">true</span>, status);</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;        <a class="code" href="../../d0/dc0/health__flag__helper_8cpp.html#a5e4b7755bd406163fec617e1fa35f212">set_health_flags_present_healthy</a>(subsystem_info_s::SUBSYSTEM_TYPE_GPS, <span class="keyword">true</span>, <span class="keyword">true</span>, status);</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;    }</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;    <a class="code" href="../../d3/dc6/class_commander.html#af1cf6dceb2225f61664e375a342d98ba">check_valid</a>(lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1488785a3e46e25e388a12fa8d132000">timestamp</a>, _failsafe_pos_delay.get() * 1_s, lpos.<a class="code" href="../../d4/d36/structvehicle__local__position__s.html#a1e26011ac97cdb64280a835282cd2484">z_valid</a>, &amp;(status_flags.<a class="code" href="../../d1/d4b/structvehicle__status__flags__s.html#a728a009d7b2aa98228f09d5b0ddf5da9">condition_local_altitude_valid</a>), status_changed);</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;}</div><div class="ttc" id="offboard__control__mode_8h_html"><div class="ttname"><a href="../../d6/d7c/offboard__control__mode_8h.html">offboard_control_mode.h</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_adb219481b72536d9c74ca2077e10d056"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#adb219481b72536d9c74ca2077e10d056">vehicle_local_position_s::z_global</a></div><div class="ttdeci">bool z_global</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00092">vehicle_local_position.h:92</a></div></div>
<div class="ttc" id="classu_o_r_b_1_1_subscription_html_aa01d2ff362359aa05b64e93c6df668e0"><div class="ttname"><a href="../../d0/d65/classu_o_r_b_1_1_subscription.html#aa01d2ff362359aa05b64e93c6df668e0">uORB::Subscription::get</a></div><div class="ttdeci">const T &amp; get() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d2a/_subscription_8hpp_source.html#l00184">Subscription.hpp:184</a></div></div>
<div class="ttc" id="src_2modules_2systemlib_2mavlink__log_8h_html_a47b0097dc42f71f4d984e98e7cbf7a90"><div class="ttname"><a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a47b0097dc42f71f4d984e98e7cbf7a90">mavlink_and_console_log_info</a></div><div class="ttdeci">#define mavlink_and_console_log_info(_pub, _text,...)</div><div class="ttdoc">Send a mavlink emergency message and print to console. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h_source.html#l00113">mavlink_log.h:113</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a5bc5269a368d9e600d2319bd25a3e24a"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a5bc5269a368d9e600d2319bd25a3e24a">power_button_state_notification_cb</a></div><div class="ttdeci">static int power_button_state_notification_cb(board_power_button_state_notification_e request)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00230">Commander.cpp:230</a></div></div>
<div class="ttc" id="battery__status_8h_html"><div class="ttname"><a href="../../d5/dc1/battery__status_8h.html">battery_status.h</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_ad3a2cfa84c8bc14c5d6dc35fcb98ec27"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#ad3a2cfa84c8bc14c5d6dc35fcb98ec27">tune_neutral</a></div><div class="ttdeci">void tune_neutral(bool use_buzzer)</div><div class="ttdoc">Blink white LED and play neutral tune (if use_buzzer == true). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00225">commander_helper.cpp:225</a></div></div>
<div class="ttc" id="structvehicle__global__position__s_html"><div class="ttname"><a href="../../da/dcb/structvehicle__global__position__s.html">vehicle_global_position_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/vehicle__global__position_8h_source.html#l00051">vehicle_global_position.h:51</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_ad0ebc3155e091da9b5f84578af8627aa"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#ad0ebc3155e091da9b5f84578af8627aa">vehicle_status_s::engine_failure</a></div><div class="ttdeci">bool engine_failure</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00108">vehicle_status.h:108</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a197fbecdade36e98c504119349fd97c6"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a197fbecdade36e98c504119349fd97c6">vehicle_control_mode_s::flag_control_offboard_enabled</a></div><div class="ttdeci">bool flag_control_offboard_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00059">vehicle_control_mode.h:59</a></div></div>
<div class="ttc" id="_commander_8cpp_html_af8ec8a0f2776b5cc0372ee2d86069c5d"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#af8ec8a0f2776b5cc0372ee2d86069c5d">min_stick_change</a></div><div class="ttdeci">static float min_stick_change</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00152">Commander.cpp:152</a></div></div>
<div class="ttc" id="geo_8cpp_html_a16bc9df3a7f0deb5c9afbabfbef7ec12"><div class="ttname"><a href="../../d7/d09/geo_8cpp.html#a16bc9df3a7f0deb5c9afbabfbef7ec12">mavlink_wpm_distance_to_point_local</a></div><div class="ttdeci">float mavlink_wpm_distance_to_point_local(float x_now, float y_now, float z_now, float x_next, float y_next, float z_next, float *dist_xy, float *dist_z)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d09/geo_8cpp_source.html#l00547">geo.cpp:547</a></div></div>
<div class="ttc" id="power__button__state_8h_html"><div class="ttname"><a href="../../d4/d58/power__button__state_8h.html">power_button_state.h</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a8a8c8d54731fad55667b29782218e016"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a8a8c8d54731fad55667b29782218e016">auto_disarm_hysteresis</a></div><div class="ttdeci">static systemlib::Hysteresis auto_disarm_hysteresis(false)</div></div>
<div class="ttc" id="_commander_8cpp_html_a3486f705b15b9507c8236c09c9f317c3"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a3486f705b15b9507c8236c09c9f317c3">COMMANDER_MONITORING_INTERVAL</a></div><div class="ttdeci">static constexpr uint64_t COMMANDER_MONITORING_INTERVAL</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00126">Commander.cpp:126</a></div></div>
<div class="ttc" id="class_commander_html_a3dffe66c51639e52593d68626698ba60"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a3dffe66c51639e52593d68626698ba60">Commander::set_home_position</a></div><div class="ttdeci">bool set_home_position(orb_advert_t &amp;homePub, home_position_s &amp;home, bool set_alt_only_to_lpos_ref)</div><div class="ttdoc">This function initializes the home position an altitude of the vehicle. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l01049">Commander.cpp:1049</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a6129ef0612b94fe46408821b068dbecd"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a6129ef0612b94fe46408821b068dbecd">vehicle_local_position_s::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00058">vehicle_local_position.h:58</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_a2c09f842c44c64a06bcfe7a921f63cdf"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#a2c09f842c44c64a06bcfe7a921f63cdf">orb_copy</a></div><div class="ttdeci">int orb_copy(const struct orb_metadata *meta, int handle, void *buffer)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00090">uORB.cpp:90</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651a8c44097aa32ee4b2b767d0d0f1da7a18"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a8c44097aa32ee4b2b767d0d0f1da7a18">PX4_CUSTOM_MAIN_MODE_OFFBOARD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00051">px4_custom_mode.h:51</a></div></div>
<div class="ttc" id="structsystem__power__s_html_a8aada9af06ed11bf4b219615c42eae4d"><div class="ttname"><a href="../../d5/d64/structsystem__power__s.html#a8aada9af06ed11bf4b219615c42eae4d">system_power_s::servo_valid</a></div><div class="ttdeci">uint8_t servo_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0c/system__power_8h_source.html#l00068">system_power.h:68</a></div></div>
<div class="ttc" id="class_commander_html_a93322580e8a6adb7647a42b9f8ed3487"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a93322580e8a6adb7647a42b9f8ed3487">Commander::custom_command</a></div><div class="ttdeci">static int custom_command(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03825">Commander.cpp:3825</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_aa5d61964104476edb329ee6dee4125d2a6af91d090b1b0869f2eb334b30fa9620"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a6af91d090b1b0869f2eb334b30fa9620">PX4_CUSTOM_SUB_MODE_AUTO_TAKEOFF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00059">px4_custom_mode.h:59</a></div></div>
<div class="ttc" id="board__common_8h_html_a5fbd4e64dbfe6a9f74421771869375b8a512698c1ea37d13e6fdbde36a88b0685"><div class="ttname"><a href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8a512698c1ea37d13e6fdbde36a88b0685">PWR_BUTTON_REQUEST_SHUT_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df6/board__common_8h_source.html#l00312">board_common.h:312</a></div></div>
<div class="ttc" id="accelerometer__calibration_8cpp_html_ad01f28350f810d176a4ae4bc4e9fa81f"><div class="ttname"><a href="../../dd/dcd/accelerometer__calibration_8cpp.html#ad01f28350f810d176a4ae4bc4e9fa81f">do_accel_calibration</a></div><div class="ttdeci">int do_accel_calibration(orb_advert_t *mavlink_log_pub)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dcd/accelerometer__calibration_8cpp_source.html#l00172">accelerometer_calibration.cpp:172</a></div></div>
<div class="ttc" id="structestimator__status__s_html_a31af1e529d73e833524180df7e2e5945"><div class="ttname"><a href="../../d3/dca/structestimator__status__s.html#a31af1e529d73e833524180df7e2e5945">estimator_status_s::control_mode_flags</a></div><div class="ttdeci">uint32_t control_mode_flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d3d/estimator__status_8h_source.html#l00089">estimator_status.h:89</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a1dab108f497c9c48c42a2ef0f315cd81"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a1dab108f497c9c48c42a2ef0f315cd81">vehicle_control_mode_s::flag_control_rates_enabled</a></div><div class="ttdeci">bool flag_control_rates_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00060">vehicle_control_mode.h:60</a></div></div>
<div class="ttc" id="structactuator__armed__s_html_a9cf631c451f379b81b2263b338945c29"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#a9cf631c451f379b81b2263b338945c29">actuator_armed_s::manual_lockdown</a></div><div class="ttdeci">bool manual_lockdown</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00059">actuator_armed.h:59</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a545a96d9feb361cc083d23d3be0f81b7"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a545a96d9feb361cc083d23d3be0f81b7">vehicle_local_position_s::eph</a></div><div class="ttdeci">float eph</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00075">vehicle_local_position.h:75</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda3ca3db8520d77466aa1c931d7fa9a2d8">TRANSITION_CHANGED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00058">state_machine_helper.h:58</a></div></div>
<div class="ttc" id="build_2doxygen_2u_o_r_b_2topics_2mission_8h_html"><div class="ttname"><a href="../../db/d02/build_2doxygen_2u_o_r_b_2topics_2mission_8h.html">mission.h</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651acf0106552e058571aac0ec3260ea9f14"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651acf0106552e058571aac0ec3260ea9f14">PX4_CUSTOM_MAIN_MODE_MANUAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00046">px4_custom_mode.h:46</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a707b22601c0c46541a855d5320fb60e4"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a707b22601c0c46541a855d5320fb60e4">status</a></div><div class="ttdeci">static struct vehicle_status_s status</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00154">Commander.cpp:154</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_ab0b913ff61a273187a2b264ee91399e5"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#ab0b913ff61a273187a2b264ee91399e5">manual_control_setpoint_s::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00072">manual_control_setpoint.h:72</a></div></div>
<div class="ttc" id="param_8c_html_acda250bde94d605ace974a67c1012d4a"><div class="ttname"><a href="../../d9/da5/param_8c.html#acda250bde94d605ace974a67c1012d4a">param_get</a></div><div class="ttdeci">int param_get(param_t param, void *val)</div><div class="ttdoc">Copy the value of a parameter. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da5/param_8c_source.html#l00590">param.c:590</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html">state_machine_helper.h</a></div><div class="ttdoc">State machine helper functions definitions. </div></div>
<div class="ttc" id="health__flag__helper_8cpp_html_a3523b6bbd000329099eed54f4994dbf1"><div class="ttname"><a href="../../d0/dc0/health__flag__helper_8cpp.html#a3523b6bbd000329099eed54f4994dbf1">set_health_flags</a></div><div class="ttdeci">void set_health_flags(uint64_t subsystem_type, bool present, bool enabled, bool ok, vehicle_status_s &amp;status)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dc0/health__flag__helper_8cpp_source.html#l00044">health_flag_helper.cpp:44</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_ab2fee9d4848de8e97f275d3bdd6acddf"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#ab2fee9d4848de8e97f275d3bdd6acddf">vehicle_status_s::data_link_lost_counter</a></div><div class="ttdeci">uint8_t data_link_lost_counter</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00107">vehicle_status.h:107</a></div></div>
<div class="ttc" id="structhome__position__s_html_a670e3ee95d617c1ca40de997c4b971d4"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a670e3ee95d617c1ca40de997c4b971d4">home_position_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00053">home_position.h:53</a></div></div>
<div class="ttc" id="structbattery__status__s_html_a54fa5c303ebc3d6ef3d3f79a8e12ea84"><div class="ttname"><a href="../../d0/d5c/structbattery__status__s.html#a54fa5c303ebc3d6ef3d3f79a8e12ea84">battery_status_s::voltage_filtered_v</a></div><div class="ttdeci">float voltage_filtered_v</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dc1/battery__status_8h_source.html#l00060">battery_status.h:60</a></div></div>
<div class="ttc" id="src_2modules_2systemlib_2mavlink__log_8h_html"><div class="ttname"><a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html">mavlink_log.h</a></div></div>
<div class="ttc" id="structoffboard__control__mode__s_html_a6d7fd315d60485d2b13fdc0f1ec273b0"><div class="ttname"><a href="../../da/d9d/structoffboard__control__mode__s.html#a6d7fd315d60485d2b13fdc0f1ec273b0">offboard_control_mode_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/offboard__control__mode_8h_source.html#l00053">offboard_control_mode.h:53</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a0fbfdcc7204af2e319abaf40e7d2b0be"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a0fbfdcc7204af2e319abaf40e7d2b0be">tune_mission_fail</a></div><div class="ttdeci">void tune_mission_fail(bool use_buzzer)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00199">commander_helper.cpp:199</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_aa5d61964104476edb329ee6dee4125d2a08af91b9a59af0f61330cbc3091f5791"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a08af91b9a59af0f61330cbc3091f5791">PX4_CUSTOM_SUB_MODE_AUTO_MISSION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00061">px4_custom_mode.h:61</a></div></div>
<div class="ttc" id="navigation_8h_html"><div class="ttname"><a href="../../d4/d9d/navigation_8h.html">navigation.h</a></div><div class="ttdoc">Definition of a mission consisting of mission items. </div></div>
<div class="ttc" id="structmission__result__s_html_aebceada7bf8a7fa201333d19b6de8a9b"><div class="ttname"><a href="../../d5/dd1/structmission__result__s.html#aebceada7bf8a7fa201333d19b6de8a9b">mission_result_s::valid</a></div><div class="ttdeci">bool valid</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0e/mission__result_8h_source.html#l00063">mission_result.h:63</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a0bb55b41f149880b19556b510bfd8b26"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a0bb55b41f149880b19556b510bfd8b26">OFFBOARD_TIMEOUT</a></div><div class="ttdeci">static constexpr uint64_t OFFBOARD_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00131">Commander.cpp:131</a></div></div>
<div class="ttc" id="structvehicle__command__ack__s_html_ab48829d9b01a0770cb9e99af9f4f685f"><div class="ttname"><a href="../../da/deb/structvehicle__command__ack__s.html#ab48829d9b01a0770cb9e99af9f4f685f">vehicle_command_ack_s::command</a></div><div class="ttdeci">uint16_t command</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d2e/vehicle__command__ack_8h_source.html#l00068">vehicle_command_ack.h:68</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a6f833ad768df9691686a66efc82b65ca"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a6f833ad768df9691686a66efc82b65ca">vehicle_status_flags_s::condition_power_input_valid</a></div><div class="ttdeci">bool condition_power_input_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00064">vehicle_status_flags.h:64</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a252a428aeec38033d858a1ff718d4413"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a252a428aeec38033d858a1ff718d4413">vehicle_control_mode_s::flag_control_rattitude_enabled</a></div><div class="ttdeci">bool flag_control_rattitude_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00062">vehicle_control_mode.h:62</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a919d99c2fbbbee1cf77993eff5eee7fa"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a919d99c2fbbbee1cf77993eff5eee7fa">vehicle_control_mode_s::flag_control_auto_enabled</a></div><div class="ttdeci">bool flag_control_auto_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00058">vehicle_control_mode.h:58</a></div></div>
<div class="ttc" id="classsystemlib_1_1_hysteresis_html_ad18f5f4835b9d51a4efa952b30e1b8b7"><div class="ttname"><a href="../../de/da3/classsystemlib_1_1_hysteresis.html#ad18f5f4835b9d51a4efa952b30e1b8b7">systemlib::Hysteresis::set_state_and_update</a></div><div class="ttdeci">void set_state_and_update(const bool new_state)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d42/hysteresis_8cpp_source.html#l00049">hysteresis.cpp:49</a></div></div>
<div class="ttc" id="structmission__result__s_html_ad8c83264a64a3a8fef920e042915b8d6"><div class="ttname"><a href="../../d5/dd1/structmission__result__s.html#ad8c83264a64a3a8fef920e042915b8d6">mission_result_s::warning</a></div><div class="ttdeci">bool warning</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0e/mission__result_8h_source.html#l00064">mission_result.h:64</a></div></div>
<div class="ttc" id="class_commander_html_a228a3bb17659b7a44a845e304da1191a"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a228a3bb17659b7a44a845e304da1191a">Commander::handle_command</a></div><div class="ttdeci">bool handle_command(vehicle_status_s *status, const vehicle_command_s &amp;cmd, actuator_armed_s *armed, home_position_s *home, orb_advert_t *home_pub, orb_advert_t *command_ack_pub, bool *changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00551">Commander.cpp:551</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a744a0719bd24008570206af7be22eafe"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a744a0719bd24008570206af7be22eafe">_home</a></div><div class="ttdeci">static struct home_position_s _home</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00160">Commander.cpp:160</a></div></div>
<div class="ttc" id="u_o_r_b_8h_html"><div class="ttname"><a href="../../db/dd6/u_o_r_b_8h.html">uORB.h</a></div><div class="ttdoc">API for the uORB lightweight object broker. </div></div>
<div class="ttc" id="geo_8h_html"><div class="ttname"><a href="../../db/d35/geo_8h.html">geo.h</a></div><div class="ttdoc">Definition of geo / math functions to perform geodesic calculations. </div></div>
<div class="ttc" id="safety_8h_html"><div class="ttname"><a href="../../d9/da0/safety_8h.html">safety.h</a></div></div>
<div class="ttc" id="structsafety__s_html_a09dd959f9c3f6f632bfb3ee3c6ceb31f"><div class="ttname"><a href="../../d1/d06/structsafety__s.html#a09dd959f9c3f6f632bfb3ee3c6ceb31f">safety_s::override_enabled</a></div><div class="ttdeci">bool override_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da0/safety_8h_source.html#l00057">safety.h:57</a></div></div>
<div class="ttc" id="pwr_8c_html_ab910bc35afda44ed87bd60c85bae1278"><div class="ttname"><a href="../../d8/d3d/pwr_8c.html#ab910bc35afda44ed87bd60c85bae1278">board_register_power_state_notification_cb</a></div><div class="ttdeci">int board_register_power_state_notification_cb(power_button_state_notification_t cb)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d3d/pwr_8c_source.html#l00082">pwr.c:82</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baa2b948319b0cae30c24654277d671e01c"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa2b948319b0cae30c24654277d671e01c">VEHICLE_MODE_FLAG_STABILIZE_ENABLED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00118">Commander.cpp:118</a></div></div>
<div class="ttc" id="class_commander_html_a2f773d7c41396c682c6769c742e53f08"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a2f773d7c41396c682c6769c742e53f08">Commander::_iridiumsbd_status_sub</a></div><div class="ttdeci">Subscription&lt; iridiumsbd_status_s &gt; _iridiumsbd_status_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00178">Commander.hpp:178</a></div></div>
<div class="ttc" id="structvehicle__land__detected__s_html_a0762b78dce1a807207f3530c1cd32ed7"><div class="ttname"><a href="../../d6/d7e/structvehicle__land__detected__s.html#a0762b78dce1a807207f3530c1cd32ed7">vehicle_land_detected_s::landed</a></div><div class="ttdeci">bool landed</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddd/vehicle__land__detected_8h_source.html#l00055">vehicle_land_detected.h:55</a></div></div>
<div class="ttc" id="system__power_8h_html"><div class="ttname"><a href="../../d6/d0c/system__power_8h.html">system_power.h</a></div></div>
<div class="ttc" id="_commander_8cpp_html_abcdc326c93c28a0a624d7d682352f53a"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#abcdc326c93c28a0a624d7d682352f53a">status_flags</a></div><div class="ttdeci">static struct vehicle_status_flags_s status_flags</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00176">Commander.cpp:176</a></div></div>
<div class="ttc" id="px4__posix_8h_html_aac9185b05932251394cfc62241f1b47e"><div class="ttname"><a href="../../d2/de9/px4__posix_8h.html#aac9185b05932251394cfc62241f1b47e">PX4_STACK_ADJUSTED</a></div><div class="ttdeci">#define PX4_STACK_ADJUSTED(_s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de9/px4__posix_8h_source.html#l00126">px4_posix.h:126</a></div></div>
<div class="ttc" id="structvtol__vehicle__status__s_html"><div class="ttname"><a href="../../d4/d41/structvtol__vehicle__status__s.html">vtol_vehicle_status_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d75/vtol__vehicle__status_8h_source.html#l00056">vtol_vehicle_status.h:56</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ae6a03cce77b545417f304d159a90b6b4"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ae6a03cce77b545417f304d159a90b6b4">stabilization_required</a></div><div class="ttdeci">bool stabilization_required()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03483">Commander.cpp:3483</a></div></div>
<div class="ttc" id="baro__calibration_8h_html"><div class="ttname"><a href="../../d8/d51/baro__calibration_8h.html">baro_calibration.h</a></div></div>
<div class="ttc" id="structsubsystem__info__s_html"><div class="ttname"><a href="../../d2/d77/structsubsystem__info__s.html">subsystem_info_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d50/subsystem__info_8h_source.html#l00080">subsystem_info.h:80</a></div></div>
<div class="ttc" id="class_commander_html_a4aa2c84e4d98b8a7b47e4acbd1ffb5b6"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a4aa2c84e4d98b8a7b47e4acbd1ffb5b6">Commander::data_link_checks</a></div><div class="ttdeci">void data_link_checks(int32_t highlatencydatalink_loss_timeout, int32_t highlatencydatalink_regain_timeout, int32_t datalink_loss_timeout, int32_t datalink_regain_timeout, bool *status_changed)</div><div class="ttdoc">Checks the status of all available data links and handles switching between different system telemetr...</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03992">Commander.cpp:3992</a></div></div>
<div class="ttc" id="structgeofence__result__s_html"><div class="ttname"><a href="../../de/d20/structgeofence__result__s.html">geofence_result_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/ddd/geofence__result_8h_source.html#l00056">geofence_result.h:56</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a3b5c5036e7865e587e2dee076b4a7d68"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a3b5c5036e7865e587e2dee076b4a7d68">INAIR_RESTART_HOLDOFF_INTERVAL</a></div><div class="ttdeci">static constexpr uint64_t INAIR_RESTART_HOLDOFF_INTERVAL</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00134">Commander.cpp:134</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a0d4722600de9592b13e00c286c34de8d"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a0d4722600de9592b13e00c286c34de8d">vehicle_control_mode_s::flag_control_climb_rate_enabled</a></div><div class="ttdeci">bool flag_control_climb_rate_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00068">vehicle_control_mode.h:68</a></div></div>
<div class="ttc" id="structpower__button__state__s_html"><div class="ttname"><a href="../../dd/db8/structpower__button__state__s.html">power_button_state_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d58/power__button__state_8h_source.html#l00055">power_button_state.h:55</a></div></div>
<div class="ttc" id="drv__hrt_8h_html_a2bf33ff8e80c1112813843ddd3b5b55d"><div class="ttname"><a href="../../d6/d10/drv__hrt_8h.html#a2bf33ff8e80c1112813843ddd3b5b55d">hrt_elapsed_time</a></div><div class="ttdeci">__EXPORT hrt_abstime hrt_elapsed_time(const volatile hrt_abstime *then)</div><div class="ttdoc">Compute the delta between a timestamp taken in the past and now. </div></div>
<div class="ttc" id="_commander_8cpp_html_a1b0e4cbb477cef67a15af010278c80f1"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a1b0e4cbb477cef67a15af010278c80f1">STICK_ON_OFF_LIMIT</a></div><div class="ttdeci">static constexpr float STICK_ON_OFF_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00129">Commander.cpp:129</a></div></div>
<div class="ttc" id="accelerometer__calibration_8cpp_html_adf8b5d0eb3d93e20d76e3273b6f27b88"><div class="ttname"><a href="../../dd/dcd/accelerometer__calibration_8cpp.html#adf8b5d0eb3d93e20d76e3273b6f27b88">do_level_calibration</a></div><div class="ttdeci">int do_level_calibration(orb_advert_t *mavlink_log_pub)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dcd/accelerometer__calibration_8cpp_source.html#l00740">accelerometer_calibration.cpp:740</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a960168242069cb0cac89e460e0ce391b"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a960168242069cb0cac89e460e0ce391b">vehicle_status_s::failsafe</a></div><div class="ttdeci">bool failsafe</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00094">vehicle_status.h:94</a></div></div>
<div class="ttc" id="calibration__routines_8h_html"><div class="ttname"><a href="../../d7/da9/calibration__routines_8h.html">calibration_routines.h</a></div><div class="ttdoc">Don Gagne don@thegagnes.com </div></div>
<div class="ttc" id="circuit__breaker_8cpp_html_a0eb495f286c64c70c007505210ec5df4"><div class="ttname"><a href="../../d8/d98/circuit__breaker_8cpp.html#a0eb495f286c64c70c007505210ec5df4">circuit_breaker_enabled</a></div><div class="ttdeci">bool circuit_breaker_enabled(const char *breaker, int32_t magic)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d98/circuit__breaker_8cpp_source.html#l00050">circuit_breaker.cpp:50</a></div></div>
<div class="ttc" id="px4__log_8h_html_a886ec74c1bf9c354786f32648756b929"><div class="ttname"><a href="../../d7/d53/px4__log_8h.html#a886ec74c1bf9c354786f32648756b929">PX4_ERR</a></div><div class="ttdeci">#define PX4_ERR(FMT,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/px4__log_8h_source.html#l00459">px4_log.h:459</a></div></div>
<div class="ttc" id="aerocore2_2led_8c_html_a43f5bcbf42e527375e744b59da4282f6"><div class="ttname"><a href="../../da/def/aerocore2_2led_8c.html#a43f5bcbf42e527375e744b59da4282f6">led_toggle</a></div><div class="ttdeci">void led_toggle(int led)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/def/aerocore2_2led_8c_source.html#l00102">led.c:102</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651a2389f6ae07055aa6657d587ca3709328"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a2389f6ae07055aa6657d587ca3709328">PX4_CUSTOM_MAIN_MODE_POSCTL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00048">px4_custom_mode.h:48</a></div></div>
<div class="ttc" id="class_commander_html_af23998581890b6330bbded526e41c6c2"><div class="ttname"><a href="../../d3/dc6/class_commander.html#af23998581890b6330bbded526e41c6c2">Commander::_local_position_sub</a></div><div class="ttdeci">Subscription&lt; vehicle_local_position_s &gt; _local_position_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00181">Commander.hpp:181</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a1a3cc064f154b4354a8fdcab80eeac4a"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a1a3cc064f154b4354a8fdcab80eeac4a">vehicle_status_s::component_id</a></div><div class="ttdeci">uint8_t component_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00097">vehicle_status.h:97</a></div></div>
<div class="ttc" id="gyro__calibration_8cpp_html_a4efe4d135d3df2f59371abd80f19801a"><div class="ttname"><a href="../../df/d5e/gyro__calibration_8cpp.html#a4efe4d135d3df2f59371abd80f19801a">do_gyro_calibration</a></div><div class="ttdeci">int do_gyro_calibration(orb_advert_t *mavlink_log_pub)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d5e/gyro__calibration_8cpp_source.html#l00208">gyro_calibration.cpp:208</a></div></div>
<div class="ttc" id="_commander_8cpp_html_af47859830f7c0908c582447aeaa1c67c"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#af47859830f7c0908c582447aeaa1c67c">usage</a></div><div class="ttdeci">void usage(const char *reason)</div><div class="ttdoc">Print the correct usage. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00494">Commander.cpp:494</a></div></div>
<div class="ttc" id="mag__calibration_8h_html"><div class="ttname"><a href="../../d4/db8/mag__calibration_8h.html">mag_calibration.h</a></div><div class="ttdoc">Barometer calibration routine. </div></div>
<div class="ttc" id="circuit__breaker_8h_html"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html">circuit_breaker.h</a></div></div>
<div class="ttc" id="build_2doxygen_2u_o_r_b_2topics_2mavlink__log_8h_html"><div class="ttname"><a href="../../d1/d88/build_2doxygen_2u_o_r_b_2topics_2mavlink__log_8h.html">mavlink_log.h</a></div></div>
<div class="ttc" id="vehicle__local__position_8h_html"><div class="ttname"><a href="../../d7/d34/vehicle__local__position_8h.html">vehicle_local_position.h</a></div></div>
<div class="ttc" id="structactuator__armed__s_html_a689c1e70fb301a147fc718dffdb5a505"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#a689c1e70fb301a147fc718dffdb5a505">actuator_armed_s::armed</a></div><div class="ttdeci">bool armed</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00055">actuator_armed.h:55</a></div></div>
<div class="ttc" id="structsystem__power__s_html"><div class="ttname"><a href="../../d5/d64/structsystem__power__s.html">system_power_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0c/system__power_8h_source.html#l00059">system_power.h:59</a></div></div>
<div class="ttc" id="structmission__s_html_afee1a7da296db84bd999a31738f474c6"><div class="ttname"><a href="../../db/d74/structmission__s.html#afee1a7da296db84bd999a31738f474c6">mission_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d02/build_2doxygen_2u_o_r_b_2topics_2mission_8h_source.html#l00053">mission.h:53</a></div></div>
<div class="ttc" id="namespace_____e_x_p_o_r_t_html"><div class="ttname"><a href="../../d9/ddc/namespace_____e_x_p_o_r_t.html">__EXPORT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d86/nuttx_2_i2_c_8hpp_source.html#l00047">I2C.hpp:47</a></div></div>
<div class="ttc" id="aerocore2_2init_8c_html_aaff94d6fc452d6b3e28b9879fc344f7b"><div class="ttname"><a href="../../d1/d3d/aerocore2_2init_8c.html#aaff94d6fc452d6b3e28b9879fc344f7b">led_init</a></div><div class="ttdeci">__BEGIN_DECLS void led_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/def/aerocore2_2led_8c_source.html#l00072">led.c:72</a></div></div>
<div class="ttc" id="state__machine__helper_8cpp_html_a21e577c574ece19b4d86dac4f79b4786"><div class="ttname"><a href="../../df/d25/state__machine__helper_8cpp.html#a21e577c574ece19b4d86dac4f79b4786">arming_state_names</a></div><div class="ttdeci">const char *const arming_state_names[vehicle_status_s::ARMING_STATE_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d25/state__machine__helper_8cpp_source.html#l00078">state_machine_helper.cpp:78</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a8e176daf1db88e230ba94a5543e72112"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a8e176daf1db88e230ba94a5543e72112">battery</a></div><div class="ttdeci">static struct battery_status_s battery</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00155">Commander.cpp:155</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_aba20d37bdb280289f4cd154a3ada5bb2"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#aba20d37bdb280289f4cd154a3ada5bb2">manual_control_setpoint_s::kill_switch</a></div><div class="ttdeci">uint8_t kill_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00088">manual_control_setpoint.h:88</a></div></div>
<div class="ttc" id="structhome__position__s_html_ab2a80f05f7fea0dfe632c2893fde1829"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#ab2a80f05f7fea0dfe632c2893fde1829">home_position_s::alt</a></div><div class="ttdeci">float alt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00056">home_position.h:56</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a79ea24b417038eeffbcd2465e94af16b"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a79ea24b417038eeffbcd2465e94af16b">vehicle_status_s::in_transition_mode</a></div><div class="ttdeci">bool in_transition_mode</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00101">vehicle_status.h:101</a></div></div>
<div class="ttc" id="structhome__position__s_html_a6ac17e9135ded73c11140645a4fd239d"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a6ac17e9135ded73c11140645a4fd239d">home_position_s::manual_home</a></div><div class="ttdeci">bool manual_home</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00063">home_position.h:63</a></div></div>
<div class="ttc" id="posix_2cdev__platform_8cpp_html_ab58015a6dcb46cf377c9091677cd4417"><div class="ttname"><a href="../../da/dc9/posix_2cdev__platform_8cpp.html#ab58015a6dcb46cf377c9091677cd4417">px4_poll</a></div><div class="ttdeci">int px4_poll(px4_pollfd_struct_t *fds, nfds_t nfds, int timeout)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc9/posix_2cdev__platform_8cpp_source.html#l00318">cdev_platform.cpp:318</a></div></div>
<div class="ttc" id="circuit__breaker_8h_html_aeb249baf44440ae8b34c290b458bdc9b"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html#aeb249baf44440ae8b34c290b458bdc9b">CBRK_AIRSPD_CHK_KEY</a></div><div class="ttdeci">#define CBRK_AIRSPD_CHK_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd4/circuit__breaker_8h_source.html#l00055">circuit_breaker.h:55</a></div></div>
<div class="ttc" id="px4__config_8h_html"><div class="ttname"><a href="../../d4/d35/px4__config_8h.html">px4_config.h</a></div><div class="ttdoc">Configuration flags used in code. </div></div>
<div class="ttc" id="class_commander_html_a8ab1a540c7edb08e96e74a4b4e03ef73"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a8ab1a540c7edb08e96e74a4b4e03ef73">Commander::_last_gpos_fail_time_us</a></div><div class="ttdeci">hrt_abstime _last_gpos_fail_time_us</div><div class="ttdoc">Last time that the global position validity recovery check failed (usec) </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00113">Commander.hpp:113</a></div></div>
<div class="ttc" id="gyro__calibration_8h_html"><div class="ttname"><a href="../../df/d3a/gyro__calibration_8h.html">gyro_calibration.h</a></div><div class="ttdoc">Airspeed sensor calibration routine. </div></div>
<div class="ttc" id="drv__tone__alarm_8h_html_adc29c2ff13d900c2f185ee95427fb06ca72d04553574119dc4ec64a7109f41615"><div class="ttname"><a href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca72d04553574119dc4ec64a7109f41615">TONE_NOTIFY_POSITIVE_TUNE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d25/drv__tone__alarm_8h_source.html#l00077">drv_tone_alarm.h:77</a></div></div>
<div class="ttc" id="px4__posix_8h_html"><div class="ttname"><a href="../../d2/de9/px4__posix_8h.html">px4_posix.h</a></div><div class="ttdoc">Includes POSIX-like functions for virtual character devices. </div></div>
<div class="ttc" id="_commander_8cpp_html_a949f89551e92456f630ceaf21ef5f590"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a949f89551e92456f630ceaf21ef5f590">internal_state</a></div><div class="ttdeci">static struct commander_state_s internal_state</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00162">Commander.cpp:162</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a2755aa25019760dab5a1f6df4edc892a"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a2755aa25019760dab5a1f6df4edc892a">link_loss_actions_t</a></div><div class="ttdeci">link_loss_actions_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00061">state_machine_helper.h:61</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a1e44f76739d29d00717d2a1a251641c9"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a1e44f76739d29d00717d2a1a251641c9">vehicle_local_position_s::v_xy_valid</a></div><div class="ttdeci">bool v_xy_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00085">vehicle_local_position.h:85</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a488df9e755effd4a41512c7528c14b78"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a488df9e755effd4a41512c7528c14b78">vehicle_status_flags_s::circuit_breaker_engaged_posfailure_check</a></div><div class="ttdeci">bool circuit_breaker_engaged_posfailure_check</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00071">vehicle_status_flags.h:71</a></div></div>
<div class="ttc" id="structoffboard__control__mode__s_html_a82aee62e79df21ad3dec7f53b73eca27"><div class="ttname"><a href="../../da/d9d/structoffboard__control__mode__s.html#a82aee62e79df21ad3dec7f53b73eca27">offboard_control_mode_s::ignore_velocity</a></div><div class="ttdeci">bool ignore_velocity</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/offboard__control__mode_8h_source.html#l00058">offboard_control_mode.h:58</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a5fd2f6f34bd14719fe79d6fd5d7e2b89"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a5fd2f6f34bd14719fe79d6fd5d7e2b89">vehicle_status_flags_s::circuit_breaker_engaged_power_check</a></div><div class="ttdeci">bool circuit_breaker_engaged_power_check</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00065">vehicle_status_flags.h:65</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_ac5ba0a0d1dc62f813314c0ff37a9a82a"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#ac5ba0a0d1dc62f813314c0ff37a9a82a">orb_advertise</a></div><div class="ttdeci">orb_advert_t orb_advertise(const struct orb_metadata *meta, const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00043">uORB.cpp:43</a></div></div>
<div class="ttc" id="class_commander_html_a507475e5384f1b19a477d4dcdcc96043"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a507475e5384f1b19a477d4dcdcc96043">Commander::_last_lpos_fail_time_us</a></div><div class="ttdeci">hrt_abstime _last_lpos_fail_time_us</div><div class="ttdoc">Last time that the local position validity recovery check failed (usec) </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00114">Commander.hpp:114</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a8008fbbb8f369eeb0f452863fe664355"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a8008fbbb8f369eeb0f452863fe664355">print_status</a></div><div class="ttdeci">void print_status()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00503">Commander.cpp:503</a></div></div>
<div class="ttc" id="board__common_8h_html_a5fbd4e64dbfe6a9f74421771869375b8ad7e82073686a1c431e2fef318678185d"><div class="ttname"><a href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8ad7e82073686a1c431e2fef318678185d">PWR_BUTTON_RESPONSE_SHUT_DOWN_PENDING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df6/board__common_8h_source.html#l00314">board_common.h:314</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_ac64e3f3cc38664a081caeceb560bb76f"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#ac64e3f3cc38664a081caeceb560bb76f">set_tune_override</a></div><div class="ttdeci">void set_tune_override(int tune)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00144">commander_helper.cpp:144</a></div></div>
<div class="ttc" id="structparameter__update__s_html"><div class="ttname"><a href="../../d4/d2a/structparameter__update__s.html">parameter_update_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d76/parameter__update_8h_source.html#l00051">parameter_update.h:51</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a1d287096c4be02f68ad3b7ba2e6d5dbd"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a1d287096c4be02f68ad3b7ba2e6d5dbd">warning_action_on</a></div><div class="ttdeci">static bool warning_action_on</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00173">Commander.cpp:173</a></div></div>
<div class="ttc" id="param_8c_html_a7ec8a852f20e4bc7577b8698120db585"><div class="ttname"><a href="../../d9/da5/param_8c.html#a7ec8a852f20e4bc7577b8698120db585">param_load_default</a></div><div class="ttdeci">int param_load_default(void)</div><div class="ttdoc">Load parameters from the default parameter file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da5/param_8c_source.html#l01001">param.c:1001</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a55e27eff85d06cb0126947a279414da3"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a55e27eff85d06cb0126947a279414da3">get_circuit_breaker_params</a></div><div class="ttdeci">void get_circuit_breaker_params()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l02646">Commander.cpp:2646</a></div></div>
<div class="ttc" id="structvehicle__global__position__s_html_ad92e6508d09300498b54c7a227b2173f"><div class="ttname"><a href="../../da/dcb/structvehicle__global__position__s.html#ad92e6508d09300498b54c7a227b2173f">vehicle_global_position_s::eph</a></div><div class="ttdeci">float eph</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/vehicle__global__position_8h_source.html#l00062">vehicle_global_position.h:62</a></div></div>
<div class="ttc" id="structmission__s_html_acaa79e79d52b69fb4f57b8941e93260d"><div class="ttname"><a href="../../db/d74/structmission__s.html#acaa79e79d52b69fb4f57b8941e93260d">mission_s::dataman_id</a></div><div class="ttdeci">uint8_t dataman_id</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d02/build_2doxygen_2u_o_r_b_2topics_2mission_8h_source.html#l00056">mission.h:56</a></div></div>
<div class="ttc" id="structactuator__armed__s_html_a1fe0540b456b257ed8cbb5f7c5a30ab3"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#a1fe0540b456b257ed8cbb5f7c5a30ab3">actuator_armed_s::prearmed</a></div><div class="ttdeci">bool prearmed</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00056">actuator_armed.h:56</a></div></div>
<div class="ttc" id="structsafety__s_html_a9e344fb952239090443e6bb0d104d0c8"><div class="ttname"><a href="../../d1/d06/structsafety__s.html#a9e344fb952239090443e6bb0d104d0c8">safety_s::override_available</a></div><div class="ttdeci">bool override_available</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da0/safety_8h_source.html#l00056">safety.h:56</a></div></div>
<div class="ttc" id="struct_commander_1_1telemetry__data_html_a713d90351231dec0dd0f8070ad90660f"><div class="ttname"><a href="../../d5/d23/struct_commander_1_1telemetry__data.html#a713d90351231dec0dd0f8070ad90660f">Commander::telemetry_data::last_heartbeat</a></div><div class="ttdeci">uint64_t last_heartbeat</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00167">Commander.hpp:167</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a599e9590c26c03d311ec605c83de93fe"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a599e9590c26c03d311ec605c83de93fe">vehicle_local_position_s::xy_valid</a></div><div class="ttdeci">bool xy_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00083">vehicle_local_position.h:83</a></div></div>
<div class="ttc" id="structactuator__armed__s_html_abc259b5c60d6ec93ca24021880faadc8"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#abc259b5c60d6ec93ca24021880faadc8">actuator_armed_s::lockdown</a></div><div class="ttdeci">bool lockdown</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00058">actuator_armed.h:58</a></div></div>
<div class="ttc" id="structestimator__status__s_html_a693f3aa08bd3d11a4bbc7f805ea0d737"><div class="ttname"><a href="../../d3/dca/structestimator__status__s.html#a693f3aa08bd3d11a4bbc7f805ea0d737">estimator_status_s::vel_test_ratio</a></div><div class="ttdeci">float vel_test_ratio</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d3d/estimator__status_8h_source.html#l00093">estimator_status.h:93</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a881c644a74329486a4925c156831747b"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a881c644a74329486a4925c156831747b">_last_condition_global_position_valid</a></div><div class="ttdeci">static bool _last_condition_global_position_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00182">Commander.cpp:182</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a1e26011ac97cdb64280a835282cd2484"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a1e26011ac97cdb64280a835282cd2484">vehicle_local_position_s::z_valid</a></div><div class="ttdeci">bool z_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00084">vehicle_local_position.h:84</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_a868def4801788306c335df9ce7ffd7e7"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#a868def4801788306c335df9ce7ffd7e7">vehicle_command_s::target_component</a></div><div class="ttdeci">uint8_t target_component</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00158">vehicle_command.h:158</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a7143908e08d82294b12d3be7d645c619"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a7143908e08d82294b12d3be7d645c619">vehicle_control_mode_s::flag_external_manual_override_ok</a></div><div class="ttdeci">bool flag_external_manual_override_ok</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00055">vehicle_control_mode.h:55</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a565a5ab4cfcae22faba52debbd7d855f"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a565a5ab4cfcae22faba52debbd7d855f">vehicle_status_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00087">vehicle_status.h:87</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a45da51db6880801086e2fee51898e4af"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a45da51db6880801086e2fee51898e4af">sp_man</a></div><div class="ttdeci">static manual_control_setpoint_s sp_man</div><div class="ttdoc">the current manual control setpoint </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00166">Commander.cpp:166</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_ab22df60b54970e3a5bb8ca8b52b004af"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#ab22df60b54970e3a5bb8ca8b52b004af">manual_control_setpoint_s::posctl_switch</a></div><div class="ttdeci">uint8_t posctl_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00084">manual_control_setpoint.h:84</a></div></div>
<div class="ttc" id="structsubsystem__info__s_html_ae88ed921e58882855dc9bdba521e5250"><div class="ttname"><a href="../../d2/d77/structsubsystem__info__s.html#ae88ed921e58882855dc9bdba521e5250">subsystem_info_s::subsystem_type</a></div><div class="ttdeci">uint64_t subsystem_type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d50/subsystem__info_8h_source.html#l00083">subsystem_info.h:83</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html">vehicle_status_flags_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00051">vehicle_status_flags.h:51</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_acdfd913506bc016506720168c4d1b2f6"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#acdfd913506bc016506720168c4d1b2f6">manual_control_setpoint_s::man_switch</a></div><div class="ttdeci">uint8_t man_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00095">manual_control_setpoint.h:95</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a2883f5d087a492fba009efe196d35399"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a2883f5d087a492fba009efe196d35399">vehicle_status_flags_s::circuit_breaker_engaged_enginefailure_check</a></div><div class="ttdeci">bool circuit_breaker_engaged_enginefailure_check</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00067">vehicle_status_flags.h:67</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_ade9caafd9e0d393e2ec14e6b99a2ef22"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#ade9caafd9e0d393e2ec14e6b99a2ef22">vehicle_status_s::rc_signal_lost</a></div><div class="ttdeci">bool rc_signal_lost</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00103">vehicle_status.h:103</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_ac0383719bafa9b5b2aa25fabc586bd1f"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a></div><div class="ttdeci">int usleep(useconds_t usec)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00032">stubs_posix.c:32</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a77354aa68f159914167923823d9b3969"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a77354aa68f159914167923823d9b3969">vehicle_status_s::system_type</a></div><div class="ttdeci">uint8_t system_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00095">vehicle_status.h:95</a></div></div>
<div class="ttc" id="structvehicle__status__s_html"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html">vehicle_status_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00085">vehicle_status.h:85</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a8394cc39ce8c41dba0adf2a5990ff1ed"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a8394cc39ce8c41dba0adf2a5990ff1ed">status_pub</a></div><div class="ttdeci">static orb_advert_t status_pub</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00516">Commander.cpp:516</a></div></div>
<div class="ttc" id="structvehicle__command__ack__s_html"><div class="ttname"><a href="../../da/deb/structvehicle__command__ack__s.html">vehicle_command_ack_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d2e/vehicle__command__ack_8h_source.html#l00064">vehicle_command_ack.h:64</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a24e135bf6ba98c55a652feab03293aa7"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a24e135bf6ba98c55a652feab03293aa7">tune_positive</a></div><div class="ttdeci">void tune_positive(bool use_buzzer)</div><div class="ttdoc">Blink green LED and play positive tune (if use_buzzer == true). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00212">commander_helper.cpp:212</a></div></div>
<div class="ttc" id="structsafety__s_html_a817089b384eadf655426f8442aa378be"><div class="ttname"><a href="../../d1/d06/structsafety__s.html#a817089b384eadf655426f8442aa378be">safety_s::safety_switch_available</a></div><div class="ttdeci">bool safety_switch_available</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da0/safety_8h_source.html#l00054">safety.h:54</a></div></div>
<div class="ttc" id="struct_commander_1_1telemetry__data_html_a6cf391072b3f42e2f4d67d837527c840"><div class="ttname"><a href="../../d5/d23/struct_commander_1_1telemetry__data.html#a6cf391072b3f42e2f4d67d837527c840">Commander::telemetry_data::preflight_checks_reported</a></div><div class="ttdeci">bool preflight_checks_reported</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00169">Commander.hpp:169</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a77167b569d24b4d50c6400e3f05e3725"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a77167b569d24b4d50c6400e3f05e3725">vehicle_status_flags_s::circuit_breaker_engaged_usb_check</a></div><div class="ttdeci">bool circuit_breaker_engaged_usb_check</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00070">vehicle_status_flags.h:70</a></div></div>
<div class="ttc" id="structvehicle__global__position__s_html_a10c47986082d72c9a1ca7767a8ab7e9d"><div class="ttname"><a href="../../da/dcb/structvehicle__global__position__s.html#a10c47986082d72c9a1ca7767a8ab7e9d">vehicle_global_position_s::lon</a></div><div class="ttdeci">double lon</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/vehicle__global__position_8h_source.html#l00055">vehicle_global_position.h:55</a></div></div>
<div class="ttc" id="px4__tasks_8h_html"><div class="ttname"><a href="../../da/d65/px4__tasks_8h.html">px4_tasks.h</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694edae2c49db287d4e902ef5b0a764d24e3c1">TRANSITION_NOT_CHANGED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00057">state_machine_helper.h:57</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a80a34d370212d373b665a295bcfdf3d1"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a80a34d370212d373b665a295bcfdf3d1">vehicle_status_flags_s::condition_global_position_valid</a></div><div class="ttdeci">bool condition_global_position_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00059">vehicle_status_flags.h:59</a></div></div>
<div class="ttc" id="structmission__s_html"><div class="ttname"><a href="../../db/d74/structmission__s.html">mission_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d02/build_2doxygen_2u_o_r_b_2topics_2mission_8h_source.html#l00051">mission.h:51</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a3be901b42cf951014fb5e1f09931d695"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a3be901b42cf951014fb5e1f09931d695">manual_control_setpoint_s::z</a></div><div class="ttdeci">float z</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00073">manual_control_setpoint.h:73</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_ac8475967543a2e5d1450b734a2e546aa"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#ac8475967543a2e5d1450b734a2e546aa">vehicle_local_position_s::evh</a></div><div class="ttdeci">float evh</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00077">vehicle_local_position.h:77</a></div></div>
<div class="ttc" id="state__machine__helper_8cpp_html_a5e5cde38d584868dbf7a3a8d76ccdb0f"><div class="ttname"><a href="../../df/d25/state__machine__helper_8cpp.html#a5e5cde38d584868dbf7a3a8d76ccdb0f">arming_state_transition</a></div><div class="ttdeci">transition_result_t arming_state_transition(vehicle_status_s *status, const battery_status_s &amp;battery, const safety_s &amp;safety, const arming_state_t new_arming_state, actuator_armed_s *armed, const bool fRunPreArmChecks, orb_advert_t *mavlink_log_pub, vehicle_status_flags_s *status_flags, const uint8_t arm_requirements, const hrt_abstime &amp;time_since_boot)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d25/state__machine__helper_8cpp_source.html#l00095">state_machine_helper.cpp:95</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baa9677280463962911f04cc2711e835381"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa9677280463962911f04cc2711e835381">VEHICLE_MODE_FLAG_ENUM_END</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00122">Commander.cpp:122</a></div></div>
<div class="ttc" id="structmission__result__s_html_a6e06db9b2266dbe0a2f302f5c42cec98"><div class="ttname"><a href="../../d5/dd1/structmission__result__s.html#a6e06db9b2266dbe0a2f302f5c42cec98">mission_result_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0e/mission__result_8h_source.html#l00056">mission_result.h:56</a></div></div>
<div class="ttc" id="actuator__controls_8h_html"><div class="ttname"><a href="../../dc/d46/actuator__controls_8h.html">actuator_controls.h</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a1fb4d0cc4b86ef4c123d4170da633d52"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a1fb4d0cc4b86ef4c123d4170da633d52">vehicle_status_flags_s::condition_home_position_valid</a></div><div class="ttdeci">bool condition_home_position_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00060">vehicle_status_flags.h:60</a></div></div>
<div class="ttc" id="board__common_8h_html_a5fbd4e64dbfe6a9f74421771869375b8aa8193660df9df37350367e61c0983ca3"><div class="ttname"><a href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8aa8193660df9df37350367e61c0983ca3">PWR_BUTTON_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df6/board__common_8h_source.html#l00310">board_common.h:310</a></div></div>
<div class="ttc" id="_commander_8cpp_html_adc80368b5bca15fac9275ce0a6ac82b8"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#adc80368b5bca15fac9275ce0a6ac82b8">_flight_mode_slots</a></div><div class="ttdeci">static int32_t _flight_mode_slots[manual_control_setpoint_s::MODE_SLOT_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00161">Commander.cpp:161</a></div></div>
<div class="ttc" id="structoffboard__control__mode__s_html_adfc9036117b22959305d95dca47b1a87"><div class="ttname"><a href="../../da/d9d/structoffboard__control__mode__s.html#adfc9036117b22959305d95dca47b1a87">offboard_control_mode_s::ignore_attitude</a></div><div class="ttdeci">bool ignore_attitude</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/offboard__control__mode_8h_source.html#l00055">offboard_control_mode.h:55</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a5e98dab42c762cafa7e5daccbafc7df1"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a5e98dab42c762cafa7e5daccbafc7df1">vehicle_status_flags_s::offboard_control_signal_found_once</a></div><div class="ttdeci">bool offboard_control_signal_found_once</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00072">vehicle_status_flags.h:72</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_afd68a20846bc6ab17ae104e8ebc152d8"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#afd68a20846bc6ab17ae104e8ebc152d8">led_deinit</a></div><div class="ttdeci">void led_deinit()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00313">commander_helper.cpp:313</a></div></div>
<div class="ttc" id="drv__hrt_8h_html"><div class="ttname"><a href="../../d6/d10/drv__hrt_8h.html">drv_hrt.h</a></div><div class="ttdoc">High-resolution timer with callouts and timekeeping. </div></div>
<div class="ttc" id="structvehicle__status__s_html_a440de8c15ef23284bb5041b54b4edd35"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a440de8c15ef23284bb5041b54b4edd35">vehicle_status_s::is_rotary_wing</a></div><div class="ttdeci">bool is_rotary_wing</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00098">vehicle_status.h:98</a></div></div>
<div class="ttc" id="class_commander_html_a7139f51a72e31ad96cf9481174a94740"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a7139f51a72e31ad96cf9481174a94740">Commander::_time_at_takeoff</a></div><div class="ttdeci">hrt_abstime _time_at_takeoff</div><div class="ttdoc">last time we were on the ground </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00123">Commander.hpp:123</a></div></div>
<div class="ttc" id="structsystem__power__s_html_afe13ca57e9b25fc674a07ecb14a97975"><div class="ttname"><a href="../../d5/d64/structsystem__power__s.html#afe13ca57e9b25fc674a07ecb14a97975">system_power_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0c/system__power_8h_source.html#l00061">system_power.h:61</a></div></div>
<div class="ttc" id="structcpuload__s_html_a827dcce1a83fb46c2ab1519effdc6aa7"><div class="ttname"><a href="../../d7/dbb/structcpuload__s.html#a827dcce1a83fb46c2ab1519effdc6aa7">cpuload_s::load</a></div><div class="ttdeci">float load</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dfb/build_2doxygen_2u_o_r_b_2topics_2cpuload_8h_source.html#l00054">cpuload.h:54</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_ab1296ede7579a9dc43aa8a9a6bd06b3a"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#ab1296ede7579a9dc43aa8a9a6bd06b3a">vehicle_status_s::vtol_fw_permanent_stab</a></div><div class="ttdeci">bool vtol_fw_permanent_stab</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00100">vehicle_status.h:100</a></div></div>
<div class="ttc" id="class_commander_html_a3e39683a9372d76c388ad29ac0ccf5f1"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a3e39683a9372d76c388ad29ac0ccf5f1">Commander::_gpos_probation_time_us</a></div><div class="ttdeci">hrt_abstime _gpos_probation_time_us</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00118">Commander.hpp:118</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a89fea35afeeebd6ec26f230f995f5b74"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a89fea35afeeebd6ec26f230f995f5b74">vehicle_status_flags_s::offboard_control_loss_timeout</a></div><div class="ttdeci">bool offboard_control_loss_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00075">vehicle_status_flags.h:75</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_aa5d61964104476edb329ee6dee4125d2a1e57825a3f1332693ea4ed0a5ad1f36a"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a1e57825a3f1332693ea4ed0a5ad1f36a">PX4_CUSTOM_SUB_MODE_AUTO_RTL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00062">px4_custom_mode.h:62</a></div></div>
<div class="ttc" id="vtol__vehicle__status_8h_html"><div class="ttname"><a href="../../d0/d75/vtol__vehicle__status_8h.html">vtol_vehicle_status.h</a></div></div>
<div class="ttc" id="structsubsystem__info__s_html_a2a3e8f0aa814145ffce5e91b89cc7ad4"><div class="ttname"><a href="../../d2/d77/structsubsystem__info__s.html#a2a3e8f0aa814145ffce5e91b89cc7ad4">subsystem_info_s::present</a></div><div class="ttdeci">bool present</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d50/subsystem__info_8h_source.html#l00084">subsystem_info.h:84</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a9339a419787f7d88202a7c05a1092551"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a9339a419787f7d88202a7c05a1092551">manual_control_setpoint_s::mode_slot</a></div><div class="ttdeci">int8_t mode_slot</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00092">manual_control_setpoint.h:92</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_a91df70141220b84c1c01619db0c3e105"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#a91df70141220b84c1c01619db0c3e105">orb_advertise_queue</a></div><div class="ttdeci">orb_advert_t orb_advertise_queue(const struct orb_metadata *meta, const void *data, unsigned int queue_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00048">uORB.cpp:48</a></div></div>
<div class="ttc" id="circuit__breaker_8h_html_a9290a1a2713a56f14a172ef688225210"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html#a9290a1a2713a56f14a172ef688225210">CBRK_SUPPLY_CHK_KEY</a></div><div class="ttdeci">#define CBRK_SUPPLY_CHK_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd4/circuit__breaker_8h_source.html#l00052">circuit_breaker.h:52</a></div></div>
<div class="ttc" id="param_8c_html_aab3a3324b8f2b8a6d4d33583024ea7cc"><div class="ttname"><a href="../../d9/da5/param_8c.html#aab3a3324b8f2b8a6d4d33583024ea7cc">param_reset_all</a></div><div class="ttdeci">void param_reset_all(void)</div><div class="ttdoc">Reset all parameters to their default values. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da5/param_8c_source.html#l00899">param.c:899</a></div></div>
<div class="ttc" id="px4__defines_8h_html"><div class="ttname"><a href="../../df/dd0/px4__defines_8h.html">px4_defines.h</a></div><div class="ttdoc">Generally used magic defines. </div></div>
<div class="ttc" id="struct_commander_1_1telemetry__data_html_a205dc941c6706dc85c62e8e6becfb6e3"><div class="ttname"><a href="../../d5/d23/struct_commander_1_1telemetry__data.html#a205dc941c6706dc85c62e8e6becfb6e3">Commander::telemetry_data::lost</a></div><div class="ttdeci">bool lost</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00170">Commander.hpp:170</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html">vehicle_control_mode_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00051">vehicle_control_mode.h:51</a></div></div>
<div class="ttc" id="param_8h_html"><div class="ttname"><a href="../../d5/d33/param_8h.html">param.h</a></div><div class="ttdoc">Global flash based parameter store. </div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a3e7159a2406220b8ba71fb6fc29e5725"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a3e7159a2406220b8ba71fb6fc29e5725">vehicle_local_position_s::ref_lon</a></div><div class="ttdeci">double ref_lon</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00056">vehicle_local_position.h:56</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a9351d6b0ff1efb4fd6d687f143be98c7"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a9351d6b0ff1efb4fd6d687f143be98c7">commander_main</a></div><div class="ttdeci">__EXPORT int commander_main(int argc, char *argv[])</div><div class="ttdoc">The daemon app only briefly exists to start the background job. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00285">Commander.cpp:285</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baa7eab6df663b28cd27c05647d1c229a44"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa7eab6df663b28cd27c05647d1c229a44">VEHICLE_MODE_FLAG_GUIDED_ENABLED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00117">Commander.cpp:117</a></div></div>
<div class="ttc" id="board__common_8h_html_a5fbd4e64dbfe6a9f74421771869375b8a7cab0fe15d4128d24401d038abf557e2"><div class="ttname"><a href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8a7cab0fe15d4128d24401d038abf557e2">PWR_BUTTON_IDEL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df6/board__common_8h_source.html#l00309">board_common.h:309</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_ad38d1e9d742cf10244b0769b7233f0ac"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#ad38d1e9d742cf10244b0769b7233f0ac">vehicle_status_flags_s::circuit_breaker_engaged_gpsfailure_check</a></div><div class="ttdeci">bool circuit_breaker_engaged_gpsfailure_check</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00068">vehicle_status_flags.h:68</a></div></div>
<div class="ttc" id="px4__defines_8h_html_a3c8cfc47ec868777204de29272228e79"><div class="ttname"><a href="../../df/dd0/px4__defines_8h.html#a3c8cfc47ec868777204de29272228e79">PX4_OK</a></div><div class="ttdeci">#define PX4_OK</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd0/px4__defines_8h_source.html#l00056">px4_defines.h:56</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_af73ac895427b64d590a879be7605d00e"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#af73ac895427b64d590a879be7605d00e">vehicle_local_position_s::xy_global</a></div><div class="ttdeci">bool xy_global</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00091">vehicle_local_position.h:91</a></div></div>
<div class="ttc" id="structestimator__status__s_html"><div class="ttname"><a href="../../d3/dca/structestimator__status__s.html">estimator_status_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d3d/estimator__status_8h_source.html#l00083">estimator_status.h:83</a></div></div>
<div class="ttc" id="struct_commander_1_1telemetry__data_html_a6ac242bf160bba783c561e8131086ea0"><div class="ttname"><a href="../../d5/d23/struct_commander_1_1telemetry__data.html#a6ac242bf160bba783c561e8131086ea0">Commander::telemetry_data::high_latency</a></div><div class="ttdeci">bool high_latency</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00171">Commander.hpp:171</a></div></div>
<div class="ttc" id="drv__tone__alarm_8h_html_adc29c2ff13d900c2f185ee95427fb06ca1198296be8e5ccba65d061c57d7ca8ac"><div class="ttname"><a href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca1198296be8e5ccba65d061c57d7ca8ac">TONE_BATTERY_WARNING_SLOW_TUNE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d25/drv__tone__alarm_8h_source.html#l00081">drv_tone_alarm.h:81</a></div></div>
<div class="ttc" id="structgeofence__result__s_html_aa4a2d86a221517f743d953e7f481f0c4"><div class="ttname"><a href="../../de/d20/structgeofence__result__s.html#aa4a2d86a221517f743d953e7f481f0c4">geofence_result_s::geofence_action</a></div><div class="ttdeci">uint8_t geofence_action</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/ddd/geofence__result_8h_source.html#l00060">geofence_result.h:60</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_ac91747453f278b9349ddd13da330fa0c"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#ac91747453f278b9349ddd13da330fa0c">vehicle_status_flags_s::condition_local_velocity_valid</a></div><div class="ttdeci">bool condition_local_velocity_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00062">vehicle_status_flags.h:62</a></div></div>
<div class="ttc" id="class_commander_html_aa8b5b8481c13e6fff25d3b447d46e8d5"><div class="ttname"><a href="../../d3/dc6/class_commander.html#aa8b5b8481c13e6fff25d3b447d46e8d5">Commander::_nav_test_failed</a></div><div class="ttdeci">bool _nav_test_failed</div><div class="ttdoc">true if the post takeoff navigation test has failed </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00126">Commander.hpp:126</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a477f9050e58a25f419da7f643b4c52fb"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a477f9050e58a25f419da7f643b4c52fb">vehicle_status_s::hil_state</a></div><div class="ttdeci">uint8_t hil_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00093">vehicle_status.h:93</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_af719bbd029ae6e9bc3eac64e9071b40d"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#af719bbd029ae6e9bc3eac64e9071b40d">vehicle_status_s::arming_state</a></div><div class="ttdeci">uint8_t arming_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00092">vehicle_status.h:92</a></div></div>
<div class="ttc" id="px4io_8c_html_abaa327c5cc17da179a4bfea0de695fbc"><div class="ttname"><a href="../../dd/d87/px4io_8c.html#abaa327c5cc17da179a4bfea0de695fbc">msg</a></div><div class="ttdeci">static char msg[NUM_MSG][CONFIG_USART1_TXBUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d87/px4io_8c_source.html#l00089">px4io.c:89</a></div></div>
<div class="ttc" id="structpower__button__state__s_html_ac9d1fe794d88be48f84f6508f0c9ba0d"><div class="ttname"><a href="../../dd/db8/structpower__button__state__s.html#ac9d1fe794d88be48f84f6508f0c9ba0d">power_button_state_s::event</a></div><div class="ttdeci">uint8_t event</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d58/power__button__state_8h_source.html#l00058">power_button_state.h:58</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a1d36762fa2d596c65f758185aa92d02a"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a1d36762fa2d596c65f758185aa92d02a">_skip_pos_accuracy_check</a></div><div class="ttdeci">static bool _skip_pos_accuracy_check</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00187">Commander.cpp:187</a></div></div>
<div class="ttc" id="arm__auth_8cpp_html_a036d498309eb1ec19b5293503a4e1e21"><div class="ttname"><a href="../../d0/d49/arm__auth_8cpp.html#a036d498309eb1ec19b5293503a4e1e21">arm_auth_update</a></div><div class="ttdeci">void arm_auth_update(hrt_abstime now, bool param_update)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d49/arm__auth_8cpp_source.html#l00174">arm_auth.cpp:174</a></div></div>
<div class="ttc" id="class_commander_html_aa5af5fbf71d0e2096d6ffe55935a53a5"><div class="ttname"><a href="../../d3/dc6/class_commander.html#aa5af5fbf71d0e2096d6ffe55935a53a5">Commander::_estimator_status_sub</a></div><div class="ttdeci">Subscription&lt; estimator_status_s &gt; _estimator_status_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00177">Commander.hpp:177</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_a196a292b740589eff958aa42c4e96ef5"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#a196a292b740589eff958aa42c4e96ef5">orb_subscribe</a></div><div class="ttdeci">int orb_subscribe(const struct orb_metadata *meta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00075">uORB.cpp:75</a></div></div>
<div class="ttc" id="class_commander_html_a78845d4a3762fc4b0a2220b032527f6c"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a78845d4a3762fc4b0a2220b032527f6c">Commander::_nav_test_passed</a></div><div class="ttdeci">bool _nav_test_passed</div><div class="ttdoc">true if the post takeoff navigation test has passed </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00125">Commander.hpp:125</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a0b85ebb1e3aac081a4c0a5e85ae3cbe9"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a0b85ebb1e3aac081a4c0a5e85ae3cbe9">pthread_attr_init</a></div><div class="ttdeci">int pthread_attr_init(pthread_attr_t *attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00062">stubs_posix.c:62</a></div></div>
<div class="ttc" id="structvtol__vehicle__status__s_html_a2bfa5197c337c95901e7384087d10a51"><div class="ttname"><a href="../../d4/d41/structvtol__vehicle__status__s.html#a2bfa5197c337c95901e7384087d10a51">vtol_vehicle_status_s::vtol_in_trans_mode</a></div><div class="ttdeci">bool vtol_in_trans_mode</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d75/vtol__vehicle__status_8h_source.html#l00060">vtol_vehicle_status.h:60</a></div></div>
<div class="ttc" id="telemetry__status_8h_html"><div class="ttname"><a href="../../d9/d33/telemetry__status_8h.html">telemetry_status.h</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a675c19070b0ca7956c113ce12c8e57d0"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a675c19070b0ca7956c113ce12c8e57d0">vehicle_status_flags_s::usb_connected</a></div><div class="ttdeci">bool usb_connected</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00080">vehicle_status_flags.h:80</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a3ca89696abad4daf8863c6bc11ae5d46"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a3ca89696abad4daf8863c6bc11ae5d46">safety</a></div><div class="ttdeci">static struct safety_s safety</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00157">Commander.cpp:157</a></div></div>
<div class="ttc" id="_commander_8cpp_html_afd0a2e6a4c9209262305d2f15ca74e4f"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#afd0a2e6a4c9209262305d2f15ca74e4f">rc_signal_lost_timestamp</a></div><div class="ttdeci">static uint64_t rc_signal_lost_timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00178">Commander.cpp:178</a></div></div>
<div class="ttc" id="_commander_8cpp_html_af62ee6f05861387a2bc3831c160afea8"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#af62ee6f05861387a2bc3831c160afea8">commander_low_prio_loop</a></div><div class="ttdeci">void * commander_low_prio_loop(void *arg)</div><div class="ttdoc">Loop that runs at a lower rate and priority for calibration and parameter tasks. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03561">Commander.cpp:3561</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baa395c3f85ae2bf89d57722a85b660f99e"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa395c3f85ae2bf89d57722a85b660f99e">VEHICLE_MODE_FLAG_MANUAL_INPUT_ENABLED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00120">Commander.cpp:120</a></div></div>
<div class="ttc" id="structvehicle__command__ack__s_html_aada7877222b0095c6650d62aa918bd2b"><div class="ttname"><a href="../../da/deb/structvehicle__command__ack__s.html#aada7877222b0095c6650d62aa918bd2b">vehicle_command_ack_s::target_component</a></div><div class="ttdeci">uint8_t target_component</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d2e/vehicle__command__ack_8h_source.html#l00073">vehicle_command_ack.h:73</a></div></div>
<div class="ttc" id="drv__board__led_8h_html_a0e72d9b104ee1fa873b85cb132aa02d1"><div class="ttname"><a href="../../d9/d71/drv__board__led_8h.html#a0e72d9b104ee1fa873b85cb132aa02d1">LED_AMBER</a></div><div class="ttdeci">#define LED_AMBER</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d71/drv__board__led_8h_source.html#l00052">drv_board_led.h:52</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a1eff7d714ab54b99193e7d3a8090e8c8"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a1eff7d714ab54b99193e7d3a8090e8c8">print_reject_mode</a></div><div class="ttdeci">void print_reject_mode(const char *msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03492">Commander.cpp:3492</a></div></div>
<div class="ttc" id="health__flag__helper_8cpp_html_a5e4b7755bd406163fec617e1fa35f212"><div class="ttname"><a href="../../d0/dc0/health__flag__helper_8cpp.html#a5e4b7755bd406163fec617e1fa35f212">set_health_flags_present_healthy</a></div><div class="ttdeci">void set_health_flags_present_healthy(uint64_t subsystem_type, bool present, bool healthy, vehicle_status_s &amp;status)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dc0/health__flag__helper_8cpp_source.html#l00070">health_flag_helper.cpp:70</a></div></div>
<div class="ttc" id="class_commander_html_a1e65f3636df4d9fba66e2be84bece448"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a1e65f3636df4d9fba66e2be84bece448">Commander::set_main_state_override_on</a></div><div class="ttdeci">transition_result_t set_main_state_override_on(const vehicle_status_s &amp;status, bool *changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l02812">Commander.cpp:2812</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baaa411c6c721ffa0bba846cfdba506faa5"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baaa411c6c721ffa0bba846cfdba506faa5">VEHICLE_MODE_FLAG_SAFETY_ARMED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00121">Commander.cpp:121</a></div></div>
<div class="ttc" id="class_commander_html_a66e5bc6e5edea5edb1eb0aab356e5663"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a66e5bc6e5edea5edb1eb0aab356e5663">Commander::reset_posvel_validity</a></div><div class="ttdeci">void reset_posvel_validity(bool *changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03199">Commander.cpp:3199</a></div></div>
<div class="ttc" id="u_o_r_b_8h_html_a96af5434ec1acdf24287bd7851b0413f"><div class="ttname"><a href="../../db/dd6/u_o_r_b_8h.html#a96af5434ec1acdf24287bd7851b0413f">ORB_ID</a></div><div class="ttdeci">#define ORB_ID(_name)</div><div class="ttdoc">Generates a pointer to the uORB metadata structure for a given topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/u_o_r_b_8h_source.html#l00087">uORB.h:87</a></div></div>
<div class="ttc" id="drv__board__led_8h_html_ae2e40566d27689f8581d7b0f12271d45"><div class="ttname"><a href="../../d9/d71/drv__board__led_8h.html#ae2e40566d27689f8581d7b0f12271d45">LED_BLUE</a></div><div class="ttdeci">#define LED_BLUE</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d71/drv__board__led_8h_source.html#l00054">drv_board_led.h:54</a></div></div>
<div class="ttc" id="class_commander_html_a800e1be6a8f20efff3869495f08dde3a"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a800e1be6a8f20efff3869495f08dde3a">Commander::estimator_check</a></div><div class="ttdeci">void estimator_check(bool *status_changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l04116">Commander.cpp:4116</a></div></div>
<div class="ttc" id="structvtol__vehicle__status__s_html_ab62ff4972289ff4622e0d4b7b06ccce3"><div class="ttname"><a href="../../d4/d41/structvtol__vehicle__status__s.html#ab62ff4972289ff4622e0d4b7b06ccce3">vtol_vehicle_status_s::vtol_transition_failsafe</a></div><div class="ttdeci">bool vtol_transition_failsafe</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d75/vtol__vehicle__status_8h_source.html#l00062">vtol_vehicle_status.h:62</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a01c628c7d19678d54ee677fd2c062a6e"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a01c628c7d19678d54ee677fd2c062a6e">print_reject_arm</a></div><div class="ttdeci">void print_reject_arm(const char *msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03507">Commander.cpp:3507</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a8901a9ed66dcf0e34733f8bef2a511fe"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a8901a9ed66dcf0e34733f8bef2a511fe">COMMANDER_MONITORING_LOOPSPERMSEC</a></div><div class="ttdeci">#define COMMANDER_MONITORING_LOOPSPERMSEC</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00127">Commander.cpp:127</a></div></div>
<div class="ttc" id="class_commander_html_a86abaf98d17aeacd9aef07a0a9a6fb9a"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a86abaf98d17aeacd9aef07a0a9a6fb9a">Commander::run</a></div><div class="ttdeci">void run() override</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l01111">Commander.cpp:1111</a></div></div>
<div class="ttc" id="structmission__result__s_html_a3634ac27af85453b6438000b5da5eacb"><div class="ttname"><a href="../../d5/dd1/structmission__result__s.html#a3634ac27af85453b6438000b5da5eacb">mission_result_s::failure</a></div><div class="ttdeci">bool failure</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0e/mission__result_8h_source.html#l00066">mission_result.h:66</a></div></div>
<div class="ttc" id="structtelemetry__status__s_html"><div class="ttname"><a href="../../dc/dda/structtelemetry__status__s.html">telemetry_status_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/telemetry__status_8h_source.html#l00057">telemetry_status.h:57</a></div></div>
<div class="ttc" id="structmission__s_html_a7aca40dd38583c2f84561d097f892409"><div class="ttname"><a href="../../db/d74/structmission__s.html#a7aca40dd38583c2f84561d097f892409">mission_s::count</a></div><div class="ttdeci">uint16_t count</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d02/build_2doxygen_2u_o_r_b_2topics_2mission_8h_source.html#l00055">mission.h:55</a></div></div>
<div class="ttc" id="src_2modules_2systemlib_2mavlink__log_8h_html_a90c4462996ffec1c2af37cadae8408f2"><div class="ttname"><a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a90c4462996ffec1c2af37cadae8408f2">mavlink_log_info</a></div><div class="ttdeci">#define mavlink_log_info(_pub, _text,...)</div><div class="ttdoc">Send a mavlink info message (not printed to console). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h_source.html#l00081">mavlink_log.h:81</a></div></div>
<div class="ttc" id="px4__tasks_8h_html_a242f0d89422bbfafc38856f4cb4a520c"><div class="ttname"><a href="../../da/d65/px4__tasks_8h.html#a242f0d89422bbfafc38856f4cb4a520c">px4_task_exit</a></div><div class="ttdeci">__EXPORT void px4_task_exit(int ret)</div><div class="ttdoc">Exit current task with return value. </div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_ab523de02dbf3b2653d75b2f8c6568481"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#ab523de02dbf3b2653d75b2f8c6568481">vehicle_status_flags_s::rc_signal_found_once</a></div><div class="ttdeci">bool rc_signal_found_once</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00076">vehicle_status_flags.h:76</a></div></div>
<div class="ttc" id="commander__helper_8h_html"><div class="ttname"><a href="../../d0/dbe/commander__helper_8h.html">commander_helper.h</a></div><div class="ttdoc">Commander helper functions definitions. </div></div>
<div class="ttc" id="structvtol__vehicle__status__s_html_a9c8011a22816871714ab7a7c7099019e"><div class="ttname"><a href="../../d4/d41/structvtol__vehicle__status__s.html#a9c8011a22816871714ab7a7c7099019e">vtol_vehicle_status_s::in_transition_to_fw</a></div><div class="ttdeci">bool in_transition_to_fw</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d75/vtol__vehicle__status_8h_source.html#l00061">vtol_vehicle_status.h:61</a></div></div>
<div class="ttc" id="dataman_8cpp_html_a3e79510848c9ee7d821d33a35f6779f3"><div class="ttname"><a href="../../d6/d47/dataman_8cpp.html#a3e79510848c9ee7d821d33a35f6779f3">dm_read</a></div><div class="ttdeci">__EXPORT ssize_t dm_read(dm_item_t item, unsigned index, void *buf, size_t count)</div><div class="ttdoc">Retrieve from the data manager file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/dataman_8cpp_source.html#l01110">dataman.cpp:1110</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a2bd88fa6ff6fb2bfd8913dd6d0465ebe"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a2bd88fa6ff6fb2bfd8913dd6d0465ebe">vehicle_control_mode_s::flag_control_velocity_enabled</a></div><div class="ttdeci">bool flag_control_velocity_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00065">vehicle_control_mode.h:65</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a3abf9c25e30016470072b3d6524b6faa"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a3abf9c25e30016470072b3d6524b6faa">vehicle_control_mode_s::flag_control_manual_enabled</a></div><div class="ttdeci">bool flag_control_manual_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00057">vehicle_control_mode.h:57</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html">vehicle_local_position_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00051">vehicle_local_position.h:51</a></div></div>
<div class="ttc" id="class_commander_html_a58568c8d5856cb438e8bfbc9592da526"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a58568c8d5856cb438e8bfbc9592da526">Commander::_lvel_probation_time_us</a></div><div class="ttdeci">hrt_abstime _lvel_probation_time_us</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00120">Commander.hpp:120</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a23f7172b1de38dc3004f54ff0858f591"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a23f7172b1de38dc3004f54ff0858f591">vehicle_control_mode_s::flag_control_termination_enabled</a></div><div class="ttdeci">bool flag_control_termination_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00069">vehicle_control_mode.h:69</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_aaa922fdf78be43086fc6453ba6a0fccc"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#aaa922fdf78be43086fc6453ba6a0fccc">vehicle_status_flags_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00053">vehicle_status_flags.h:53</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_aacfdf5807d384b2a735e0b1942e7a478"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#aacfdf5807d384b2a735e0b1942e7a478">vehicle_command_s::param1</a></div><div class="ttdeci">float param1</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00151">vehicle_command.h:151</a></div></div>
<div class="ttc" id="structhome__position__s_html_abb00d6356fa27cb10bf632ed86fcddac"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#abb00d6356fa27cb10bf632ed86fcddac">home_position_s::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00058">home_position.h:58</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_abf8f27de653a86414890a4928caff730"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#abf8f27de653a86414890a4928caff730">vehicle_status_flags_s::condition_system_sensors_initialized</a></div><div class="ttdeci">bool condition_system_sensors_initialized</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00055">vehicle_status_flags.h:55</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a728a009d7b2aa98228f09d5b0ddf5da9"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a728a009d7b2aa98228f09d5b0ddf5da9">vehicle_status_flags_s::condition_local_altitude_valid</a></div><div class="ttdeci">bool condition_local_altitude_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00063">vehicle_status_flags.h:63</a></div></div>
<div class="ttc" id="class_commander_html_a387b22616ab617aaba60b804e6b4723e"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a387b22616ab617aaba60b804e6b4723e">Commander::enable_hil</a></div><div class="ttdeci">void enable_hil()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03872">Commander.cpp:3872</a></div></div>
<div class="ttc" id="src_2modules_2systemlib_2mavlink__log_8h_html_a81e8bb90838931b6a26c130cde3567f8"><div class="ttname"><a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#a81e8bb90838931b6a26c130cde3567f8">mavlink_log_critical</a></div><div class="ttdeci">#define mavlink_log_critical(_pub, _text,...)</div><div class="ttdoc">Send a mavlink critical message and print to console. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h_source.html#l00101">mavlink_log.h:101</a></div></div>
<div class="ttc" id="dataman_8h_html_af4d60143bf40b951e9e5c0ebd5ff60a8a57d12e18d8660fd0083bf75f76670e07"><div class="ttname"><a href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8a57d12e18d8660fd0083bf75f76670e07">DM_KEY_WAYPOINTS_OFFBOARD_1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6e/dataman_8h_source.html#l00054">dataman.h:54</a></div></div>
<div class="ttc" id="structbattery__status__s_html_a446b3327cc7afcc85cd58d0a08af72f0"><div class="ttname"><a href="../../d0/d5c/structbattery__status__s.html#a446b3327cc7afcc85cd58d0a08af72f0">battery_status_s::current_a</a></div><div class="ttdeci">float current_a</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dc1/battery__status_8h_source.html#l00061">battery_status.h:61</a></div></div>
<div class="ttc" id="drv__tone__alarm_8h_html_adc29c2ff13d900c2f185ee95427fb06caa3dae1e566fb7da3fadca5c160df51b6"><div class="ttname"><a href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06caa3dae1e566fb7da3fadca5c160df51b6">TONE_GPS_WARNING_TUNE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d25/drv__tone__alarm_8h_source.html#l00083">drv_tone_alarm.h:83</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_aa5d61964104476edb329ee6dee4125d2a175ba35fe9b90492566bbfd685d30bfa"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a175ba35fe9b90492566bbfd685d30bfa">PX4_CUSTOM_SUB_MODE_AUTO_LOITER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00060">px4_custom_mode.h:60</a></div></div>
<div class="ttc" id="structgeofence__result__s_html_a276582775437eb350e7c20d739c4b4e5"><div class="ttname"><a href="../../de/d20/structgeofence__result__s.html#a276582775437eb350e7c20d739c4b4e5">geofence_result_s::geofence_violated</a></div><div class="ttdeci">bool geofence_violated</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/ddd/geofence__result_8h_source.html#l00059">geofence_result.h:59</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_aa5d61964104476edb329ee6dee4125d2ac081e262ec37301d4484082d4b11edf7"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2ac081e262ec37301d4484082d4b11edf7">PX4_CUSTOM_SUB_MODE_AUTO_FOLLOW_TARGET</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00065">px4_custom_mode.h:65</a></div></div>
<div class="ttc" id="actuator__armed_8h_html"><div class="ttname"><a href="../../d5/d5d/actuator__armed_8h.html">actuator_armed.h</a></div></div>
<div class="ttc" id="class_commander_html_a51dba9924beda93aea01a07793dda28a"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a51dba9924beda93aea01a07793dda28a">Commander::instantiate</a></div><div class="ttdeci">static Commander * instantiate(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03856">Commander.cpp:3856</a></div></div>
<div class="ttc" id="classsystemlib_1_1_hysteresis_html_a5143218563224b1fd4113a8e25234830"><div class="ttname"><a href="../../de/da3/classsystemlib_1_1_hysteresis.html#a5143218563224b1fd4113a8e25234830">systemlib::Hysteresis::get_state</a></div><div class="ttdeci">bool get_state() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dad/hysteresis_8h_source.html#l00073">hysteresis.h:73</a></div></div>
<div class="ttc" id="structvehicle__command__ack__s_html_a94715751095348a093d9774f9f4151b5"><div class="ttname"><a href="../../da/deb/structvehicle__command__ack__s.html#a94715751095348a093d9774f9f4151b5">vehicle_command_ack_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d2e/vehicle__command__ack_8h_source.html#l00066">vehicle_command_ack.h:66</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a1488785a3e46e25e388a12fa8d132000"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a1488785a3e46e25e388a12fa8d132000">vehicle_local_position_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00053">vehicle_local_position.h:53</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a89e60c74fcb66b9a7660faa6486d6658"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a89e60c74fcb66b9a7660faa6486d6658">vehicle_local_position_s::vy</a></div><div class="ttdeci">float vy</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00063">vehicle_local_position.h:63</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a20baad7833089fbd4b892688c449ef47"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a20baad7833089fbd4b892688c449ef47">vehicle_control_mode_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00053">vehicle_control_mode.h:53</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a791f24dab19dc433eabd2f32b8024638"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a791f24dab19dc433eabd2f32b8024638">vehicle_status_s::high_latency_data_link_active</a></div><div class="ttdeci">bool high_latency_data_link_active</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00106">vehicle_status.h:106</a></div></div>
<div class="ttc" id="structcommander__state__s_html_a4f40eddad3e8b89feae1d4d7a5ff4e32"><div class="ttname"><a href="../../d4/d88/structcommander__state__s.html#a4f40eddad3e8b89feae1d4d7a5ff4e32">commander_state_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/commander__state_8h_source.html#l00068">commander_state.h:68</a></div></div>
<div class="ttc" id="_commander_8cpp_html_abf6a81077538616d8077090cf219d843"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#abf6a81077538616d8077090cf219d843">commander_boot_timestamp</a></div><div class="ttdeci">static hrt_abstime commander_boot_timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00144">Commander.cpp:144</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73ec72898aee859e97d53a79b7492539a7fbd2725bf089f82868a221a5694616b"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a7fbd2725bf089f82868a221a5694616b">ARM_REQ_GPS_BIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00075">state_machine_helper.h:75</a></div></div>
<div class="ttc" id="px4__log_8h_html_a741f969d42a457b9c79ff4613a5c8f3a"><div class="ttname"><a href="../../d7/d53/px4__log_8h.html#a741f969d42a457b9c79ff4613a5c8f3a">PX4_INFO</a></div><div class="ttdeci">#define PX4_INFO(FMT,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/px4__log_8h_source.html#l00419">px4_log.h:419</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baafd83f65335a20163ec2f5246b29c1ac3"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baafd83f65335a20163ec2f5246b29c1ac3">VEHICLE_MODE_FLAG_TEST_ENABLED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00115">Commander.cpp:115</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a7c98f34a2a21a5f74958fd6b5f9c38ed"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a7c98f34a2a21a5f74958fd6b5f9c38ed">vehicle_control_mode_s::flag_armed</a></div><div class="ttdeci">bool flag_armed</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00054">vehicle_control_mode.h:54</a></div></div>
<div class="ttc" id="esc__calibration_8cpp_html_a076fa55d1c50ba98926631180977e012"><div class="ttname"><a href="../../d1/d41/esc__calibration_8cpp.html#a076fa55d1c50ba98926631180977e012">do_esc_calibration</a></div><div class="ttdeci">int do_esc_calibration(orb_advert_t *mavlink_log_pub, struct actuator_armed_s *armed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d41/esc__calibration_8cpp_source.html#l00066">esc_calibration.cpp:66</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ae0d147ece8faaedae07ffcb987b28d42"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ae0d147ece8faaedae07ffcb987b28d42">arm_disarm</a></div><div class="ttdeci">transition_result_t arm_disarm(bool arm, orb_advert_t *mavlink_log_pub, const char *armedBy)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00518">Commander.cpp:518</a></div></div>
<div class="ttc" id="hello__start__posix_8cpp_html_aea5747e6274863a22260d0046ca87452"><div class="ttname"><a href="../../d6/dad/hello__start__posix_8cpp.html#aea5747e6274863a22260d0046ca87452">SCHED_DEFAULT</a></div><div class="ttdeci">#define SCHED_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dad/hello__start__posix_8cpp_source.html#l00049">hello_start_posix.cpp:49</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a5f3ba300194ab441460971eb29f5be09"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a5f3ba300194ab441460971eb29f5be09">vehicle_status_flags_s::rc_calibration_valid</a></div><div class="ttdeci">bool rc_calibration_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00078">vehicle_status_flags.h:78</a></div></div>
<div class="ttc" id="u_o_r_b_8h_html_a1d8875c6fa9f0e16530aaa02dc0b15a0"><div class="ttname"><a href="../../db/dd6/u_o_r_b_8h.html#a1d8875c6fa9f0e16530aaa02dc0b15a0">ORB_ID_VEHICLE_ATTITUDE_CONTROLS</a></div><div class="ttdeci">#define ORB_ID_VEHICLE_ATTITUDE_CONTROLS</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/u_o_r_b_8h_source.html#l00256">uORB.h:256</a></div></div>
<div class="ttc" id="drv__board__led_8h_html_aca338dbd19d7940923334629f6e5f3b7"><div class="ttname"><a href="../../d9/d71/drv__board__led_8h.html#aca338dbd19d7940923334629f6e5f3b7">LED_GREEN</a></div><div class="ttdeci">#define LED_GREEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d71/drv__board__led_8h_source.html#l00056">drv_board_led.h:56</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_aa5d61964104476edb329ee6dee4125d2a0f84ecb91094f0d3263db94087fd5801"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2a0f84ecb91094f0d3263db94087fd5801">PX4_CUSTOM_SUB_MODE_AUTO_LAND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00063">px4_custom_mode.h:63</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_af4cedc421ae8ff1d0036ffae953f4ff1"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#af4cedc421ae8ff1d0036ffae953f4ff1">vehicle_status_s::mission_failure</a></div><div class="ttdeci">bool mission_failure</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00109">vehicle_status.h:109</a></div></div>
<div class="ttc" id="struct_commander_1_1telemetry__data_html_adb6c4f049a665c5e8b945d5bfeb08249"><div class="ttname"><a href="../../d5/d23/struct_commander_1_1telemetry__data.html#adb6c4f049a665c5e8b945d5bfeb08249">Commander::telemetry_data::last_dl_loss</a></div><div class="ttdeci">uint64_t last_dl_loss</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00168">Commander.hpp:168</a></div></div>
<div class="ttc" id="param_8c_html_a8c23617be66d165d07cc3bd42e9acffd"><div class="ttname"><a href="../../d9/da5/param_8c.html#a8c23617be66d165d07cc3bd42e9acffd">param_save_default</a></div><div class="ttdeci">int param_save_default(void)</div><div class="ttdoc">Save parameters to the default file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da5/param_8c_source.html#l00956">param.c:956</a></div></div>
<div class="ttc" id="vehicle__status__flags_8h_html"><div class="ttname"><a href="../../d6/d33/vehicle__status__flags_8h.html">vehicle_status_flags.h</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a4e49d10dc620a86b1b762bea8639020d"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a4e49d10dc620a86b1b762bea8639020d">vehicle_control_mode_s::flag_system_hil_enabled</a></div><div class="ttdeci">bool flag_system_hil_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00056">vehicle_control_mode.h:56</a></div></div>
<div class="ttc" id="structmission__result__s_html_ad18bbbbc2a2bade91480f6cf56029f63"><div class="ttname"><a href="../../d5/dd1/structmission__result__s.html#ad18bbbbc2a2bade91480f6cf56029f63">mission_result_s::instance_count</a></div><div class="ttdeci">uint32_t instance_count</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0e/mission__result_8h_source.html#l00057">mission_result.h:57</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a43de48f7498f5233b5f62dc2e50985a1"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a43de48f7498f5233b5f62dc2e50985a1">armed</a></div><div class="ttdeci">static struct actuator_armed_s armed</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00156">Commander.cpp:156</a></div></div>
<div class="ttc" id="integration_8cpp_html_af5ba872dd09316732300733cc164ac1a"><div class="ttname"><a href="../../d8/da1/integration_8cpp.html#af5ba872dd09316732300733cc164ac1a">f</a></div><div class="ttdeci">Vector&lt; float, 6 &gt; f(float t, const Matrix&lt; float, 6, 1 &gt; &amp;, const Matrix&lt; float, 3, 1 &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da1/integration_8cpp_source.html#l00008">integration.cpp:8</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_ae5d18438d4d20c8a2e42cd2500578d79"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#ae5d18438d4d20c8a2e42cd2500578d79">pthread_create</a></div><div class="ttdeci">int pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine)(void *), void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00082">stubs_posix.c:82</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a28a15bba47cab57cbc9f5dac9af99c8b"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a28a15bba47cab57cbc9f5dac9af99c8b">pthread_join</a></div><div class="ttdeci">int pthread_join(pthread_t thread, void **retval)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00053">stubs_posix.c:53</a></div></div>
<div class="ttc" id="rc__calibration_8cpp_html_a0e46b1efe365665e7ae7eba4aefae32b"><div class="ttname"><a href="../../da/db3/rc__calibration_8cpp.html#a0e46b1efe365665e7ae7eba4aefae32b">do_trim_calibration</a></div><div class="ttdeci">int do_trim_calibration(orb_advert_t *mavlink_log_pub)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/db3/rc__calibration_8cpp_source.html#l00054">rc_calibration.cpp:54</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_af5c7947e4a99fd45ecdac793f12b0ed0"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#af5c7947e4a99fd45ecdac793f12b0ed0">vehicle_status_flags_s::offboard_control_signal_lost</a></div><div class="ttdeci">bool offboard_control_signal_lost</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00073">vehicle_status_flags.h:73</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ae70d79a727876216e886dab6d5282fc1"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ae70d79a727876216e886dab6d5282fc1">HOTPLUG_SENS_TIMEOUT</a></div><div class="ttdeci">static constexpr uint64_t HOTPLUG_SENS_TIMEOUT</div><div class="ttdoc">wait for hotplug sensors to come online for upto 8 seconds </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00132">Commander.cpp:132</a></div></div>
<div class="ttc" id="drv__tone__alarm_8h_html_adc29c2ff13d900c2f185ee95427fb06caf6aecf75f49cf6fdca0e1c63bea30e0f"><div class="ttname"><a href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06caf6aecf75f49cf6fdca0e1c63bea30e0f">TONE_STOP_TUNE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d25/drv__tone__alarm_8h_source.html#l00074">drv_tone_alarm.h:74</a></div></div>
<div class="ttc" id="aerofc__adc_8cpp_html_ad0a45fb9e843829aecb496154724b9de"><div class="ttname"><a href="../../d2/dec/aerofc__adc_8cpp.html#ad0a45fb9e843829aecb496154724b9de">instance</a></div><div class="ttdeci">static AEROFC_ADC * instance</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dec/aerofc__adc_8cpp_source.html#l00103">aerofc_adc.cpp:103</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baafd28e3943259929afa30fd1df7a31484"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baafd28e3943259929afa30fd1df7a31484">VEHICLE_MODE_FLAG_AUTO_ENABLED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00116">Commander.cpp:116</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a22967f4ba02c22cbc1f09983ceb412db"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a22967f4ba02c22cbc1f09983ceb412db">vehicle_status_flags_s::condition_auto_mission_available</a></div><div class="ttdeci">bool condition_auto_mission_available</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00058">vehicle_status_flags.h:58</a></div></div>
<div class="ttc" id="structhome__position__s_html"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html">home_position_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00051">home_position.h:51</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_ad6c06c3627044589f604943b761fa051"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#ad6c06c3627044589f604943b761fa051">manual_control_setpoint_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00070">manual_control_setpoint.h:70</a></div></div>
<div class="ttc" id="structvehicle__global__position__s_html_a9a576ebabe4dc0ef1bff7c709d3b6e9a"><div class="ttname"><a href="../../da/dcb/structvehicle__global__position__s.html#a9a576ebabe4dc0ef1bff7c709d3b6e9a">vehicle_global_position_s::alt</a></div><div class="ttdeci">float alt</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/vehicle__global__position_8h_source.html#l00056">vehicle_global_position.h:56</a></div></div>
<div class="ttc" id="err_8h_html_ae6cfebfa20e754bd09c394f8bd07f624"><div class="ttname"><a href="../../d6/d40/err_8h.html#ae6cfebfa20e754bd09c394f8bd07f624">warnx</a></div><div class="ttdeci">#define warnx(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d40/err_8h_source.html#l00095">err.h:95</a></div></div>
<div class="ttc" id="dataman_8h_html"><div class="ttname"><a href="../../db/d6e/dataman_8h.html">dataman.h</a></div><div class="ttdoc">DATAMANAGER driver. </div></div>
<div class="ttc" id="class_commander_html_af6c317d7048a7e6711cd0c15e5e5e6e4"><div class="ttname"><a href="../../d3/dc6/class_commander.html#af6c317d7048a7e6711cd0c15e5e5e6e4">Commander::print_usage</a></div><div class="ttdeci">static int print_usage(const char *reason=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03830">Commander.cpp:3830</a></div></div>
<div class="ttc" id="structsystem__power__s_html_a71d2a39e424f04cd5a035bddf2d354a1"><div class="ttname"><a href="../../d5/d64/structsystem__power__s.html#a71d2a39e424f04cd5a035bddf2d354a1">system_power_s::usb_connected</a></div><div class="ttdeci">uint8_t usb_connected</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0c/system__power_8h_source.html#l00065">system_power.h:65</a></div></div>
<div class="ttc" id="mag__calibration_8cpp_html_afc0e4e0619e1f2846eeec88a20aa9b8e"><div class="ttname"><a href="../../de/d14/mag__calibration_8cpp.html#afc0e4e0619e1f2846eeec88a20aa9b8e">do_mag_calibration</a></div><div class="ttdeci">int do_mag_calibration(orb_advert_t *mavlink_log_pub)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d14/mag__calibration_8cpp_source.html#l00099">mag_calibration.cpp:99</a></div></div>
<div class="ttc" id="err_8h_html"><div class="ttname"><a href="../../d6/d40/err_8h.html">err.h</a></div><div class="ttdoc">Simple error/warning functions, heavily inspired by the BSD functions of the same names...</div></div>
<div class="ttc" id="structsafety__s_html"><div class="ttname"><a href="../../d1/d06/structsafety__s.html">safety_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da0/safety_8h_source.html#l00051">safety.h:51</a></div></div>
<div class="ttc" id="structactuator__armed__s_html_aef783cd736e2fef1e8f22578b7dcb585"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#aef783cd736e2fef1e8f22578b7dcb585">actuator_armed_s::ready_to_arm</a></div><div class="ttdeci">bool ready_to_arm</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00057">actuator_armed.h:57</a></div></div>
<div class="ttc" id="structbattery__status__s_html_a835d994b04cbebd2f056660c4f01dfda"><div class="ttname"><a href="../../d0/d5c/structbattery__status__s.html#a835d994b04cbebd2f056660c4f01dfda">battery_status_s::warning</a></div><div class="ttdeci">uint8_t warning</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dc1/battery__status_8h_source.html#l00078">battery_status.h:78</a></div></div>
<div class="ttc" id="safety_8c_html_a57451d202e70f5eafc93a3cc5e6c0c6e"><div class="ttname"><a href="../../d4/d6d/safety_8c.html#a57451d202e70f5eafc93a3cc5e6c0c6e">counter</a></div><div class="ttdeci">static unsigned counter</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d6d/safety_8c_source.html#l00056">safety.c:56</a></div></div>
<div class="ttc" id="class_commander_html"><div class="ttname"><a href="../../d3/dc6/class_commander.html">Commander</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00070">Commander.hpp:70</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73ec72898aee859e97d53a79b7492539a5e98cfd3ee04ceb54280b7dce3976897"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a5e98cfd3ee04ceb54280b7dce3976897">ARM_REQ_ARM_AUTH_BIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00074">state_machine_helper.h:74</a></div></div>
<div class="ttc" id="manual__control__setpoint_8h_html"><div class="ttname"><a href="../../d0/d28/manual__control__setpoint_8h.html">manual_control_setpoint.h</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a0220800d92bc1bc7338fc81a3985c99b"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a0220800d92bc1bc7338fc81a3985c99b">answer_command</a></div><div class="ttdeci">static void answer_command(const vehicle_command_s &amp;cmd, unsigned result, orb_advert_t &amp;command_ack_pub)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03518">Commander.cpp:3518</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a90a80fd140e5e1feba80ba0c5ef25c7c"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a90a80fd140e5e1feba80ba0c5ef25c7c">is_rotary_wing</a></div><div class="ttdeci">bool is_rotary_wing(const struct vehicle_status_s *current_status)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00094">commander_helper.cpp:94</a></div></div>
<div class="ttc" id="px4__tasks_8h_html_ad6b4506aaddc80015da7892f25772f40"><div class="ttname"><a href="../../da/d65/px4__tasks_8h.html#ad6b4506aaddc80015da7892f25772f40">px4_main_t</a></div><div class="ttdeci">int(* px4_main_t)(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d65/px4__tasks_8h_source.html#l00154">px4_tasks.h:154</a></div></div>
<div class="ttc" id="class_commander_html_a22b2616f06eaa67f40b87d7a897f90f2"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a22b2616f06eaa67f40b87d7a897f90f2">Commander::_mission_result_sub</a></div><div class="ttdeci">Subscription&lt; mission_result_s &gt; _mission_result_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00179">Commander.hpp:179</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_aa021364ef29e453bc47ea80afec2af55"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#aa021364ef29e453bc47ea80afec2af55">tune_mission_ok</a></div><div class="ttdeci">void tune_mission_ok(bool use_buzzer)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00189">commander_helper.cpp:189</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_ac9d6d724d9a0766dab248d713484ecea"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#ac9d6d724d9a0766dab248d713484ecea">is_vtol</a></div><div class="ttdeci">bool is_vtol(const struct vehicle_status_s *current_status)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00100">commander_helper.cpp:100</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a564b08611fcdc00e94d8a30a53584722"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a564b08611fcdc00e94d8a30a53584722">vehicle_status_flags_s::vtol_transition_failure</a></div><div class="ttdeci">bool vtol_transition_failure</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00079">vehicle_status_flags.h:79</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a19e65cfacb780bf766338756148a966d"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a19e65cfacb780bf766338756148a966d">thread_should_exit</a></div><div class="ttdeci">static volatile bool thread_should_exit</div><div class="ttdoc">daemon exit flag </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00141">Commander.cpp:141</a></div></div>
<div class="ttc" id="mission__result_8h_html"><div class="ttname"><a href="../../df/d0e/mission__result_8h.html">mission_result.h</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_aa6c8fa923869f0f73ab0404a411af37e"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#aa6c8fa923869f0f73ab0404a411af37e">vehicle_control_mode_s::flag_control_attitude_enabled</a></div><div class="ttdeci">bool flag_control_attitude_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00061">vehicle_control_mode.h:61</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a8a3174a9dbd2ed822ef1ead8b3b2adaa"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a8a3174a9dbd2ed822ef1ead8b3b2adaa">manual_control_setpoint_s::loiter_switch</a></div><div class="ttdeci">uint8_t loiter_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00085">manual_control_setpoint.h:85</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a4bb2805e2c19990012dae67329d2f4ab"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a4bb2805e2c19990012dae67329d2f4ab">vehicle_control_mode_s::flag_control_acceleration_enabled</a></div><div class="ttdeci">bool flag_control_acceleration_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00064">vehicle_control_mode.h:64</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a69bb5f2c7b1da001628ef44926171f29"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a69bb5f2c7b1da001628ef44926171f29">offboard_control_mode</a></div><div class="ttdeci">static struct offboard_control_mode_s offboard_control_mode</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00159">Commander.cpp:159</a></div></div>
<div class="ttc" id="drv__tone__alarm_8h_html_adc29c2ff13d900c2f185ee95427fb06ca8a36d4dbb249f522ed9d6116711150d6"><div class="ttname"><a href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca8a36d4dbb249f522ed9d6116711150d6">TONE_BATTERY_WARNING_FAST_TUNE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d25/drv__tone__alarm_8h_source.html#l00082">drv_tone_alarm.h:82</a></div></div>
<div class="ttc" id="class_commander_html_a7b9c381b03caead8f28b7b8b69a6d5cd"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a7b9c381b03caead8f28b7b8b69a6d5cd">Commander::poll_telemetry_status</a></div><div class="ttdeci">void poll_telemetry_status()</div><div class="ttdoc">Update the telemetry status and the corresponding status variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03916">Commander.cpp:3916</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baa44f1b640cbede2524ebd969b83543fa2"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa44f1b640cbede2524ebd969b83543fa2">VEHICLE_MODE_FLAG_CUSTOM_MODE_ENABLED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00114">Commander.cpp:114</a></div></div>
<div class="ttc" id="structhome__position__s_html_a81736b88f32e773a42da7a9b79616e53"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a81736b88f32e773a42da7a9b79616e53">home_position_s::valid_hpos</a></div><div class="ttdeci">bool valid_hpos</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00062">home_position.h:62</a></div></div>
<div class="ttc" id="structvehicle__land__detected__s_html_a538b7032a1788f22c0b9f6cdf96da0e6"><div class="ttname"><a href="../../d6/d7e/structvehicle__land__detected__s.html#a538b7032a1788f22c0b9f6cdf96da0e6">vehicle_land_detected_s::freefall</a></div><div class="ttdeci">bool freefall</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddd/vehicle__land__detected_8h_source.html#l00056">vehicle_land_detected.h:56</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_ad634aeca2e48fc3badeabf702712443c"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#ad634aeca2e48fc3badeabf702712443c">vehicle_local_position_s::ref_lat</a></div><div class="ttdeci">double ref_lat</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00055">vehicle_local_position.h:55</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a5fdd1516317993b343f2c3a02e273da6"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a5fdd1516317993b343f2c3a02e273da6">blink_msg_state</a></div><div class="ttdeci">int blink_msg_state()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00258">commander_helper.cpp:258</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a52639ebfc6a2acfc2b5624c2f623dbb1"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a52639ebfc6a2acfc2b5624c2f623dbb1">mavlink_log_pub</a></div><div class="ttdeci">static orb_advert_t mavlink_log_pub</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00137">Commander.cpp:137</a></div></div>
<div class="ttc" id="class_commander_html_ade5d0ec0717254516d98549218e1ed74"><div class="ttname"><a href="../../d3/dc6/class_commander.html#ade5d0ec0717254516d98549218e1ed74">Commander::set_main_state</a></div><div class="ttdeci">transition_result_t set_main_state(const vehicle_status_s &amp;status, bool *changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l02801">Commander.cpp:2801</a></div></div>
<div class="ttc" id="namespaceland__detector_html"><div class="ttname"><a href="../../d8/d08/namespaceland__detector.html">land_detector</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d8a/_fixedwing_land_detector_8cpp_source.html#l00049">FixedwingLandDetector.cpp:49</a></div></div>
<div class="ttc" id="drv__hrt_8h_html_a9f8bbf0e883115e04a457a268533a87c"><div class="ttname"><a href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a></div><div class="ttdeci">__BEGIN_DECLS typedef uint64_t hrt_abstime</div><div class="ttdoc">Absolute time, in microsecond units. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d10/drv__hrt_8h_source.html#l00057">drv_hrt.h:57</a></div></div>
<div class="ttc" id="structsubsystem__info__s_html_a75c83be03c2805eee14b5d215bf88edb"><div class="ttname"><a href="../../d2/d77/structsubsystem__info__s.html#a75c83be03c2805eee14b5d215bf88edb">subsystem_info_s::enabled</a></div><div class="ttdeci">bool enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d50/subsystem__info_8h_source.html#l00085">subsystem_info.h:85</a></div></div>
<div class="ttc" id="class_commander_html_ac3fc4568a88c91cb4ab97de9f77698a9"><div class="ttname"><a href="../../d3/dc6/class_commander.html#ac3fc4568a88c91cb4ab97de9f77698a9">Commander::Commander</a></div><div class="ttdeci">Commander()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00545">Commander.cpp:545</a></div></div>
<div class="ttc" id="drv__tone__alarm_8h_html"><div class="ttname"><a href="../../d9/d25/drv__tone__alarm_8h.html">drv_tone_alarm.h</a></div><div class="ttdoc">Driver for the PX4 audio alarm port, /dev/tone_alarm. </div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a0087298fe10a24a1846302fcb16ce493"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a0087298fe10a24a1846302fcb16ce493">manual_control_setpoint_s::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00071">manual_control_setpoint.h:71</a></div></div>
<div class="ttc" id="class_commander_html_a10b495bdc2e05bbaa14fb7cf22481a4b"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a10b495bdc2e05bbaa14fb7cf22481a4b">Commander::_global_position_sub</a></div><div class="ttdeci">Subscription&lt; vehicle_global_position_s &gt; _global_position_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00180">Commander.hpp:180</a></div></div>
<div class="ttc" id="structvehicle__land__detected__s_html"><div class="ttname"><a href="../../d6/d7e/structvehicle__land__detected__s.html">vehicle_land_detected_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddd/vehicle__land__detected_8h_source.html#l00051">vehicle_land_detected.h:51</a></div></div>
<div class="ttc" id="u_o_r_b_8h_html_a8d0cfa5f9ea6427a37057d6cea6dd990"><div class="ttname"><a href="../../db/dd6/u_o_r_b_8h.html#a8d0cfa5f9ea6427a37057d6cea6dd990">orb_advert_t</a></div><div class="ttdeci">__BEGIN_DECLS typedef void * orb_advert_t</div><div class="ttdoc">ORB topic advertiser handle. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/u_o_r_b_8h_source.html#l00134">uORB.h:134</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a8bb4bd9db2891f8edb99b0086e973001"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a8bb4bd9db2891f8edb99b0086e973001">last_overload</a></div><div class="ttdeci">static bool last_overload</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00174">Commander.cpp:174</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_afd3d272d702481044f8a8cd253fd9b47"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#afd3d272d702481044f8a8cd253fd9b47">pthread_attr_getschedparam</a></div><div class="ttdeci">int pthread_attr_getschedparam(const pthread_attr_t *attr, struct sched_param *param)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00086">stubs_posix.c:86</a></div></div>
<div class="ttc" id="structpower__button__state__s_html_ad9992550fcc33ebb4a18721e84266730"><div class="ttname"><a href="../../dd/db8/structpower__button__state__s.html#ad9992550fcc33ebb4a18721e84266730">power_button_state_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d58/power__button__state_8h_source.html#l00057">power_button_state.h:57</a></div></div>
<div class="ttc" id="structoffboard__control__mode__s_html"><div class="ttname"><a href="../../da/d9d/structoffboard__control__mode__s.html">offboard_control_mode_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/offboard__control__mode_8h_source.html#l00051">offboard_control_mode.h:51</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_af7a143a80b6b04689a3a4890ce8df4ae"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#af7a143a80b6b04689a3a4890ce8df4ae">orb_publish</a></div><div class="ttdeci">int orb_publish(const struct orb_metadata *meta, orb_advert_t handle, const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00070">uORB.cpp:70</a></div></div>
<div class="ttc" id="px4__log_8h_html_a1456147685cf86fa9d058baf143ae141"><div class="ttname"><a href="../../d7/d53/px4__log_8h.html#a1456147685cf86fa9d058baf143ae141">PX4_WARN</a></div><div class="ttdeci">#define PX4_WARN(FMT,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d53/px4__log_8h_source.html#l00460">px4_log.h:460</a></div></div>
<div class="ttc" id="struct_commander_1_1telemetry__data_html_a13413085d6b18bac3d37b3bf9ad3a54a"><div class="ttname"><a href="../../d5/d23/struct_commander_1_1telemetry__data.html#a13413085d6b18bac3d37b3bf9ad3a54a">Commander::telemetry_data::subscriber</a></div><div class="ttdeci">int subscriber</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00166">Commander.hpp:166</a></div></div>
<div class="ttc" id="state__machine__helper_8cpp_html_adf3c034062b0d6d7f415a35efebedf01"><div class="ttname"><a href="../../df/d25/state__machine__helper_8cpp.html#adf3c034062b0d6d7f415a35efebedf01">is_safe</a></div><div class="ttdeci">bool is_safe(const safety_s &amp;safety, const actuator_armed_s &amp;armed)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d25/state__machine__helper_8cpp_source.html#l00232">state_machine_helper.cpp:232</a></div></div>
<div class="ttc" id="px4__shutdown_8h_html"><div class="ttname"><a href="../../dd/d3d/px4__shutdown_8h.html">px4_shutdown.h</a></div><div class="ttdoc">Power-related API. </div></div>
<div class="ttc" id="structvehicle__status__s_html_ae26ef24bdabb5128240bc28750ef0dd2"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#ae26ef24bdabb5128240bc28750ef0dd2">vehicle_status_s::nav_state</a></div><div class="ttdeci">uint8_t nav_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00091">vehicle_status.h:91</a></div></div>
<div class="ttc" id="state__machine__helper_8cpp_html_a7633ff1e49699b0d54cdf0865bc11f3f"><div class="ttname"><a href="../../df/d25/state__machine__helper_8cpp.html#a7633ff1e49699b0d54cdf0865bc11f3f">hil_state_transition</a></div><div class="ttdeci">transition_result_t hil_state_transition(hil_state_t new_state, orb_advert_t status_pub, vehicle_status_s *current_status, orb_advert_t *mavlink_log_pub)</div><div class="ttdoc">Transition from one hil state to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d25/state__machine__helper_8cpp_source.html#l00374">state_machine_helper.cpp:374</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_a3da26a5e7cda0177a3457522377bad9e"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#a3da26a5e7cda0177a3457522377bad9e">vehicle_command_s::source_component</a></div><div class="ttdeci">uint8_t source_component</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00160">vehicle_command.h:160</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_abf33e0b4f76f58d75a48482b78aacb5a"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#abf33e0b4f76f58d75a48482b78aacb5a">vehicle_command_s::command</a></div><div class="ttdeci">uint16_t command</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00156">vehicle_command.h:156</a></div></div>
<div class="ttc" id="structvehicle__command__ack__s_html_a8042a3b38a4f70c1664f096ff1304646"><div class="ttname"><a href="../../da/deb/structvehicle__command__ack__s.html#a8042a3b38a4f70c1664f096ff1304646">vehicle_command_ack_s::target_system</a></div><div class="ttdeci">uint8_t target_system</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d2e/vehicle__command__ack_8h_source.html#l00072">vehicle_command_ack.h:72</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a8e666483c56f26571b30d63ebcd83f4d"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a8e666483c56f26571b30d63ebcd83f4d">manual_control_setpoint_s::arm_switch</a></div><div class="ttdeci">uint8_t arm_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00089">manual_control_setpoint.h:89</a></div></div>
<div class="ttc" id="structoffboard__control__mode__s_html_a6bdb3691df2192bf78c51c49382494fc"><div class="ttname"><a href="../../da/d9d/structoffboard__control__mode__s.html#a6bdb3691df2192bf78c51c49382494fc">offboard_control_mode_s::ignore_bodyrate</a></div><div class="ttdeci">bool ignore_bodyrate</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/offboard__control__mode_8h_source.html#l00056">offboard_control_mode.h:56</a></div></div>
<div class="ttc" id="geofence__result_8h_html"><div class="ttname"><a href="../../d7/ddd/geofence__result_8h.html">geofence_result.h</a></div></div>
<div class="ttc" id="structactuator__controls__s_html"><div class="ttname"><a href="../../de/d27/structactuator__controls__s.html">actuator_controls_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d46/actuator__controls_8h_source.html#l00063">actuator_controls.h:63</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967ba"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967ba">VEHICLE_MODE_FLAG</a></div><div class="ttdeci">VEHICLE_MODE_FLAG</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00112">Commander.cpp:112</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_aab64c98667c7e68911b4c4be515589d8"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#aab64c98667c7e68911b4c4be515589d8">vehicle_control_mode_s::flag_control_altitude_enabled</a></div><div class="ttdeci">bool flag_control_altitude_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00067">vehicle_control_mode.h:67</a></div></div>
<div class="ttc" id="structmap__projection__reference__s_html"><div class="ttname"><a href="../../de/d7e/structmap__projection__reference__s.html">map_projection_reference_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d35/geo_8h_source.html#l00075">geo.h:75</a></div></div>
<div class="ttc" id="dataman_8h_html_af4d60143bf40b951e9e5c0ebd5ff60a8a1f821db4150166fbe2c5a8b67c4579bc"><div class="ttname"><a href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8a1f821db4150166fbe2c5a8b67c4579bc">DM_KEY_WAYPOINTS_OFFBOARD_0</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6e/dataman_8h_source.html#l00053">dataman.h:53</a></div></div>
<div class="ttc" id="px4__tasks_8h_html_a9c9c04f140b8e63904e0e0c6597a5fc8"><div class="ttname"><a href="../../da/d65/px4__tasks_8h.html#a9c9c04f140b8e63904e0e0c6597a5fc8">px4_task_spawn_cmd</a></div><div class="ttdeci">__EXPORT px4_task_t px4_task_spawn_cmd(const char *name, int scheduler, int priority, int stack_size, px4_main_t entry, char *const argv[])</div><div class="ttdoc">Starts a task and performs any specific accounting, scheduler setup, etc. </div></div>
<div class="ttc" id="structvehicle__global__position__s_html_a73b4ca186bb7f3e8e1bafdb6f5110f8d"><div class="ttname"><a href="../../da/dcb/structvehicle__global__position__s.html#a73b4ca186bb7f3e8e1bafdb6f5110f8d">vehicle_global_position_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/vehicle__global__position_8h_source.html#l00053">vehicle_global_position.h:53</a></div></div>
<div class="ttc" id="structcpuload__s_html"><div class="ttname"><a href="../../d7/dbb/structcpuload__s.html">cpuload_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dfb/build_2doxygen_2u_o_r_b_2topics_2cpuload_8h_source.html#l00051">cpuload.h:51</a></div></div>
<div class="ttc" id="structmission__result__s_html"><div class="ttname"><a href="../../d5/dd1/structmission__result__s.html">mission_result_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0e/mission__result_8h_source.html#l00054">mission_result.h:54</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a00d869b19f4893dfdffbbc156fc3202b"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a00d869b19f4893dfdffbbc156fc3202b">PRINT_MODE_REJECT_INTERVAL</a></div><div class="ttdeci">static constexpr uint64_t PRINT_MODE_REJECT_INTERVAL</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00133">Commander.cpp:133</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_ae886d0e0606a4c10194b38789b30ba4e"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#ae886d0e0606a4c10194b38789b30ba4e">vehicle_command_s::source_system</a></div><div class="ttdeci">uint8_t source_system</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00159">vehicle_command.h:159</a></div></div>
<div class="ttc" id="hysteresis_8h_html"><div class="ttname"><a href="../../d4/dad/hysteresis_8h.html">hysteresis.h</a></div><div class="ttdoc">Hysteresis of a boolean value. </div></div>
<div class="ttc" id="u_o_r_b_8h_html_a2f52ae536a2c0afd5c4e45e87c7cb522"><div class="ttname"><a href="../../db/dd6/u_o_r_b_8h.html#a2f52ae536a2c0afd5c4e45e87c7cb522">main_state_t</a></div><div class="ttdeci">uint8_t main_state_t</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/u_o_r_b_8h_source.html#l00258">uORB.h:258</a></div></div>
<div class="ttc" id="aerocore2_2init_8c_html_a8c948cf27b7a7d6bdd33b42e23bca938"><div class="ttname"><a href="../../d1/d3d/aerocore2_2init_8c.html#a8c948cf27b7a7d6bdd33b42e23bca938">led_on</a></div><div class="ttdeci">void led_on(int led)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/def/aerocore2_2led_8c_source.html#l00092">led.c:92</a></div></div>
<div class="ttc" id="structhome__position__s_html_a6cccfd19ff9b7e8075d8c14ab485ac63"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a6cccfd19ff9b7e8075d8c14ab485ac63">home_position_s::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00057">home_position.h:57</a></div></div>
<div class="ttc" id="structbattery__status__s_html"><div class="ttname"><a href="../../d0/d5c/structbattery__status__s.html">battery_status_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dc1/battery__status_8h_source.html#l00056">battery_status.h:56</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_a4a1ffaa0862d627a54c57bc8cb6d3929"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#a4a1ffaa0862d627a54c57bc8cb6d3929">vehicle_command_s::param3</a></div><div class="ttdeci">float param3</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00153">vehicle_command.h:153</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a3d4469acb69130e594504c604825d2d6"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a3d4469acb69130e594504c604825d2d6">arm_requirements</a></div><div class="ttdeci">static uint8_t arm_requirements</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00180">Commander.cpp:180</a></div></div>
<div class="ttc" id="class_commander_html_af1cf6dceb2225f61664e375a342d98ba"><div class="ttname"><a href="../../d3/dc6/class_commander.html#af1cf6dceb2225f61664e375a342d98ba">Commander::check_valid</a></div><div class="ttdeci">void check_valid(const hrt_abstime &amp;timestamp, const hrt_abstime &amp;timeout, const bool valid_in, bool *valid_out, bool *changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l02658">Commander.cpp:2658</a></div></div>
<div class="ttc" id="classsystemlib_1_1_hysteresis_html_ab6beddd49f853bc44d352bff928944fa"><div class="ttname"><a href="../../de/da3/classsystemlib_1_1_hysteresis.html#ab6beddd49f853bc44d352bff928944fa">systemlib::Hysteresis::set_hysteresis_time_from</a></div><div class="ttdeci">void set_hysteresis_time_from(const bool from_state, const hrt_abstime new_hysteresis_time_us)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dad/hysteresis_8h_source.html#l00063">hysteresis.h:63</a></div></div>
<div class="ttc" id="state__machine__helper_8cpp_html_ad29324d14c22f8565991bcb678368db2"><div class="ttname"><a href="../../df/d25/state__machine__helper_8cpp.html#ad29324d14c22f8565991bcb678368db2">set_nav_state</a></div><div class="ttdeci">bool set_nav_state(vehicle_status_s *status, actuator_armed_s *armed, commander_state_s *internal_state, orb_advert_t *mavlink_log_pub, const link_loss_actions_t data_link_loss_act, const bool mission_finished, const bool stay_in_failsafe, const vehicle_status_flags_s &amp;status_flags, bool landed, const link_loss_actions_t rc_loss_act, const int offb_loss_act, const int offb_loss_rc_act, const int posctl_nav_loss_act)</div><div class="ttdoc">Check failsafe and main status and set navigation status for navigator accordingly. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d25/state__machine__helper_8cpp_source.html#l00445">state_machine_helper.cpp:445</a></div></div>
<div class="ttc" id="circuit__breaker_8h_html_a13dc33b8da38ffdd4d2e41355536e356"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html#a13dc33b8da38ffdd4d2e41355536e356">CBRK_GPSFAIL_KEY</a></div><div class="ttdeci">#define CBRK_GPSFAIL_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd4/circuit__breaker_8h_source.html#l00058">circuit_breaker.h:58</a></div></div>
<div class="ttc" id="state__machine__helper_8cpp_html_ac8732d75f16faf5917ec531ad9dc2856"><div class="ttname"><a href="../../df/d25/state__machine__helper_8cpp.html#ac8732d75f16faf5917ec531ad9dc2856">prearm_check</a></div><div class="ttdeci">bool prearm_check(orb_advert_t *mavlink_log_pub, const vehicle_status_flags_s &amp;status_flags, const battery_status_s &amp;battery, const safety_s &amp;safety, const uint8_t arm_requirements, const hrt_abstime &amp;time_since_boot)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d25/state__machine__helper_8cpp_source.html#l00920">state_machine_helper.cpp:920</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a305f75480edf19f6dccc6ea8bf7c46d5"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a305f75480edf19f6dccc6ea8bf7c46d5">rgbled_set_color_and_mode</a></div><div class="ttdeci">void rgbled_set_color_and_mode(uint8_t color, uint8_t mode, uint8_t blinks, uint8_t prio)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00336">commander_helper.cpp:336</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_a63efacb8a96b64f975496cb06b9636d5"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#a63efacb8a96b64f975496cb06b9636d5">vehicle_command_s::param4</a></div><div class="ttdeci">float param4</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00154">vehicle_command.h:154</a></div></div>
<div class="ttc" id="vehicle__command__ack_8h_html"><div class="ttname"><a href="../../db/d2e/vehicle__command__ack_8h.html">vehicle_command_ack.h</a></div></div>
<div class="ttc" id="classu_o_r_b_1_1_subscription_html_a1f7f1bd26da7cc8d23bbbb1a278f742f"><div class="ttname"><a href="../../d0/d65/classu_o_r_b_1_1_subscription.html#a1f7f1bd26da7cc8d23bbbb1a278f742f">uORB::Subscription::update</a></div><div class="ttdeci">bool update() override</div><div class="ttdoc">Create an update function that uses the embedded struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d2a/_subscription_8hpp_source.html#l00171">Subscription.hpp:171</a></div></div>
<div class="ttc" id="structtelemetry__status__s_html_a9240e83bb480acd0dd3f984db3703314"><div class="ttname"><a href="../../dc/dda/structtelemetry__status__s.html#a9240e83bb480acd0dd3f984db3703314">telemetry_status_s::type</a></div><div class="ttdeci">uint8_t type</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/telemetry__status_8h_source.html#l00064">telemetry_status.h:64</a></div></div>
<div class="ttc" id="circuit__breaker_8h_html_af35d5fdcf430edeb6a2e622154c0ef9d"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html#af35d5fdcf430edeb6a2e622154c0ef9d">CBRK_USB_CHK_KEY</a></div><div class="ttdeci">#define CBRK_USB_CHK_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd4/circuit__breaker_8h_source.html#l00059">circuit_breaker.h:59</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_ab7e004388fbc3c6caad2379ecf9cd846"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#ab7e004388fbc3c6caad2379ecf9cd846">vehicle_local_position_s::yaw</a></div><div class="ttdeci">float yaw</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00071">vehicle_local_position.h:71</a></div></div>
<div class="ttc" id="structvtol__vehicle__status__s_html_ac693321b0d448d89bc3405f42c0aca25"><div class="ttname"><a href="../../d4/d41/structvtol__vehicle__status__s.html#ac693321b0d448d89bc3405f42c0aca25">vtol_vehicle_status_s::vtol_in_rw_mode</a></div><div class="ttdeci">bool vtol_in_rw_mode</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d75/vtol__vehicle__status_8h_source.html#l00059">vtol_vehicle_status.h:59</a></div></div>
<div class="ttc" id="structvehicle__control__mode__s_html_a7a4fd47211f9675e4dd64f238b82834f"><div class="ttname"><a href="../../d3/d52/structvehicle__control__mode__s.html#a7a4fd47211f9675e4dd64f238b82834f">vehicle_control_mode_s::flag_control_position_enabled</a></div><div class="ttdeci">bool flag_control_position_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d30/vehicle__control__mode_8h_source.html#l00066">vehicle_control_mode.h:66</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_ab15c816845decd002c45d1b5b4791c75"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#ab15c816845decd002c45d1b5b4791c75">manual_control_setpoint_s::acro_switch</a></div><div class="ttdeci">uint8_t acro_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00086">manual_control_setpoint.h:86</a></div></div>
<div class="ttc" id="param_8c_html_ac0eb17a3cb026fd36cc681b5ef762531"><div class="ttname"><a href="../../d9/da5/param_8c.html#ac0eb17a3cb026fd36cc681b5ef762531">param_find</a></div><div class="ttdeci">param_t param_find(const char *name)</div><div class="ttdoc">Look up a parameter by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da5/param_8c_source.html#l00371">param.c:371</a></div></div>
<div class="ttc" id="vehicle__global__position_8h_html"><div class="ttname"><a href="../../d6/d55/vehicle__global__position_8h.html">vehicle_global_position.h</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_aa5d61964104476edb329ee6dee4125d2aa74de9e199a8e8a1000097f7f5fc3cde"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#aa5d61964104476edb329ee6dee4125d2aa74de9e199a8e8a1000097f7f5fc3cde">PX4_CUSTOM_SUB_MODE_AUTO_PRECLAND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00066">px4_custom_mode.h:66</a></div></div>
<div class="ttc" id="esc__calibration_8h_html"><div class="ttname"><a href="../../d1/d14/esc__calibration_8h.html">esc_calibration.h</a></div><div class="ttdoc">Definition of esc calibration. </div></div>
<div class="ttc" id="structactuator__armed__s_html_af8c77c6ad99b1b28aea8bdade01d5b44"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#af8c77c6ad99b1b28aea8bdade01d5b44">actuator_armed_s::force_failsafe</a></div><div class="ttdeci">bool force_failsafe</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00060">actuator_armed.h:60</a></div></div>
<div class="ttc" id="build_2doxygen_2u_o_r_b_2topics_2cpuload_8h_html"><div class="ttname"><a href="../../d3/dfb/build_2doxygen_2u_o_r_b_2topics_2cpuload_8h.html">cpuload.h</a></div></div>
<div class="ttc" id="class_commander_html_a41dfb7eb8f0d7af2fba709f5006b3ec2"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a41dfb7eb8f0d7af2fba709f5006b3ec2">Commander::POSVEL_PROBATION_MAX</a></div><div class="ttdeci">const int64_t POSVEL_PROBATION_MAX</div><div class="ttdoc">maximum probation duration (usec) </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00111">Commander.hpp:111</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a7bf26316cc590a9f16bd15abf4469870"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a7bf26316cc590a9f16bd15abf4469870">vehicle_status_flags_s::circuit_breaker_flight_termination_disabled</a></div><div class="ttdeci">bool circuit_breaker_flight_termination_disabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00069">vehicle_status_flags.h:69</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a45d36e6d933a09e22156f39017eb4892"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a45d36e6d933a09e22156f39017eb4892">vehicle_local_position_s::epv</a></div><div class="ttdeci">float epv</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00076">vehicle_local_position.h:76</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a90487f5880f298a4be4208abcbf46ec9"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a90487f5880f298a4be4208abcbf46ec9">vehicle_status_flags_s::offboard_control_set_by_command</a></div><div class="ttdeci">bool offboard_control_set_by_command</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00074">vehicle_status_flags.h:74</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a4b80590dd1db81d27e827b8707bd6e07"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a4b80590dd1db81d27e827b8707bd6e07">_eph_threshold_adj</a></div><div class="ttdeci">static float _eph_threshold_adj</div><div class="ttdoc">maximum allowable horizontal position uncertainty after adjustment for flight condition ...</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00186">Commander.cpp:186</a></div></div>
<div class="ttc" id="structvehicle__global__position__s_html_a2d59429010e175af866935d9ad749d45"><div class="ttname"><a href="../../da/dcb/structvehicle__global__position__s.html#a2d59429010e175af866935d9ad749d45">vehicle_global_position_s::epv</a></div><div class="ttdeci">float epv</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/vehicle__global__position_8h_source.html#l00063">vehicle_global_position.h:63</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a7ccb4c5db7dd218912ddf900036ef95a"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a7ccb4c5db7dd218912ddf900036ef95a">main_state_before_rtl</a></div><div class="ttdeci">static uint8_t main_state_before_rtl</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00164">Commander.cpp:164</a></div></div>
<div class="ttc" id="param_8c_html_a803f9e8aef28899d6311b39e482584eb"><div class="ttname"><a href="../../d9/da5/param_8c.html#a803f9e8aef28899d6311b39e482584eb">param_set_no_notification</a></div><div class="ttdeci">int param_set_no_notification(param_t param, const void *val)</div><div class="ttdoc">Set the value of a parameter, but do not notify the system about the change. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da5/param_8c_source.html#l00809">param.c:809</a></div></div>
<div class="ttc" id="geo_8cpp_html_a5ea48079b8cf05b1b7f7d2b96e07b7f3"><div class="ttname"><a href="../../d7/d09/geo_8cpp.html#a5ea48079b8cf05b1b7f7d2b96e07b7f3">map_projection_project</a></div><div class="ttdeci">int map_projection_project(const struct map_projection_reference_s *ref, double lat, double lon, float *x, float *y)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d09/geo_8cpp_source.html#l00132">geo.cpp:132</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_acf14f5fa1366e5fd4b23c9f708abfc46"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#acf14f5fa1366e5fd4b23c9f708abfc46">vehicle_status_s::data_link_lost</a></div><div class="ttdeci">bool data_link_lost</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00105">vehicle_status.h:105</a></div></div>
<div class="ttc" id="rc__calibration_8h_html"><div class="ttname"><a href="../../d3/dc5/rc__calibration_8h.html">rc_calibration.h</a></div><div class="ttdoc">Remote Control calibration routine. </div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_aae8f00ee97a82f182912b95d4b017df5"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#aae8f00ee97a82f182912b95d4b017df5">vehicle_status_flags_s::condition_calibration_enabled</a></div><div class="ttdeci">bool condition_calibration_enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00054">vehicle_status_flags.h:54</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_adaecaa390e38921923f07353069200d0"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#adaecaa390e38921923f07353069200d0">vehicle_status_s::system_id</a></div><div class="ttdeci">uint8_t system_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00096">vehicle_status.h:96</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_a29b31278909062127ba89245a8182706"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#a29b31278909062127ba89245a8182706">orb_check</a></div><div class="ttdeci">int orb_check(int handle, bool *updated)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00095">uORB.cpp:95</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a11781677749dd4c7b3306165a9db7235"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a11781677749dd4c7b3306165a9db7235">control_status_leds</a></div><div class="ttdeci">void control_status_leds(vehicle_status_s *status_local, const actuator_armed_s *actuator_armed, bool changed, battery_status_s *battery_local, const cpuload_s *cpuload_local)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l02670">Commander.cpp:2670</a></div></div>
<div class="ttc" id="structestimator__status__s_html_aa95b821a48b7903642e86c6299a2490b"><div class="ttname"><a href="../../d3/dca/structestimator__status__s.html#aa95b821a48b7903642e86c6299a2490b">estimator_status_s::pos_test_ratio</a></div><div class="ttdeci">float pos_test_ratio</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d3d/estimator__status_8h_source.html#l00094">estimator_status.h:94</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_a2c71c73d77220ff8faf2cb8eb7509e66"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#a2c71c73d77220ff8faf2cb8eb7509e66">orb_subscribe_multi</a></div><div class="ttdeci">int orb_subscribe_multi(const struct orb_metadata *meta, unsigned instance)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00080">uORB.cpp:80</a></div></div>
<div class="ttc" id="structmission__s_html_a18927047aee87dc848d11106607cb0f5"><div class="ttname"><a href="../../db/d74/structmission__s.html#a18927047aee87dc848d11106607cb0f5">mission_s::current_seq</a></div><div class="ttdeci">int32_t current_seq</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d02/build_2doxygen_2u_o_r_b_2topics_2mission_8h_source.html#l00054">mission.h:54</a></div></div>
<div class="ttc" id="accelerometer__calibration_8h_html"><div class="ttname"><a href="../../d0/db5/accelerometer__calibration_8h.html">accelerometer_calibration.h</a></div><div class="ttdoc">Definition of accelerometer calibration. </div></div>
<div class="ttc" id="airspeed__calibration_8h_html"><div class="ttname"><a href="../../d0/dc9/airspeed__calibration_8h.html">airspeed_calibration.h</a></div></div>
<div class="ttc" id="structhome__position__s_html_a17f2ace87bd73b3f2c6593e350c1519b"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a17f2ace87bd73b3f2c6593e350c1519b">home_position_s::yaw</a></div><div class="ttdeci">float yaw</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00060">home_position.h:60</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_a0b788807aa3def3dc8db87a124c0f552"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a0b788807aa3def3dc8db87a124c0f552">vehicle_status_s::rc_input_mode</a></div><div class="ttdeci">uint8_t rc_input_mode</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00104">vehicle_status.h:104</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a3a559214533089fa9b2ef7bfc5540eb2"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a3a559214533089fa9b2ef7bfc5540eb2">last_print_mode_reject_time</a></div><div class="ttdeci">static uint64_t last_print_mode_reject_time</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00148">Commander.cpp:148</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651a82ba96ba45e14bd6e8f11def4302025b"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a82ba96ba45e14bd6e8f11def4302025b">PX4_CUSTOM_MAIN_MODE_RATTITUDE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00053">px4_custom_mode.h:53</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html">px4_custom_mode.h</a></div><div class="ttdoc">PX4 custom flight modes. </div></div>
<div class="ttc" id="structvehicle__status__s_html_a6933ad99aa1ab7be2ca6bac09268fe7d"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#a6933ad99aa1ab7be2ca6bac09268fe7d">vehicle_status_s::is_vtol</a></div><div class="ttdeci">bool is_vtol</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00099">vehicle_status.h:99</a></div></div>
<div class="ttc" id="u_o_r_b_8h_html_a8c09e8f28a090e8cae61e10d627f102a"><div class="ttname"><a href="../../db/dd6/u_o_r_b_8h.html#a8c09e8f28a090e8cae61e10d627f102a">ORB_MULTI_MAX_INSTANCES</a></div><div class="ttdeci">#define ORB_MULTI_MAX_INSTANCES</div><div class="ttdoc">Maximum number of multi topic instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/u_o_r_b_8h_source.html#l00062">uORB.h:62</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html">manual_control_setpoint_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00068">manual_control_setpoint.h:68</a></div></div>
<div class="ttc" id="u_o_r_b_8h_html_a6728c9b87db5be26a1fca643136f77d6"><div class="ttname"><a href="../../db/dd6/u_o_r_b_8h.html#a6728c9b87db5be26a1fca643136f77d6">hil_state_t</a></div><div class="ttdeci">uint8_t hil_state_t</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/u_o_r_b_8h_source.html#l00259">uORB.h:259</a></div></div>
<div class="ttc" id="subsystem__info_8h_html"><div class="ttname"><a href="../../dc/d50/subsystem__info_8h.html">subsystem_info.h</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651ae33a097de52d1ef791d7e847ca4bdc13"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651ae33a097de52d1ef791d7e847ca4bdc13">PX4_CUSTOM_MAIN_MODE_ALTCTL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00047">px4_custom_mode.h:47</a></div></div>
<div class="ttc" id="_commander_8cpp_html_aa578d8384f0c48d5814fe5be88c4b3a9"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#aa578d8384f0c48d5814fe5be88c4b3a9">power_button_state_pub</a></div><div class="ttdeci">static orb_advert_t power_button_state_pub</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00138">Commander.cpp:138</a></div></div>
<div class="ttc" id="structtelemetry__status__s_html_ad565cfa34c3921393e5425bbf153d749"><div class="ttname"><a href="../../dc/dda/structtelemetry__status__s.html#ad565cfa34c3921393e5425bbf153d749">telemetry_status_s::heartbeat_time</a></div><div class="ttdeci">uint64_t heartbeat_time</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d33/telemetry__status_8h_source.html#l00060">telemetry_status.h:60</a></div></div>
<div class="ttc" id="class_commander_html_aadc83535d40152c2a955887915ef60d6"><div class="ttname"><a href="../../d3/dc6/class_commander.html#aadc83535d40152c2a955887915ef60d6">Commander::set_main_state_rc</a></div><div class="ttdeci">transition_result_t set_main_state_rc(const vehicle_status_s &amp;status, bool *changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l02821">Commander.cpp:2821</a></div></div>
<div class="ttc" id="class_commander_html_a31c2d7d8ee9793a82b291658016a3f29"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a31c2d7d8ee9793a82b291658016a3f29">Commander::preflight_check</a></div><div class="ttdeci">static bool preflight_check(bool report)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03902">Commander.cpp:3902</a></div></div>
<div class="ttc" id="src_2modules_2systemlib_2mavlink__log_8h_html_ad55e944bb2c25f461468408bb8e10856"><div class="ttname"><a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h.html#ad55e944bb2c25f461468408bb8e10856">mavlink_log_emergency</a></div><div class="ttdeci">#define mavlink_log_emergency(_pub, _text,...)</div><div class="ttdoc">Send a mavlink emergency message and print to console. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dac/src_2modules_2systemlib_2mavlink__log_8h_source.html#l00089">mavlink_log.h:89</a></div></div>
<div class="ttc" id="arm__auth_8h_html"><div class="ttname"><a href="../../d6/dda/arm__auth_8h.html">arm_auth.h</a></div></div>
<div class="ttc" id="u_o_r_b_8cpp_html_a1c2ecd4919751835265681c212badaf4"><div class="ttname"><a href="../../d9/d97/u_o_r_b_8cpp.html#a1c2ecd4919751835265681c212badaf4">orb_unadvertise</a></div><div class="ttdeci">int orb_unadvertise(orb_advert_t handle)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d97/u_o_r_b_8cpp_source.html#l00065">uORB.cpp:65</a></div></div>
<div class="ttc" id="vehicle__command_8h_html"><div class="ttname"><a href="../../d7/d94/vehicle__command_8h.html">vehicle_command.h</a></div></div>
<div class="ttc" id="_commander_8cpp_html_aab672fcf477e5224043c668ea3981b81"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#aab672fcf477e5224043c668ea3981b81">cpuload</a></div><div class="ttdeci">static struct cpuload_s cpuload</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00171">Commander.cpp:171</a></div></div>
<div class="ttc" id="_commander_8cpp_html_abbddddc6e2c6951b59f612c852b13467"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#abbddddc6e2c6951b59f612c852b13467">set_control_mode</a></div><div class="ttdeci">void set_control_mode()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03273">Commander.cpp:3273</a></div></div>
<div class="ttc" id="test__mixer_8cpp_html_af32da262f1b7e3453e38a3916d74a937"><div class="ttname"><a href="../../da/d56/test__mixer_8cpp.html#af32da262f1b7e3453e38a3916d74a937">actuator_controls</a></div><div class="ttdeci">static float actuator_controls[output_max]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d56/test__mixer_8cpp_source.html#l00064">test_mixer.cpp:64</a></div></div>
<div class="ttc" id="structoffboard__control__mode__s_html_ac908a1835dfd9330d6e3394ec4a96bae"><div class="ttname"><a href="../../da/d9d/structoffboard__control__mode__s.html#ac908a1835dfd9330d6e3394ec4a96bae">offboard_control_mode_s::ignore_acceleration_force</a></div><div class="ttdeci">bool ignore_acceleration_force</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/offboard__control__mode_8h_source.html#l00059">offboard_control_mode.h:59</a></div></div>
<div class="ttc" id="structactuator__controls__s_html_a79704ffb6e8e15bfb0e0d82538d7b0e2"><div class="ttname"><a href="../../de/d27/structactuator__controls__s.html#a79704ffb6e8e15bfb0e0d82538d7b0e2">actuator_controls_s::control</a></div><div class="ttdeci">float control[8]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d46/actuator__controls_8h_source.html#l00067">actuator_controls.h:67</a></div></div>
<div class="ttc" id="navio__rgbled_2test_2main_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="../../de/d33/navio__rgbled_2test_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d33/navio__rgbled_2test_2main_8cpp_source.html#l00036">main.cpp:36</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a02fe8d41494860e12091f8bc69476fd3"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a02fe8d41494860e12091f8bc69476fd3">vehicle_status_flags_s::circuit_breaker_engaged_airspd_check</a></div><div class="ttdeci">bool circuit_breaker_engaged_airspd_check</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00066">vehicle_status_flags.h:66</a></div></div>
<div class="ttc" id="structcommander__state__s_html_aef16dba36fab4f6ab21e6ca392ba7702"><div class="ttname"><a href="../../d4/d88/structcommander__state__s.html#aef16dba36fab4f6ab21e6ca392ba7702">commander_state_s::main_state</a></div><div class="ttdeci">uint8_t main_state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/commander__state_8h_source.html#l00069">commander_state.h:69</a></div></div>
<div class="ttc" id="home__position_8h_html"><div class="ttname"><a href="../../d7/df9/home__position_8h.html">home_position.h</a></div></div>
<div class="ttc" id="state__machine__helper_8cpp_html_a12cdf6d677418283df9b76837a479420"><div class="ttname"><a href="../../df/d25/state__machine__helper_8cpp.html#a12cdf6d677418283df9b76837a479420">main_state_transition</a></div><div class="ttdeci">transition_result_t main_state_transition(const vehicle_status_s &amp;status, const main_state_t new_main_state, const vehicle_status_flags_s &amp;status_flags, commander_state_s *internal_state)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d25/state__machine__helper_8cpp_source.html#l00244">state_machine_helper.cpp:244</a></div></div>
<div class="ttc" id="namespace_preflight_html_a40c1bbeaadf96c1bd47cff1babc0f159"><div class="ttname"><a href="../../d4/d96/namespace_preflight.html#a40c1bbeaadf96c1bd47cff1babc0f159">Preflight::preflightCheck</a></div><div class="ttdeci">bool preflightCheck(orb_advert_t *mavlink_log_pub, vehicle_status_s &amp;status, vehicle_status_flags_s &amp;status_flags, bool checkGNSS, bool reportFailures, bool prearm, const hrt_abstime &amp;time_since_boot)</div><div class="ttdoc">Runs a preflight check on all sensors to see if they are properly calibrated and healthy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d24/_preflight_check_8cpp_source.html#l00654">PreflightCheck.cpp:654</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a69dd696400330312a7b07eeaca2b61b5"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a69dd696400330312a7b07eeaca2b61b5">control_mode</a></div><div class="ttdeci">static struct vehicle_control_mode_s control_mode</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00158">Commander.cpp:158</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a23d724cfb7bf7c731ef66063dbe13cd9"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a23d724cfb7bf7c731ef66063dbe13cd9">thread_running</a></div><div class="ttdeci">static volatile bool thread_running</div><div class="ttdoc">daemon status flag </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00142">Commander.cpp:142</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a4a95c9c57e780fd2be653c6031104c96"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a4a95c9c57e780fd2be653c6031104c96">manual_control_setpoint_s::return_switch</a></div><div class="ttdeci">uint8_t return_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00082">manual_control_setpoint.h:82</a></div></div>
<div class="ttc" id="structoffboard__control__mode__s_html_a2a24b25049165a1cdab8f39c953290fc"><div class="ttname"><a href="../../da/d9d/structoffboard__control__mode__s.html#a2a24b25049165a1cdab8f39c953290fc">offboard_control_mode_s::ignore_position</a></div><div class="ttdeci">bool ignore_position</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7c/offboard__control__mode_8h_source.html#l00057">offboard_control_mode.h:57</a></div></div>
<div class="ttc" id="class_commander_html_a9a354bcb8a90b2090e15d1ae25894a34"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a9a354bcb8a90b2090e15d1ae25894a34">Commander::_lpos_probation_time_us</a></div><div class="ttdeci">hrt_abstime _lpos_probation_time_us</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00119">Commander.hpp:119</a></div></div>
<div class="ttc" id="dataman_8cpp_html_a9d8d206c43b9939cfd6f5d3aed46983b"><div class="ttname"><a href="../../d6/d47/dataman_8cpp.html#a9d8d206c43b9939cfd6f5d3aed46983b">dm_write</a></div><div class="ttdeci">__EXPORT ssize_t dm_write(dm_item_t item, unsigned index, dm_persitence_t persistence, const void *buf, size_t count)</div><div class="ttdoc">Write to the data manager file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/dataman_8cpp_source.html#l01083">dataman.cpp:1083</a></div></div>
<div class="ttc" id="circuit__breaker_8h_html_a7aa936101a7f04927540fd03ee90fa50"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html#a7aa936101a7f04927540fd03ee90fa50">CBRK_ENGINEFAIL_KEY</a></div><div class="ttdeci">#define CBRK_ENGINEFAIL_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd4/circuit__breaker_8h_source.html#l00057">circuit_breaker.h:57</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a3856cb2922ca5879cf4039f78b482df6"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a3856cb2922ca5879cf4039f78b482df6">buzzer_init</a></div><div class="ttdeci">int buzzer_init()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00122">commander_helper.cpp:122</a></div></div>
<div class="ttc" id="class_module_params_html"><div class="ttname"><a href="../../db/db3/class_module_params.html">ModuleParams</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd2/px4__module__params_8h_source.html#l00046">px4_module_params.h:46</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a544045618786171c0de95d5d3ee6f4b3"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a544045618786171c0de95d5d3ee6f4b3">vehicle_local_position_s::z</a></div><div class="ttdeci">float z</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00059">vehicle_local_position.h:59</a></div></div>
<div class="ttc" id="dataman_8h_html_a3aa83981a3a5ad8b8fd5a6dd657cbb2bab2d66c95797064a2803f282d203b0048"><div class="ttname"><a href="../../db/d6e/dataman_8h.html#a3aa83981a3a5ad8b8fd5a6dd657cbb2bab2d66c95797064a2803f282d203b0048">DM_PERSIST_POWER_ON_RESET</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6e/dataman_8h_source.html#l00085">dataman.h:85</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651a83e626f323c886037e137a1547a7f485"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a83e626f323c886037e137a1547a7f485">PX4_CUSTOM_MAIN_MODE_STABILIZED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00052">px4_custom_mode.h:52</a></div></div>
<div class="ttc" id="parameter__update_8h_html"><div class="ttname"><a href="../../de/d76/parameter__update_8h.html">parameter_update.h</a></div></div>
<div class="ttc" id="uavcan__main_8cpp_html_aba51915c87d64af47fb1cc59348961c9"><div class="ttname"><a href="../../d7/de6/uavcan__main_8cpp.html#aba51915c87d64af47fb1cc59348961c9">OK</a></div><div class="ttdeci">#define OK</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/de6/uavcan__main_8cpp_source.html#l00072">uavcan_main.cpp:72</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_a9b67102131d452cb37c2b5c20eeaa25a"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#a9b67102131d452cb37c2b5c20eeaa25a">vehicle_local_position_s::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00057">vehicle_local_position.h:57</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_aa30c2b5c06210fdd374c5ad97475b550"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#aa30c2b5c06210fdd374c5ad97475b550">manual_control_setpoint_s::r</a></div><div class="ttdeci">float r</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00074">manual_control_setpoint.h:74</a></div></div>
<div class="ttc" id="structhome__position__s_html_a01b9c594d162ddd0ea3a9d3184095599"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a01b9c594d162ddd0ea3a9d3184095599">home_position_s::z</a></div><div class="ttdeci">float z</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00059">home_position.h:59</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651a0c5569ce5df2d68fbe8794ce3e50528a"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651a0c5569ce5df2d68fbe8794ce3e50528a">PX4_CUSTOM_MAIN_MODE_ACRO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00050">px4_custom_mode.h:50</a></div></div>
<div class="ttc" id="_commander_8cpp_html_af618a6b9c76079c11172b6c0c7bd326c"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#af618a6b9c76079c11172b6c0c7bd326c">_last_sp_man_arm_switch</a></div><div class="ttdeci">static uint8_t _last_sp_man_arm_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00168">Commander.cpp:168</a></div></div>
<div class="ttc" id="shutdown_8cpp_html_ac973512abb1ee1d0cacd5df9e1f68b6a"><div class="ttname"><a href="../../df/d04/shutdown_8cpp.html#ac973512abb1ee1d0cacd5df9e1f68b6a">px4_shutdown_request</a></div><div class="ttdeci">int px4_shutdown_request(bool reboot, bool to_bootloader)</div><div class="ttdoc">Request the system to shut down or reboot. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d04/shutdown_8cpp_source.html#l00205">shutdown.cpp:205</a></div></div>
<div class="ttc" id="_commander_8hpp_html"><div class="ttname"><a href="../../d8/d55/_commander_8hpp.html">Commander.hpp</a></div></div>
<div class="ttc" id="_preflight_check_8h_html"><div class="ttname"><a href="../../d7/da8/_preflight_check_8h.html">PreflightCheck.h</a></div><div class="ttdoc">Preflight check for main system components. </div></div>
<div class="ttc" id="structvehicle__command__s_html_a7a66aafb32c26d7245a7d1e1106045e0"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#a7a66aafb32c26d7245a7d1e1106045e0">vehicle_command_s::param5</a></div><div class="ttdeci">double param5</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00149">vehicle_command.h:149</a></div></div>
<div class="ttc" id="circuit__breaker_8h_html_a9e0fc82dcdfde650600169450a6497c1"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html#a9e0fc82dcdfde650600169450a6497c1">CBRK_FLIGHTTERM_KEY</a></div><div class="ttdeci">#define CBRK_FLIGHTTERM_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd4/circuit__breaker_8h_source.html#l00056">circuit_breaker.h:56</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a64e7b89a4779519af7a79d8e9293ca34"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a64e7b89a4779519af7a79d8e9293ca34">_last_sp_man</a></div><div class="ttdeci">static manual_control_setpoint_s _last_sp_man</div><div class="ttdoc">the manual control setpoint valid at the last mode switch </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00167">Commander.cpp:167</a></div></div>
<div class="ttc" id="health__flag__helper_8h_html"><div class="ttname"><a href="../../dc/d63/health__flag__helper_8h.html">health_flag_helper.h</a></div><div class="ttdoc">Contains helper functions to efficiently set the system health flags from commander and preflight che...</div></div>
<div class="ttc" id="_commander_8cpp_html_a7d4ab27a470c0ef9f9f693631ab1ff22"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a7d4ab27a470c0ef9f9f693631ab1ff22">send_vehicle_command</a></div><div class="ttdeci">static bool send_vehicle_command(uint16_t cmd, float param1=NAN, float param2=NAN)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00265">Commander.cpp:265</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_abbb4baad7f6410ef1f2ce1ba5841f00a"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#abbb4baad7f6410ef1f2ce1ba5841f00a">vehicle_command_s::param2</a></div><div class="ttdeci">float param2</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00152">vehicle_command.h:152</a></div></div>
<div class="ttc" id="health__flag__helper_8cpp_html_a7473f8ce7686f32763799b3b393d475f"><div class="ttname"><a href="../../d0/dc0/health__flag__helper_8cpp.html#a7473f8ce7686f32763799b3b393d475f">set_health_flags_healthy</a></div><div class="ttdeci">void set_health_flags_healthy(uint64_t subsystem_type, bool healthy, vehicle_status_s &amp;status)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dc0/health__flag__helper_8cpp_source.html#l00076">health_flag_helper.cpp:76</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694eda5afe0489aff4ffba0499dd0cdea7b9e0">TRANSITION_DENIED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00056">state_machine_helper.h:56</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73ec72898aee859e97d53a79b7492539af8cefe7a4cc03a758c7209dd6d721b79"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539af8cefe7a4cc03a758c7209dd6d721b79">ARM_REQ_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00072">state_machine_helper.h:72</a></div></div>
<div class="ttc" id="px4__custom__mode_8h_html_a5431c9e1ea20b61a861676459a3e4651aaac23d3467b1659a528e372e6873064c"><div class="ttname"><a href="../../dd/d20/px4__custom__mode_8h.html#a5431c9e1ea20b61a861676459a3e4651aaac23d3467b1659a528e372e6873064c">PX4_CUSTOM_MAIN_MODE_AUTO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d20/px4__custom__mode_8h_source.html#l00049">px4_custom_mode.h:49</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a11ce1287b0d3d546b347ed09a43462fc"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a11ce1287b0d3d546b347ed09a43462fc">vehicle_status_flags_s::condition_system_hotplug_timeout</a></div><div class="ttdeci">bool condition_system_hotplug_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00056">vehicle_status_flags.h:56</a></div></div>
<div class="ttc" id="class_commander_html_af910bab86d61393dae3f0786476e6df9"><div class="ttname"><a href="../../d3/dc6/class_commander.html#af910bab86d61393dae3f0786476e6df9">Commander::_last_lvel_fail_time_us</a></div><div class="ttdeci">hrt_abstime _last_lvel_fail_time_us</div><div class="ttdoc">Last time that the local velocity validity recovery check failed (usec) </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00115">Commander.hpp:115</a></div></div>
<div class="ttc" id="structcpuload__s_html_a34fee17defc29417b53aa8a32992d29d"><div class="ttname"><a href="../../d7/dbb/structcpuload__s.html#a34fee17defc29417b53aa8a32992d29d">cpuload_s::ram_usage</a></div><div class="ttdeci">float ram_usage</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dfb/build_2doxygen_2u_o_r_b_2topics_2cpuload_8h_source.html#l00055">cpuload.h:55</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73234ac9dad928080b85a4f2977694ed"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73234ac9dad928080b85a4f2977694ed">transition_result_t</a></div><div class="ttdeci">transition_result_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00055">state_machine_helper.h:55</a></div></div>
<div class="ttc" id="structvehicle__global__position__s_html_ac54e9f7030508c4633fd509e4c7ad3ff"><div class="ttname"><a href="../../da/dcb/structvehicle__global__position__s.html#ac54e9f7030508c4633fd509e4c7ad3ff">vehicle_global_position_s::lat</a></div><div class="ttdeci">double lat</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d55/vehicle__global__position_8h_source.html#l00054">vehicle_global_position.h:54</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a1691b2b3d7a262531bab73303f08a413"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a1691b2b3d7a262531bab73303f08a413">manual_control_setpoint_s::offboard_switch</a></div><div class="ttdeci">uint8_t offboard_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00087">manual_control_setpoint.h:87</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a85bd5445469c33c209c0947ec5050d67"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a85bd5445469c33c209c0947ec5050d67">set_tune</a></div><div class="ttdeci">void set_tune(int tune)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00153">commander_helper.cpp:153</a></div></div>
<div class="ttc" id="vehicle__land__detected_8h_html"><div class="ttname"><a href="../../d8/ddd/vehicle__land__detected_8h.html">vehicle_land_detected.h</a></div></div>
<div class="ttc" id="structhome__position__s_html_a719b8706b5e251c3ca85de8bb3ea46eb"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a719b8706b5e251c3ca85de8bb3ea46eb">home_position_s::lon</a></div><div class="ttdeci">double lon</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00055">home_position.h:55</a></div></div>
<div class="ttc" id="geo_8cpp_html_a0233fe4ad7352b7918faeaf7aa5d8818"><div class="ttname"><a href="../../d7/d09/geo_8cpp.html#a0233fe4ad7352b7918faeaf7aa5d8818">map_projection_init</a></div><div class="ttdeci">int map_projection_init(struct map_projection_reference_s *ref, double lat_0, double lon_0)</div><div class="ttdoc">Initializes the map transformation given by the argument and sets the timestamp to now...</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d09/geo_8cpp_source.html#l00105">geo.cpp:105</a></div></div>
<div class="ttc" id="structactuator__armed__s_html_a415b07e3247c7d8d6ccafb25681db1f0"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#a415b07e3247c7d8d6ccafb25681db1f0">actuator_armed_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00053">actuator_armed.h:53</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a160aaccd15cb7daf7d2533255c364dec"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a160aaccd15cb7daf7d2533255c364dec">vehicle_status_flags_s::condition_local_position_valid</a></div><div class="ttdeci">bool condition_local_position_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00061">vehicle_status_flags.h:61</a></div></div>
<div class="ttc" id="structvehicle__status__s_html_ac8d6d35a973defcbdd48f855ee191044"><div class="ttname"><a href="../../d8/dee/structvehicle__status__s.html#ac8d6d35a973defcbdd48f855ee191044">vehicle_status_s::in_transition_to_fw</a></div><div class="ttdeci">bool in_transition_to_fw</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da5/vehicle__status_8h_source.html#l00102">vehicle_status.h:102</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a579e6529f0ce482312a5e77ac61cb4d5"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a579e6529f0ce482312a5e77ac61cb4d5">pthread_attr_setschedparam</a></div><div class="ttdeci">int pthread_attr_setschedparam(pthread_attr_t *attr, const struct sched_param *param)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00077">stubs_posix.c:77</a></div></div>
<div class="ttc" id="classsystemlib_1_1_hysteresis_html"><div class="ttname"><a href="../../de/da3/classsystemlib_1_1_hysteresis.html">systemlib::Hysteresis</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dad/hysteresis_8h_source.html#l00049">hysteresis.h:49</a></div></div>
<div class="ttc" id="structsubsystem__info__s_html_a2b1fcc36dc57d1fa226fcc69088afc06"><div class="ttname"><a href="../../d2/d77/structsubsystem__info__s.html#a2b1fcc36dc57d1fa226fcc69088afc06">subsystem_info_s::ok</a></div><div class="ttdeci">bool ok</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d50/subsystem__info_8h_source.html#l00086">subsystem_info.h:86</a></div></div>
<div class="ttc" id="structhome__position__s_html_affca1cec624c8bcf53bced8a1fa3174e"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#affca1cec624c8bcf53bced8a1fa3174e">home_position_s::valid_alt</a></div><div class="ttdeci">bool valid_alt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00061">home_position.h:61</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_a99e267a3df97d3af511a5469c0d035fc"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#a99e267a3df97d3af511a5469c0d035fc">manual_control_setpoint_s::rattitude_switch</a></div><div class="ttdeci">uint8_t rattitude_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00083">manual_control_setpoint.h:83</a></div></div>
<div class="ttc" id="circuit__breaker_8h_html_a284617a00775c5d76d47a455d94d8af9"><div class="ttname"><a href="../../d2/dd4/circuit__breaker_8h.html#a284617a00775c5d76d47a455d94d8af9">CBRK_VELPOSERR_KEY</a></div><div class="ttdeci">#define CBRK_VELPOSERR_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd4/circuit__breaker_8h_source.html#l00060">circuit_breaker.h:60</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a812a9a455ae2ef2bb0dca4fff201a281"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a812a9a455ae2ef2bb0dca4fff201a281">pthread_attr_setstacksize</a></div><div class="ttdeci">int pthread_attr_setstacksize(pthread_attr_t *attr, size_t stacksize)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00067">stubs_posix.c:67</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_ab335c1f1cc07d57fa0b0a10af3c024f7"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#ab335c1f1cc07d57fa0b0a10af3c024f7">tune_failsafe</a></div><div class="ttdeci">void tune_failsafe(bool use_buzzer)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00248">commander_helper.cpp:248</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a4bcdbf47c17c7dcc51e9f05f5cb56d81"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a4bcdbf47c17c7dcc51e9f05f5cb56d81">pthread_attr_destroy</a></div><div class="ttdeci">int pthread_attr_destroy(pthread_attr_t *attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00091">stubs_posix.c:91</a></div></div>
<div class="ttc" id="err_8h_html_a8224a361dddd2ad59b411982e5ea746f"><div class="ttname"><a href="../../d6/d40/err_8h.html#a8224a361dddd2ad59b411982e5ea746f">warn</a></div><div class="ttdeci">#define warn(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d40/err_8h_source.html#l00094">err.h:94</a></div></div>
<div class="ttc" id="aerocore2_2init_8c_html_a051724a3dd62335291d698ff09ab262b"><div class="ttname"><a href="../../d1/d3d/aerocore2_2init_8c.html#a051724a3dd62335291d698ff09ab262b">led_off</a></div><div class="ttdeci">void led_off(int led)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/def/aerocore2_2led_8c_source.html#l00097">led.c:97</a></div></div>
<div class="ttc" id="board__common_8h_html_a5fbd4e64dbfe6a9f74421771869375b8a9947c957447b1ac8d174ae99c78f5997"><div class="ttname"><a href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8a9947c957447b1ac8d174ae99c78f5997">PWR_BUTTON_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df6/board__common_8h_source.html#l00311">board_common.h:311</a></div></div>
<div class="ttc" id="state__machine__helper_8h_html_a73ec72898aee859e97d53a79b7492539a6b89b750b7cbb3572b9f0c0e5af6af95"><div class="ttname"><a href="../../d2/de8/state__machine__helper_8h.html#a73ec72898aee859e97d53a79b7492539a6b89b750b7cbb3572b9f0c0e5af6af95">ARM_REQ_MISSION_BIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/de8/state__machine__helper_8h_source.html#l00073">state_machine_helper.h:73</a></div></div>
<div class="ttc" id="structvehicle__command__s_html"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html">vehicle_command_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00146">vehicle_command.h:146</a></div></div>
<div class="ttc" id="px4__time_8h_html"><div class="ttname"><a href="../../d3/d2d/px4__time_8h.html">px4_time.h</a></div></div>
<div class="ttc" id="structsafety__s_html_a0a18454dfbc2b49de1bfed7e4298f3cc"><div class="ttname"><a href="../../d1/d06/structsafety__s.html#a0a18454dfbc2b49de1bfed7e4298f3cc">safety_s::safety_off</a></div><div class="ttdeci">bool safety_off</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da0/safety_8h_source.html#l00055">safety.h:55</a></div></div>
<div class="ttc" id="structactuator__armed__s_html_a0c785f711e5a5a4bb0104ff5670e85a7"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html#a0c785f711e5a5a4bb0104ff5670e85a7">actuator_armed_s::soft_stop</a></div><div class="ttdeci">bool soft_stop</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00062">actuator_armed.h:62</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac0183f1af8e195266959e86793c8f8a2"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac0183f1af8e195266959e86793c8f8a2">leds_counter</a></div><div class="ttdeci">static unsigned int leds_counter</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00146">Commander.cpp:146</a></div></div>
<div class="ttc" id="airspeed__calibration_8cpp_html_a86965ddfd735f86625739ca51be885d7"><div class="ttname"><a href="../../d3/d73/airspeed__calibration_8cpp.html#a86965ddfd735f86625739ca51be885d7">do_airspeed_calibration</a></div><div class="ttdeci">int do_airspeed_calibration(orb_advert_t *mavlink_log_pub)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d73/airspeed__calibration_8cpp_source.html#l00067">airspeed_calibration.cpp:67</a></div></div>
<div class="ttc" id="namespacemath_html_a9ab5768499dc798629f31a3e785ea313"><div class="ttname"><a href="../../dd/d47/namespacemath.html#a9ab5768499dc798629f31a3e785ea313">math::constrain</a></div><div class="ttdeci">constexpr const _Tp &amp; constrain(const _Tp &amp;val, const _Tp &amp;min_val, const _Tp &amp;max_val)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d34/_limits_8hpp_source.html#l00070">Limits.hpp:70</a></div></div>
<div class="ttc" id="structactuator__armed__s_html"><div class="ttname"><a href="../../d0/d54/structactuator__armed__s.html">actuator_armed_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5d/actuator__armed_8h_source.html#l00051">actuator_armed.h:51</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a1e95efa5d45a4c40cb89f9e917913a86"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a1e95efa5d45a4c40cb89f9e917913a86">buzzer_deinit</a></div><div class="ttdeci">void buzzer_deinit()</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00139">commander_helper.cpp:139</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_a388b7a9e0e9d2e211904cb365db2155b"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#a388b7a9e0e9d2e211904cb365db2155b">vehicle_command_s::param6</a></div><div class="ttdeci">double param6</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00150">vehicle_command.h:150</a></div></div>
<div class="ttc" id="dataman_8h_html_af4d60143bf40b951e9e5c0ebd5ff60a8aec9fb8d456f6c372b1fd778e91600087"><div class="ttname"><a href="../../db/d6e/dataman_8h.html#af4d60143bf40b951e9e5c0ebd5ff60a8aec9fb8d456f6c372b1fd778e91600087">DM_KEY_MISSION_STATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6e/dataman_8h_source.html#l00056">dataman.h:56</a></div></div>
<div class="ttc" id="structvehicle__status__flags__s_html_a2b48cdd399be15b5d8a85868e07fb009"><div class="ttname"><a href="../../d1/d4b/structvehicle__status__flags__s.html#a2b48cdd399be15b5d8a85868e07fb009">vehicle_status_flags_s::rc_input_blocked</a></div><div class="ttdeci">bool rc_input_blocked</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/vehicle__status__flags_8h_source.html#l00077">vehicle_status_flags.h:77</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_acd9cafc24c99139963c3a0e699ffd811"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#acd9cafc24c99139963c3a0e699ffd811">manual_control_setpoint_s::stab_switch</a></div><div class="ttdeci">uint8_t stab_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00094">manual_control_setpoint.h:94</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_a81cc3fc9405436c7f6100259e69d18b1"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#a81cc3fc9405436c7f6100259e69d18b1">vehicle_command_s::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00148">vehicle_command.h:148</a></div></div>
<div class="ttc" id="_commander_8cpp_html_a5b71f638371b95b5cf3e0a97479c3d56"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#a5b71f638371b95b5cf3e0a97479c3d56">vtol_status</a></div><div class="ttdeci">static struct vtol_vehicle_status_s vtol_status</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00170">Commander.cpp:170</a></div></div>
<div class="ttc" id="class_commander_html_a43dcbde3ce6e1d76a4bfec4c986df5c5"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a43dcbde3ce6e1d76a4bfec4c986df5c5">Commander::_telemetry</a></div><div class="ttdeci">struct Commander::telemetry_data _telemetry[ORB_MULTI_MAX_INSTANCES]</div></div>
<div class="ttc" id="structsystem__power__s_html_abb6386885b9fd026949aa75ccb50bdda"><div class="ttname"><a href="../../d5/d64/structsystem__power__s.html#abb6386885b9fd026949aa75ccb50bdda">system_power_s::brick_valid</a></div><div class="ttdeci">uint8_t brick_valid</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d0c/system__power_8h_source.html#l00066">system_power.h:66</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_ac6becf13094bd56fdc0baa04bd5a2fb0"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#ac6becf13094bd56fdc0baa04bd5a2fb0">vehicle_local_position_s::ref_alt</a></div><div class="ttdeci">float ref_alt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00072">vehicle_local_position.h:72</a></div></div>
<div class="ttc" id="class_commander_html_a696be25d63902827023236ca7329740c"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a696be25d63902827023236ca7329740c">Commander::check_posvel_validity</a></div><div class="ttdeci">bool check_posvel_validity(const bool data_valid, const float data_accuracy, const float required_accuracy, const hrt_abstime &amp;data_timestamp_us, hrt_abstime *last_fail_time_us, hrt_abstime *probation_time_us, bool *valid_state, bool *validity_changed)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03218">Commander.cpp:3218</a></div></div>
<div class="ttc" id="drv__hrt_8h_html_a1450e339b7c5b8d47656500167a6676d"><div class="ttname"><a href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time</a></div><div class="ttdeci">__EXPORT hrt_abstime hrt_absolute_time(void)</div><div class="ttdoc">Get absolute time in [us] (does not wrap). </div></div>
<div class="ttc" id="param_8h_html_a9f3da6556e3c2f619b2ac72e18595f92"><div class="ttname"><a href="../../d5/d33/param_8h.html#a9f3da6556e3c2f619b2ac72e18595f92">param_t</a></div><div class="ttdeci">uint32_t param_t</div><div class="ttdoc">Parameter handle. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d33/param_8h_source.html#l00098">param.h:98</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a95b47dab68ab6fcdd951fb1b9dfc64b8"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a95b47dab68ab6fcdd951fb1b9dfc64b8">tune_negative</a></div><div class="ttdeci">void tune_negative(bool use_buzzer)</div><div class="ttdoc">Blink red LED and play negative tune (if use_buzzer == true). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00238">commander_helper.cpp:238</a></div></div>
<div class="ttc" id="commander__helper_8cpp_html_a93b848866e8f1f475dba5d34c911a7fb"><div class="ttname"><a href="../../df/d08/commander__helper_8cpp.html#a93b848866e8f1f475dba5d34c911a7fb">tune_home_set</a></div><div class="ttdeci">void tune_home_set(bool use_buzzer)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d08/commander__helper_8cpp_source.html#l00179">commander_helper.cpp:179</a></div></div>
<div class="ttc" id="_commander_8cpp_html_ac2d06f6d9e8fad9a117c6b851e8967baa49f8f6f0548e303ff4ad833b82e3a6c9"><div class="ttname"><a href="../../da/d73/_commander_8cpp.html#ac2d06f6d9e8fad9a117c6b851e8967baa49f8f6f0548e303ff4ad833b82e3a6c9">VEHICLE_MODE_FLAG_HIL_ENABLED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l00119">Commander.cpp:119</a></div></div>
<div class="ttc" id="class_module_params_html_acf08d1a67a584f7b6e0feaa9182bede1"><div class="ttname"><a href="../../db/db3/class_module_params.html#acf08d1a67a584f7b6e0feaa9182bede1">ModuleParams::updateParams</a></div><div class="ttdeci">virtual void updateParams()</div><div class="ttdoc">Call this whenever the module gets a parameter change notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd2/px4__module__params_8h_source.html#l00079">px4_module_params.h:79</a></div></div>
<div class="ttc" id="structhome__position__s_html_a93b8b23d202c9af3989e4be84c88cb8a"><div class="ttname"><a href="../../dc/d6d/structhome__position__s.html#a93b8b23d202c9af3989e4be84c88cb8a">home_position_s::lat</a></div><div class="ttdeci">double lat</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/df9/home__position_8h_source.html#l00054">home_position.h:54</a></div></div>
<div class="ttc" id="arm__auth_8cpp_html_a0a9c9025843ead7dbd98608fabd36d2a"><div class="ttname"><a href="../../d0/d49/arm__auth_8cpp.html#a0a9c9025843ead7dbd98608fabd36d2a">arm_auth_init</a></div><div class="ttdeci">void arm_auth_init(orb_advert_t *mav_log_pub, uint8_t *sys_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d49/arm__auth_8cpp_source.html#l00257">arm_auth.cpp:257</a></div></div>
<div class="ttc" id="class_commander_html_af1dc603ce8ac5c165ffbf71cc57f850f"><div class="ttname"><a href="../../d3/dc6/class_commander.html#af1dc603ce8ac5c165ffbf71cc57f850f">Commander::mission_init</a></div><div class="ttdeci">void mission_init()</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03877">Commander.cpp:3877</a></div></div>
<div class="ttc" id="class_commander_html_a697c3a90626f984c3a792c2e623c0c13"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a697c3a90626f984c3a792c2e623c0c13">Commander::_time_last_innov_pass</a></div><div class="ttdeci">hrt_abstime _time_last_innov_pass</div><div class="ttdoc">last time velocity innovations passed </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d55/_commander_8hpp_source.html#l00124">Commander.hpp:124</a></div></div>
<div class="ttc" id="drv__tone__alarm_8h_html_adc29c2ff13d900c2f185ee95427fb06ca103a315c3ebd325e38539413836ee925"><div class="ttname"><a href="../../d9/d25/drv__tone__alarm_8h.html#adc29c2ff13d900c2f185ee95427fb06ca103a315c3ebd325e38539413836ee925">TONE_ARMING_WARNING_TUNE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d25/drv__tone__alarm_8h_source.html#l00080">drv_tone_alarm.h:80</a></div></div>
<div class="ttc" id="board__common_8h_html_a5fbd4e64dbfe6a9f74421771869375b8"><div class="ttname"><a href="../../d6/df6/board__common_8h.html#a5fbd4e64dbfe6a9f74421771869375b8">board_power_button_state_notification_e</a></div><div class="ttdeci">board_power_button_state_notification_e</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/df6/board__common_8h_source.html#l00308">board_common.h:308</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_abefaf0afd13d3b4cd44c3e29a6cb1694"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#abefaf0afd13d3b4cd44c3e29a6cb1694">vehicle_command_s::param7</a></div><div class="ttdeci">float param7</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00155">vehicle_command.h:155</a></div></div>
<div class="ttc" id="posix_2cdev__platform_8cpp_html_a050ecef08105582119cf1adf517a9c06"><div class="ttname"><a href="../../da/dc9/posix_2cdev__platform_8cpp.html#a050ecef08105582119cf1adf517a9c06">px4_close</a></div><div class="ttdeci">int px4_close(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dc9/posix_2cdev__platform_8cpp_source.html#l00226">cdev_platform.cpp:226</a></div></div>
<div class="ttc" id="px4__defines_8h_html_a70e1b6490b2e0b591672067b5cb2a06b"><div class="ttname"><a href="../../df/dd0/px4__defines_8h.html#a70e1b6490b2e0b591672067b5cb2a06b">PX4_ERROR</a></div><div class="ttdeci">#define PX4_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd0/px4__defines_8h_source.html#l00055">px4_defines.h:55</a></div></div>
<div class="ttc" id="structvehicle__command__s_html_aa0e9092f01d4004c4ea966daafbd36d9"><div class="ttname"><a href="../../d7/dcc/structvehicle__command__s.html#aa0e9092f01d4004c4ea966daafbd36d9">vehicle_command_s::target_system</a></div><div class="ttdeci">uint8_t target_system</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d94/vehicle__command_8h_source.html#l00157">vehicle_command.h:157</a></div></div>
<div class="ttc" id="structvehicle__local__position__s_html_aa781a9d6c47b7446415873e65666c904"><div class="ttname"><a href="../../d4/d36/structvehicle__local__position__s.html#aa781a9d6c47b7446415873e65666c904">vehicle_local_position_s::vx</a></div><div class="ttdeci">float vx</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d34/vehicle__local__position_8h_source.html#l00062">vehicle_local_position.h:62</a></div></div>
<div class="ttc" id="structmanual__control__setpoint__s_html_aeffc7f6be61085d94cf3944d488ae58d"><div class="ttname"><a href="../../de/de6/structmanual__control__setpoint__s.html#aeffc7f6be61085d94cf3944d488ae58d">manual_control_setpoint_s::mode_switch</a></div><div class="ttdeci">uint8_t mode_switch</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d28/manual__control__setpoint_8h_source.html#l00081">manual_control_setpoint.h:81</a></div></div>
<div class="ttc" id="structvehicle__command__ack__s_html_a2a7cc7ebb5d9fe0d8ac550790e150699"><div class="ttname"><a href="../../da/deb/structvehicle__command__ack__s.html#a2a7cc7ebb5d9fe0d8ac550790e150699">vehicle_command_ack_s::result</a></div><div class="ttdeci">uint8_t result</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d2e/vehicle__command__ack_8h_source.html#l00069">vehicle_command_ack.h:69</a></div></div>
<div class="ttc" id="class_commander_html_a0b128d701d0bcb19a4376f32a0002f73"><div class="ttname"><a href="../../d3/dc6/class_commander.html#a0b128d701d0bcb19a4376f32a0002f73">Commander::task_spawn</a></div><div class="ttdeci">static int task_spawn(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d73/_commander_8cpp_source.html#l03839">Commander.cpp:3839</a></div></div>
<div class="ttc" id="structvtol__vehicle__status__s_html_aec88b6ced052abc9e7fe5d5a2a31223a"><div class="ttname"><a href="../../d4/d41/structvtol__vehicle__status__s.html#aec88b6ced052abc9e7fe5d5a2a31223a">vtol_vehicle_status_s::fw_permanent_stab</a></div><div class="ttdeci">bool fw_permanent_stab</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d75/vtol__vehicle__status_8h_source.html#l00063">vtol_vehicle_status.h:63</a></div></div>
<div class="ttc" id="structcommander__state__s_html"><div class="ttname"><a href="../../d4/d88/structcommander__state__s.html">commander_state_s</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/df7/commander__state_8h_source.html#l00066">commander_state.h:66</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_ddb4d7e95cc2d6c8e1ade10a20d7247d.html">modules</a></li><li class="navelem"><a class="el" href="../../dir_936c26b3e4a2dbda1abdc749c014ce33.html">commander</a></li><li class="navelem"><a class="el" href="../../da/d73/_commander_8cpp.html">Commander.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
