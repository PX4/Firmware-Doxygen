<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PX4 Firmware: src/lib/rc/dsm.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PX4 Firmware
   </div>
   <div id="projectbrief">PX4 Autopilot Software http://px4.io</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d3/d37/dsm_8cpp.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dsm.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Serial protocol decoder for the Spektrum DSM* family of protocols.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="../../d4/d35/px4__config_8h_source.html">px4_config.h</a>&gt;</code><br />
<code>#include &lt;board_config.h&gt;</code><br />
<code>#include &lt;<a class="el" href="../../df/dd0/px4__defines_8h_source.html">px4_defines.h</a>&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;termios.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d1/d32/dsm_8h_source.html">dsm.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/d8a/spektrum__rssi_8h_source.html">spektrum_rssi.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/d37/common__rc_8h_source.html">common_rc.h</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="../../d6/d10/drv__hrt_8h_source.html">drivers/drv_hrt.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dsm.cpp:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d1/d36/dsm_8cpp__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div>
<p><a href="../../d3/d37/dsm_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7b4599bf2f3af92b7053d582f426266f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a7b4599bf2f3af92b7053d582f426266f">dsm_udelay</a>(arg)&#160;&#160;&#160;<a class="el" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(arg)</td></tr>
<tr class="separator:a7b4599bf2f3af92b7053d582f426266f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a6fc5e3073fe86a4957e09a4eecc5e255"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255">DSM_DECODE_STATE</a> { <a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255a087364024813f976419a969de5cccfbf">DSM_DECODE_STATE_DESYNC</a> = 0, 
<a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255a406e0e601e988f18be2aa30a13e4b9ae">DSM_DECODE_STATE_SYNC</a>
 }</td></tr>
<tr class="separator:a6fc5e3073fe86a4957e09a4eecc5e255"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3a63475bf3d8b4ac19ea396d834312f3"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a3a63475bf3d8b4ac19ea396d834312f3">dsm_decode</a> (<a class="el" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> frame_time, uint16_t *values, uint16_t *num_values, bool *dsm_11_bit, unsigned max_values, int8_t *rssi_percent)</td></tr>
<tr class="memdesc:a3a63475bf3d8b4ac19ea396d834312f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode the entire dsm frame (all contained channels)  <a href="#a3a63475bf3d8b4ac19ea396d834312f3">More...</a><br /></td></tr>
<tr class="separator:a3a63475bf3d8b4ac19ea396d834312f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a155e9a9889d2e342ea3bf13aaaa4458d"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a155e9a9889d2e342ea3bf13aaaa4458d">dsm_decode_channel</a> (uint16_t raw, unsigned shift, unsigned *channel, unsigned *value)</td></tr>
<tr class="memdesc:a155e9a9889d2e342ea3bf13aaaa4458d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempt to decode a single channel raw channel datum.  <a href="#a155e9a9889d2e342ea3bf13aaaa4458d">More...</a><br /></td></tr>
<tr class="separator:a155e9a9889d2e342ea3bf13aaaa4458d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf6292c506d3f3601cfa8f34199023b6"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#aaf6292c506d3f3601cfa8f34199023b6">dsm_guess_format</a> (bool reset)</td></tr>
<tr class="memdesc:aaf6292c506d3f3601cfa8f34199023b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempt to guess if receiving 10 or 11 bit channel values.  <a href="#aaf6292c506d3f3601cfa8f34199023b6">More...</a><br /></td></tr>
<tr class="separator:aaf6292c506d3f3601cfa8f34199023b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab38619ebbecd716b6e0757356d116039"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#ab38619ebbecd716b6e0757356d116039">dsm_config</a> (int <a class="el" href="../../d6/d47/dataman_8cpp.html#a6f8059414f0228f0256115e024eeed4b">fd</a>)</td></tr>
<tr class="separator:ab38619ebbecd716b6e0757356d116039"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af65ffa1caa34ebd22be77188397346b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#af65ffa1caa34ebd22be77188397346b9">dsm_proto_init</a> ()</td></tr>
<tr class="separator:af65ffa1caa34ebd22be77188397346b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a650fd06b0cf33eb946789d0490045c95"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a650fd06b0cf33eb946789d0490045c95">dsm_init</a> (const char *device)</td></tr>
<tr class="memdesc:a650fd06b0cf33eb946789d0490045c95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the DSM receive functionality.  <a href="#a650fd06b0cf33eb946789d0490045c95">More...</a><br /></td></tr>
<tr class="separator:a650fd06b0cf33eb946789d0490045c95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1365a2dbb5eeb7a065555c975f66b41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#ae1365a2dbb5eeb7a065555c975f66b41">dsm_deinit</a> ()</td></tr>
<tr class="separator:ae1365a2dbb5eeb7a065555c975f66b41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45323ace084ebbdfd91bb7752f844696"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a45323ace084ebbdfd91bb7752f844696">dsm_input</a> (int <a class="el" href="../../d6/d47/dataman_8cpp.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, uint16_t *values, uint16_t *num_values, bool *dsm_11_bit, uint8_t *n_bytes, uint8_t **bytes, int8_t *rssi, unsigned max_values)</td></tr>
<tr class="memdesc:a45323ace084ebbdfd91bb7752f844696"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called periodically to check for input data from the DSM UART.  <a href="#a45323ace084ebbdfd91bb7752f844696">More...</a><br /></td></tr>
<tr class="separator:a45323ace084ebbdfd91bb7752f844696"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f7fa1d6f81b4f1d8f9c97b0264664ad"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a6f7fa1d6f81b4f1d8f9c97b0264664ad">dsm_parse</a> (const uint64_t now, const uint8_t *frame, const unsigned len, uint16_t *values, uint16_t *num_values, bool *dsm_11_bit, unsigned *frame_drops, int8_t *rssi_percent, uint16_t max_channels)</td></tr>
<tr class="separator:a6f7fa1d6f81b4f1d8f9c97b0264664ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac1d0060e20459c61596ab68ae1ed1bfe"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255">DSM_DECODE_STATE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#ac1d0060e20459c61596ab68ae1ed1bfe">dsm_decode_state</a> = <a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255a087364024813f976419a969de5cccfbf">DSM_DECODE_STATE_DESYNC</a></td></tr>
<tr class="separator:ac1d0060e20459c61596ab68ae1ed1bfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac75a178a7daa466e17066738dfdea0fb"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#ac75a178a7daa466e17066738dfdea0fb">dsm_fd</a> = -1</td></tr>
<tr class="memdesc:ac75a178a7daa466e17066738dfdea0fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">File handle to the DSM UART.  <a href="#ac75a178a7daa466e17066738dfdea0fb">More...</a><br /></td></tr>
<tr class="separator:ac75a178a7daa466e17066738dfdea0fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf340809bbf653f0c8a79b0c65aaf580"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#abf340809bbf653f0c8a79b0c65aaf580">dsm_last_rx_time</a></td></tr>
<tr class="memdesc:abf340809bbf653f0c8a79b0c65aaf580"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp when we last received data.  <a href="#abf340809bbf653f0c8a79b0c65aaf580">More...</a><br /></td></tr>
<tr class="separator:abf340809bbf653f0c8a79b0c65aaf580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47d02cb11ba47b779f0ec69b6146e72d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a47d02cb11ba47b779f0ec69b6146e72d">dsm_last_frame_time</a></td></tr>
<tr class="memdesc:a47d02cb11ba47b779f0ec69b6146e72d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp for start of last valid dsm frame.  <a href="#a47d02cb11ba47b779f0ec69b6146e72d">More...</a><br /></td></tr>
<tr class="separator:a47d02cb11ba47b779f0ec69b6146e72d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a31e97a1bac7f6bd4584c14b99c8249"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d1/d32/dsm_8h.html#a6e01dc02ca202e02a10e8c24b85d5a65">dsm_frame_t</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a1a31e97a1bac7f6bd4584c14b99c8249">dsm_frame</a> = rc_decode_buf.dsm.frame</td></tr>
<tr class="memdesc:a1a31e97a1bac7f6bd4584c14b99c8249"><td class="mdescLeft">&#160;</td><td class="mdescRight">DSM_BUFFER_SIZE DSM dsm frame receive buffer.  <a href="#a1a31e97a1bac7f6bd4584c14b99c8249">More...</a><br /></td></tr>
<tr class="separator:a1a31e97a1bac7f6bd4584c14b99c8249"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a562151164c0c482caf38727e501a8cab"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../d1/d32/dsm_8h.html#ae5f4bf80712ff27b88908d9ae669c30a">dsm_buf_t</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a562151164c0c482caf38727e501a8cab">dsm_buf</a> = rc_decode_buf.dsm.buf</td></tr>
<tr class="memdesc:a562151164c0c482caf38727e501a8cab"><td class="mdescLeft">&#160;</td><td class="mdescRight">DSM_BUFFER_SIZE DSM dsm frame receive buffer.  <a href="#a562151164c0c482caf38727e501a8cab">More...</a><br /></td></tr>
<tr class="separator:a562151164c0c482caf38727e501a8cab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada6ed4c3ac7af2e2fe310412a9255d33"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#ada6ed4c3ac7af2e2fe310412a9255d33">dsm_chan_buf</a> [<a class="el" href="../../d1/d32/dsm_8h.html#a2b38ac1d6c4294152a63264e5030ea4d">DSM_MAX_CHANNEL_COUNT</a>]</td></tr>
<tr class="separator:ada6ed4c3ac7af2e2fe310412a9255d33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2d0d721b5e1f3c41775314bdf4845cd"><td class="memItemLeft" align="right" valign="top">static unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#aa2d0d721b5e1f3c41775314bdf4845cd">dsm_partial_frame_count</a></td></tr>
<tr class="memdesc:aa2d0d721b5e1f3c41775314bdf4845cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count of bytes received for current dsm frame.  <a href="#aa2d0d721b5e1f3c41775314bdf4845cd">More...</a><br /></td></tr>
<tr class="separator:aa2d0d721b5e1f3c41775314bdf4845cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5af53247466d85ca900387e62c22c1bd"><td class="memItemLeft" align="right" valign="top">static unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a5af53247466d85ca900387e62c22c1bd">dsm_channel_shift</a> = 0</td></tr>
<tr class="memdesc:a5af53247466d85ca900387e62c22c1bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Channel resolution, 0=unknown, 1=10 bit, 2=11 bit.  <a href="#a5af53247466d85ca900387e62c22c1bd">More...</a><br /></td></tr>
<tr class="separator:a5af53247466d85ca900387e62c22c1bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca6581ed988732dc1bff70557c4e7800"><td class="memItemLeft" align="right" valign="top">static unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#aca6581ed988732dc1bff70557c4e7800">dsm_frame_drops</a> = 0</td></tr>
<tr class="memdesc:aca6581ed988732dc1bff70557c4e7800"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count of incomplete DSM frames.  <a href="#aca6581ed988732dc1bff70557c4e7800">More...</a><br /></td></tr>
<tr class="separator:aca6581ed988732dc1bff70557c4e7800"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b6625c6e047791f8866326d32fd5c89"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d37/dsm_8cpp.html#a9b6625c6e047791f8866326d32fd5c89">dsm_chan_count</a> = 0</td></tr>
<tr class="memdesc:a9b6625c6e047791f8866326d32fd5c89"><td class="mdescLeft">&#160;</td><td class="mdescRight">DSM channel count.  <a href="#a9b6625c6e047791f8866326d32fd5c89">More...</a><br /></td></tr>
<tr class="separator:a9b6625c6e047791f8866326d32fd5c89"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Serial protocol decoder for the Spektrum DSM* family of protocols. </p>
<p>Decodes into the global PPM buffer and updates accordingly. </p>

<p>Definition in file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a7b4599bf2f3af92b7053d582f426266f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define dsm_udelay</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">arg</td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="../../d6/dfb/stubs__posix_8c.html#ac0383719bafa9b5b2aa25fabc586bd1f">usleep</a>(arg)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00060">60</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00313">dsm_deinit()</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a6fc5e3073fe86a4957e09a4eecc5e255"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255">DSM_DECODE_STATE</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a6fc5e3073fe86a4957e09a4eecc5e255a087364024813f976419a969de5cccfbf"></a>DSM_DECODE_STATE_DESYNC&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a6fc5e3073fe86a4957e09a4eecc5e255a406e0e601e988f18be2aa30a13e4b9ae"></a>DSM_DECODE_STATE_SYNC&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00065">65</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ab38619ebbecd716b6e0757356d116039"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsm_config </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00240">240</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00135">dsm_guess_format()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00071">dsm_last_rx_time</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00077">dsm_partial_frame_count</a>, <a class="el" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time()</a>, and <a class="el" href="../../d5/dc1/aerocore2_2board__config_8h_source.html#l00188">SPEKTRUM_POWER</a>.</p>

<p>Referenced by <a class="el" href="../../d5/d40/_r_c_input_8cpp_source.html#l00290">RCInput::cycle()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00293">dsm_init()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_ab38619ebbecd716b6e0757356d116039_cgraph.svg" width="478" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_ab38619ebbecd716b6e0757356d116039_icgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3a63475bf3d8b4ac19ea396d834312f3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool dsm_decode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a>&#160;</td>
          <td class="paramname"><em>frame_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>num_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>dsm_11_bit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>max_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t *&#160;</td>
          <td class="paramname"><em>rssi_percent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Decode the entire dsm frame (all contained channels) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">frame_time</td><td>timestamp when this dsm frame was received. Used to detect RX loss in order to reset 10/11 bit guess. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">values</td><td>pointer to per channel array of decoded values </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_values</td><td>pointer to number of raw channel values returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true=DSM frame successfully decoded, false=no update </dd></dl>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00388">388</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00078">dsm_channel_shift</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00112">dsm_decode_channel()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00073">dsm_frame</a>, <a class="el" href="../../d1/d32/dsm_8h_source.html#l00052">DSM_FRAME_CHANNELS</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00135">dsm_guess_format()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00072">dsm_last_frame_time</a>, <a class="el" href="../../d1/d32/dsm_8h_source.html#l00053">DSM_MAX_CHANNEL_COUNT</a>, and <a class="el" href="../../d9/d8a/spektrum__rssi_8h_source.html#l00079">spek_dbm_to_percent()</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a3a63475bf3d8b4ac19ea396d834312f3_cgraph.svg" width="502" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a3a63475bf3d8b4ac19ea396d834312f3_icgraph.svg" width="100%" height="518"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a155e9a9889d2e342ea3bf13aaaa4458d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool dsm_decode_channel </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>raw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>shift</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Attempt to decode a single channel raw channel datum. </p>
<p>The DSM* protocol doesn't provide any explicit framing, so we detect dsm frame boundaries by the inter-dsm frame delay.</p>
<p>The minimum dsm frame spacing is 11ms; with 16 bytes at 115200bps dsm frame transmission time is ~1.4ms.</p>
<p>We expect to only be called when bytes arrive for processing, and if an interval of more than 5ms passes between calls, the first byte we read will be the first byte of a dsm frame.</p>
<p>In the case where byte(s) are dropped from a dsm frame, this also provides a degree of protection. Of course, it would be better if we didn't drop bytes...</p>
<p>Upon receiving a full dsm frame we attempt to decode it</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">raw</td><td>16 bit raw channel value from dsm frame </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">shift</td><td>position of channel number in raw data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">channel</td><td>pointer to returned channel number </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">value</td><td>pointer to returned channel value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true=raw value successfully decoded </dd></dl>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00112">112</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00388">dsm_decode()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00135">dsm_guess_format()</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a155e9a9889d2e342ea3bf13aaaa4458d_icgraph.svg" width="100%" height="556"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae1365a2dbb5eeb7a065555c975f66b41"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dsm_deinit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00313">313</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d1/d32/dsm_8h_source.html#l00083">DSM_CMD_BIND_POWER_DOWN</a>, <a class="el" href="../../d1/d32/dsm_8h_source.html#l00084">DSM_CMD_BIND_POWER_UP</a>, <a class="el" href="../../d1/d32/dsm_8h_source.html#l00087">DSM_CMD_BIND_REINIT_UART</a>, <a class="el" href="../../d1/d32/dsm_8h_source.html#l00086">DSM_CMD_BIND_SEND_PULSES</a>, <a class="el" href="../../d1/d32/dsm_8h_source.html#l00085">DSM_CMD_BIND_SET_RX_OUT</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00070">dsm_fd</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00135">dsm_guess_format()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00060">dsm_udelay</a>, <a class="el" href="../../d5/dc1/aerocore2_2board__config_8h_source.html#l00193">SPEKTRUM_OUT</a>, <a class="el" href="../../d5/dc1/aerocore2_2board__config_8h_source.html#l00188">SPEKTRUM_POWER</a>, <a class="el" href="../../d5/dc1/aerocore2_2board__config_8h_source.html#l00192">SPEKTRUM_RX_AS_GPIO_OUTPUT</a>, and <a class="el" href="../../d5/dc1/aerocore2_2board__config_8h_source.html#l00194">SPEKTRUM_RX_AS_UART</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d92/spektrum__rc_8cpp_source.html#l00078">spektrum_rc::task_main()</a>, and <a class="el" href="../../d5/d40/_r_c_input_8cpp_source.html#l00063">RCInput::~RCInput()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_ae1365a2dbb5eeb7a065555c975f66b41_cgraph.svg" width="474" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_ae1365a2dbb5eeb7a065555c975f66b41_icgraph.svg" width="483" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaf6292c506d3f3601cfa8f34199023b6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool dsm_guess_format </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reset</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Attempt to guess if receiving 10 or 11 bit channel values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">reset</td><td>true=reset the 10/11 bit state to unknown </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00135">135</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00078">dsm_channel_shift</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00112">dsm_decode_channel()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00073">dsm_frame</a>, and <a class="el" href="../../d1/d32/dsm_8h_source.html#l00052">DSM_FRAME_CHANNELS</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00240">dsm_config()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00388">dsm_decode()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00313">dsm_deinit()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_aaf6292c506d3f3601cfa8f34199023b6_cgraph.svg" width="340" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_aaf6292c506d3f3601cfa8f34199023b6_icgraph.svg" width="100%" height="556"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a650fd06b0cf33eb946789d0490045c95"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dsm_init </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>device</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the DSM receive functionality. </p>
<p>Open the UART for receiving DSM frames and configure it appropriately</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">device</td><td>Device name of DSM UART </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00293">293</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00240">dsm_config()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00070">dsm_fd</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00273">dsm_proto_init()</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d2f/controls_8c_source.html#l00173">controls_init()</a>, <a class="el" href="../../d5/d40/_r_c_input_8cpp_source.html#l00083">RCInput::init()</a>, and <a class="el" href="../../d3/d92/spektrum__rc_8cpp_source.html#l00078">spektrum_rc::task_main()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a650fd06b0cf33eb946789d0490045c95_cgraph.svg" width="614" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a650fd06b0cf33eb946789d0490045c95_icgraph.svg" width="100%" height="442"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a45323ace084ebbdfd91bb7752f844696"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool dsm_input </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>num_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>dsm_11_bit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>n_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t *&#160;</td>
          <td class="paramname"><em>rssi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>max_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called periodically to check for input data from the DSM UART. </p>
<p>The DSM* protocol doesn't provide any explicit framing, so we detect dsm frame boundaries by the inter-dsm frame delay. The minimum dsm frame spacing is 11ms; with 16 bytes at 115200bps dsm frame transmission time is ~1.4ms. We expect to only be called when bytes arrive for processing, and if an interval of more than 5ms passes between calls, the first byte we read will be the first byte of a dsm frame. In the case where byte(s) are dropped from a dsm frame, this also provides a degree of protection. Of course, it would be better if we didn't drop bytes... Upon receiving a full dsm frame we attempt to decode it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">values</td><td>pointer to per channel array of decoded values </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_values</td><td>pointer to number of raw channel values returned, high order bit 0:10 bit data, 1:11 bit data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">n_butes</td><td>number of bytes read </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">bytes</td><td>pointer to the buffer of read bytes </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rssi</td><td>value in percent, if supported, or 127 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true=decoded raw channel values updated, false=no update </dd></dl>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00593">593</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00074">dsm_buf</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00079">dsm_frame_drops</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>, <a class="el" href="../../d6/d10/drv__hrt_8h.html#a1450e339b7c5b8d47656500167a6676d">hrt_absolute_time()</a>, <a class="el" href="../../d6/d10/drv__hrt_8h_source.html#l00057">hrt_abstime</a>, and <a class="el" href="../../da/d60/boot__app__shared_8c_source.html#l00100">read()</a>.</p>

<p>Referenced by <a class="el" href="../../d2/d2f/controls_8c_source.html#l00079">dsm_port_input()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a45323ace084ebbdfd91bb7752f844696_cgraph.svg" width="100%" height="423"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a45323ace084ebbdfd91bb7752f844696_icgraph.svg" width="524" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6f7fa1d6f81b4f1d8f9c97b0264664ad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool dsm_parse </td>
          <td>(</td>
          <td class="paramtype">const uint64_t&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>num_values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>dsm_11_bit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>frame_drops</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t *&#160;</td>
          <td class="paramname"><em>rssi_percent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>max_channels</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">640</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00076">dsm_chan_buf</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00080">dsm_chan_count</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00388">dsm_decode()</a>, <a class="el" href="../../d3/d37/dsm_8cpp.html#ac1d0060e20459c61596ab68ae1ed1bfe">dsm_decode_state</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00066">DSM_DECODE_STATE_DESYNC</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00067">DSM_DECODE_STATE_SYNC</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00073">dsm_frame</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00079">dsm_frame_drops</a>, <a class="el" href="../../d1/d32/dsm_8h_source.html#l00051">DSM_FRAME_SIZE</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00071">dsm_last_rx_time</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00077">dsm_partial_frame_count</a>.</p>

<p>Referenced by <a class="el" href="../../d5/d40/_r_c_input_8cpp_source.html#l00290">RCInput::cycle()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00593">dsm_input()</a>, <a class="el" href="../../d3/dab/_r_c_test_8cpp_source.html#l00148">RCTest::dsmTest()</a>, and <a class="el" href="../../d3/d92/spektrum__rc_8cpp_source.html#l00078">spektrum_rc::task_main()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a6f7fa1d6f81b4f1d8f9c97b0264664ad_cgraph.svg" width="636" height="114"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_a6f7fa1d6f81b4f1d8f9c97b0264664ad_icgraph.svg" width="100%" height="518"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<a class="anchor" id="af65ffa1caa34ebd22be77188397346b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dsm_proto_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00273">273</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>References <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00076">dsm_chan_buf</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00080">dsm_chan_count</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00078">dsm_channel_shift</a>, <a class="el" href="../../d3/d37/dsm_8cpp.html#ac1d0060e20459c61596ab68ae1ed1bfe">dsm_decode_state</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00066">DSM_DECODE_STATE_DESYNC</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00079">dsm_frame_drops</a>, and <a class="el" href="../../d1/d32/dsm_8h_source.html#l00053">DSM_MAX_CHANNEL_COUNT</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00293">dsm_init()</a>, and <a class="el" href="../../d3/dab/_r_c_test_8cpp_source.html#l00148">RCTest::dsmTest()</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="../../d3/d37/dsm_8cpp_af65ffa1caa34ebd22be77188397346b9_icgraph.svg" width="100%" height="556"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a562151164c0c482caf38727e501a8cab"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d32/dsm_8h.html#ae5f4bf80712ff27b88908d9ae669c30a">dsm_buf_t</a>&amp; dsm_buf = rc_decode_buf.dsm.buf</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>DSM_BUFFER_SIZE DSM dsm frame receive buffer. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00074">74</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00593">dsm_input()</a>.</p>

</div>
</div>
<a class="anchor" id="ada6ed4c3ac7af2e2fe310412a9255d33"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t dsm_chan_buf[<a class="el" href="../../d1/d32/dsm_8h.html#a2b38ac1d6c4294152a63264e5030ea4d">DSM_MAX_CHANNEL_COUNT</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00076">76</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00273">dsm_proto_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a9b6625c6e047791f8866326d32fd5c89"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t dsm_chan_count = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>DSM channel count. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00080">80</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00273">dsm_proto_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a5af53247466d85ca900387e62c22c1bd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned dsm_channel_shift = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Channel resolution, 0=unknown, 1=10 bit, 2=11 bit. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00078">78</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00388">dsm_decode()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00135">dsm_guess_format()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00273">dsm_proto_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ac1d0060e20459c61596ab68ae1ed1bfe"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255">DSM_DECODE_STATE</a>  dsm_decode_state = <a class="el" href="../../d3/d37/dsm_8cpp.html#a6fc5e3073fe86a4957e09a4eecc5e255a087364024813f976419a969de5cccfbf">DSM_DECODE_STATE_DESYNC</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00273">dsm_proto_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ac75a178a7daa466e17066738dfdea0fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int dsm_fd = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>File handle to the DSM UART. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00070">70</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00313">dsm_deinit()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00293">dsm_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a1a31e97a1bac7f6bd4584c14b99c8249"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d1/d32/dsm_8h.html#a6e01dc02ca202e02a10e8c24b85d5a65">dsm_frame_t</a>&amp; dsm_frame = rc_decode_buf.dsm.frame</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>DSM_BUFFER_SIZE DSM dsm frame receive buffer. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00073">73</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00388">dsm_decode()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00135">dsm_guess_format()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>.</p>

</div>
</div>
<a class="anchor" id="aca6581ed988732dc1bff70557c4e7800"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned dsm_frame_drops = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Count of incomplete DSM frames. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00079">79</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00593">dsm_input()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>, <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00273">dsm_proto_init()</a>, and <a class="el" href="../../d3/dab/_r_c_test_8cpp_source.html#l00148">RCTest::dsmTest()</a>.</p>

</div>
</div>
<a class="anchor" id="a47d02cb11ba47b779f0ec69b6146e72d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> dsm_last_frame_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timestamp for start of last valid dsm frame. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00072">72</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00388">dsm_decode()</a>.</p>

</div>
</div>
<a class="anchor" id="abf340809bbf653f0c8a79b0c65aaf580"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d6/d10/drv__hrt_8h.html#a9f8bbf0e883115e04a457a268533a87c">hrt_abstime</a> dsm_last_rx_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timestamp when we last received data. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00071">71</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00240">dsm_config()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>.</p>

</div>
</div>
<a class="anchor" id="aa2d0d721b5e1f3c41775314bdf4845cd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned dsm_partial_frame_count</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Count of bytes received for current dsm frame. </p>

<p>Definition at line <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00077">77</a> of file <a class="el" href="../../d3/d37/dsm_8cpp_source.html">dsm.cpp</a>.</p>

<p>Referenced by <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00240">dsm_config()</a>, and <a class="el" href="../../d3/d37/dsm_8cpp_source.html#l00640">dsm_parse()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_c85d3e3c5052e9ad9ce18c6863244a25.html">lib</a></li><li class="navelem"><a class="el" href="../../dir_699d26f554e02cf3496b3cd552d5875f.html">rc</a></li><li class="navelem"><a class="el" href="../../d3/d37/dsm_8cpp.html">dsm.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
