<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PX4 Firmware: src/modules/uavcan/uavcan_virtual_can_driver.hpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PX4 Firmware
   </div>
   <div id="projectbrief">PX4 Autopilot Software http://px4.io</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d0/d9d/uavcan__virtual__can__driver_8hpp_source.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">uavcan_virtual_can_driver.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/****************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *   Copyright (c) 2015 PX4 Development Team. All rights reserved.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *               Pavel Kirienko &lt;pavel.kirienko@zubax.com&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *               David Sidrane &lt;david_s5@nscdg.com&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * are met:</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * 1. Redistributions of source code must retain the above copyright</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *    notice, this list of conditions and the following disclaimer in</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *    the documentation and/or other materials provided with the</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *    distribution.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * 3. Neither the name PX4 nor the names of its contributors may be</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *    used to endorse or promote products derived from this software</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> *    without specific prior written permission.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> ****************************************************************************/</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#pragma once</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;nuttx/config.h&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;cstdlib&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &lt;pthread.h&gt;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &lt;semaphore.h&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &lt;debug.h&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &lt;uavcan_stm32/clock.hpp&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &lt;uavcan/node/sub_node.hpp&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &lt;uavcan/protocol/node_status_monitor.hpp&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> * General purpose wrapper around os&#39;s mutual exclusion</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> * mechanism.</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"> * It supports the</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> * Note the naming of thier_mutex_ implies that the underlying</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> * mutex is owned by class using the Lock.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"> * and this wrapper provides service to initialize and de initialize</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> * the mutex.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="../../db/d3b/class_lock.html">   64</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../db/d3b/class_lock.html">Lock</a></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../db/d3b/class_lock.html#a2ca06d379f1e159a90f0727f1f4aefa9">   66</a></span>&#160;    pthread_mutex_t &amp;<a class="code" href="../../db/d3b/class_lock.html#a2ca06d379f1e159a90f0727f1f4aefa9">thier_mutex_</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="../../db/d3b/class_lock.html#a25c1411f1b3c0874bc3f9d703b4b793c">   70</a></span>&#160;    <a class="code" href="../../db/d3b/class_lock.html#a25c1411f1b3c0874bc3f9d703b4b793c">Lock</a>(pthread_mutex_t &amp;m) :</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        thier_mutex_(m)</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        (void)<a class="code" href="../../d6/dfb/stubs__posix_8c.html#a12809c44718c21544ceb280dc1a53573">pthread_mutex_lock</a>(&amp;m);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="../../db/d3b/class_lock.html#a7ab6d9485c8665bb3643710432882971">   76</a></span>&#160;    <a class="code" href="../../db/d3b/class_lock.html#a7ab6d9485c8665bb3643710432882971">~Lock</a>()</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        (void)<a class="code" href="../../d6/dfb/stubs__posix_8c.html#a96184290ffb60e04c53a52869cf960a2">pthread_mutex_unlock</a>(&amp;thier_mutex_);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="../../db/d3b/class_lock.html#aea74f30dd5eda4470dca64afd055041f">   81</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d3b/class_lock.html#aea74f30dd5eda4470dca64afd055041f">init</a>(pthread_mutex_t &amp;thier_mutex_)</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d6/dfb/stubs__posix_8c.html#a7454d249ed94ad5d5e57ba1529d7a7f2">pthread_mutex_init</a>(&amp;thier_mutex_, NULL);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="../../db/d3b/class_lock.html#ae29131873c9817d0dc40689b83e7baf6">   86</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../db/d3b/class_lock.html#ae29131873c9817d0dc40689b83e7baf6">deinit</a>(pthread_mutex_t &amp;thier_mutex_)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="../../d6/dfb/stubs__posix_8c.html#a3cf620ff3a40af11d79cf28901dc55e2">pthread_mutex_destroy</a>(&amp;thier_mutex_);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;};</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"> * Generic queue based on the linked list class defined in libuavcan.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> * This class does not use heap memory.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html">   98</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d4/da4/class_queue.html">Queue</a></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;{</div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="../../dc/d37/struct_queue_1_1_item.html">  100</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="../../dc/d37/struct_queue_1_1_item.html">Item</a> : <span class="keyword">public</span> uavcan::LinkedListNode&lt;Item&gt; {</div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="../../dc/d37/struct_queue_1_1_item.html#a9ff8538d4b4f7638dbf6b413cb0e1a62">  101</a></span>&#160;        T <a class="code" href="../../dc/d37/struct_queue_1_1_item.html#a9ff8538d4b4f7638dbf6b413cb0e1a62">payload</a>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div><div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="../../dc/d37/struct_queue_1_1_item.html#a3b44f8897d704825fc0ed20883e03112">  104</a></span>&#160;        <a class="code" href="../../dc/d37/struct_queue_1_1_item.html#a3b44f8897d704825fc0ed20883e03112">Item</a>(Args... args) : payload(args...) { }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    };</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#a8e5c64485832b1272155d9bcb0c1e03c">  107</a></span>&#160;    uavcan::LimitedPoolAllocator <a class="code" href="../../d4/da4/class_queue.html#a8e5c64485832b1272155d9bcb0c1e03c">allocator_</a>;</div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#a42bd48a2f8a6ecae4f9cd231289c5ccd">  108</a></span>&#160;    uavcan::LinkedListRoot&lt;Item&gt; <a class="code" href="../../d4/da4/class_queue.html#a42bd48a2f8a6ecae4f9cd231289c5ccd">list_</a>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#a502d7eec8f7935f1bba1b459e7b08999">  111</a></span>&#160;    <a class="code" href="../../d4/da4/class_queue.html#a502d7eec8f7935f1bba1b459e7b08999">Queue</a>(uavcan::IPoolAllocator &amp;arg_allocator, std::size_t block_allocation_quota) :</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        allocator_(arg_allocator, block_allocation_quota)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        uavcan::IsDynamicallyAllocatable&lt;Item&gt;::check();</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#aa7eef1b427e24555780505de20e9acbc">  117</a></span>&#160;    <a class="code" href="../../d4/da4/class_queue.html#aa7eef1b427e24555780505de20e9acbc">~Queue</a>()</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">while</span> (!isEmpty()) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            pop();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#a1faa6b4d1a26c860a3ac17d73d0a0de4">  124</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d4/da4/class_queue.html#a1faa6b4d1a26c860a3ac17d73d0a0de4">isEmpty</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> list_.isEmpty(); }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">     * Creates one item in-place at the end of the list.</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">     * Returns true if the item was appended successfully, false if there&#39;s not enough memory.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">     * Complexity is O(N) where N is queue length.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#a0343865396a8cb15e7bad96f55ed958c">  132</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d4/da4/class_queue.html#a0343865396a8cb15e7bad96f55ed958c">tryEmplace</a>(Args... args)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="comment">// Allocating memory</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordtype">void</span> *<span class="keyword">const</span> ptr = allocator_.allocate(<span class="keyword">sizeof</span>(Item));</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">if</span> (ptr == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// Constructing the new item</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        Item *<span class="keyword">const</span> item = <span class="keyword">new</span> (ptr) Item(args...);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        assert(item != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// Inserting the new item at the end of the list</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        Item *p = list_.get();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">if</span> (p == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            list_.insert(item);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="keywordflow">while</span> (p-&gt;getNextListNode() != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                p = p-&gt;getNextListNode();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            assert(p-&gt;getNextListNode() == <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            p-&gt;setNextListNode(item);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            assert(p-&gt;getNextListNode()-&gt;getNextListNode() == <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">     * Accesses the first element.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">     * Nullptr will be returned if the queue is empty.</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">     * Complexity is O(1).</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#aaa5d5958feddf65b9c66d6276f57d782">  169</a></span>&#160;    T       *<a class="code" href="../../d4/da4/class_queue.html#aaa5d5958feddf65b9c66d6276f57d782">peek</a>()       { <span class="keywordflow">return</span> isEmpty() ? <span class="keyword">nullptr</span> : &amp;list_.get()-&gt;payload; }</div><div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#ab574458abe9ba0f79292c310f22a7e06">  170</a></span>&#160;    <span class="keyword">const</span> T *<a class="code" href="../../d4/da4/class_queue.html#ab574458abe9ba0f79292c310f22a7e06">peek</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> isEmpty() ? <span class="keyword">nullptr</span> : &amp;list_.get()-&gt;payload; }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">     * Removes the first element.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">     * If the queue is empty, nothing will be done and assertion failure will be triggered.</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">     * Complexity is O(1).</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="../../d4/da4/class_queue.html#a02ea784625fe33b5793d00c3b02b4878">  177</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d4/da4/class_queue.html#a02ea784625fe33b5793d00c3b02b4878">pop</a>()</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        Item *<span class="keyword">const</span> item = list_.get();</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        assert(item != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span> (item != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            list_.remove(item);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            item-&gt;~Item();</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            allocator_.deallocate(item);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;};</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment"> * Objects of this class are owned by the sub-node thread.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment"> * This class does not use heap memory.</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html">  194</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d1/d29/class_virtual_can_iface.html">VirtualCanIface</a> : <span class="keyword">public</span> uavcan::ICanIface,</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    uavcan::Noncopyable</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;{<span class="comment"></span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">     * This class re-defines uavcan::RxCanFrame with flags.</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">     * Simple inheritance or composition won&#39;t work here, because the 40 byte limit will be exceeded,</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">     * rendering this class unusable with Queue&lt;&gt;.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html">  202</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html">RxItem</a>: <span class="keyword">public</span> uavcan::CanFrame {</div><div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a5f5e23ff8f11285ff6c17f5f6a5ca972">  203</a></span>&#160;        <span class="keyword">const</span> uavcan::MonotonicTime <a class="code" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a5f5e23ff8f11285ff6c17f5f6a5ca972">ts_mono</a>;</div><div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a9e8513a156e7d767f4e74b9de9bb97f5">  204</a></span>&#160;        <span class="keyword">const</span> uavcan::UtcTime <a class="code" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a9e8513a156e7d767f4e74b9de9bb97f5">ts_utc</a>;</div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a56e859906bc41d5dae8a9e4aa53614d8">  205</a></span>&#160;        <span class="keyword">const</span> uavcan::CanIOFlags <a class="code" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a56e859906bc41d5dae8a9e4aa53614d8">flags</a>;</div><div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a05a4cd733f2dd7c9db4d6815b932f935">  206</a></span>&#160;        <span class="keyword">const</span> uint8_t <a class="code" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a05a4cd733f2dd7c9db4d6815b932f935">iface_index</a>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a5503180da92d9a8a244c14922f3e5bed">  208</a></span>&#160;        <a class="code" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a5503180da92d9a8a244c14922f3e5bed">RxItem</a>(<span class="keyword">const</span> uavcan::CanRxFrame &amp;arg_frame, uavcan::CanIOFlags arg_flags) :</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            uavcan::CanFrame(arg_frame),</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            ts_mono(arg_frame.ts_mono),</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            ts_utc(arg_frame.ts_utc),</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            flags(arg_flags),</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            iface_index(arg_frame.iface_index)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="comment">// Making sure it will fit into a pool block with a pointer prefix</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            static_assert(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html">RxItem</a>) &lt;= (uavcan::MemPoolBlockSize - 8), <span class="stringliteral">&quot;Bad coder, no coffee&quot;</span>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    };</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#aa35ac7d011f4df8f62a60892720bc1f0">  220</a></span>&#160;    pthread_mutex_t &amp;<a class="code" href="../../d1/d29/class_virtual_can_iface.html#aa35ac7d011f4df8f62a60892720bc1f0">common_driver_mutex_</a>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#af343b15763018fa099c5b6fa3fd6e55e">  222</a></span>&#160;    uavcan::CanTxQueue <a class="code" href="../../d1/d29/class_virtual_can_iface.html#af343b15763018fa099c5b6fa3fd6e55e">prioritized_tx_queue_</a>;</div><div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#a33537b0b56810ebbf8618c78d55366c3">  223</a></span>&#160;    <a class="code" href="../../d4/da4/class_queue.html">Queue&lt;RxItem&gt;</a> <a class="code" href="../../d1/d29/class_virtual_can_iface.html#a33537b0b56810ebbf8618c78d55366c3">rx_queue_</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#acefab39e54d254817bee573f89cbf433">  225</a></span>&#160;    int16_t <a class="code" href="../../d1/d29/class_virtual_can_iface.html#acefab39e54d254817bee573f89cbf433">send</a>(<span class="keyword">const</span> uavcan::CanFrame &amp;frame, uavcan::MonotonicTime tx_deadline, uavcan::CanIOFlags flags)<span class="keyword"> override</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="../../db/d3b/class_lock.html">Lock</a> <a class="code" href="../../d2/d70/namespace_micro_bench_h_r_t.html#aca2d9f12c0defb51efac182da6a55f12">lock</a>(common_driver_mutex_);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        prioritized_tx_queue_.push(frame, tx_deadline, uavcan::CanTxQueue::Volatile, flags);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#aa0019570de64206ff167e7954a852b62">  232</a></span>&#160;    int16_t <a class="code" href="../../d1/d29/class_virtual_can_iface.html#aa0019570de64206ff167e7954a852b62">receive</a>(uavcan::CanFrame &amp;out_frame, uavcan::MonotonicTime &amp;out_ts_monotonic,</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            uavcan::UtcTime &amp;out_ts_utc, uavcan::CanIOFlags &amp;out_flags)<span class="keyword"> override</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <a class="code" href="../../db/d3b/class_lock.html">Lock</a> <a class="code" href="../../d2/d70/namespace_micro_bench_h_r_t.html#aca2d9f12c0defb51efac182da6a55f12">lock</a>(common_driver_mutex_);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">if</span> (rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#a1faa6b4d1a26c860a3ac17d73d0a0de4">isEmpty</a>()) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> item = *rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#aaa5d5958feddf65b9c66d6276f57d782">peek</a>();</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#a02ea784625fe33b5793d00c3b02b4878">pop</a>();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        out_frame = item;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        out_ts_monotonic = item.ts_mono;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        out_ts_utc = item.ts_utc;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        out_flags = item.flags;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#a52d2546fc167fd59aa44f4073541f82e">  252</a></span>&#160;    int16_t <a class="code" href="../../d1/d29/class_virtual_can_iface.html#a52d2546fc167fd59aa44f4073541f82e">configureFilters</a>(<span class="keyword">const</span> uavcan::CanFilterConfig *, std::uint16_t)<span class="keyword"> override </span>{ <span class="keywordflow">return</span> -uavcan::ErrDriver; }</div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#aa676f4f87d00698dd60f49f08eec96cf">  253</a></span>&#160;    uint16_t <a class="code" href="../../d1/d29/class_virtual_can_iface.html#aa676f4f87d00698dd60f49f08eec96cf">getNumFilters</a>()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> 0; }</div><div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#a5da1072c2af0081805d861a0ca72dd8e">  254</a></span>&#160;    uint64_t <a class="code" href="../../d1/d29/class_virtual_can_iface.html#a5da1072c2af0081805d861a0ca72dd8e">getErrorCount</a>()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> 0; }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#a49eb72b640bd7c7d440e85dc671e3406">  257</a></span>&#160;    <a class="code" href="../../d1/d29/class_virtual_can_iface.html#a49eb72b640bd7c7d440e85dc671e3406">VirtualCanIface</a>(uavcan::IPoolAllocator &amp;allocator, uavcan::ISystemClock &amp;clock,</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            pthread_mutex_t &amp;arg_mutex, <span class="keywordtype">unsigned</span> quota_per_queue) :</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        common_driver_mutex_(arg_mutex),</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        prioritized_tx_queue_(allocator, clock, quota_per_queue),</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        rx_queue_(allocator, quota_per_queue)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#ae139eee858b95f93bd8cdc80ef7c806b">  265</a></span>&#160;    <a class="code" href="../../d1/d29/class_virtual_can_iface.html#ae139eee858b95f93bd8cdc80ef7c806b">~VirtualCanIface</a>()</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">     * Note that RX queue overwrites oldest items when overflowed.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">     * Call this from the main thread only.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">     * No additional locking is required.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#a61eae57ca60afe032bce33f29be6d2f3">  274</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/d29/class_virtual_can_iface.html#a61eae57ca60afe032bce33f29be6d2f3">addRxFrame</a>(<span class="keyword">const</span> uavcan::CanRxFrame &amp;frame, uavcan::CanIOFlags flags)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="../../db/d3b/class_lock.html">Lock</a> <a class="code" href="../../d2/d70/namespace_micro_bench_h_r_t.html#aca2d9f12c0defb51efac182da6a55f12">lock</a>(common_driver_mutex_);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">if</span> (!rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#a0343865396a8cb15e7bad96f55ed958c">tryEmplace</a>(frame, flags) &amp;&amp; !rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#a1faa6b4d1a26c860a3ac17d73d0a0de4">isEmpty</a>()) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#a02ea784625fe33b5793d00c3b02b4878">pop</a>();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            (void)rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#a0343865396a8cb15e7bad96f55ed958c">tryEmplace</a>(frame, flags);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">     * Call this from the main thread only.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">     * No additional locking is required.</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#ad37df6f309e19237d81ea7cb0080fe9d">  288</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../d1/d29/class_virtual_can_iface.html#ad37df6f309e19237d81ea7cb0080fe9d">flushTxQueueTo</a>(uavcan::INode &amp;main_node, std::uint8_t iface_index)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <a class="code" href="../../db/d3b/class_lock.html">Lock</a> <a class="code" href="../../d2/d70/namespace_micro_bench_h_r_t.html#aca2d9f12c0defb51efac182da6a55f12">lock</a>(common_driver_mutex_);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keyword">const</span> std::uint8_t iface_mask = <span class="keyword">static_cast&lt;</span>std::uint8_t<span class="keyword">&gt;</span>(1U &lt;&lt; iface_index);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">while</span> (<span class="keyword">auto</span> e = prioritized_tx_queue_.peek()) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            UAVCAN_TRACE(<span class="stringliteral">&quot;VirtualCanIface&quot;</span>, <span class="stringliteral">&quot;TX injection [iface=0x%02x]: %s&quot;</span>,</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                     <span class="keywordtype">unsigned</span>(iface_mask), e-&gt;toString().c_str());</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> res = main_node.injectTxFrame(e-&gt;frame, e-&gt;deadline, iface_mask,</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                                uavcan::CanTxQueue::Qos(e-&gt;qos), e-&gt;flags);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            prioritized_tx_queue_.remove(e);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="keywordflow">if</span> (res &lt;= 0) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        }</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">     * Call this from the sub-node thread only.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">     * No additional locking is required.</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="../../d1/d29/class_virtual_can_iface.html#ae6d0e0ea515921c91f59651be663522a">  313</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="../../d1/d29/class_virtual_can_iface.html#ae6d0e0ea515921c91f59651be663522a">hasDataInRxQueue</a>()</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="../../db/d3b/class_lock.html">Lock</a> <a class="code" href="../../d2/d70/namespace_micro_bench_h_r_t.html#aca2d9f12c0defb51efac182da6a55f12">lock</a>(common_driver_mutex_);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">return</span> !rx_queue_.<a class="code" href="../../d4/da4/class_queue.html#a1faa6b4d1a26c860a3ac17d73d0a0de4">isEmpty</a>();</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;};</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"> * This interface defines one method that will be called by the main node thread periodically in order to</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> * transfer contents of TX queue of the sub-node into the TX queue of the main node.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="../../d2/d2d/class_i_tx_queue_injector.html">  324</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../d2/d2d/class_i_tx_queue_injector.html">ITxQueueInjector</a></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;{</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="../../d2/d2d/class_i_tx_queue_injector.html#a80bd263b1e9f8495e9d882ec439862d7">  327</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="../../d2/d2d/class_i_tx_queue_injector.html#a80bd263b1e9f8495e9d882ec439862d7">~ITxQueueInjector</a>() { }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">     * Flush contents of TX queues into the main node.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">     * @param main_node         Reference to the main node.</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> injectTxFramesInto(uavcan::INode &amp;main_node) = 0;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;};</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">/**</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"> * Objects of this class are owned by the sub-node thread.</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment"> * This class does not use heap memory.</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html">  340</a></span>&#160;<span class="keyword">class </span><a class="code" href="../../db/db6/class_virtual_can_driver.html">VirtualCanDriver</a> : <span class="keyword">public</span> uavcan::ICanDriver,</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keyword">public</span> uavcan::IRxFrameListener,</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keyword">public</span> <a class="code" href="../../d2/d2d/class_i_tx_queue_injector.html">ITxQueueInjector</a>,</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    uavcan::Noncopyable</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html">  345</a></span>&#160;    <span class="keyword">class </span><a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html">Event</a></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    {</div><div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a08a503a8d7ab27aa478e4df0e1230e47">  347</a></span>&#160;        FAR <a class="code" href="../../d4/d7f/px4__sem_8h.html#a311e53286e47192d932966d4479f10aa">px4_sem_t</a> <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a08a503a8d7ab27aa478e4df0e1230e47">sem</a>;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#afbb23b56fd6adfb9d1fc61a771e4254e">  352</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#afbb23b56fd6adfb9d1fc61a771e4254e">init</a>()</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordtype">int</span> rv = <a class="code" href="../../d4/d7f/px4__sem_8h.html#ac14071bebf87d069c19c372f6c05d1ec">px4_sem_init</a>(&amp;sem, 0, 0);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">if</span> (rv == 0) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <a class="code" href="../../d4/d7f/px4__sem_8h.html#a4f54341f3d7f7e8b9d106c0c755baa6b">px4_sem_setprotocol</a>(&amp;sem, <a class="code" href="../../d4/d7f/px4__sem_8h.html#a37ef33568349957f6e4adda3e7623fa5">SEM_PRIO_NONE</a>);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="keywordflow">return</span> rv;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a004963b9e5958f112a20a8d59427dd25">  363</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a004963b9e5958f112a20a8d59427dd25">deinit</a>()</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d4/d7f/px4__sem_8h.html#a23b2b574cc1026cef9547072398e2df0">px4_sem_destroy</a>(&amp;sem);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#ab732f7f2d02de4af7b21fbc971efe77f">  369</a></span>&#160;        <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#ab732f7f2d02de4af7b21fbc971efe77f">Event</a>()</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#ab6362984d85a9c678c27dd5bf43d9435">  373</a></span>&#160;        <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#ab6362984d85a9c678c27dd5bf43d9435">~Event</a>()</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">        /**</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">         */</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a0b98bb8a062e9892e4e8bfd839f54891">  381</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a0b98bb8a062e9892e4e8bfd839f54891">waitFor</a>(uavcan::MonotonicDuration duration)</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> NsPerSec = 1000000000;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            <span class="keywordflow">if</span> (duration.isPositive()) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <span class="keyword">auto</span> abstime = ::timespec();</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d6/dfb/stubs__posix_8c.html#a6fa4fcf1ad1f2f62773a03323f08592e">clock_gettime</a>(CLOCK_REALTIME, &amp;abstime) &gt;= 0) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                    abstime.tv_nsec += duration.toUSec() * 1000;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                    <span class="keywordflow">if</span> (abstime.tv_nsec &gt;= NsPerSec) {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                        abstime.tv_sec++;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                        abstime.tv_nsec -= NsPerSec;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                    }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                    (void)<a class="code" href="../../d4/d7f/px4__sem_8h.html#a8cb43c0d1797830bcd1a928c94396cb3">px4_sem_timedwait</a>(&amp;sem, &amp;abstime);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno"><a class="line" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#aa5597776b00791495b678c276ae2ca7e">  401</a></span>&#160;        <span class="keywordtype">void</span> <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#aa5597776b00791495b678c276ae2ca7e">signal</a>()</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="keywordtype">int</span> count;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="keywordtype">int</span> rv = <a class="code" href="../../d4/d7f/px4__sem_8h.html#a48c4b7580efc1cd6e0fb255187cc35f8">px4_sem_getvalue</a>(&amp;sem, &amp;count);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="keywordflow">if</span> (rv &gt; 0 &amp;&amp; count &lt;= 0) {</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                <a class="code" href="../../d4/d7f/px4__sem_8h.html#ad6c85e11e5f9498b2321f5fc77f611da">px4_sem_post</a>(&amp;sem);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    };</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#afc3bf594c193039a1206d8521a0a715d">  412</a></span>&#160;    <a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html">Event</a> <a class="code" href="../../db/db6/class_virtual_can_driver.html#afc3bf594c193039a1206d8521a0a715d">event_</a>;                     <span class="comment">///&lt; Used to unblock the select() call when IO happens.</span></div><div class="line"><a name="l00413"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#a5f4608809d06ad5fd559810960cf9746">  413</a></span>&#160;<span class="comment"></span>    pthread_mutex_t <a class="code" href="../../db/db6/class_virtual_can_driver.html#a5f4608809d06ad5fd559810960cf9746">driver_mutex_</a>;    <span class="comment">///&lt; Shared across all ifaces</span></div><div class="line"><a name="l00414"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#a10ccddcf659b3a7a7ac25b518cfca7b8">  414</a></span>&#160;<span class="comment"></span>    uavcan::LazyConstructor&lt;VirtualCanIface&gt; ifaces_[uavcan::MaxCanIfaces];</div><div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#aea835be0f989f7cc5e733fc5d2d8cb77">  415</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="../../db/db6/class_virtual_can_driver.html#aea835be0f989f7cc5e733fc5d2d8cb77">num_ifaces_</a>;</div><div class="line"><a name="l00416"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#af25803a62dd458b7b084624afc88cdd1">  416</a></span>&#160;    uavcan::ISystemClock &amp;<a class="code" href="../../db/db6/class_virtual_can_driver.html#af25803a62dd458b7b084624afc88cdd1">clock_</a>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#a35ac55c30fdbbce153f243dbc1311ee2">  418</a></span>&#160;    uavcan::ICanIface *<a class="code" href="../../db/db6/class_virtual_can_driver.html#a35ac55c30fdbbce153f243dbc1311ee2">getIface</a>(uint8_t iface_index)<span class="keyword"> override</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">return</span> (iface_index &lt; num_ifaces_) ? ifaces_[iface_index].operator <a class="code" href="../../d1/d29/class_virtual_can_iface.html">VirtualCanIface</a> * () : <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#ae267f2b6ff76408291dfa79fdf874896">  423</a></span>&#160;    uint8_t <a class="code" href="../../db/db6/class_virtual_can_driver.html#ae267f2b6ff76408291dfa79fdf874896">getNumIfaces</a>()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> num_ifaces_; }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">     * This and other methods of ICanDriver will be invoked by the sub-node thread.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00428"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#a2e1b301ecef721d219193435c5a6af59">  428</a></span>&#160;    int16_t <a class="code" href="../../db/db6/class_virtual_can_driver.html#a2e1b301ecef721d219193435c5a6af59">select</a>(uavcan::CanSelectMasks &amp;inout_masks,</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;               <span class="keyword">const</span> uavcan::CanFrame * (&amp;)[uavcan::MaxCanIfaces],</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;               uavcan::MonotonicTime blocking_deadline)<span class="keyword"> override</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordtype">bool</span> need_block = (inout_masks.write == 0);    <span class="comment">// Write queue is infinite</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; need_block &amp;&amp; (i &lt; num_ifaces_); i++) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> need_read = inout_masks.read &amp; (1U &lt;&lt; i);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <span class="keywordflow">if</span> (need_read &amp;&amp; ifaces_[i]-&gt;hasDataInRxQueue()) {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                need_block = <span class="keyword">false</span>;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">if</span> (need_block) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            event_.<a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a0b98bb8a062e9892e4e8bfd839f54891">waitFor</a>(blocking_deadline - clock_.getMonotonic());</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        inout_masks = uavcan::CanSelectMasks();</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; num_ifaces_; i++) {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keyword">const</span> std::uint8_t iface_mask = 1U &lt;&lt; i;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            inout_masks.write |= iface_mask;           <span class="comment">// Always ready to write</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">if</span> (ifaces_[i]-&gt;hasDataInRxQueue()) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                inout_masks.read |= iface_mask;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            }</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">return</span> num_ifaces_;       <span class="comment">// We&#39;re always ready to write, hence &gt; 0.</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">     * This handler will be invoked by the main node thread.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#a96bbbba1b9037456a2498ee98c2180f4">  463</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/db6/class_virtual_can_driver.html#a96bbbba1b9037456a2498ee98c2180f4">handleRxFrame</a>(<span class="keyword">const</span> uavcan::CanRxFrame &amp;frame, uavcan::CanIOFlags flags)<span class="keyword"> override</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        UAVCAN_TRACE(<span class="stringliteral">&quot;VirtualCanDriver&quot;</span>, <span class="stringliteral">&quot;RX [flags=%u]: %s&quot;</span>, <span class="keywordtype">unsigned</span>(flags), frame.toString().c_str());</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">if</span> (frame.iface_index &lt; num_ifaces_) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            ifaces_[frame.iface_index]-&gt;addRxFrame(frame, flags);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            event_.<a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#aa5597776b00791495b678c276ae2ca7e">signal</a>();</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">    /**</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">     * This method will be invoked by the main node thread.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00477"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#aae70d257db9c0dc6f394935d2fdd9b1f">  477</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="../../db/db6/class_virtual_can_driver.html#aae70d257db9c0dc6f394935d2fdd9b1f">injectTxFramesInto</a>(uavcan::INode &amp;main_node)<span class="keyword"> override</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; num_ifaces_; i++) {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            ifaces_[i]-&gt;flushTxQueueTo(main_node, i);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        event_.<a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#aa5597776b00791495b678c276ae2ca7e">signal</a>();</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00487"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#a23b343e9c9984a669fcc508965241f70">  487</a></span>&#160;    <a class="code" href="../../db/db6/class_virtual_can_driver.html#a23b343e9c9984a669fcc508965241f70">VirtualCanDriver</a>(<span class="keywordtype">unsigned</span> arg_num_ifaces,</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;             uavcan::ISystemClock &amp;system_clock,</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;             uavcan::IPoolAllocator &amp;allocator,</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;             <span class="keywordtype">unsigned</span> virtual_iface_block_allocation_quota) :</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        num_ifaces_(arg_num_ifaces),</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        clock_(system_clock)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <a class="code" href="../../db/d3b/class_lock.html#aea74f30dd5eda4470dca64afd055041f">Lock::init</a>(driver_mutex_);</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        event_.<a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#afbb23b56fd6adfb9d1fc61a771e4254e">init</a>();</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        assert(num_ifaces_ &gt; 0 &amp;&amp; num_ifaces_ &lt;= uavcan::MaxCanIfaces);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> quota_per_queue = virtual_iface_block_allocation_quota;             <span class="comment">// 2x overcommit</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; num_ifaces_; i++) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            ifaces_[i].construct&lt;uavcan::IPoolAllocator &amp;, uavcan::ISystemClock &amp;, pthread_mutex_t &amp;,</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <span class="keywordtype">unsigned</span>&gt;(allocator, clock_, driver_mutex_, quota_per_queue);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="../../db/db6/class_virtual_can_driver.html#ad8520f1ec9fe42b1791d843963e756ce">  507</a></span>&#160;    <a class="code" href="../../db/db6/class_virtual_can_driver.html#ad8520f1ec9fe42b1791d843963e756ce">~VirtualCanDriver</a>()</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <a class="code" href="../../db/d3b/class_lock.html#ae29131873c9817d0dc40689b83e7baf6">Lock::deinit</a>(driver_mutex_);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        event_.<a class="code" href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a004963b9e5958f112a20a8d59427dd25">deinit</a>();</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;};</div><div class="ttc" id="class_virtual_can_driver_html_aea835be0f989f7cc5e733fc5d2d8cb77"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#aea835be0f989f7cc5e733fc5d2d8cb77">VirtualCanDriver::num_ifaces_</a></div><div class="ttdeci">const unsigned num_ifaces_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00415">uavcan_virtual_can_driver.hpp:415</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html_ab6362984d85a9c678c27dd5bf43d9435"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html#ab6362984d85a9c678c27dd5bf43d9435">VirtualCanDriver::Event::~Event</a></div><div class="ttdeci">~Event()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00373">uavcan_virtual_can_driver.hpp:373</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_ad8520f1ec9fe42b1791d843963e756ce"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#ad8520f1ec9fe42b1791d843963e756ce">VirtualCanDriver::~VirtualCanDriver</a></div><div class="ttdeci">~VirtualCanDriver()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00507">uavcan_virtual_can_driver.hpp:507</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html">VirtualCanIface</a></div><div class="ttdoc">Objects of this class are owned by the sub-node thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00194">uavcan_virtual_can_driver.hpp:194</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_aae70d257db9c0dc6f394935d2fdd9b1f"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#aae70d257db9c0dc6f394935d2fdd9b1f">VirtualCanDriver::injectTxFramesInto</a></div><div class="ttdeci">void injectTxFramesInto(uavcan::INode &amp;main_node) override</div><div class="ttdoc">This method will be invoked by the main node thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00477">uavcan_virtual_can_driver.hpp:477</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_acefab39e54d254817bee573f89cbf433"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#acefab39e54d254817bee573f89cbf433">VirtualCanIface::send</a></div><div class="ttdeci">int16_t send(const uavcan::CanFrame &amp;frame, uavcan::MonotonicTime tx_deadline, uavcan::CanIOFlags flags) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00225">uavcan_virtual_can_driver.hpp:225</a></div></div>
<div class="ttc" id="class_queue_html_aaa5d5958feddf65b9c66d6276f57d782"><div class="ttname"><a href="../../d4/da4/class_queue.html#aaa5d5958feddf65b9c66d6276f57d782">Queue::peek</a></div><div class="ttdeci">T * peek()</div><div class="ttdoc">Accesses the first element. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00169">uavcan_virtual_can_driver.hpp:169</a></div></div>
<div class="ttc" id="px4__sem_8h_html_a23b2b574cc1026cef9547072398e2df0"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#a23b2b574cc1026cef9547072398e2df0">px4_sem_destroy</a></div><div class="ttdeci">#define px4_sem_destroy</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00086">px4_sem.h:86</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_ad37df6f309e19237d81ea7cb0080fe9d"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#ad37df6f309e19237d81ea7cb0080fe9d">VirtualCanIface::flushTxQueueTo</a></div><div class="ttdeci">void flushTxQueueTo(uavcan::INode &amp;main_node, std::uint8_t iface_index)</div><div class="ttdoc">Call this from the main thread only. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00288">uavcan_virtual_can_driver.hpp:288</a></div></div>
<div class="ttc" id="class_queue_html_a1faa6b4d1a26c860a3ac17d73d0a0de4"><div class="ttname"><a href="../../d4/da4/class_queue.html#a1faa6b4d1a26c860a3ac17d73d0a0de4">Queue::isEmpty</a></div><div class="ttdeci">bool isEmpty() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00124">uavcan_virtual_can_driver.hpp:124</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_a5da1072c2af0081805d861a0ca72dd8e"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#a5da1072c2af0081805d861a0ca72dd8e">VirtualCanIface::getErrorCount</a></div><div class="ttdeci">uint64_t getErrorCount() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00254">uavcan_virtual_can_driver.hpp:254</a></div></div>
<div class="ttc" id="struct_queue_1_1_item_html_a3b44f8897d704825fc0ed20883e03112"><div class="ttname"><a href="../../dc/d37/struct_queue_1_1_item.html#a3b44f8897d704825fc0ed20883e03112">Queue::Item::Item</a></div><div class="ttdeci">Item(Args...args)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00104">uavcan_virtual_can_driver.hpp:104</a></div></div>
<div class="ttc" id="struct_virtual_can_iface_1_1_rx_item_html_a5503180da92d9a8a244c14922f3e5bed"><div class="ttname"><a href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a5503180da92d9a8a244c14922f3e5bed">VirtualCanIface::RxItem::RxItem</a></div><div class="ttdeci">RxItem(const uavcan::CanRxFrame &amp;arg_frame, uavcan::CanIOFlags arg_flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00208">uavcan_virtual_can_driver.hpp:208</a></div></div>
<div class="ttc" id="class_lock_html_a2ca06d379f1e159a90f0727f1f4aefa9"><div class="ttname"><a href="../../db/d3b/class_lock.html#a2ca06d379f1e159a90f0727f1f4aefa9">Lock::thier_mutex_</a></div><div class="ttdeci">pthread_mutex_t &amp; thier_mutex_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00066">uavcan_virtual_can_driver.hpp:66</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_af343b15763018fa099c5b6fa3fd6e55e"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#af343b15763018fa099c5b6fa3fd6e55e">VirtualCanIface::prioritized_tx_queue_</a></div><div class="ttdeci">uavcan::CanTxQueue prioritized_tx_queue_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00222">uavcan_virtual_can_driver.hpp:222</a></div></div>
<div class="ttc" id="px4__sem_8h_html_a4f54341f3d7f7e8b9d106c0c755baa6b"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#a4f54341f3d7f7e8b9d106c0c755baa6b">px4_sem_setprotocol</a></div><div class="ttdeci">#define px4_sem_setprotocol</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00081">px4_sem.h:81</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_a33537b0b56810ebbf8618c78d55366c3"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#a33537b0b56810ebbf8618c78d55366c3">VirtualCanIface::rx_queue_</a></div><div class="ttdeci">Queue&lt; RxItem &gt; rx_queue_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00223">uavcan_virtual_can_driver.hpp:223</a></div></div>
<div class="ttc" id="class_lock_html_ae29131873c9817d0dc40689b83e7baf6"><div class="ttname"><a href="../../db/d3b/class_lock.html#ae29131873c9817d0dc40689b83e7baf6">Lock::deinit</a></div><div class="ttdeci">static int deinit(pthread_mutex_t &amp;thier_mutex_)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00086">uavcan_virtual_can_driver.hpp:86</a></div></div>
<div class="ttc" id="px4__sem_8h_html_a8cb43c0d1797830bcd1a928c94396cb3"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#a8cb43c0d1797830bcd1a928c94396cb3">px4_sem_timedwait</a></div><div class="ttdeci">#define px4_sem_timedwait</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00091">px4_sem.h:91</a></div></div>
<div class="ttc" id="class_i_tx_queue_injector_html_a80bd263b1e9f8495e9d882ec439862d7"><div class="ttname"><a href="../../d2/d2d/class_i_tx_queue_injector.html#a80bd263b1e9f8495e9d882ec439862d7">ITxQueueInjector::~ITxQueueInjector</a></div><div class="ttdeci">virtual ~ITxQueueInjector()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00327">uavcan_virtual_can_driver.hpp:327</a></div></div>
<div class="ttc" id="struct_queue_1_1_item_html"><div class="ttname"><a href="../../dc/d37/struct_queue_1_1_item.html">Queue::Item</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00100">uavcan_virtual_can_driver.hpp:100</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_a35ac55c30fdbbce153f243dbc1311ee2"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#a35ac55c30fdbbce153f243dbc1311ee2">VirtualCanDriver::getIface</a></div><div class="ttdeci">uavcan::ICanIface * getIface(uint8_t iface_index) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00418">uavcan_virtual_can_driver.hpp:418</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_aa676f4f87d00698dd60f49f08eec96cf"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#aa676f4f87d00698dd60f49f08eec96cf">VirtualCanIface::getNumFilters</a></div><div class="ttdeci">uint16_t getNumFilters() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00253">uavcan_virtual_can_driver.hpp:253</a></div></div>
<div class="ttc" id="struct_virtual_can_iface_1_1_rx_item_html_a5f5e23ff8f11285ff6c17f5f6a5ca972"><div class="ttname"><a href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a5f5e23ff8f11285ff6c17f5f6a5ca972">VirtualCanIface::RxItem::ts_mono</a></div><div class="ttdeci">const uavcan::MonotonicTime ts_mono</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00203">uavcan_virtual_can_driver.hpp:203</a></div></div>
<div class="ttc" id="px4__sem_8h_html_a48c4b7580efc1cd6e0fb255187cc35f8"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#a48c4b7580efc1cd6e0fb255187cc35f8">px4_sem_getvalue</a></div><div class="ttdeci">#define px4_sem_getvalue</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00085">px4_sem.h:85</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html_a0b98bb8a062e9892e4e8bfd839f54891"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a0b98bb8a062e9892e4e8bfd839f54891">VirtualCanDriver::Event::waitFor</a></div><div class="ttdeci">void waitFor(uavcan::MonotonicDuration duration)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00381">uavcan_virtual_can_driver.hpp:381</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_af25803a62dd458b7b084624afc88cdd1"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#af25803a62dd458b7b084624afc88cdd1">VirtualCanDriver::clock_</a></div><div class="ttdeci">uavcan::ISystemClock &amp; clock_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00416">uavcan_virtual_can_driver.hpp:416</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_aa0019570de64206ff167e7954a852b62"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#aa0019570de64206ff167e7954a852b62">VirtualCanIface::receive</a></div><div class="ttdeci">int16_t receive(uavcan::CanFrame &amp;out_frame, uavcan::MonotonicTime &amp;out_ts_monotonic, uavcan::UtcTime &amp;out_ts_utc, uavcan::CanIOFlags &amp;out_flags) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00232">uavcan_virtual_can_driver.hpp:232</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_a49eb72b640bd7c7d440e85dc671e3406"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#a49eb72b640bd7c7d440e85dc671e3406">VirtualCanIface::VirtualCanIface</a></div><div class="ttdeci">VirtualCanIface(uavcan::IPoolAllocator &amp;allocator, uavcan::ISystemClock &amp;clock, pthread_mutex_t &amp;arg_mutex, unsigned quota_per_queue)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00257">uavcan_virtual_can_driver.hpp:257</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html_afbb23b56fd6adfb9d1fc61a771e4254e"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html#afbb23b56fd6adfb9d1fc61a771e4254e">VirtualCanDriver::Event::init</a></div><div class="ttdeci">int init()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00352">uavcan_virtual_can_driver.hpp:352</a></div></div>
<div class="ttc" id="px4__sem_8h_html_ad6c85e11e5f9498b2321f5fc77f611da"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#ad6c85e11e5f9498b2321f5fc77f611da">px4_sem_post</a></div><div class="ttdeci">#define px4_sem_post</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00084">px4_sem.h:84</a></div></div>
<div class="ttc" id="struct_virtual_can_iface_1_1_rx_item_html_a56e859906bc41d5dae8a9e4aa53614d8"><div class="ttname"><a href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a56e859906bc41d5dae8a9e4aa53614d8">VirtualCanIface::RxItem::flags</a></div><div class="ttdeci">const uavcan::CanIOFlags flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00205">uavcan_virtual_can_driver.hpp:205</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_afc3bf594c193039a1206d8521a0a715d"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#afc3bf594c193039a1206d8521a0a715d">VirtualCanDriver::event_</a></div><div class="ttdeci">Event event_</div><div class="ttdoc">Used to unblock the select() call when IO happens. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00412">uavcan_virtual_can_driver.hpp:412</a></div></div>
<div class="ttc" id="class_queue_html_aa7eef1b427e24555780505de20e9acbc"><div class="ttname"><a href="../../d4/da4/class_queue.html#aa7eef1b427e24555780505de20e9acbc">Queue::~Queue</a></div><div class="ttdeci">~Queue()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00117">uavcan_virtual_can_driver.hpp:117</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_a52d2546fc167fd59aa44f4073541f82e"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#a52d2546fc167fd59aa44f4073541f82e">VirtualCanIface::configureFilters</a></div><div class="ttdeci">int16_t configureFilters(const uavcan::CanFilterConfig *, std::uint16_t) override</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00252">uavcan_virtual_can_driver.hpp:252</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a7454d249ed94ad5d5e57ba1529d7a7f2"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a7454d249ed94ad5d5e57ba1529d7a7f2">pthread_mutex_init</a></div><div class="ttdeci">int pthread_mutex_init(pthread_mutex_t *mutex, const pthread_mutexattr_t *attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00119">stubs_posix.c:119</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_aa35ac7d011f4df8f62a60892720bc1f0"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#aa35ac7d011f4df8f62a60892720bc1f0">VirtualCanIface::common_driver_mutex_</a></div><div class="ttdeci">pthread_mutex_t &amp; common_driver_mutex_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00220">uavcan_virtual_can_driver.hpp:220</a></div></div>
<div class="ttc" id="class_lock_html_aea74f30dd5eda4470dca64afd055041f"><div class="ttname"><a href="../../db/d3b/class_lock.html#aea74f30dd5eda4470dca64afd055041f">Lock::init</a></div><div class="ttdeci">static int init(pthread_mutex_t &amp;thier_mutex_)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00081">uavcan_virtual_can_driver.hpp:81</a></div></div>
<div class="ttc" id="class_queue_html_a0343865396a8cb15e7bad96f55ed958c"><div class="ttname"><a href="../../d4/da4/class_queue.html#a0343865396a8cb15e7bad96f55ed958c">Queue::tryEmplace</a></div><div class="ttdeci">bool tryEmplace(Args...args)</div><div class="ttdoc">Creates one item in-place at the end of the list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00132">uavcan_virtual_can_driver.hpp:132</a></div></div>
<div class="ttc" id="namespace_micro_bench_h_r_t_html_aca2d9f12c0defb51efac182da6a55f12"><div class="ttname"><a href="../../d2/d70/namespace_micro_bench_h_r_t.html#aca2d9f12c0defb51efac182da6a55f12">MicroBenchHRT::lock</a></div><div class="ttdeci">void lock()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d91/test__microbench__hrt_8cpp_source.html#l00052">test_microbench_hrt.cpp:52</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html_ab732f7f2d02de4af7b21fbc971efe77f"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html#ab732f7f2d02de4af7b21fbc971efe77f">VirtualCanDriver::Event::Event</a></div><div class="ttdeci">Event()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00369">uavcan_virtual_can_driver.hpp:369</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html_a004963b9e5958f112a20a8d59427dd25"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a004963b9e5958f112a20a8d59427dd25">VirtualCanDriver::Event::deinit</a></div><div class="ttdeci">int deinit()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00363">uavcan_virtual_can_driver.hpp:363</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_a61eae57ca60afe032bce33f29be6d2f3"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#a61eae57ca60afe032bce33f29be6d2f3">VirtualCanIface::addRxFrame</a></div><div class="ttdeci">void addRxFrame(const uavcan::CanRxFrame &amp;frame, uavcan::CanIOFlags flags)</div><div class="ttdoc">Note that RX queue overwrites oldest items when overflowed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00274">uavcan_virtual_can_driver.hpp:274</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_ae6d0e0ea515921c91f59651be663522a"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#ae6d0e0ea515921c91f59651be663522a">VirtualCanIface::hasDataInRxQueue</a></div><div class="ttdeci">bool hasDataInRxQueue()</div><div class="ttdoc">Call this from the sub-node thread only. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00313">uavcan_virtual_can_driver.hpp:313</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a12809c44718c21544ceb280dc1a53573"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a12809c44718c21544ceb280dc1a53573">pthread_mutex_lock</a></div><div class="ttdeci">int pthread_mutex_lock(pthread_mutex_t *mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00101">stubs_posix.c:101</a></div></div>
<div class="ttc" id="px4__sem_8h_html_a37ef33568349957f6e4adda3e7623fa5"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#a37ef33568349957f6e4adda3e7623fa5">SEM_PRIO_NONE</a></div><div class="ttdeci">#define SEM_PRIO_NONE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00047">px4_sem.h:47</a></div></div>
<div class="ttc" id="class_virtual_can_iface_html_ae139eee858b95f93bd8cdc80ef7c806b"><div class="ttname"><a href="../../d1/d29/class_virtual_can_iface.html#ae139eee858b95f93bd8cdc80ef7c806b">VirtualCanIface::~VirtualCanIface</a></div><div class="ttdeci">~VirtualCanIface()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00265">uavcan_virtual_can_driver.hpp:265</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html_aa5597776b00791495b678c276ae2ca7e"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html#aa5597776b00791495b678c276ae2ca7e">VirtualCanDriver::Event::signal</a></div><div class="ttdeci">void signal()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00401">uavcan_virtual_can_driver.hpp:401</a></div></div>
<div class="ttc" id="class_queue_html_a8e5c64485832b1272155d9bcb0c1e03c"><div class="ttname"><a href="../../d4/da4/class_queue.html#a8e5c64485832b1272155d9bcb0c1e03c">Queue::allocator_</a></div><div class="ttdeci">uavcan::LimitedPoolAllocator allocator_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00107">uavcan_virtual_can_driver.hpp:107</a></div></div>
<div class="ttc" id="class_queue_html_a02ea784625fe33b5793d00c3b02b4878"><div class="ttname"><a href="../../d4/da4/class_queue.html#a02ea784625fe33b5793d00c3b02b4878">Queue::pop</a></div><div class="ttdeci">void pop()</div><div class="ttdoc">Removes the first element. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00177">uavcan_virtual_can_driver.hpp:177</a></div></div>
<div class="ttc" id="class_queue_html_ab574458abe9ba0f79292c310f22a7e06"><div class="ttname"><a href="../../d4/da4/class_queue.html#ab574458abe9ba0f79292c310f22a7e06">Queue::peek</a></div><div class="ttdeci">const T * peek() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00170">uavcan_virtual_can_driver.hpp:170</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a6fa4fcf1ad1f2f62773a03323f08592e"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a6fa4fcf1ad1f2f62773a03323f08592e">clock_gettime</a></div><div class="ttdeci">int clock_gettime(clockid_t clk_id, struct timespec *tp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00096">stubs_posix.c:96</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_a5f4608809d06ad5fd559810960cf9746"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#a5f4608809d06ad5fd559810960cf9746">VirtualCanDriver::driver_mutex_</a></div><div class="ttdeci">pthread_mutex_t driver_mutex_</div><div class="ttdoc">Shared across all ifaces. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00413">uavcan_virtual_can_driver.hpp:413</a></div></div>
<div class="ttc" id="class_lock_html_a25c1411f1b3c0874bc3f9d703b4b793c"><div class="ttname"><a href="../../db/d3b/class_lock.html#a25c1411f1b3c0874bc3f9d703b4b793c">Lock::Lock</a></div><div class="ttdeci">Lock(pthread_mutex_t &amp;m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00070">uavcan_virtual_can_driver.hpp:70</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_a2e1b301ecef721d219193435c5a6af59"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#a2e1b301ecef721d219193435c5a6af59">VirtualCanDriver::select</a></div><div class="ttdeci">int16_t select(uavcan::CanSelectMasks &amp;inout_masks, const uavcan::CanFrame *(&amp;)[uavcan::MaxCanIfaces], uavcan::MonotonicTime blocking_deadline) override</div><div class="ttdoc">This and other methods of ICanDriver will be invoked by the sub-node thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00428">uavcan_virtual_can_driver.hpp:428</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html">VirtualCanDriver::Event</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00345">uavcan_virtual_can_driver.hpp:345</a></div></div>
<div class="ttc" id="class_virtual_can_driver_1_1_event_html_a08a503a8d7ab27aa478e4df0e1230e47"><div class="ttname"><a href="../../db/d3f/class_virtual_can_driver_1_1_event.html#a08a503a8d7ab27aa478e4df0e1230e47">VirtualCanDriver::Event::sem</a></div><div class="ttdeci">FAR px4_sem_t sem</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00347">uavcan_virtual_can_driver.hpp:347</a></div></div>
<div class="ttc" id="class_queue_html_a502d7eec8f7935f1bba1b459e7b08999"><div class="ttname"><a href="../../d4/da4/class_queue.html#a502d7eec8f7935f1bba1b459e7b08999">Queue::Queue</a></div><div class="ttdeci">Queue(uavcan::IPoolAllocator &amp;arg_allocator, std::size_t block_allocation_quota)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00111">uavcan_virtual_can_driver.hpp:111</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a3cf620ff3a40af11d79cf28901dc55e2"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a3cf620ff3a40af11d79cf28901dc55e2">pthread_mutex_destroy</a></div><div class="ttdeci">int pthread_mutex_destroy(pthread_mutex_t *mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00115">stubs_posix.c:115</a></div></div>
<div class="ttc" id="stubs__posix_8c_html_a96184290ffb60e04c53a52869cf960a2"><div class="ttname"><a href="../../d6/dfb/stubs__posix_8c.html#a96184290ffb60e04c53a52869cf960a2">pthread_mutex_unlock</a></div><div class="ttdeci">int pthread_mutex_unlock(pthread_mutex_t *mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dfb/stubs__posix_8c_source.html#l00106">stubs_posix.c:106</a></div></div>
<div class="ttc" id="class_queue_html_a42bd48a2f8a6ecae4f9cd231289c5ccd"><div class="ttname"><a href="../../d4/da4/class_queue.html#a42bd48a2f8a6ecae4f9cd231289c5ccd">Queue::list_</a></div><div class="ttdeci">uavcan::LinkedListRoot&lt; Item &gt; list_</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00108">uavcan_virtual_can_driver.hpp:108</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_ae267f2b6ff76408291dfa79fdf874896"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#ae267f2b6ff76408291dfa79fdf874896">VirtualCanDriver::getNumIfaces</a></div><div class="ttdeci">uint8_t getNumIfaces() const override</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00423">uavcan_virtual_can_driver.hpp:423</a></div></div>
<div class="ttc" id="struct_virtual_can_iface_1_1_rx_item_html_a9e8513a156e7d767f4e74b9de9bb97f5"><div class="ttname"><a href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a9e8513a156e7d767f4e74b9de9bb97f5">VirtualCanIface::RxItem::ts_utc</a></div><div class="ttdeci">const uavcan::UtcTime ts_utc</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00204">uavcan_virtual_can_driver.hpp:204</a></div></div>
<div class="ttc" id="px4__sem_8h_html_ac14071bebf87d069c19c372f6c05d1ec"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#ac14071bebf87d069c19c372f6c05d1ec">px4_sem_init</a></div><div class="ttdeci">#define px4_sem_init</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00080">px4_sem.h:80</a></div></div>
<div class="ttc" id="struct_queue_1_1_item_html_a9ff8538d4b4f7638dbf6b413cb0e1a62"><div class="ttname"><a href="../../dc/d37/struct_queue_1_1_item.html#a9ff8538d4b4f7638dbf6b413cb0e1a62">Queue::Item::payload</a></div><div class="ttdeci">T payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00101">uavcan_virtual_can_driver.hpp:101</a></div></div>
<div class="ttc" id="class_queue_html"><div class="ttname"><a href="../../d4/da4/class_queue.html">Queue</a></div><div class="ttdoc">Generic queue based on the linked list class defined in libuavcan. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00098">uavcan_virtual_can_driver.hpp:98</a></div></div>
<div class="ttc" id="struct_virtual_can_iface_1_1_rx_item_html_a05a4cd733f2dd7c9db4d6815b932f935"><div class="ttname"><a href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html#a05a4cd733f2dd7c9db4d6815b932f935">VirtualCanIface::RxItem::iface_index</a></div><div class="ttdeci">const uint8_t iface_index</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00206">uavcan_virtual_can_driver.hpp:206</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_a96bbbba1b9037456a2498ee98c2180f4"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#a96bbbba1b9037456a2498ee98c2180f4">VirtualCanDriver::handleRxFrame</a></div><div class="ttdeci">void handleRxFrame(const uavcan::CanRxFrame &amp;frame, uavcan::CanIOFlags flags) override</div><div class="ttdoc">This handler will be invoked by the main node thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00463">uavcan_virtual_can_driver.hpp:463</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html_a23b343e9c9984a669fcc508965241f70"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html#a23b343e9c9984a669fcc508965241f70">VirtualCanDriver::VirtualCanDriver</a></div><div class="ttdeci">VirtualCanDriver(unsigned arg_num_ifaces, uavcan::ISystemClock &amp;system_clock, uavcan::IPoolAllocator &amp;allocator, unsigned virtual_iface_block_allocation_quota)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00487">uavcan_virtual_can_driver.hpp:487</a></div></div>
<div class="ttc" id="struct_virtual_can_iface_1_1_rx_item_html"><div class="ttname"><a href="../../d0/d8b/struct_virtual_can_iface_1_1_rx_item.html">VirtualCanIface::RxItem</a></div><div class="ttdoc">This class re-defines uavcan::RxCanFrame with flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00202">uavcan_virtual_can_driver.hpp:202</a></div></div>
<div class="ttc" id="class_virtual_can_driver_html"><div class="ttname"><a href="../../db/db6/class_virtual_can_driver.html">VirtualCanDriver</a></div><div class="ttdoc">Objects of this class are owned by the sub-node thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00340">uavcan_virtual_can_driver.hpp:340</a></div></div>
<div class="ttc" id="class_lock_html"><div class="ttname"><a href="../../db/d3b/class_lock.html">Lock</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00064">uavcan_virtual_can_driver.hpp:64</a></div></div>
<div class="ttc" id="class_lock_html_a7ab6d9485c8665bb3643710432882971"><div class="ttname"><a href="../../db/d3b/class_lock.html#a7ab6d9485c8665bb3643710432882971">Lock::~Lock</a></div><div class="ttdeci">~Lock()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00076">uavcan_virtual_can_driver.hpp:76</a></div></div>
<div class="ttc" id="px4__sem_8h_html_a311e53286e47192d932966d4479f10aa"><div class="ttname"><a href="../../d4/d7f/px4__sem_8h.html#a311e53286e47192d932966d4479f10aa">px4_sem_t</a></div><div class="ttdeci">__BEGIN_DECLS typedef sem_t px4_sem_t</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d7f/px4__sem_8h_source.html#l00078">px4_sem.h:78</a></div></div>
<div class="ttc" id="class_i_tx_queue_injector_html"><div class="ttname"><a href="../../d2/d2d/class_i_tx_queue_injector.html">ITxQueueInjector</a></div><div class="ttdoc">This interface defines one method that will be called by the main node thread periodically in order t...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9d/uavcan__virtual__can__driver_8hpp_source.html#l00324">uavcan_virtual_can_driver.hpp:324</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_ddb4d7e95cc2d6c8e1ade10a20d7247d.html">modules</a></li><li class="navelem"><a class="el" href="../../dir_d0e71455a8aae9431f8ed3891bd6b7d2.html">uavcan</a></li><li class="navelem"><a class="el" href="../../d0/d9d/uavcan__virtual__can__driver_8hpp.html">uavcan_virtual_can_driver.hpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
